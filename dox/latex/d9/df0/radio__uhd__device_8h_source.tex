\doxysection{radio\+\_\+uhd\+\_\+device.\+h}
\hypertarget{radio__uhd__device_8h_source}{}\label{radio__uhd__device_8h_source}\index{lib/radio/uhd/radio\_uhd\_device.h@{lib/radio/uhd/radio\_uhd\_device.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Copyright\ 2021-\/2024\ Software\ Radio\ Systems\ Limited}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ This\ file\ is\ part\ of\ srsRAN.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ srsRAN\ is\ free\ software:\ you\ can\ redistribute\ it\ and/or\ modify}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ it\ under\ the\ terms\ of\ the\ GNU\ Affero\ General\ Public\ License\ as}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *\ published\ by\ the\ Free\ Software\ Foundation,\ either\ version\ 3\ of}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *\ the\ License,\ or\ (at\ your\ option)\ any\ later\ version.}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *\ srsRAN\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ but\ WITHOUT\ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ MERCHANTABILITY\ or\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ GNU\ Affero\ General\ Public\ License\ for\ more\ details.}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ A\ copy\ of\ the\ GNU\ Affero\ General\ Public\ License\ can\ be\ found\ in}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ the\ LICENSE\ file\ in\ the\ top-\/level\ directory\ of\ this\ distribution}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ and\ at\ http://www.gnu.org/licenses/.}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{pragma}\ \textcolor{preprocessor}{once}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{radio__uhd__device__type_8h}{"{}radio\_uhd\_device\_type.h"{}}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{radio__uhd__exception__handler_8h}{"{}radio\_uhd\_exception\_handler.h"{}}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{radio__uhd__rx__stream_8h}{"{}radio\_uhd\_rx\_stream.h"{}}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{radio__uhd__tx__stream_8h}{"{}radio\_uhd\_tx\_stream.h"{}}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/radio/radio\_session.h"{}}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{comment}{///\ \(\backslash\)brief\ Determines\ whether\ a\ frequency\ is\ valid\ within\ a\ range.}}
\DoxyCodeLine{00032\ \textcolor{comment}{///}}
\DoxyCodeLine{00033\ \textcolor{comment}{///\ A\ frequency\ is\ considered\ valid\ within\ a\ range\ if\ the\ range\ clips\ the\ frequency\ value\ within\ 1\ Hz\ error.}}
\DoxyCodeLine{00034\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ radio\_uhd\_device\_validate\_freq\_range(\textcolor{keyword}{const}\ uhd::freq\_range\_t\&\ range,\ \textcolor{keywordtype}{double}\ freq)}
\DoxyCodeLine{00035\ \{}
\DoxyCodeLine{00036\ \ \ \textcolor{keywordtype}{double}\ clipped\_freq\ =\ range.clip(freq);}
\DoxyCodeLine{00037\ \ \ \textcolor{keywordflow}{return}\ std::abs(clipped\_freq\ -\/\ freq)\ <\ 1.0;}
\DoxyCodeLine{00038\ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{comment}{///\ \(\backslash\)brief\ Determines\ whether\ a\ gain\ is\ valid\ within\ a\ range.}}
\DoxyCodeLine{00041\ \textcolor{comment}{///}}
\DoxyCodeLine{00042\ \textcolor{comment}{///\ A\ gain\ is\ considered\ valid\ within\ a\ range\ if\ the\ range\ clips\ the\ frequency\ value\ within\ 0.01\ error.}}
\DoxyCodeLine{00043\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ radio\_uhd\_device\_validate\_gain\_range(\textcolor{keyword}{const}\ uhd::gain\_range\_t\&\ range,\ \textcolor{keywordtype}{double}\ gain)}
\DoxyCodeLine{00044\ \{}
\DoxyCodeLine{00045\ \ \ int64\_t\ clipped\_gain\ =\ \textcolor{keyword}{static\_cast}<uint64\_t>(std::round(range.clip(gain,\ \textcolor{keyword}{true})\ *\ 100));}
\DoxyCodeLine{00046\ \ \ int64\_t\ uint\_gain\ \ \ \ =\ \textcolor{keyword}{static\_cast}<uint64\_t>(gain\ *\ 100);}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \textcolor{keywordflow}{return}\ (clipped\_gain\ ==\ uint\_gain);}
\DoxyCodeLine{00049\ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ to\_MHz(\textcolor{keywordtype}{double}\ value\_Hz)}
\DoxyCodeLine{00052\ \{}
\DoxyCodeLine{00053\ \ \ \textcolor{keywordflow}{return}\ value\_Hz\ *\ 1e-\/6;}
\DoxyCodeLine{00054\ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{keyword}{namespace}\ \mbox{\hyperlink{namespacesrsran}{srsran}}\ \{}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device}{radio\_uhd\_device}}\ :\ \textcolor{keyword}{public}\ uhd\_exception\_handler}
\DoxyCodeLine{00059\ \{}
\DoxyCodeLine{00060\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00061\ \ \ radio\_uhd\_device()\ :\ logger(srslog::fetch\_basic\_logger(\textcolor{stringliteral}{"{}RF"{}}))\ \{\}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \textcolor{keywordtype}{bool}\ is\_valid()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ usrp\ !=\ \textcolor{keywordtype}{nullptr};\ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \textcolor{keywordtype}{bool}\ usrp\_make(\textcolor{keyword}{const}\ std::string\&\ device\_address)}
\DoxyCodeLine{00066\ \ \ \{}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{comment}{//\ Parse\ args\ into\ dictionary.}}
\DoxyCodeLine{00068\ \ \ \ \ uhd::device\_addr\_t\ device\_addr;}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordflow}{if}\ (!safe\_execution([device\_address,\ \&device\_addr]()\ \{\ device\_addr\ =\ uhd::device\_addr\_t(device\_address);\ \}))\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00071\ \ \ \ \ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ Destroy\ any\ previous\ USRP\ instance}}
\DoxyCodeLine{00074\ \ \ \ \ usrp\ =\ \textcolor{keywordtype}{nullptr};}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//\ If\ device\ type\ or\ name\ not\ given\ in\ args,\ select\ device\ from\ found\ list.}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{not}\ device\_addr.has\_key(\textcolor{stringliteral}{"{}type"{}}))\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ available\ devices\ that\ match\ the\ given\ device\ address.}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ uhd::device\_addrs\_t\ devices\ =\ uhd::device::find(device\_addr);}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \ \ \textcolor{comment}{//\ Stop\ if\ no\ device\ is\ found.}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (devices.empty())\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error:\ no\ radio\ devices\ found.\(\backslash\)n"{}});}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ the\ first\ available\ device.}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ uhd::device\_addr\_t\ first\_device\_addr\ =\ devices.front();}
\DoxyCodeLine{00089\ \ \ \ \ \ \ fmt::print(\textcolor{stringliteral}{"{}No\ device\ type\ given,\ found\ device\ with\ address\ '\{\}'\(\backslash\)n"{}},\ first\_device\_addr.to\_string());}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \ \ \textcolor{comment}{//\ Append\ to\ the\ device\ address\ the\ device\ type.}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (first\_device\_addr.has\_key(\textcolor{stringliteral}{"{}type"{}}))\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ device\_addr.set(\textcolor{stringliteral}{"{}type"{}},\ first\_device\_addr.get(\textcolor{stringliteral}{"{}type"{}}));}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{comment}{//\ If\ device\ type\ is\ known,\ parse\ and\ select\ default\ address\ parameters.}}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{if}\ (device\_addr.has\_key(\textcolor{stringliteral}{"{}type"{}}))\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ device\ type.}}
\DoxyCodeLine{00100\ \ \ \ \ \ \ type\ =\ radio\_uhd\_device\_type(device\_addr.get(\textcolor{stringliteral}{"{}type"{}}));}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (type)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa0bb80e62d306c6898431b1f3c30ae237}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa0bb80e62d306c6898431b1f3c30ae237}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa0bb80e62d306c6898431b1f3c30ae237}{E3xx}}:}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ default\ master\ clock\ rate.}}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!device\_addr.has\_key(\textcolor{stringliteral}{"{}master\_clock\_rate"{}}))\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ device\_addr.set(\textcolor{stringliteral}{"{}master\_clock\_rate"{}},\ \textcolor{stringliteral}{"{}30.72e6"{}});}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa15b4dfca0520057f9507795b5bc9d841}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa15b4dfca0520057f9507795b5bc9d841}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa15b4dfca0520057f9507795b5bc9d841}{X3x0}}:}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ default\ master\ clock\ rate.}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!device\_addr.has\_key(\textcolor{stringliteral}{"{}master\_clock\_rate"{}}))\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ device\_addr.set(\textcolor{stringliteral}{"{}master\_clock\_rate"{}},\ \textcolor{stringliteral}{"{}184.32e6"{}});}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa224cf04bef152970bd6f45c0dde8ddf0}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa224cf04bef152970bd6f45c0dde8ddf0}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa224cf04bef152970bd6f45c0dde8ddf0}{X410}}:}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ default\ master\ clock\ rate.}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!device\_addr.has\_key(\textcolor{stringliteral}{"{}master\_clock\_rate"{}}))\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ device\_addr.set(\textcolor{stringliteral}{"{}master\_clock\_rate"{}},\ \textcolor{stringliteral}{"{}245.76e6"{}});}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa2969479bfa09b68bd89cdb82d6740ac2}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa2969479bfa09b68bd89cdb82d6740ac2}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa2969479bfa09b68bd89cdb82d6740ac2}{N3x0}}:}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ default\ master\ clock\ rate.}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!device\_addr.has\_key(\textcolor{stringliteral}{"{}master\_clock\_rate"{}}))\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ device\_addr.set(\textcolor{stringliteral}{"{}master\_clock\_rate"{}},\ \textcolor{stringliteral}{"{}122.88e6"{}});}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa5110c43a6fa53a7fedfd0adb1405fec5}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa5110c43a6fa53a7fedfd0adb1405fec5}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa5110c43a6fa53a7fedfd0adb1405fec5}{N32x}}:}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ default\ master\ clock\ rate.}}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!device\_addr.has\_key(\textcolor{stringliteral}{"{}master\_clock\_rate"{}}))\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ device\_addr.set(\textcolor{stringliteral}{"{}master\_clock\_rate"{}},\ \textcolor{stringliteral}{"{}245.76e6"{}});}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa49007b2908a3d74ee65c762d016ba5ec}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa49007b2908a3d74ee65c762d016ba5ec}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa49007b2908a3d74ee65c762d016ba5ec}{B2xx}}:}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa696b031073e74bf2cb98e5ef201d4aa3}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa696b031073e74bf2cb98e5ef201d4aa3}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa696b031073e74bf2cb98e5ef201d4aa3}{UNKNOWN}}:}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ default\ parameters\ are\ required.}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ frame\ sizes\ for\ network\ based\ USRP\ devices.}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((type\ ==\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa5110c43a6fa53a7fedfd0adb1405fec5}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa5110c43a6fa53a7fedfd0adb1405fec5}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa5110c43a6fa53a7fedfd0adb1405fec5}{N32x}})\ ||\ (type\ ==\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa2969479bfa09b68bd89cdb82d6740ac2}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa2969479bfa09b68bd89cdb82d6740ac2}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa2969479bfa09b68bd89cdb82d6740ac2}{N3x0}})\ ||}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ (type\ ==\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa15b4dfca0520057f9507795b5bc9d841}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa15b4dfca0520057f9507795b5bc9d841}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa15b4dfca0520057f9507795b5bc9d841}{X3x0}})\ ||\ (type\ ==\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa224cf04bef152970bd6f45c0dde8ddf0}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa224cf04bef152970bd6f45c0dde8ddf0}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa224cf04bef152970bd6f45c0dde8ddf0}{X410}}))\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ default\ send\ frame\ size.}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!device\_addr.has\_key(\textcolor{stringliteral}{"{}send\_frame\_size"{}}))\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ device\_addr.set(\textcolor{stringliteral}{"{}send\_frame\_size"{}},\ \textcolor{stringliteral}{"{}8000"{}});}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ default\ receive\ frame\ size.}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!device\_addr.has\_key(\textcolor{stringliteral}{"{}recv\_frame\_size"{}}))\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ device\_addr.set(\textcolor{stringliteral}{"{}recv\_frame\_size"{}},\ \textcolor{stringliteral}{"{}8000"{}});}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00152\ \ \ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ fmt::print(\textcolor{stringliteral}{"{}Making\ USRP\ object\ with\ args\ '\{\}'\(\backslash\)n"{}},\ device\_addr.to\_string());}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ \&device\_addr]()\ \{\ usrp\ =\ uhd::usrp::multi\_usrp::make(device\_addr);\ \});}
\DoxyCodeLine{00157\ \ \ \}}
\DoxyCodeLine{00158\ \ \ \textcolor{keywordtype}{bool}\ is\_connection\_valid()}
\DoxyCodeLine{00159\ \ \ \{}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{comment}{//\ If\ the\ device\ is\ a\ B2xx,\ check\ if\ the\ USB\ is\ version\ 3.}}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa49007b2908a3d74ee65c762d016ba5ec}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa49007b2908a3d74ee65c762d016ba5ec}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa49007b2908a3d74ee65c762d016ba5ec}{B2xx}})\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ USB\ version.}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ usb\_version\ =\ 0;}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ success\ \ \ \ \ =\ safe\_execution([\textcolor{keyword}{this},\ \&usb\_version]()\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ usb\_version\ =\ usrp-\/>get\_device()-\/>get\_tree()-\/>access<\textcolor{keywordtype}{unsigned}>(\textcolor{stringliteral}{"{}/mboards/0/usb\_version"{}}).get();}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ USB\ version\ is\ invalid\ if\ the\ USB\ version\ is\ accessed\ successfully\ and\ the\ version\ is\ not\ 3.}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (success\ \&\&\ (usb\_version\ !=\ 3))\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ fmt::print(\textcolor{stringliteral}{"{}USRP\ operating\ over\ USB\ version\ \{\},\ USB\ 3\ is\ required.\(\backslash\)n"{}},\ usb\_version);}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00173\ \ \ \ \ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00176\ \ \ \}}
\DoxyCodeLine{00177\ \ \ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\ get\_type()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ type;\ \}}
\DoxyCodeLine{00178\ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_mboard\_sensor\_names(std::vector<std::string>\&\ sensors)}
\DoxyCodeLine{00179\ \ \ \{}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ \&sensors]()\ \{\ sensors\ =\ usrp-\/>get\_mboard\_sensor\_names();\ \});}
\DoxyCodeLine{00181\ \ \ \}}
\DoxyCodeLine{00182\ \ \ \textcolor{keywordtype}{bool}\ get\_rx\_sensor\_names(std::vector<std::string>\&\ sensors)}
\DoxyCodeLine{00183\ \ \ \{}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ \&sensors]()\ \{\ sensors\ =\ usrp-\/>get\_rx\_sensor\_names();\ \});}
\DoxyCodeLine{00185\ \ \ \}}
\DoxyCodeLine{00186\ \ \ \textcolor{keywordtype}{bool}\ get\_sensor(\textcolor{keyword}{const}\ std::string\&\ sensor\_name,\ \textcolor{keywordtype}{double}\&\ sensor\_value)}
\DoxyCodeLine{00187\ \ \ \{}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution(}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this},\ \&sensor\_name,\ \&sensor\_value]()\ \{\ sensor\_value\ =\ usrp-\/>get\_mboard\_sensor(sensor\_name).to\_real();\ \});}
\DoxyCodeLine{00190\ \ \ \}}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordtype}{bool}\ get\_sensor(\textcolor{keyword}{const}\ std::string\&\ sensor\_name,\ \textcolor{keywordtype}{bool}\&\ sensor\_value)}
\DoxyCodeLine{00192\ \ \ \{}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution(}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this},\ \&sensor\_name,\ \&sensor\_value]()\ \{\ sensor\_value\ =\ usrp-\/>get\_mboard\_sensor(sensor\_name).to\_bool();\ \});}
\DoxyCodeLine{00195\ \ \ \}}
\DoxyCodeLine{00196\ \ \ \textcolor{keywordtype}{bool}\ get\_rx\_sensor(\textcolor{keyword}{const}\ std::string\&\ sensor\_name,\ \textcolor{keywordtype}{bool}\&\ sensor\_value)}
\DoxyCodeLine{00197\ \ \ \{}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution(}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this},\ \&sensor\_name,\ \&sensor\_value]()\ \{\ sensor\_value\ =\ usrp-\/>get\_rx\_sensor(sensor\_name).to\_bool();\ \});}
\DoxyCodeLine{00200\ \ \ \}}
\DoxyCodeLine{00201\ \ \ \textcolor{keywordtype}{bool}\ set\_time\_unknown\_pps(\textcolor{keyword}{const}\ uhd::time\_spec\_t\&\ timespec)}
\DoxyCodeLine{00202\ \ \ \{}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ \&timespec]()\ \{\ usrp-\/>set\_time\_unknown\_pps(timespec);\ \});}
\DoxyCodeLine{00204\ \ \ \}}
\DoxyCodeLine{00205\ \ \ \textcolor{keywordtype}{bool}\ set\_automatic\_master\_clock\_rate(\textcolor{keywordtype}{double}\ srate\_Hz)}
\DoxyCodeLine{00206\ \ \ \{}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ \&srate\_Hz]()\ \{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ range\ of\ valid\ master\ clock\ rates.}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ uhd::meta\_range\_t\ range\ =\ usrp-\/>get\_master\_clock\_rate\_range();}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ the\ nearest\ valid\ master\ clock\ rate.}}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ mcr\_Hz\ =\ range.clip(srate\_Hz);}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \ \ usrp-\/>set\_master\_clock\_rate(mcr\_Hz);}
\DoxyCodeLine{00215\ \ \ \ \ \});}
\DoxyCodeLine{00216\ \ \ \}}
\DoxyCodeLine{00217\ \ \ \textcolor{keywordtype}{bool}\ get\_time\_now(uhd::time\_spec\_t\&\ timespec)}
\DoxyCodeLine{00218\ \ \ \{}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ \&timespec]()\ \{\ timespec\ =\ usrp-\/>get\_time\_now();\ \});}
\DoxyCodeLine{00220\ \ \ \}}
\DoxyCodeLine{00221\ \ \ \textcolor{keywordtype}{bool}\ set\_sync\_source(\textcolor{keyword}{const}\ radio\_configuration::\mbox{\hyperlink{structsrsran_1_1radio__configuration_1_1clock__sources}{clock\_sources}}\&\ config)}
\DoxyCodeLine{00222\ \ \ \{}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{comment}{//\ Convert\ clock\ source\ to\ string.}}
\DoxyCodeLine{00224\ \ \ \ \ std::string\ clock\_src;}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordflow}{switch}\ (config\mbox{\hyperlink{structsrsran_1_1radio__configuration_1_1clock__sources_acdbb9d533b08584565dffe125a417d99}{.}}\mbox{\hyperlink{structsrsran_1_1radio__configuration_1_1clock__sources_acdbb9d533b08584565dffe125a417d99}{clock}})\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::clock\_sources::source::DEFAULT:}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::clock\_sources::source::INTERNAL:}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ clock\_src\ =\ \textcolor{stringliteral}{"{}internal"{}};}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::clock\_sources::source::EXTERNAL:}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ clock\_src\ =\ \textcolor{stringliteral}{"{}external"{}};}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::clock\_sources::source::GPSDO:}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ clock\_src\ =\ \textcolor{stringliteral}{"{}gpsdo"{}};}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00236\ \ \ \ \ \}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{comment}{//\ Convert\ sync\ source\ to\ string.}}
\DoxyCodeLine{00239\ \ \ \ \ std::string\ sync\_src;}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordflow}{switch}\ (config\mbox{\hyperlink{structsrsran_1_1radio__configuration_1_1clock__sources_a82f1444146a0c588cc84cee172222a4c}{.}}\mbox{\hyperlink{structsrsran_1_1radio__configuration_1_1clock__sources_a82f1444146a0c588cc84cee172222a4c}{sync}})\ \{}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::clock\_sources::source::DEFAULT:}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::clock\_sources::source::INTERNAL:}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ sync\_src\ =\ \textcolor{stringliteral}{"{}internal"{}};}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::clock\_sources::source::EXTERNAL:}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ sync\_src\ =\ \textcolor{stringliteral}{"{}external"{}};}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::clock\_sources::source::GPSDO:}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ sync\_src\ =\ \textcolor{stringliteral}{"{}gpsdo"{}};}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00251\ \ \ \ \ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \ \ logger.debug(\textcolor{stringliteral}{"{}Setting\ PPS\ source\ to\ '\{\}'\ and\ clock\ source\ to\ '\{\}'."{}},\ sync\_src,\ clock\_src);}
\DoxyCodeLine{00254\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{if}\ \textcolor{preprocessor}{UHD\_VERSION}\ \textcolor{preprocessor}{<}\ 3140099}
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ \&sync\_src,\ \&clock\_src]()\ \{}
\DoxyCodeLine{00256\ \ \ \ \ \ \ std::vector<std::string>\ time\_sources\ =\ usrp-\/>get\_time\_sources(0);}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::find(time\_sources.begin(),\ time\_sources.end(),\ sync\_src)\ ==\ time\_sources.end())\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ on\_error(\textcolor{stringliteral}{"{}Invalid\ time\ source\ \{\}.\ Supported:\ \{\}"{}},\ sync\_src,\ span<\textcolor{keyword}{const}\ std::string>(time\_sources));}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00261\ \ \ \ \ \ \ std::vector<std::string>\ clock\_sources\ =\ usrp-\/>get\_clock\_sources(0);}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::find(clock\_sources.begin(),\ clock\_sources.end(),\ clock\_src)\ ==\ clock\_sources.end())\ \{}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ on\_error(\textcolor{stringliteral}{"{}Invalid\ clock\ source\ \{\}.\ Supported:\ \{\}"{}},\ clock\_src,\ span<\textcolor{keyword}{const}\ std::string>(clock\_sources));}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \ \ \ \ usrp-\/>set\_time\_source(sync\_src);}
\DoxyCodeLine{00268\ \ \ \ \ \ \ usrp-\/>set\_clock\_source(clock\_src);}
\DoxyCodeLine{00269\ \ \ \ \ \});}
\DoxyCodeLine{00270\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{else}}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ \&sync\_source,\ \&clock\_source]()\ \{\ usrp-\/>set\_sync\_source(clock\_source,\ sync\_source);\ \});}
\DoxyCodeLine{00272\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{endif}}
\DoxyCodeLine{00273\ \ \ \}}
\DoxyCodeLine{00274\ \ \ \textcolor{keywordtype}{bool}\ set\_rx\_rate(\textcolor{keywordtype}{double}\&\ actual\_rate,\ \textcolor{keywordtype}{double}\ rate)}
\DoxyCodeLine{00275\ \ \ \{}
\DoxyCodeLine{00276\ \ \ \ \ logger.debug(\textcolor{stringliteral}{"{}Setting\ Rx\ Rate\ to\ \{\}\ MHz."{}},\ to\_MHz(rate));}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ \&actual\_rate,\ rate]()\ \{}
\DoxyCodeLine{00279\ \ \ \ \ \ \ uhd::meta\_range\_t\ range\ =\ usrp-\/>get\_rx\_rates();}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!radio\_uhd\_device\_validate\_freq\_range(range,\ rate))\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ on\_error(\textcolor{stringliteral}{"{}Rx\ Rate\ \{\}\ MHz\ is\ invalid.\ The\ nearest\ valid\ value\ is\ \{\}."{}},\ to\_MHz(rate),\ to\_MHz(range.clip(rate)));}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \ \ \ \ usrp-\/>set\_rx\_rate(rate);}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ \ \ actual\_rate\ =\ usrp-\/>get\_rx\_rate();}
\DoxyCodeLine{00289\ \ \ \ \ \});}
\DoxyCodeLine{00290\ \ \ \}}
\DoxyCodeLine{00291\ \ \ \textcolor{keywordtype}{bool}\ set\_tx\_rate(\textcolor{keywordtype}{double}\&\ actual\_rate,\ \textcolor{keywordtype}{double}\ rate)}
\DoxyCodeLine{00292\ \ \ \{}
\DoxyCodeLine{00293\ \ \ \ \ logger.debug(\textcolor{stringliteral}{"{}Setting\ Tx\ Rate\ to\ \{\}\ MHz."{}},\ to\_MHz(rate));}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ \&actual\_rate,\ rate]()\ \{}
\DoxyCodeLine{00296\ \ \ \ \ \ \ uhd::meta\_range\_t\ range\ =\ usrp-\/>get\_tx\_rates();}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!radio\_uhd\_device\_validate\_freq\_range(range,\ rate))\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ on\_error(\textcolor{stringliteral}{"{}Tx\ Rate\ \{\}\ MHz\ is\ invalid.\ The\ nearest\ valid\ value\ is\ \{\}."{}},\ to\_MHz(rate),\ to\_MHz(range.clip(rate)));}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \ \ \ \ \ \ usrp-\/>set\_tx\_rate(rate);}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \ \ \ \ actual\_rate\ =\ usrp-\/>get\_tx\_rate();}
\DoxyCodeLine{00306\ \ \ \ \ \});}
\DoxyCodeLine{00307\ \ \ \}}
\DoxyCodeLine{00308\ \ \ \textcolor{keywordtype}{bool}\ set\_command\_time(\textcolor{keyword}{const}\ uhd::time\_spec\_t\&\ timespec)}
\DoxyCodeLine{00309\ \ \ \{}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ \&timespec]()\ \{\ usrp-\/>set\_command\_time(timespec);\ \});}
\DoxyCodeLine{00311\ \ \ \}}
\DoxyCodeLine{00312\ \ \ std::unique\_ptr<radio\_uhd\_tx\_stream>\ create\_tx\_stream(task\_executor\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ async\_executor,}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ radio\_notification\_handler\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ notifier,}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ radio\_uhd\_tx\_stream::stream\_description\&\ description)}
\DoxyCodeLine{00315\ \ \ \{}
\DoxyCodeLine{00316\ \ \ \ \ std::unique\_ptr<radio\_uhd\_tx\_stream>\ stream\ =}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ std::make\_unique<radio\_uhd\_tx\_stream>(usrp,\ description,\ async\_executor,\ notifier);}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \ \ \textcolor{keywordflow}{if}\ (stream-\/>is\_successful())\ \{}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ stream;}
\DoxyCodeLine{00321\ \ \ \ \ \}}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{nullptr};}
\DoxyCodeLine{00324\ \ \ \}}
\DoxyCodeLine{00325\ \ \ std::unique\_ptr<radio\_uhd\_rx\_stream>\ create\_rx\_stream(radio\_notification\_handler\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ notifier,}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ radio\_uhd\_rx\_stream::stream\_description\&\ description)}
\DoxyCodeLine{00327\ \ \ \{}
\DoxyCodeLine{00328\ \ \ \ \ std::unique\_ptr<radio\_uhd\_rx\_stream>\ stream\ =\ std::make\_unique<radio\_uhd\_rx\_stream>(usrp,\ description,\ notifier);}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keywordflow}{if}\ (stream-\/>is\_successful())\ \{}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ stream;}
\DoxyCodeLine{00332\ \ \ \ \ \}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error:\ failed\ to\ create\ receive\ stream\ \%d.\ \%s."{}},\ description.id,\ stream-\/>get\_error\_message().c\_str());}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{nullptr};}
\DoxyCodeLine{00336\ \ \ \}}
\DoxyCodeLine{00337\ \ \ \textcolor{keywordtype}{bool}\ set\_tx\_gain(\textcolor{keywordtype}{unsigned}\ ch,\ \textcolor{keywordtype}{double}\ gain)}
\DoxyCodeLine{00338\ \ \ \{}
\DoxyCodeLine{00339\ \ \ \ \ logger.debug(\textcolor{stringliteral}{"{}Setting\ channel\ \{\}\ Tx\ gain\ to\ \{:.2f\}\ dB."{}},\ ch,\ gain);}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ ch,\ gain]()\ \{}
\DoxyCodeLine{00342\ \ \ \ \ \ \ uhd::gain\_range\_t\ range\ =\ usrp-\/>get\_tx\_gain\_range(ch);}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!radio\_uhd\_device\_validate\_gain\_range(range,\ gain))\ \{}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ on\_error(\textcolor{stringliteral}{"{}Tx\ gain\ (i.e.,\ \{\}\ dB)\ is\ out-\/of-\/range.\ Range\ is\ [\{\},\ \{\}]\ dB\ in\ steps\ of\ \{\}\ dB."{}},}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gain,}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ range.start(),}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ range.stop(),}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ range.step());}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \ \ \ \ usrp-\/>set\_tx\_gain(gain,\ ch);}
\DoxyCodeLine{00354\ \ \ \ \ \});}
\DoxyCodeLine{00355\ \ \ \}}
\DoxyCodeLine{00356\ \ \ \textcolor{keywordtype}{bool}\ set\_rx\_gain(size\_t\ ch,\ \textcolor{keywordtype}{double}\ gain)}
\DoxyCodeLine{00357\ \ \ \{}
\DoxyCodeLine{00358\ \ \ \ \ logger.debug(\textcolor{stringliteral}{"{}Setting\ channel\ \{\}\ Rx\ gain\ to\ \{:.2f\}\ dB."{}},\ ch,\ gain);}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ ch,\ gain]()\ \{}
\DoxyCodeLine{00361\ \ \ \ \ \ \ uhd::gain\_range\_t\ range\ =\ usrp-\/>get\_rx\_gain\_range(ch);}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!radio\_uhd\_device\_validate\_gain\_range(range,\ gain))\ \{}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ on\_error(\textcolor{stringliteral}{"{}Rx\ gain\ (i.e.,\ \{\}\ dB)\ is\ out-\/of-\/range.\ Range\ is\ [\{\},\ \{\}]\ dB\ in\ steps\ of\ \{\}\ dB."{}},}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gain,}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ range.start(),}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ range.stop(),}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ range.step());}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \ \ \ \ usrp-\/>set\_rx\_gain(gain,\ ch);}
\DoxyCodeLine{00373\ \ \ \ \ \});}
\DoxyCodeLine{00374\ \ \ \}}
\DoxyCodeLine{00375\ \ \ \textcolor{keywordtype}{bool}\ set\_tx\_freq(uint32\_t\ ch,\ \textcolor{keyword}{const}\ radio\_configuration::\mbox{\hyperlink{structsrsran_1_1radio__configuration_1_1lo__frequency}{lo\_frequency}}\&\ config)}
\DoxyCodeLine{00376\ \ \ \{}
\DoxyCodeLine{00377\ \ \ \ \ logger.debug(\textcolor{stringliteral}{"{}Setting\ channel\ \{\}\ Tx\ frequency\ to\ \{\}\ MHz."{}},\ ch,\ to\_MHz(config.center\_frequency\_hz));}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ ch,\ \&config]()\ \{}
\DoxyCodeLine{00380\ \ \ \ \ \ \ uhd::freq\_range\_t\ range\ =\ usrp-\/>get\_tx\_freq\_range(ch);}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!radio\_uhd\_device\_validate\_freq\_range(range,\ config.center\_frequency\_hz))\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ on\_error(\textcolor{stringliteral}{"{}Tx\ RF\ frequency\ \{\}\ MHz\ is\ out-\/of-\/range.\ Range\ is\ \{\}."{}},}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_MHz(config.center\_frequency\_hz),}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ range.to\_pp\_string());}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ tune\ request.}}
\DoxyCodeLine{00390\ \ \ \ \ \ \ uhd::tune\_request\_t\ tune\_request(config.center\_frequency\_hz);}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ LO\ frequency\ is\ defined,\ force\ a\ LO\ frequency\ and\ set\ the\ DSP\ frequency\ to\ auto.}}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::isnormal(config\mbox{\hyperlink{structsrsran_1_1radio__configuration_1_1lo__frequency_aa166c8b622cf4f37d385df12d43a9559}{.}}\mbox{\hyperlink{structsrsran_1_1radio__configuration_1_1lo__frequency_aa166c8b622cf4f37d385df12d43a9559}{lo\_frequency\_hz}}))\ \{}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ tune\_request.rf\_freq\ \ \ \ \ \ \ \ \ =\ config.lo\_frequency\_hz;}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ tune\_request.rf\_freq\_policy\ \ =\ uhd::tune\_request\_t::POLICY\_MANUAL;}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ tune\_request.dsp\_freq\_policy\ =\ uhd::tune\_request\_t::POLICY\_AUTO;}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \ \ \ \ usrp-\/>set\_tx\_freq(tune\_request,\ ch);}
\DoxyCodeLine{00400\ \ \ \ \ \});}
\DoxyCodeLine{00401\ \ \ \}}
\DoxyCodeLine{00402\ \ \ \textcolor{keywordtype}{bool}\ set\_rx\_freq(uint32\_t\ ch,\ \textcolor{keyword}{const}\ radio\_configuration::\mbox{\hyperlink{structsrsran_1_1radio__configuration_1_1lo__frequency}{lo\_frequency}}\&\ config)}
\DoxyCodeLine{00403\ \ \ \{}
\DoxyCodeLine{00404\ \ \ \ \ logger.debug(\textcolor{stringliteral}{"{}Setting\ channel\ \{\}\ Rx\ frequency\ to\ \{\}\ MHz."{}},\ ch,\ to\_MHz(config.center\_frequency\_hz));}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{keywordflow}{return}\ safe\_execution([\textcolor{keyword}{this},\ ch,\ \&config]()\ \{}
\DoxyCodeLine{00407\ \ \ \ \ \ \ uhd::freq\_range\_t\ range\ =\ usrp-\/>get\_rx\_freq\_range(ch);}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!radio\_uhd\_device\_validate\_freq\_range(range,\ config.center\_frequency\_hz))\ \{}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ on\_error(\textcolor{stringliteral}{"{}Rx\ RF\ frequency\ \{\}\ MHz\ is\ out-\/of-\/range.\ Range\ is\ \{\}."{}},}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_MHz(config.center\_frequency\_hz),}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ range.to\_pp\_string());}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ tune\ request.}}
\DoxyCodeLine{00417\ \ \ \ \ \ \ uhd::tune\_request\_t\ tune\_request(config.center\_frequency\_hz);}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ LO\ frequency\ is\ defined,\ force\ a\ LO\ frequency\ and\ set\ the\ DSP\ frequency\ to\ auto.}}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::isnormal(config\mbox{\hyperlink{structsrsran_1_1radio__configuration_1_1lo__frequency_aa166c8b622cf4f37d385df12d43a9559}{.}}\mbox{\hyperlink{structsrsran_1_1radio__configuration_1_1lo__frequency_aa166c8b622cf4f37d385df12d43a9559}{lo\_frequency\_hz}}))\ \{}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ tune\_request.rf\_freq\ \ \ \ \ \ \ \ \ =\ config.lo\_frequency\_hz;}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ tune\_request.rf\_freq\_policy\ \ =\ uhd::tune\_request\_t::POLICY\_MANUAL;}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ tune\_request.dsp\_freq\_policy\ =\ uhd::tune\_request\_t::POLICY\_AUTO;}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \ \ \ \ \ \ usrp-\/>set\_rx\_freq(tune\_request,\ ch);}
\DoxyCodeLine{00427\ \ \ \ \ \});}
\DoxyCodeLine{00428\ \ \ \}}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00431\ \ \ uhd::usrp::multi\_usrp::sptr\ usrp\ =\ \textcolor{keywordtype}{nullptr};}
\DoxyCodeLine{00432\ \ \ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\ \ \ \ \ \ \ type\ =\ \mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type}{radio\_uhd\_device\_type}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa696b031073e74bf2cb98e5ef201d4aa3}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fda}{types}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa696b031073e74bf2cb98e5ef201d4aa3}{::}}\mbox{\hyperlink{classsrsran_1_1radio__uhd__device__type_a89fef702251e27c3e616fa7654d56fdaa696b031073e74bf2cb98e5ef201d4aa3}{UNKNOWN}};}
\DoxyCodeLine{00433\ \ \ srslog::basic\_logger\&\ \ \ \ \ \ \ logger;}
\DoxyCodeLine{00434\ \};}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \}\ \textcolor{comment}{//\ namespace\ srsran}}

\end{DoxyCode}
