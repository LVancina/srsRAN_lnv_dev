\doxysection{srsran\+::prach\+\_\+detector\+\_\+generic\+\_\+impl Class Reference}
\hypertarget{classsrsran_1_1prach__detector__generic__impl}{}\label{classsrsran_1_1prach__detector__generic__impl}\index{srsran::prach\_detector\_generic\_impl@{srsran::prach\_detector\_generic\_impl}}


Implements a simple PRACH detector.  




{\ttfamily \#include $<$prach\+\_\+detector\+\_\+generic\+\_\+impl.\+h$>$}



Inheritance diagram for srsran\+::prach\+\_\+detector\+\_\+generic\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=216pt]{db/dd4/classsrsran_1_1prach__detector__generic__impl__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::prach\+\_\+detector\+\_\+generic\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=216pt]{d0/d9f/classsrsran_1_1prach__detector__generic__impl__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1prach__detector__generic__impl_a3d3f217783b91e8d3341fd914e5e6555}{prach\+\_\+detector\+\_\+generic\+\_\+impl}} (std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1dft__processor}{dft\+\_\+processor}} $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\+\_\+long\+\_\+}}, std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1dft__processor}{dft\+\_\+processor}} $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\+\_\+short\+\_\+}}, std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1prach__generator}{prach\+\_\+generator}} $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{generator\+\_\+}}, \mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{combine\+\_\+symbols\+\_\+}})
\begin{DoxyCompactList}\small\item\em Constructor -\/ Acquires ownership of the internal components. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structsrsran_1_1prach__detection__result}{prach\+\_\+detection\+\_\+result}} \mbox{\hyperlink{classsrsran_1_1prach__detector__generic__impl_ae6d2486eca2484e1f62eef6f00c8502d}{detect}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1prach__buffer}{prach\+\_\+buffer}} \&input, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1prach__detector_1_1configuration}{configuration}} \&config) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Detects PRACH transmissions according to the given configuration. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1prach__detector}{srsran\+::prach\+\_\+detector}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{virtual}} {\bfseries \texorpdfstring{$\sim$}{\string~}prach\+\_\+detector} ()=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{default}}
\begin{DoxyCompactList}\small\item\em Default destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implements a simple PRACH detector. 

Detects PRACH sequences from the frequency-\/domain channel samples. The detector is inspired by the generalized log-\/likelihood ratio detection test. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1prach__detector__generic__impl_a3d3f217783b91e8d3341fd914e5e6555}\label{classsrsran_1_1prach__detector__generic__impl_a3d3f217783b91e8d3341fd914e5e6555} 
\index{srsran::prach\_detector\_generic\_impl@{srsran::prach\_detector\_generic\_impl}!prach\_detector\_generic\_impl@{prach\_detector\_generic\_impl}}
\index{prach\_detector\_generic\_impl@{prach\_detector\_generic\_impl}!srsran::prach\_detector\_generic\_impl@{srsran::prach\_detector\_generic\_impl}}
\doxysubsubsection{\texorpdfstring{prach\_detector\_generic\_impl()}{prach\_detector\_generic\_impl()}}
{\footnotesize\ttfamily prach\+\_\+detector\+\_\+generic\+\_\+impl\+::prach\+\_\+detector\+\_\+generic\+\_\+impl (\begin{DoxyParamCaption}\item[{std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1dft__processor}{dft\+\_\+processor}} $>$}]{idft\+\_\+long\+\_\+,  }\item[{std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1dft__processor}{dft\+\_\+processor}} $>$}]{idft\+\_\+short\+\_\+,  }\item[{std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1prach__generator}{prach\+\_\+generator}} $>$}]{generator\+\_\+,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{combine\+\_\+symbols\+\_\+ }\end{DoxyParamCaption})}



Constructor -\/ Acquires ownership of the internal components. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em idft\+\_\+long\+\_\+} & Inverse DFT processor for long preambles. \\
\hline
\mbox{\texttt{ in}}  & {\em idft\+\_\+short\+\_\+} & Inverse DFT processor for short preambles. \\
\hline
\mbox{\texttt{ in}}  & {\em generator\+\_\+} & PRACH frequency-\/domain sequence generator. \\
\hline
\mbox{\texttt{ in}}  & {\em combine\+\_\+symbols\+\_\+} & Set to true for combining PRACH symbols for each port. \\
\hline
\end{DoxyParams}
\begin{DoxyRemark}{Remarks}
Assertions are triggered if the IDFT sizes are smaller than their sequences or greater than \doxylink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{MAX\+\_\+\+DFT\+\_\+\+SIZE}. 
\end{DoxyRemark}

\begin{DoxyCode}{0}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00062\ \ \ temp(),}
\DoxyCodeLine{00063\ \ \ temp2(),}
\DoxyCodeLine{00064\ \ \ idft\_long(std::move(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_long\_}})),}
\DoxyCodeLine{00065\ \ \ idft\_short(std::move(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_short\_}})),}
\DoxyCodeLine{00066\ \ \ generator(std::move(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{generator\_}})),}
\DoxyCodeLine{00067\ \ \ combine\_symbols(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{combine\_symbols\_}})}
\DoxyCodeLine{00068\ \{}
\DoxyCodeLine{00069\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{classsrsran_1_1interval}{interval<unsigned,\ true>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_long\_sz\_range}}(prach\_constants::LONG\_SEQUENCE\_LENGTH,\ MAX\_IDFT\_SIZE);}
\DoxyCodeLine{00070\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{classsrsran_1_1interval}{interval<unsigned,\ true>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_short\_sz\_range}}(prach\_constants::SHORT\_SEQUENCE\_LENGTH,\ MAX\_IDFT\_SIZE);}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ Verify\ IDFT\ for\ long\ preambles.}}
\DoxyCodeLine{00073\ \ \ srsran\_assert(idft\_long,\ \textcolor{stringliteral}{"{}Invalid\ IDFT\ processor."{}});}
\DoxyCodeLine{00074\ \ \ srsran\_assert(idft\_long-\/>get\_direction()\ ==\ \mbox{\hyperlink{classsrsran_1_1dft__processor_ad6d2dd1eff168ecf482b422a7c363d40a1955bdc302911f376074eb9b02e56639}{dft\_processor::direction::INVERSE}},\ \textcolor{stringliteral}{"{}Expected\ IDFT."{}});}
\DoxyCodeLine{00075\ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_long\_sz\_range}}.contains(idft\_long-\/>get\_size()),}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}IDFT\ size\ for\ long\ preambles\ (i.e.,\ \{\})\ must\ be\ in\ range\ \{\}."{}},}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idft\_long-\/>get\_size(),}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_long\_sz\_range}});}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \textcolor{comment}{//\ Verify\ IDFT\ for\ short\ preambles.}}
\DoxyCodeLine{00081\ \ \ srsran\_assert(idft\_short,\ \textcolor{stringliteral}{"{}Invalid\ IDFT\ processor."{}});}
\DoxyCodeLine{00082\ \ \ srsran\_assert(idft\_short-\/>get\_direction()\ ==\ \mbox{\hyperlink{classsrsran_1_1dft__processor_ad6d2dd1eff168ecf482b422a7c363d40a1955bdc302911f376074eb9b02e56639}{dft\_processor::direction::INVERSE}},\ \textcolor{stringliteral}{"{}Expected\ IDFT."{}});}
\DoxyCodeLine{00083\ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_short\_sz\_range}}.contains(idft\_short-\/>get\_size()),}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}IDFT\ size\ for\ short\ preambles\ (i.e.,\ \{\})\ must\ be\ in\ range\ \{\}."{}},}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idft\_short-\/>get\_size(),}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_long\_sz\_range}});}
\DoxyCodeLine{00087\ \};}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1prach__detector__generic__impl_ae6d2486eca2484e1f62eef6f00c8502d}\label{classsrsran_1_1prach__detector__generic__impl_ae6d2486eca2484e1f62eef6f00c8502d} 
\index{srsran::prach\_detector\_generic\_impl@{srsran::prach\_detector\_generic\_impl}!detect@{detect}}
\index{detect@{detect}!srsran::prach\_detector\_generic\_impl@{srsran::prach\_detector\_generic\_impl}}
\doxysubsubsection{\texorpdfstring{detect()}{detect()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structsrsran_1_1prach__detection__result}{prach\+\_\+detection\+\_\+result}} prach\+\_\+detector\+\_\+generic\+\_\+impl\+::detect (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1prach__buffer}{prach\+\_\+buffer}} \&}]{input,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1prach__detector_1_1configuration}{configuration}} \&}]{config }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Detects PRACH transmissions according to the given configuration. 

The PRACH detector assumes that {\ttfamily signal} is captured at the start of the PRACH reception window and it is at least as long as the PRACH preamble sequence.

An assertion is triggered if the sum of start preamble index and number of preambles exceeds 64.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em signal} & Baseband signal buffer. \\
\hline
\mbox{\texttt{ in}}  & {\em config} & PRACH configuration for the slot. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The detection result. 
\end{DoxyReturn}


Implements \mbox{\hyperlink{classsrsran_1_1prach__detector_ad67df2539b0a3aebb896faff1b401f41}{srsran\+::prach\+\_\+detector}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00090\ \{}
\DoxyCodeLine{00091\ \ \ srsran\_assert(config.start\_preamble\_index\ +\ config.nof\_preamble\_indices\ <=\ prach\_constants::MAX\_NUM\_PREAMBLES,}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ start\ preamble\ index\ (i.e.,\ \{\})\ and\ the\ number\ of\ preambles\ to\ detect\ (i.e.,\ \{\}),\ exceed\ the\ "{}}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}maximum\ of\ 64."{}},}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config.start\_preamble\_index,}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config.nof\_preamble\_indices);}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \textcolor{comment}{//\ Get\ preamble\ information.}}
\DoxyCodeLine{00098\ \ \ \mbox{\hyperlink{structsrsran_1_1prach__preamble__information}{prach\_preamble\_information}}\ preamble\_info;}
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_aaea6c484cd5f8113a5b11434d68e371b}{is\_long\_preamble}}(config.format))\ \{}
\DoxyCodeLine{00100\ \ \ \ \ preamble\_info\ =\ \mbox{\hyperlink{namespacesrsran_a41d072dc823c78c2627da83a877dcf5a}{get\_prach\_preamble\_long\_info}}(config.format);}
\DoxyCodeLine{00101\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00102\ \ \ \ \ preamble\_info\ =\ \mbox{\hyperlink{namespacesrsran_a33cfd882b612da5eceff76a95662d0b3}{get\_prach\_preamble\_short\_info}}(config.format,\ config.ra\_scs,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00103\ \ \ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{//\ Get\ cyclic\ shift.}}
\DoxyCodeLine{00106\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{N\_cs}}\ =\ \mbox{\hyperlink{namespacesrsran_aafa4c456e58b29f8804fedc599ab8710}{prach\_cyclic\_shifts\_get}}(config.ra\_scs,\ config.restricted\_set,\ config.zero\_correlation\_zone);}
\DoxyCodeLine{00107\ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{N\_cs}}\ !=\ PRACH\_CYCLIC\_SHIFTS\_RESERVED,\ \textcolor{stringliteral}{"{}Reserved\ cyclic\ shift."{}});}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \textcolor{comment}{//\ Get\ sequence\ length.}}
\DoxyCodeLine{00110\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}}\ =\ prach\_constants::LONG\_SEQUENCE\_LENGTH;}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a7c2e3c58a56b57be024f8bfc3271186d}{is\_short\_preamble}}(config.format))\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}}\ =\ prach\_constants::SHORT\_SEQUENCE\_LENGTH;}
\DoxyCodeLine{00113\ \ \ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \textcolor{comment}{//\ Gets\ the\ number\ of\ preambles\ using\ the\ same\ root\ sequence\ (i.e.,\ the\ number\ of\ cyclic\ shifts)\ and\ the\ total}}
\DoxyCodeLine{00116\ \ \ \textcolor{comment}{//\ number\ of\ root\ sequences\ needed.}}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_shifts}}\ \ \ \ =\ 1;}
\DoxyCodeLine{00118\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_sequences}}\ =\ 64;}
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{N\_cs}}\ !=\ 0)\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_shifts}}\ \ \ \ =\ std::min(prach\_constants::MAX\_NUM\_PREAMBLES,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}}\ /\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{N\_cs}});}
\DoxyCodeLine{00121\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_sequences}}\ =\ \mbox{\hyperlink{namespacesrsran_a6e5aee1d553dc6e825017842e4059adb}{divide\_ceil}}(64,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_shifts}});}
\DoxyCodeLine{00122\ \ \ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \textcolor{comment}{//\ Select\ IDFT\ processor.}}
\DoxyCodeLine{00125\ \ \ \mbox{\hyperlink{classsrsran_1_1dft__processor}{dft\_processor}}\&\ idft\ =\ \mbox{\hyperlink{namespacesrsran_aaea6c484cd5f8113a5b11434d68e371b}{is\_long\_preamble}}(config.format)\ ?\ *idft\_long\ :\ *idft\_short;}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{//\ Get\ DFT\ size.}}
\DoxyCodeLine{00128\ \ \ \textcolor{keywordtype}{unsigned}\ dft\_size\ =\ idft.\mbox{\hyperlink{classsrsran_1_1dft__processor_afcb93862572be80c25306a1a627b3d07}{get\_size}}();}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \textcolor{comment}{//\ Deduce\ sampling\ rate.}}
\DoxyCodeLine{00131\ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sample\_rate\_Hz}}\ =\ dft\_size\ *\ \mbox{\hyperlink{namespacesrsran_a4172874a14aceea21d35086683d66f1b}{ra\_scs\_to\_Hz}}(preamble\_info.\mbox{\hyperlink{structsrsran_1_1prach__preamble__information_a1cf7f9574b0a8249a736a0b6f39b6f1e}{scs}});}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \textcolor{comment}{//\ Calculate\ cyclic\ prefix\ duration\ in\ seconds.}}
\DoxyCodeLine{00134\ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cp\_duration}}\ =\ preamble\_info.\mbox{\hyperlink{structsrsran_1_1prach__preamble__information_a3b327e535ddff17fbba0e2f9b96169d3}{cp\_length}}.\mbox{\hyperlink{classsrsran_1_1phy__time__unit_a2ff9cda97bc4196edee275927c1d9430}{to\_seconds}}();}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \textcolor{comment}{//\ Calculate\ cyclic\ prefix\ duration\ in\ the\ same\ units\ as\ Ncs.}}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cp\_prach}}\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(std::floor(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cp\_duration}}\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}}\ *\ \mbox{\hyperlink{namespacesrsran_a4172874a14aceea21d35086683d66f1b}{ra\_scs\_to\_Hz}}(preamble\_info.\mbox{\hyperlink{structsrsran_1_1prach__preamble__information_a1cf7f9574b0a8249a736a0b6f39b6f1e}{scs}})));}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \textcolor{comment}{//\ Calculate\ the\ window\ width\ for\ each\ shift\ and\ convert\ it\ to\ the\ correlation\ sampling\ rate.}}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_width}}\ =\ std::min(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{N\_cs}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cp\_prach}});}
\DoxyCodeLine{00141\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{N\_cs}}\ ==\ 0)\ \{}
\DoxyCodeLine{00142\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_width}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cp\_prach}};}
\DoxyCodeLine{00143\ \ \ \}}
\DoxyCodeLine{00144\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_width}}\ =\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_width}}\ *\ dft\_size)\ /\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}};}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \textcolor{comment}{//\ Select\ window\ margin\ and\ threshold.}}
\DoxyCodeLine{00147\ \ \ detail::threshold\_params\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{th\_params}};}
\DoxyCodeLine{00148\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{th\_params}}.nof\_rx\_ports\ \ \ \ \ \ \ \ \ \ =\ config.nof\_rx\_ports;}
\DoxyCodeLine{00149\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{th\_params}}.scs\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ config.ra\_scs;}
\DoxyCodeLine{00150\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{th\_params}}.format\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ config.format;}
\DoxyCodeLine{00151\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{th\_params}}.zero\_correlation\_zone\ =\ config.zero\_correlation\_zone;}
\DoxyCodeLine{00152\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{th\_params}}.combine\_symbols\ \ \ \ \ \ \ =\ combine\_symbols;}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \textcolor{keyword}{auto}\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{th\_and\_margin}}\ =\ threshold\_and\_margin\_table.get(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{th\_params}});}
\DoxyCodeLine{00155\ \ \ \textcolor{keywordtype}{float}\ \ \ \ threshold\ \ \ \ \ =\ std::get<0>(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{th\_and\_margin}});}
\DoxyCodeLine{00156\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_margin}}\ \ \ \ =\ std::get<1>(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{th\_and\_margin}});}
\DoxyCodeLine{00157\ \ \ srsran\_assert((\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_margin}}\ >\ 0)\ \&\&\ (threshold\ >\ 0.0),}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Window\ margin\ and\ threshold\ are\ not\ selected\ for\ the\ number\ of\ ports\ (i.e.,\ \{\})\ and\ the\ preamble\ "{}}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}format\ (i.e.,\ \{\})."{}},}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config.nof\_rx\_ports,}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a5fa5b607b51bce906141a06d7ecdebbf}{to\_string}}(config.format));}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \textcolor{comment}{//\ Calculate\ maximum\ delay.}}
\DoxyCodeLine{00164\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_delay\_samples}}\ =\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{N\_cs}}\ ==\ 0)\ ?\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cp\_prach}}\ :\ std::\mbox{\hyperlink{namespacesrsran_a2a7e19abbadc531788e0849e634c23c6}{min}}(std::\mbox{\hyperlink{namespacesrsran_a2918c0347dde854fce1aaebb70a16c33}{max}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{N\_cs}},\ 1U)\ -\/\ 1U,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cp\_prach}});}
\DoxyCodeLine{00165\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_delay\_samples}}\ \ \ \ \ \ \ \ \ \ =\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_delay\_samples}}\ *\ dft\_size)\ /\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}};}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \textcolor{comment}{//\ Calculate\ number\ of\ symbols.}}
\DoxyCodeLine{00168\ \ \ \textcolor{keywordtype}{unsigned}\ nof\_symbols\ =}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(preamble\_info.\mbox{\hyperlink{structsrsran_1_1prach__preamble__information_aef1493b57fbc2fdbc433976b4bdec7f4}{symbol\_length}}.\mbox{\hyperlink{classsrsran_1_1phy__time__unit_a2ff9cda97bc4196edee275927c1d9430}{to\_seconds}}()\ *\ \mbox{\hyperlink{namespacesrsran_a4172874a14aceea21d35086683d66f1b}{ra\_scs\_to\_Hz}}(preamble\_info.\mbox{\hyperlink{structsrsran_1_1prach__preamble__information_a1cf7f9574b0a8249a736a0b6f39b6f1e}{scs}}));}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_td\_occasion}}\ =\ 0;}
\DoxyCodeLine{00172\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_fd\_occasion}}\ =\ 0;}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \textcolor{comment}{//\ Calculate\ RSSI.}}
\DoxyCodeLine{00175\ \ \ \textcolor{keywordtype}{float}\ rssi\ =\ 0.0F;}
\DoxyCodeLine{00176\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}}\ !=\ config.nof\_rx\_ports;\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}})\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}}\ !=\ nof\_symbols;\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}})\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ rssi\ +=\ srsvec::average\_power(input.\mbox{\hyperlink{classsrsran_1_1prach__buffer_a9393f0ec690ad95fab986ae6d5d93fa3}{get\_symbol}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_td\_occasion}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_fd\_occasion}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}}));}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ \ \ \}}
\DoxyCodeLine{00181\ \ \ rssi\ /=\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(config.nof\_rx\_ports\ *\ nof\_symbols\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}});}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{comment}{//\ Prepare\ results.}}
\DoxyCodeLine{00184\ \ \ \mbox{\hyperlink{structsrsran_1_1prach__detection__result}{prach\_detection\_result}}\ result;}
\DoxyCodeLine{00185\ \ \ result.rssi\_dB\ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a5756a255042b67673f46c371665d04ec}{convert\_power\_to\_dB}}(rssi);}
\DoxyCodeLine{00186\ \ \ result.time\_resolution\ =\ \mbox{\hyperlink{classsrsran_1_1phy__time__unit_a9759195d4f33e9afbf1c790ab103af94}{phy\_time\_unit::from\_seconds}}(1.0\ /\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sample\_rate\_Hz}}));}
\DoxyCodeLine{00187\ \ \ result.time\_advance\_max\ =}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1phy__time__unit_a9759195d4f33e9afbf1c790ab103af94}{phy\_time\_unit::from\_seconds}}(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_delay\_samples}})\ *\ 0.8\ /\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sample\_rate\_Hz}}));}
\DoxyCodeLine{00189\ \ \ result.preambles.clear();}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \textcolor{comment}{//\ Early\ stop\ if\ the\ RSSI\ is\ zero.}}
\DoxyCodeLine{00192\ \ \ \textcolor{keywordflow}{if}\ (!std::isnormal(rssi))\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00194\ \ \ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \textcolor{comment}{//\ Get\ view\ of\ the\ IDFT\ input\ and\ zero\ it.}}
\DoxyCodeLine{00197\ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<cf\_t>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_input}}\ =\ idft.\mbox{\hyperlink{classsrsran_1_1dft__processor_aa07d386497c47ca798864f6300937cab}{get\_input}}();}
\DoxyCodeLine{00198\ \ \ srsvec::zero(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_input}});}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_sequence}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_sequence}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_sequences}};\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_sequence}})\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{comment}{//\ Prepare\ root\ sequence\ configuration.}}
\DoxyCodeLine{00202\ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1prach__generator_1_1configuration}{prach\_generator::configuration}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{generator\_config}};}
\DoxyCodeLine{00203\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{generator\_config}}.\mbox{\hyperlink{structsrsran_1_1prach__generator_1_1configuration_a6cd97abef53c40cddf6ee4d0b7dfd259}{format}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ config.format;}
\DoxyCodeLine{00204\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{generator\_config}}.root\_sequence\_index\ \ \ =\ config.root\_sequence\_index;}
\DoxyCodeLine{00205\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{generator\_config}}.preamble\_index\ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_sequence}}\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_shifts}};}
\DoxyCodeLine{00206\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{generator\_config}}.restricted\_set\ \ \ \ \ \ \ \ =\ config.restricted\_set;}
\DoxyCodeLine{00207\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{generator\_config}}.zero\_correlation\_zone\ =\ config.zero\_correlation\_zone;}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{comment}{//\ Generate\ root\ sequence.}}
\DoxyCodeLine{00210\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ cf\_t>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{root}}\ =\ generator-\/>generate(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{generator\_config}});}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{comment}{//\ Prepare\ metric\ global\ numerator.}}
\DoxyCodeLine{00213\ \ \ \ \ metric\_global\_num.\mbox{\hyperlink{classsrsran_1_1static__tensor_aef91c69724fa16cb8ddefca0eb9d88d2}{resize}}(\{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_width}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_shifts}}\});}
\DoxyCodeLine{00214\ \ \ \ \ srsvec::zero(metric\_global\_num.\mbox{\hyperlink{classsrsran_1_1static__tensor_a4a29f86b7d16e71ffbe4a5e31f211f51}{get\_data}}());}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{comment}{//\ Prepare\ metric\ global\ denominator.}}
\DoxyCodeLine{00217\ \ \ \ \ metric\_global\_den.\mbox{\hyperlink{classsrsran_1_1static__tensor_aef91c69724fa16cb8ddefca0eb9d88d2}{resize}}(\{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_width}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_shifts}}\});}
\DoxyCodeLine{00218\ \ \ \ \ srsvec::zero(metric\_global\_den.\mbox{\hyperlink{classsrsran_1_1static__tensor_a4a29f86b7d16e71ffbe4a5e31f211f51}{get\_data}}());}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{comment}{//\ Iterate\ over\ all\ receive\ ports.}}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}}\ !=\ config.nof\_rx\_ports;\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}})\ \{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \textcolor{comment}{//\ Iterate\ all\ PRACH\ symbols\ if\ they\ are\ not\ combined,\ otherwise\ process\ only\ one\ PRACH\ symbol.}}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}}\ =\ 0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol\_end}}\ =\ (combine\_symbols)\ ?\ 1\ :\ nof\_symbols;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol\_end}};}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}})\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ view\ of\ the\ preamble.}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ cf\_t>}}\ preamble\ =\ input.\mbox{\hyperlink{classsrsran_1_1prach__buffer_a9393f0ec690ad95fab986ae6d5d93fa3}{get\_symbol}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_td\_occasion}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_fd\_occasion}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}});}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Combine\ symbols.}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (combine\_symbols\ \&\&\ (nof\_symbols\ >\ 1))\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ a\ temporary\ destination\ for\ the\ symbol\ combination.}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<cf\_t>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{combined\_symbols}}\ =\ \mbox{\hyperlink{classsrsran_1_1span}{span<cf\_t>}}(cf\_temp).\mbox{\hyperlink{classsrsran_1_1span_aa4238c2e04ac8c60726db8cc0b687582}{first}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}});}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ first\ PRACH\ symbol.}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ srsvec::copy(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{combined\_symbols}},\ preamble);}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Combine\ the\ rest\ of\ PRACH\ symbols.}}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_comb\_symbol}}\ =\ 1;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_comb\_symbol}}\ !=\ nof\_symbols;\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_comb\_symbol}})\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ srsvec::add(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{combined\_symbols}},}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input.\mbox{\hyperlink{classsrsran_1_1prach__buffer_a9393f0ec690ad95fab986ae6d5d93fa3}{get\_symbol}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_td\_occasion}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_fd\_occasion}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_comb\_symbol}}),}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{combined\_symbols}});}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ preamble\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{combined\_symbols}};}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Multiply\ the\ preamble\ by\ the\ complex\ conjugate\ of\ the\ root\ sequence.}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ std::array<cf\_t,\ prach\_constants::LONG\_SEQUENCE\_LENGTH>\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{no\_root\_temp}};}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<cf\_t>}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{no\_root}}\ =\ \mbox{\hyperlink{classsrsran_1_1span}{span<cf\_t>}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{no\_root\_temp}}).\mbox{\hyperlink{classsrsran_1_1span_aa4238c2e04ac8c60726db8cc0b687582}{first}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}});}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ srsvec::prod\_conj(preamble,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{root}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{no\_root}});}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Prepare\ IDFT\ for\ correlation.}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ srsvec::copy(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_input}}.first(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}}\ /\ 2\ +\ 1),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{no\_root}}.last(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}}\ /\ 2\ +\ 1));}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ srsvec::copy(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{idft\_input}}.last(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}}\ /\ 2),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{no\_root}}.first(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}}\ /\ 2));}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Perform\ IDFT.}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ cf\_t>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{no\_root\_time\_simple}}\ =\ idft.\mbox{\hyperlink{classsrsran_1_1dft__processor_a628d1ee463ea4107a2809eeb6cdac552}{run}}();}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Perform\ the\ modulus\ square\ of\ the\ correlation.}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<float>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mod\_square}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{span<float>}}(temp).\mbox{\hyperlink{classsrsran_1_1span_aa4238c2e04ac8c60726db8cc0b687582}{first}}(dft\_size);}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ srsvec::modulus\_square(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mod\_square}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{no\_root\_time\_simple}});}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Normalize\ the\ signal:\ we\ divide\ by\ the\ DFT\ size\ to\ compensate\ for\ the\ inherent\ scaling\ of\ the\ DFT,\ and\ by}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ L\_ra\string^2\ to\ compensate\ for\ the\ amplitude\ of\ the\ ZC\ sequence\ in\ the\ frequency\ domain.}}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ srsvec::sc\_prod(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mod\_square}},\ 1.0F\ /\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(dft\_size\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}}\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}}),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mod\_square}});}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ each\ shift\ of\ the\ sequence.}}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_shifts}};\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}})\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ start\ of\ the\ window.}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_start}}\ =\ (dft\_size\ -\/\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{N\_cs}}\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}}\ *\ dft\_size)\ /\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}})\ \%\ dft\_size;}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ reference\ energy.}}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ reference\ =\ 0.0F;}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_start}}\ =\ ((\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_start}}\ +\ dft\_size)\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_margin}})\ \%\ dft\_size;}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_end}}\ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_start}}\ +\ 2\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_margin}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_width}};}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ reference\ +=\ srsvec::accumulate(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mod\_square}}.subspan(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_start}},\ std::min(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_end}},\ dft\_size)\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_start}}));}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_end}}\ >\ dft\_size)\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reference\ +=\ srsvec::accumulate(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mod\_square}}.first(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_end}}\ -\/\ dft\_size));}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ modulus\ square\ view\ for\ the\ window.}}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<float>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_mod\_square}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{span<float>}}(temp2).\mbox{\hyperlink{classsrsran_1_1span_aa4238c2e04ac8c60726db8cc0b687582}{first}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_width}});}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Scale\ window.}}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ srsvec::sc\_prod(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mod\_square}}.subspan(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_start}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_width}}),}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(dft\_size)\ /\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{L\_ra}}),}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_mod\_square}});}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ metric\ global\ numerator.}}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<float>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_metric\_global\_num}}\ =\ metric\_global\_num.\mbox{\hyperlink{classsrsran_1_1tensor_aa4379387498edc2307a09f6a60b85c8a}{get\_view}}(\{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}}\});}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ metric\ global\ denominator.}}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<float>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_metric\_global\_den}}\ =\ metric\_global\_den.\mbox{\hyperlink{classsrsran_1_1tensor_aa4379387498edc2307a09f6a60b85c8a}{get\_view}}(\{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}}\});}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Scale\ modulus\ square\ and\ accumulate\ numerator.}}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ srsvec::add(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_metric\_global\_num}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_mod\_square}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_metric\_global\_num}});}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Scale\ modulus\ square\ and\ accumulate\ denominator.}}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ vector\_noise\_estimation(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_metric\_global\_den}},\ reference,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_mod\_square}});}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00303\ \ \ \ \ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \ \ \textcolor{comment}{//\ Process\ global\ metric.}}
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_shifts}};\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}})\ \{}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ metric\ global.}}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<float>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{metric\_global}}\ \ \ \ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{span<float>}}(temp).\mbox{\hyperlink{classsrsran_1_1span_aa4238c2e04ac8c60726db8cc0b687582}{first}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{win\_width}});}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<float>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_metric\_global\_num}}\ =\ metric\_global\_num.\mbox{\hyperlink{classsrsran_1_1tensor_aa4379387498edc2307a09f6a60b85c8a}{get\_view}}(\{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}}\});}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<float>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_metric\_global\_den}}\ =\ metric\_global\_den.\mbox{\hyperlink{classsrsran_1_1tensor_aa4379387498edc2307a09f6a60b85c8a}{get\_view}}(\{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}}\});}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ metric\ global.}}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{float}\&\ a\ :\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_metric\_global\_den}})\ \{}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ a\ =\ std::abs(a);}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ srsvec::divide(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{metric\_global}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_metric\_global\_num}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{window\_metric\_global\_den}});}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ maximum.}}
\DoxyCodeLine{00319\ \ \ \ \ \ \ std::pair<unsigned,\ float>\ max\_element\ =\ srsvec::max\_element(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{metric\_global}});}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \ \ \ \ \ \ \textcolor{comment}{//\ Extract\ peak\ value\ and\ index\ from\ the\ iterator.}}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ delay\ =\ max\_element.first;}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{peak}}\ \ =\ max\_element.second;}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \ \ \ \ \textcolor{comment}{//\ Compare\ with\ the\ threshold.\ Note\ that\ we\ neglect\ the\ last\ 1/5\ of\ the\ detection\ window\ because\ it\ may\ contain}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \textcolor{comment}{//\ spurious\ peaks\ due\ to\ the\ adjacent\ window.}}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((delay\ <\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{metric\_global}}.size())\ \&\&\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{peak}}\ >\ threshold)\ \&\&}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ (delay\ <\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_delay\_samples}})\ *\ 0.8))\ \{}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1prach__detection__result_1_1preamble__indication}{prach\_detection\_result::preamble\_indication}}\&\ info\ =\ result.preambles.emplace\_back();}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ info.preamble\_index\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_sequence}}\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_shifts}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_window}};}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ info.time\_advance\ =}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1phy__time__unit_a9759195d4f33e9afbf1c790ab103af94}{phy\_time\_unit::from\_seconds}}(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(delay)\ /\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sample\_rate\_Hz}}));}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Normalize\ the\ detection\ metric\ with\ respect\ to\ the\ threshold.}}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ info.detection\_metric\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{peak}}\ /\ threshold;}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00336\ \ \ \ \ \}}
\DoxyCodeLine{00337\ \ \ \}}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00340\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/phy/upper/channel\+\_\+processors/prach\+\_\+detector\+\_\+generic\+\_\+impl.\+h\item 
lib/phy/upper/channel\+\_\+processors/prach\+\_\+detector\+\_\+generic\+\_\+impl.\+cpp\end{DoxyCompactItemize}
