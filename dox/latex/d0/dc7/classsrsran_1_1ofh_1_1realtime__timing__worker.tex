\doxysection{srsran\+::ofh\+::realtime\+\_\+timing\+\_\+worker Class Reference}
\hypertarget{classsrsran_1_1ofh_1_1realtime__timing__worker}{}\label{classsrsran_1_1ofh_1_1realtime__timing__worker}\index{srsran::ofh::realtime\_timing\_worker@{srsran::ofh::realtime\_timing\_worker}}


Realtime worker that generates OTA symbol notifications.  




{\ttfamily \#include $<$realtime\+\_\+timing\+\_\+worker.\+h$>$}



Inheritance diagram for srsran\+::ofh\+::realtime\+\_\+timing\+\_\+worker\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/d20/classsrsran_1_1ofh_1_1realtime__timing__worker__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::ofh\+::realtime\+\_\+timing\+\_\+worker\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d9/d4e/classsrsran_1_1ofh_1_1realtime__timing__worker__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1ofh_1_1realtime__timing__worker_a994dcfbc67f51cd045e83f4725b1b82b}{realtime\+\_\+timing\+\_\+worker}} (\mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{logger\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{executor\+\_\+}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1ofh_1_1realtime__worker__cfg}{realtime\+\_\+worker\+\_\+cfg}} \&cfg)
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ofh_1_1realtime__timing__worker_af9cc246af1b6d69cd469d72da9cf6075}{start}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Starts the Open Fronthaul operation. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ofh_1_1realtime__timing__worker_a4de778615a7541ef891ded5bf6a635c4}{stop}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Stops the Open Fronthaul operation. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ofh_1_1realtime__timing__worker_a17326c6f6f5771b428894aafe67f33d5}{subscribe}} (\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classsrsran_1_1ofh_1_1ota__symbol__boundary__notifier}{ota\+\_\+symbol\+\_\+boundary\+\_\+notifier}} \texorpdfstring{$\ast$}{*} $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{notifiers}}) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Subscribes the given notifiers to listen to OTA symbol boundary events. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1ofh_1_1ota__symbol__boundary__notifier__manager}{srsran\+::ofh\+::ota\+\_\+symbol\+\_\+boundary\+\_\+notifier\+\_\+manager}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{virtual}} {\bfseries \texorpdfstring{$\sim$}{\string~}ota\+\_\+symbol\+\_\+boundary\+\_\+notifier\+\_\+manager} ()=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{default}}
\begin{DoxyCompactList}\small\item\em Default destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Realtime worker that generates OTA symbol notifications. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1ofh_1_1realtime__timing__worker_a994dcfbc67f51cd045e83f4725b1b82b}\label{classsrsran_1_1ofh_1_1realtime__timing__worker_a994dcfbc67f51cd045e83f4725b1b82b} 
\index{srsran::ofh::realtime\_timing\_worker@{srsran::ofh::realtime\_timing\_worker}!realtime\_timing\_worker@{realtime\_timing\_worker}}
\index{realtime\_timing\_worker@{realtime\_timing\_worker}!srsran::ofh::realtime\_timing\_worker@{srsran::ofh::realtime\_timing\_worker}}
\doxysubsubsection{\texorpdfstring{realtime\_timing\_worker()}{realtime\_timing\_worker()}}
{\footnotesize\ttfamily realtime\+\_\+timing\+\_\+worker\+::realtime\+\_\+timing\+\_\+worker (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&}]{logger\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&}]{executor\+\_\+,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1ofh_1_1realtime__worker__cfg}{realtime\+\_\+worker\+\_\+cfg}} \&}]{cfg }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00075\ \ \ logger(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{logger\_}}),}
\DoxyCodeLine{00076\ \ \ executor(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{executor\_}}),}
\DoxyCodeLine{00077\ \ \ scs(cfg.\mbox{\hyperlink{structsrsran_1_1ofh_1_1realtime__worker__cfg_ab6b1666b5b834b9ec0529824f3f6e9cd}{scs}}),}
\DoxyCodeLine{00078\ \ \ nof\_symbols\_per\_slot(\mbox{\hyperlink{namespacesrsran_aa1d2bd5d3008afda19c0949d241a73f7}{get\_nsymb\_per\_slot}}(cfg.\mbox{\hyperlink{structsrsran_1_1ofh_1_1realtime__worker__cfg_a2753c7f305a2ddbb602771790a7d6c98}{cp}})),}
\DoxyCodeLine{00079\ \ \ nof\_symbols\_per\_sec(nof\_symbols\_per\_slot\ *\ \mbox{\hyperlink{namespacesrsran_a45b408115d2fba72e768ef375c59da19}{get\_nof\_slots\_per\_subframe}}(scs)\ *\ \mbox{\hyperlink{namespacesrsran_afe120c5fa59fc13e75fa47b6161f3ad3}{NOF\_SUBFRAMES\_PER\_FRAME}}\ *\ 100),}
\DoxyCodeLine{00080\ \ \ symbol\_duration(1\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{e9}}\ /\ nof\_symbols\_per\_sec),}
\DoxyCodeLine{00081\ \ \ sleep\_time(std::chrono::duration\_cast<std::chrono::nanoseconds>(symbol\_duration)\ /\ 15)}
\DoxyCodeLine{00082\ \{}
\DoxyCodeLine{00083\ \ \ gps\_offset\ =\ std::chrono::nanoseconds(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(std::round(cfg.\mbox{\hyperlink{structsrsran_1_1ofh_1_1realtime__worker__cfg_a681f7897335d285936a612b90948039f}{gps\_Alpha}}\ /\ 1.2288)))\ +}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::chrono::milliseconds(cfg.\mbox{\hyperlink{structsrsran_1_1ofh_1_1realtime__worker__cfg_afc7c2331710a55cc5a024a0884900f14}{gps\_Beta}}\ *\ 10)\ +\ std::chrono::seconds(UNIX\_TO\_GPS\_SECONDS\_OFFSET);}
\DoxyCodeLine{00085\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1ofh_1_1realtime__timing__worker_af9cc246af1b6d69cd469d72da9cf6075}\label{classsrsran_1_1ofh_1_1realtime__timing__worker_af9cc246af1b6d69cd469d72da9cf6075} 
\index{srsran::ofh::realtime\_timing\_worker@{srsran::ofh::realtime\_timing\_worker}!start@{start}}
\index{start@{start}!srsran::ofh::realtime\_timing\_worker@{srsran::ofh::realtime\_timing\_worker}}
\doxysubsubsection{\texorpdfstring{start()}{start()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} realtime\+\_\+timing\+\_\+worker\+::start (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Starts the Open Fronthaul operation. 

\begin{DoxyNote}{Note}
Caller will be blocked until the controller is fully started. 
\end{DoxyNote}


Implements \mbox{\hyperlink{classsrsran_1_1ofh_1_1controller_a706b37eb101376cb3cf04b0a5ec6947d}{srsran\+::ofh\+::controller}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00096\ \{}
\DoxyCodeLine{00097\ \ \ logger.info(\textcolor{stringliteral}{"{}Starting\ the\ realtime\ timing\ worker"{}});}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ std::promise<void>\ p;}
\DoxyCodeLine{00100\ \ \ std::future<void>\ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{fut}}\ =\ p.get\_future();}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \textcolor{keywordflow}{if}\ (!executor.\mbox{\hyperlink{classsrsran_1_1task__executor_a296e1c4285dafdbfcbc912c3006690a4}{defer}}([\textcolor{keyword}{this},\ \&p]()\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ status.store(worker\_status::running,\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Signal\ start()\ caller\ thread\ that\ the\ operation\ is\ complete.}}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ p.set\_value();}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ auto\ ns\_fraction\ \ \ \ =\ calculate\_ns\_fraction\_from(gps\_clock::now());}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ previous\_symb\_index\ =\ get\_symbol\_index(ns\_fraction,\ symbol\_duration);}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ timing\_loop();}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \}))\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a630688b51219f81c5a47ec5650326afc}{report\_fatal\_error}}(\textcolor{stringliteral}{"{}Unable\ to\ start\ the\ realtime\ timing\ worker"{}});}
\DoxyCodeLine{00112\ \ \ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \textcolor{comment}{//\ Block\ waiting\ for\ timing\ executor\ to\ start.}}
\DoxyCodeLine{00115\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{fut}}.wait();}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ logger.info(\textcolor{stringliteral}{"{}Started\ the\ realtime\ timing\ worker"{}});}
\DoxyCodeLine{00118\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ofh_1_1realtime__timing__worker_a4de778615a7541ef891ded5bf6a635c4}\label{classsrsran_1_1ofh_1_1realtime__timing__worker_a4de778615a7541ef891ded5bf6a635c4} 
\index{srsran::ofh::realtime\_timing\_worker@{srsran::ofh::realtime\_timing\_worker}!stop@{stop}}
\index{stop@{stop}!srsran::ofh::realtime\_timing\_worker@{srsran::ofh::realtime\_timing\_worker}}
\doxysubsubsection{\texorpdfstring{stop()}{stop()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} realtime\+\_\+timing\+\_\+worker\+::stop (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Stops the Open Fronthaul operation. 

\begin{DoxyNote}{Note}
Caller will be blocked until the controller is fully stopped. 
\end{DoxyNote}


Implements \mbox{\hyperlink{classsrsran_1_1ofh_1_1controller_a68916425ee20e2c5ca06bfbc0d3fc606}{srsran\+::ofh\+::controller}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00121\ \{}
\DoxyCodeLine{00122\ \ \ logger.info(\textcolor{stringliteral}{"{}Requesting\ stop\ of\ the\ realtime\ timing\ worker"{}});}
\DoxyCodeLine{00123\ \ \ status.store(worker\_status::stop\_requested,\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \textcolor{comment}{//\ Wait\ for\ the\ timing\ thread\ to\ stop.}}
\DoxyCodeLine{00126\ \ \ \textcolor{keywordflow}{while}\ (status.load(std::memory\_order\_acquire)\ !=\ worker\_status::stopped)\ \{}
\DoxyCodeLine{00127\ \ \ \ \ std::this\_thread::sleep\_for(std::chrono::milliseconds(1));}
\DoxyCodeLine{00128\ \ \ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ logger.info(\textcolor{stringliteral}{"{}Stopped\ the\ realtime\ timing\ worker"{}});}
\DoxyCodeLine{00131\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ofh_1_1realtime__timing__worker_a17326c6f6f5771b428894aafe67f33d5}\label{classsrsran_1_1ofh_1_1realtime__timing__worker_a17326c6f6f5771b428894aafe67f33d5} 
\index{srsran::ofh::realtime\_timing\_worker@{srsran::ofh::realtime\_timing\_worker}!subscribe@{subscribe}}
\index{subscribe@{subscribe}!srsran::ofh::realtime\_timing\_worker@{srsran::ofh::realtime\_timing\_worker}}
\doxysubsubsection{\texorpdfstring{subscribe()}{subscribe()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} realtime\+\_\+timing\+\_\+worker\+::subscribe (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classsrsran_1_1ofh_1_1ota__symbol__boundary__notifier}{ota\+\_\+symbol\+\_\+boundary\+\_\+notifier}} \texorpdfstring{$\ast$}{*} $>$}]{notifiers }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Subscribes the given notifiers to listen to OTA symbol boundary events. 



Implements \mbox{\hyperlink{classsrsran_1_1ofh_1_1ota__symbol__boundary__notifier__manager_a8327a3d5a75a441c6cfb99590efe559f}{srsran\+::ofh\+::ota\+\_\+symbol\+\_\+boundary\+\_\+notifier\+\_\+manager}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00217\ \{}
\DoxyCodeLine{00218\ \ \ std::vector<ota\_symbol\_boundary\_notifier*>\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{notifier\_list}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{notifiers}}.begin(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{notifiers}}.end());}
\DoxyCodeLine{00219\ \ \ \textcolor{keywordflow}{if}\ (!executor.\mbox{\hyperlink{classsrsran_1_1task__executor_a296e1c4285dafdbfcbc912c3006690a4}{defer}}([\textcolor{keyword}{this},\ n\ =\ std::move(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{notifier\_list}})]()\ \textcolor{keyword}{mutable}\ \{\ ota\_notifiers\ =\ std::move(n);\ \}))\ \{}
\DoxyCodeLine{00220\ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}Could\ not\ subscribe\ the\ given\ OTA\ symbol\ boundary\ notifiers"{}});}
\DoxyCodeLine{00221\ \ \ \}}
\DoxyCodeLine{00222\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/ofh/timing/realtime\+\_\+timing\+\_\+worker.\+h\item 
lib/ofh/timing/realtime\+\_\+timing\+\_\+worker.\+cpp\end{DoxyCompactItemize}
