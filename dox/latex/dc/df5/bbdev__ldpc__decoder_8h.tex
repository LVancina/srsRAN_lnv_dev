\doxysection{lib/hal/dpdk/bbdev/ldpc/bbdev\+\_\+ldpc\+\_\+decoder.h File Reference}
\hypertarget{bbdev__ldpc__decoder_8h}{}\label{bbdev__ldpc__decoder_8h}\index{lib/hal/dpdk/bbdev/ldpc/bbdev\_ldpc\_decoder.h@{lib/hal/dpdk/bbdev/ldpc/bbdev\_ldpc\_decoder.h}}


Definition of the specific functions used by the bbdeb-\/based hardware-\/accelerated LDPC decoder implementations.  


{\ttfamily \#include "{}srsran/adt/static\+\_\+vector.\+h"{}}\newline
{\ttfamily \#include "{}srsran/hal/phy/upper/channel\+\_\+processors/pusch/hw\+\_\+accelerator\+\_\+pusch\+\_\+dec.\+h"{}}\newline
{\ttfamily \#include $<$rte\+\_\+bbdev\+\_\+op.\+h$>$}\newline
Include dependency graph for bbdev\+\_\+ldpc\+\_\+decoder.\+h\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d20/bbdev__ldpc__decoder_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/de9/bbdev__ldpc__decoder_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Namespaces}
\begin{DoxyCompactItemize}
\item 
namespace \mbox{\hyperlink{namespacesrsran}{srsran}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{bbdev__ldpc__decoder_8h_a3917e1c4c2418b57f65abe349e23c55d}{srsran\+::dpdk\+::set\+\_\+ldpc\+\_\+dec\+\_\+bbdev\+\_\+config}} (\+::rte\+\_\+bbdev\+\_\+dec\+\_\+op \&op, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration}{srsran\+::hal\+::hw\+\_\+pusch\+\_\+decoder\+\_\+configuration}} \&cfg, \mbox{\hyperlink{classbool}{bool}} ext\+\_\+softbuffer)
\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{bbdev__ldpc__decoder_8h_aa6185de3e28387fac14217e74abb2f4d}{srsran\+::dpdk\+::set\+\_\+ldpc\+\_\+dec\+\_\+bbdev\+\_\+data}} (\+::rte\+\_\+bbdev\+\_\+dec\+\_\+op \&op, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&in\+\_\+mbuf\+\_\+pool, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&harq\+\_\+in\+\_\+mbuf\+\_\+pool, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&out\+\_\+mbuf\+\_\+pool, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&harq\+\_\+out\+\_\+mbuf\+\_\+pool, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} int8\+\_\+t $>$ data, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} int8\+\_\+t $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{soft\+\_\+data}}, \mbox{\hyperlink{classbool}{bool}} new\+\_\+data, \mbox{\hyperlink{classbool}{bool}} ext\+\_\+softbuffer, uint32\+\_\+t soft\+\_\+data\+\_\+len, \mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\+\_\+index}}, \mbox{\hyperlink{classunsigned}{unsigned}} absolute\+\_\+cb\+\_\+id, \mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&logger)
\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{bbdev__ldpc__decoder_8h_a3c4ceacdcd98d020d3117101450b8041}{srsran\+::dpdk\+::enqueue\+\_\+ldpc\+\_\+dec\+\_\+operation}} (\+::rte\+\_\+bbdev\+\_\+dec\+\_\+op \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\+\_\+ops}}, uint16\+\_\+t \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ldpc\+\_\+dec\+\_\+ops}}, uint16\+\_\+t id, uint16\+\_\+t \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\+\_\+queue\+\_\+id}}, \mbox{\hyperlink{classbool}{bool}} new\+\_\+data, \mbox{\hyperlink{classbool}{bool}} ext\+\_\+softbuffer, \mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&logger)
\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{bbdev__ldpc__decoder_8h_ab7e8dda0e01135f02c8373ccf4c10f70}{srsran\+::dpdk\+::dequeue\+\_\+ldpc\+\_\+dec\+\_\+operation}} (\+::rte\+\_\+bbdev\+\_\+dec\+\_\+op \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\+\_\+ops}}, uint16\+\_\+t \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ldpc\+\_\+dec\+\_\+ops}}, uint16\+\_\+t id, uint16\+\_\+t \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\+\_\+queue\+\_\+id}}, \mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&logger)
\item 
uint32\+\_\+t \mbox{\hyperlink{bbdev__ldpc__decoder_8h_af34eed669caa91d40b126ab6b207c7b1}{srsran\+::dpdk\+::read\+\_\+ldpc\+\_\+dec\+\_\+bbdev\+\_\+data}} (\+::rte\+\_\+bbdev\+\_\+dec\+\_\+op \&op, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ data, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ int8\+\_\+t $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{soft\+\_\+data}}, \mbox{\hyperlink{classbool}{bool}} new\+\_\+data, \mbox{\hyperlink{classbool}{bool}} ext\+\_\+softbuffer)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Definition of the specific functions used by the bbdeb-\/based hardware-\/accelerated LDPC decoder implementations. 



\doxysubsection{Function Documentation}
\Hypertarget{bbdev__ldpc__decoder_8h_ab7e8dda0e01135f02c8373ccf4c10f70}\label{bbdev__ldpc__decoder_8h_ab7e8dda0e01135f02c8373ccf4c10f70} 
\index{bbdev\_ldpc\_decoder.h@{bbdev\_ldpc\_decoder.h}!dequeue\_ldpc\_dec\_operation@{dequeue\_ldpc\_dec\_operation}}
\index{dequeue\_ldpc\_dec\_operation@{dequeue\_ldpc\_dec\_operation}!bbdev\_ldpc\_decoder.h@{bbdev\_ldpc\_decoder.h}}
\doxysubsubsection{\texorpdfstring{dequeue\_ldpc\_dec\_operation()}{dequeue\_ldpc\_dec\_operation()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classbool}{bool}} srsran\+::dpdk\+::dequeue\+\_\+ldpc\+\_\+dec\+\_\+operation (\begin{DoxyParamCaption}\item[{\+::rte\+\_\+bbdev\+\_\+dec\+\_\+op \&}]{dec\+\_\+ops,  }\item[{uint16\+\_\+t}]{ldpc\+\_\+dec\+\_\+ops,  }\item[{uint16\+\_\+t}]{id,  }\item[{uint16\+\_\+t}]{dec\+\_\+queue\+\_\+id,  }\item[{\mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&}]{logger }\end{DoxyParamCaption})}

Dequeues processed operations from the hardware-\/accelerated LDPC decoder. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em dec\+\_\+ops} & Array of decoder operation configuration structures. \\
\hline
\mbox{\texttt{ in}}  & {\em num\+\_\+dec\+\_\+ops} & Number of decoder operations (to be dequeued -\/ to the array). \\
\hline
\mbox{\texttt{ in}}  & {\em id} & bbdev ID of the hardware-\/accelerator. \\
\hline
\mbox{\texttt{ in}}  & {\em dec\+\_\+queue\+\_\+id} & bbdev ID of the queue used by the hardrware-\/accelerator. \\
\hline
\mbox{\texttt{ in}}  & {\em new\+\_\+data} & Indicates if the data is new or a retransmission. \\
\hline
\mbox{\texttt{ in}}  & {\em ext\+\_\+softbuffer} & Indicates if the soft-\/buffer implementation type. \\
\hline
\mbox{\texttt{ in}}  & {\em logger} & SRS logger. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00292\ \{}
\DoxyCodeLine{00293\ \ \ \textcolor{comment}{//\ Dequeue\ processed\ operations\ from\ the\ hardware-\/accelerator\ LDPC\ decoder.}}
\DoxyCodeLine{00294\ \ \ ::rte\_bbdev\_dec\_op*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ops}}\ \ \ \ \ \ \ \ \ \ \ \ \ =\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_ops}};}
\DoxyCodeLine{00295\ \ \ uint16\_t\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_deq\_dec\_ops}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_bbdev\_dequeue\_ldpc\_dec\_ops}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bbdev\_id}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_queue\_id}},\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ops}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_dec\_ops}});}
\DoxyCodeLine{00296\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_deq\_dec\_ops}}\ <=\ 0)\ \{}
\DoxyCodeLine{00297\ \ \ \ \ \textcolor{comment}{//\ logger.error("{}[bbdev]\ Couldn't\ dequeue\ new\ operations\ from\ the\ ldpc\ decoder."{});}}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00299\ \ \ \}}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00302\ \}}

\end{DoxyCode}
\Hypertarget{bbdev__ldpc__decoder_8h_a3c4ceacdcd98d020d3117101450b8041}\label{bbdev__ldpc__decoder_8h_a3c4ceacdcd98d020d3117101450b8041} 
\index{bbdev\_ldpc\_decoder.h@{bbdev\_ldpc\_decoder.h}!enqueue\_ldpc\_dec\_operation@{enqueue\_ldpc\_dec\_operation}}
\index{enqueue\_ldpc\_dec\_operation@{enqueue\_ldpc\_dec\_operation}!bbdev\_ldpc\_decoder.h@{bbdev\_ldpc\_decoder.h}}
\doxysubsubsection{\texorpdfstring{enqueue\_ldpc\_dec\_operation()}{enqueue\_ldpc\_dec\_operation()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classbool}{bool}} srsran\+::dpdk\+::enqueue\+\_\+ldpc\+\_\+dec\+\_\+operation (\begin{DoxyParamCaption}\item[{\+::rte\+\_\+bbdev\+\_\+dec\+\_\+op \&}]{dec\+\_\+ops,  }\item[{uint16\+\_\+t}]{ldpc\+\_\+dec\+\_\+ops,  }\item[{uint16\+\_\+t}]{id,  }\item[{uint16\+\_\+t}]{dec\+\_\+queue\+\_\+id,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{new\+\_\+data,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{ext\+\_\+softbuffer,  }\item[{\mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&}]{logger }\end{DoxyParamCaption})}

Enqueues new operations in the hardware-\/accelerated LDPC decoder. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em dec\+\_\+ops} & Array of decoder operation configuration structures. \\
\hline
\mbox{\texttt{ in}}  & {\em num\+\_\+dec\+\_\+ops} & Number of decoder operations (to be enqueued -\/ from the array). \\
\hline
\mbox{\texttt{ in}}  & {\em id} & bbdev ID of the hardware-\/accelerator. \\
\hline
\mbox{\texttt{ in}}  & {\em dec\+\_\+queue\+\_\+id} & bbdev ID of the queue used by the hardrware-\/accelerator. \\
\hline
\mbox{\texttt{ in}}  & {\em logger} & SRS logger. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00263\ \{}
\DoxyCodeLine{00264\ \ \ \textcolor{comment}{//\ Enqueue\ new\ operations\ on\ the\ hardware-\/accelerator\ LDPC\ decoder.}}
\DoxyCodeLine{00265\ \ \ ::rte\_bbdev\_dec\_op*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ops}}\ \ \ \ \ \ \ \ \ \ \ \ \ =\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_ops}};}
\DoxyCodeLine{00266\ \ \ uint16\_t\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_enq\_dec\_ops}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_bbdev\_enqueue\_ldpc\_dec\_ops}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bbdev\_id}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_queue\_id}},\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ops}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_dec\_ops}});}
\DoxyCodeLine{00267\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_enq\_dec\_ops}}\ <=\ 0)\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{comment}{//\ Free\ the\ input\ and\ output\ mbuf\ back\ to\ its\ original\ mbuf\ pools.}}
\DoxyCodeLine{00269\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_ops}}.ldpc\_dec.input.data);}
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{comment}{//\ Input\ HARQ\ combining\ data\ is\ only\ needed\ in\ case\ of\ a\ retransmission.}}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_data\ \&\&\ !ext\_softbuffer)\ \{}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_ops}}.ldpc\_dec.harq\_combined\_input.data);}
\DoxyCodeLine{00273\ \ \ \ \ \}}
\DoxyCodeLine{00274\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_ops}}.ldpc\_dec.hard\_output.data);}
\DoxyCodeLine{00275\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ext\_softbuffer)\ \{}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_ops}}.ldpc\_dec.harq\_combined\_output.data);}
\DoxyCodeLine{00277\ \ \ \ \ \}}
\DoxyCodeLine{00278\ \ \ \ \ logger.error(}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[bbdev]\ Couldn't\ enqueue\ new\ operations\ in\ the\ ldpc\ decoder.\ The\ operation\ will\ be\ dropped:\ acc\ [queue=\{\}]."{}},}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_queue\_id}});}
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00282\ \ \ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00285\ \}}

\end{DoxyCode}
\Hypertarget{bbdev__ldpc__decoder_8h_af34eed669caa91d40b126ab6b207c7b1}\label{bbdev__ldpc__decoder_8h_af34eed669caa91d40b126ab6b207c7b1} 
\index{bbdev\_ldpc\_decoder.h@{bbdev\_ldpc\_decoder.h}!read\_ldpc\_dec\_bbdev\_data@{read\_ldpc\_dec\_bbdev\_data}}
\index{read\_ldpc\_dec\_bbdev\_data@{read\_ldpc\_dec\_bbdev\_data}!bbdev\_ldpc\_decoder.h@{bbdev\_ldpc\_decoder.h}}
\doxysubsubsection{\texorpdfstring{read\_ldpc\_dec\_bbdev\_data()}{read\_ldpc\_dec\_bbdev\_data()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classuint32__t}{uint32\+\_\+t}} srsran\+::dpdk\+::read\+\_\+ldpc\+\_\+dec\+\_\+bbdev\+\_\+data (\begin{DoxyParamCaption}\item[{\+::rte\+\_\+bbdev\+\_\+dec\+\_\+op \&}]{op,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$}]{data,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ int8\+\_\+t $>$}]{soft\+\_\+data,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{new\+\_\+data,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{ext\+\_\+softbuffer }\end{DoxyParamCaption})}

Reads the contents of the bbdev output mbuffer structures from the hardware-\/accelerated LPDC decoder operations. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em op} & bbdev decoder operation configuration structure. \\
\hline
\mbox{\texttt{ out}}  & {\em data} & The output data from the hardware-\/accelerated LDPC decoder operations. \\
\hline
\mbox{\texttt{ out}}  & {\em soft\+\_\+data} & The output soft-\/data from the hardware-\/accelerated LDPC decoder operations. \\
\hline
\mbox{\texttt{ in}}  & {\em new\+\_\+data} & Indicates if the data is new or a retransmission. \\
\hline
\mbox{\texttt{ in}}  & {\em ext\+\_\+softbuffer} & Indicates if the soft-\/buffer implementation type. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Length of the soft-\/combining output data. 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{00309\ \{}
\DoxyCodeLine{00310\ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{new\_soft\_data\_len}}\ =\ 0;}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_mbuf}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.hard\_output.data;}
\DoxyCodeLine{00313\ \ \ uint16\_t\ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_len}}\ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rte\_pktmbuf\_data\_len}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}});}
\DoxyCodeLine{00314\ \ \ \textcolor{comment}{//\ Read\ the\ CB\ data.\ Note\ that\ a\ single\ read\ operation\ is\ performed\ per\ CB.\ The\ read\ assumes\ that\ the\ output\ data\ size}}
\DoxyCodeLine{00315\ \ \ \textcolor{comment}{//\ is\ below\ the\ requested\ mbuf\ size\ (by\ default\ set\ to\ the\ maximum\ supported\ value\ RTE\_BBDEV\_LDPC\_E\_MAX\_MBUF).}}
\DoxyCodeLine{00316\ \ \ uint16\_t\ offset\ \ \ =\ 0;\ \textcolor{comment}{//\ Note\ that\ a\ dedicated\ mbuf\ is\ used\ per\ segment.}}
\DoxyCodeLine{00317\ \ \ \mbox{\hyperlink{classuint8__t}{uint8\_t}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_data}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rte\_pktmbuf\_mtod\_offset}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}},\ \mbox{\hyperlink{classuint8__t}{uint8\_t}}*,\ offset);}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \textcolor{comment}{//\ Recover\ the\ decoded\ data.}}
\DoxyCodeLine{00320\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_memcpy}}(data.data(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_data}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_len}});}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ \textcolor{comment}{//\ Update\ the\ harq\ length\ for\ this\ CB.}}
\DoxyCodeLine{00323\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{new\_soft\_data\_len}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_output.length;}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \textcolor{comment}{//\ Only\ if\ the\ soft-\/buffer\ is\ implemented\ in\ the\ host\ then\ the\ output\ soft-\/data\ needs\ to\ be\ read\ from\ the\ accelerator}}
\DoxyCodeLine{00326\ \ \ \textcolor{comment}{//\ HARQ\ memory.}}
\DoxyCodeLine{00327\ \ \ \textcolor{keywordflow}{if}\ (!ext\_softbuffer)\ \{}
\DoxyCodeLine{00328\ \ \ \ \ \textcolor{comment}{//\ Push\ back\ the\ data\ from\ the\ accelerator\ HARQ\ memory.}}
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{comment}{//\ Note\ this\ will\ introduce\ non-\/negligible\ latency.}}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keywordtype}{int}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_status}}\ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.status;}
\DoxyCodeLine{00331\ \ \ \ \ \mbox{\hyperlink{classuint8__t}{uint8\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_iter\_count}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.iter\_count;}
\DoxyCodeLine{00332\ \ \ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_flags}}\ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.op\_flags;}
\DoxyCodeLine{00333\ \ \ \ \ ::rte\_bbdev\_dec\_op*\ op\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}};}
\DoxyCodeLine{00334\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.op\_flags\ =}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_INTERNAL\_HARQ\_MEMORY\_LOOPBACK}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_INTERNAL\_HARQ\_MEMORY\_IN\_ENABLE}};}
\DoxyCodeLine{00336\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_input.length\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{new\_soft\_data\_len}};}
\DoxyCodeLine{00337\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_bbdev\_enqueue\_ldpc\_dec\_ops}}(0,\ 0,\ \&op,\ 1);}
\DoxyCodeLine{00338\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ret}}\ =\ 0;}
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ret}}\ ==\ 0)\ \{}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ret}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_bbdev\_dequeue\_ldpc\_dec\_ops}}(0,\ 0,\ \&op,\ 1);}
\DoxyCodeLine{00341\ \ \ \ \ \}}
\DoxyCodeLine{00342\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.op\_flags\ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_flags}};}
\DoxyCodeLine{00343\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.status\ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_status}};}
\DoxyCodeLine{00344\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.iter\_count\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_iter\_count}};}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{comment}{//\ Retrieve\ the\ pointer\ to\ the\ mbuf\ used\ for\ the\ output\ soft-\/data.}}
\DoxyCodeLine{00347\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_mbuf}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_soft\_out}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_output.data;}
\DoxyCodeLine{00348\ \ \ \ \ \textcolor{comment}{//\ Note\ that\ te\ read\ assumes\ that\ the\ decoded\ soft-\/data\ size\ is\ below\ the\ requested\ mbuf\ size\ (by\ default\ set\ to\ the}}
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{comment}{//\ maximum\ supported\ value\ RTE\_BBDEV\_LDPC\_E\_MAX\_MBUF).}}
\DoxyCodeLine{00350\ \ \ \ \ uint16\_t\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{soft\_offset}}\ \ \ =\ 0;}
\DoxyCodeLine{00351\ \ \ \ \ int8\_t*\ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_soft\_data}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rte\_pktmbuf\_mtod\_offset}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_soft\_out}},\ int8\_t*,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{soft\_offset}});}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ output\ soft-\/data\ in\ the\ soft-\/buffer.}}
\DoxyCodeLine{00354\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_memcpy}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{soft\_data}}.data(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_soft\_data}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{new\_soft\_data\_len}});}
\DoxyCodeLine{00355\ \ \ \}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \textcolor{comment}{//\ Free\ the\ input\ and\ output\ mbuf\ back\ to\ its\ original\ mbuf\ pools.}}
\DoxyCodeLine{00358\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.input.data);}
\DoxyCodeLine{00359\ \ \ \textcolor{comment}{//\ Input\ HARQ\ combining\ data\ is\ only\ needed\ in\ case\ of\ a\ retransmission.}}
\DoxyCodeLine{00360\ \ \ \textcolor{keywordflow}{if}\ (!new\_data\ \&\&\ !ext\_softbuffer)\ \{}
\DoxyCodeLine{00361\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_input.data);}
\DoxyCodeLine{00362\ \ \ \}}
\DoxyCodeLine{00363\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.hard\_output.data);}
\DoxyCodeLine{00364\ \ \ \textcolor{keywordflow}{if}\ (!ext\_softbuffer)\ \{}
\DoxyCodeLine{00365\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_output.data);}
\DoxyCodeLine{00366\ \ \ \}}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{new\_soft\_data\_len}};}
\DoxyCodeLine{00369\ \}}

\end{DoxyCode}
\Hypertarget{bbdev__ldpc__decoder_8h_a3917e1c4c2418b57f65abe349e23c55d}\label{bbdev__ldpc__decoder_8h_a3917e1c4c2418b57f65abe349e23c55d} 
\index{bbdev\_ldpc\_decoder.h@{bbdev\_ldpc\_decoder.h}!set\_ldpc\_dec\_bbdev\_config@{set\_ldpc\_dec\_bbdev\_config}}
\index{set\_ldpc\_dec\_bbdev\_config@{set\_ldpc\_dec\_bbdev\_config}!bbdev\_ldpc\_decoder.h@{bbdev\_ldpc\_decoder.h}}
\doxysubsubsection{\texorpdfstring{set\_ldpc\_dec\_bbdev\_config()}{set\_ldpc\_dec\_bbdev\_config()}}
{\footnotesize\ttfamily void srsran\+::dpdk\+::set\+\_\+ldpc\+\_\+dec\+\_\+bbdev\+\_\+config (\begin{DoxyParamCaption}\item[{\+::rte\+\_\+bbdev\+\_\+dec\+\_\+op \&}]{op,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration}{srsran\+::hal\+::hw\+\_\+pusch\+\_\+decoder\+\_\+configuration}} \&}]{cfg,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{ext\+\_\+softbuffer }\end{DoxyParamCaption})}

Sets the contents of the bbdev configuration structure for the hardware-\/accelerated LPDC decoder operations. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em op} & bbdev decoder operation configuration structure. \\
\hline
\mbox{\texttt{ in}}  & {\em cfg} & PUSCH decoder configuration parameter-\/structure. \\
\hline
\mbox{\texttt{ in}}  & {\em ext\+\_\+softbuffer} & Indicates if the soft-\/buffer implementation type. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00034\ \{}
\DoxyCodeLine{00035\ \ \ \textcolor{comment}{//\ Base\ graph.}}
\DoxyCodeLine{00036\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.basegraph\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint8__t}{uint8\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration_a1ff9367db21d862a5c35095166fa7fc0}{base\_graph\_index}});}
\DoxyCodeLine{00037\ \ \ \textcolor{comment}{//\ Modulation.}}
\DoxyCodeLine{00038\ \ \ \textcolor{comment}{//\ Note\ that\ in\ terms\ of\ LDPC\ decoding,\ 'PI\_2\_BPSK'\ and\ 'BPSK'\ are\ the\ same.}}
\DoxyCodeLine{00039\ \ \ \textcolor{keywordtype}{unsigned}\ modulation\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint8__t}{uint8\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration_aee8234181a841ea5f5fa431388f4ea43}{modulation}});}
\DoxyCodeLine{00040\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.q\_m\ =\ modulation;}
\DoxyCodeLine{00041\ \ \ \textcolor{keywordflow}{if}\ (modulation\ ==\ 0)\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.q\_m\ =\ 1;}
\DoxyCodeLine{00043\ \ \ \}}
\DoxyCodeLine{00044\ \ \ \textcolor{comment}{//\ RV\ index.}}
\DoxyCodeLine{00045\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.rv\_index\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint8__t}{uint8\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration_a3723d9b1e236033f8bdbe22a0504f475}{rv}});}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \textcolor{comment}{//\ CB\ mode\ is\ currently\ forced\ (TB\ mode\ is\ not\ yet\ supported\ by\ bbdev/ACC100).\ CB\ size\ is\ in\ bytes.}}
\DoxyCodeLine{00048\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.code\_block\_mode\ =\ 1;}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{//\ Set\ the\ CB-\/specific\ parameters.}}
\DoxyCodeLine{00051\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.cb\_params.e\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint32__t}{uint32\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration_a2cebfcc4849d07fcffac33ca06f8266f}{cw\_length}});}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{//\ Lifting\ size.}}
\DoxyCodeLine{00054\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.z\_c\ =\ \textcolor{keyword}{static\_cast<}uint16\_t\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration_ac7344e31aadb72e5a3af7542429b1888}{lifting\_size}});}
\DoxyCodeLine{00055\ \ \ \textcolor{comment}{//\ Filler\ bits.}}
\DoxyCodeLine{00056\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.n\_filler\ =\ \textcolor{keyword}{static\_cast<}uint16\_t\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration_acfe3c79676714f249baf4bcce99e6a48}{nof\_filler\_bits}});}
\DoxyCodeLine{00057\ \ \ \textcolor{comment}{//\ Length\ of\ the\ circular\ buffer\ in\ bits,\ as\ described\ in\ TS38.212\ Section\ 5.4.2.1.}}
\DoxyCodeLine{00058\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.n\_cb\ =\ \textcolor{keyword}{static\_cast<}uint16\_t\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration_a8eddc6091e8c9d068c8350dd038aed9f}{Ncb}});}
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//\ Maximum\ number\ of\ iterations\ to\ perform\ in\ decoding\ CB.}}
\DoxyCodeLine{00060\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.iter\_max\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint8__t}{uint8\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration_a06e49027afd834f7b20b6b786c1481e0}{max\_nof\_ldpc\_iterations}});}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \textcolor{comment}{//\ TBD:\ a\ certain\ operation\ mode\ is\ assumed,\ see\ if\ a\ detailed\ hardware-\/accelerator\ capabilities\ checking\ is\ required?}}
\DoxyCodeLine{00063\ \ \ \textcolor{comment}{//\ Define\ the\ PDSCH\ decoder\ operation\ flags.}}
\DoxyCodeLine{00064\ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ =\ 0;}
\DoxyCodeLine{00065\ \ \ \textcolor{comment}{//\ Only\ CRC24B\ checking\ is\ supported\ by\ the\ hardware-\/accelerator.}}
\DoxyCodeLine{00066\ \ \ \textcolor{keywordflow}{if}\ (cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration_a1cb6138f7240386dd4a89fdac54efa6c}{cb\_crc\_type}}\ ==\ srsran::hal::hw\_dec\_cb\_crc\_type::CRC24B)\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{comment}{//\ Codeblock\ CRC-\/24B\ checking\ is\ always\ implemented\ by\ the\ accelerator\ (set\ the\ bit).}}
\DoxyCodeLine{00068\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ |=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_CRC\_TYPE\_24B\_CHECK}};}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{//\ Dropping\ of\ last\ CRC\ bits\ decoding\ output\ is\ always\ implemented\ in\ the\ accelerator\ (set\ the\ bit).}}
\DoxyCodeLine{00070\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ |=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_CRC\_TYPE\_24B\_DROP}};}
\DoxyCodeLine{00071\ \ \ \}}
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ Bit-\/level\ de-\/interleaver\ is\ always\ implemented\ by\ the\ accelerator\ (clear\ the\ bit).}}
\DoxyCodeLine{00073\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ \&=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\string~RTE\_BBDEV\_LDPC\_DEINTERLEAVER\_BYPASS}};}
\DoxyCodeLine{00074\ \ \ \textcolor{comment}{//\ Input\ HARQ\ combining\ data\ is\ only\ needed\ in\ case\ of\ a\ retransmission.}}
\DoxyCodeLine{00075\ \ \ \textcolor{keywordflow}{if}\ (!cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration_a07e82ce3218a7aa9c34182e306b6017b}{new\_data}})\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//\ HARQ\ combined\ input\ stream\ is\ enabled\ in\ the\ accelerator\ (set\ the\ bit).}}
\DoxyCodeLine{00077\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ |=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_HQ\_COMBINE\_IN\_ENABLE}};}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ the\ soft-\/buffer\ is\ implemented\ in\ the\ accelerator\ or\ in\ the\ host.}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordflow}{if}\ (ext\_softbuffer)\ \{}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \textcolor{comment}{//\ HARQ\ input\ is\ provided\ from\ the\ accelerator's\ internal\ memory\ (set\ the\ bit).}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ |=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_INTERNAL\_HARQ\_MEMORY\_IN\_ENABLE}};}
\DoxyCodeLine{00083\ \ \ \ \ \}}
\DoxyCodeLine{00084\ \ \ \}}
\DoxyCodeLine{00085\ \ \ \textcolor{comment}{//\ HARQ\ combined\ output\ stream\ is\ always\ enabled\ in\ the\ accelerator\ (set\ the\ bit).}}
\DoxyCodeLine{00086\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ |=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_HQ\_COMBINE\_OUT\_ENABLE}};}
\DoxyCodeLine{00087\ \ \ \textcolor{comment}{//\ Check\ if\ the\ soft-\/buffer\ is\ implemented\ in\ the\ accelerator\ or\ in\ the\ host.}}
\DoxyCodeLine{00088\ \ \ \textcolor{keywordflow}{if}\ (ext\_softbuffer)\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ HARQ\ output\ is\ provided\ to\ the\ accelerator's\ internal\ memory\ (set\ the\ bit).}}
\DoxyCodeLine{00090\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ |=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_INTERNAL\_HARQ\_MEMORY\_OUT\_ENABLE}};}
\DoxyCodeLine{00091\ \ \ \}}
\DoxyCodeLine{00092\ \ \ \textcolor{comment}{//\ LDPC\ decoder\ is\ always\ implemented\ by\ the\ accelerator\ (clear\ the\ bit).}}
\DoxyCodeLine{00093\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ \&=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\string~RTE\_BBDEV\_LDPC\_DECODE\_BYPASS}};}
\DoxyCodeLine{00094\ \ \ \textcolor{comment}{//\ If\ early\ stop\ is\ requested,\ enable\ it\ in\ the\ accerlerator\ (set\ the\ bit,\ otherwise\ clear\ it).}}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{if}\ (cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pusch__decoder__configuration_a246b2f08a35094b6cfcb47c72abac9cb}{use\_early\_stop}})\ \{}
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ |=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_ITERATION\_STOP\_ENABLE}};}
\DoxyCodeLine{00097\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ \&=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\string~RTE\_BBDEV\_LDPC\_ITERATION\_STOP\_ENABLE}};}
\DoxyCodeLine{00099\ \ \ \}}
\DoxyCodeLine{00100\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.op\_flags\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}};}
\DoxyCodeLine{00101\ \}}

\end{DoxyCode}
\Hypertarget{bbdev__ldpc__decoder_8h_aa6185de3e28387fac14217e74abb2f4d}\label{bbdev__ldpc__decoder_8h_aa6185de3e28387fac14217e74abb2f4d} 
\index{bbdev\_ldpc\_decoder.h@{bbdev\_ldpc\_decoder.h}!set\_ldpc\_dec\_bbdev\_data@{set\_ldpc\_dec\_bbdev\_data}}
\index{set\_ldpc\_dec\_bbdev\_data@{set\_ldpc\_dec\_bbdev\_data}!bbdev\_ldpc\_decoder.h@{bbdev\_ldpc\_decoder.h}}
\doxysubsubsection{\texorpdfstring{set\_ldpc\_dec\_bbdev\_data()}{set\_ldpc\_dec\_bbdev\_data()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classbool}{bool}} srsran\+::dpdk\+::set\+\_\+ldpc\+\_\+dec\+\_\+bbdev\+\_\+data (\begin{DoxyParamCaption}\item[{\+::rte\+\_\+bbdev\+\_\+dec\+\_\+op \&}]{op,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&}]{in\+\_\+mbuf\+\_\+pool,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&}]{harq\+\_\+in\+\_\+mbuf\+\_\+pool,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&}]{out\+\_\+mbuf\+\_\+pool,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&}]{harq\+\_\+out\+\_\+mbuf\+\_\+pool,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} int8\+\_\+t $>$}]{data,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} int8\+\_\+t $>$}]{soft\+\_\+data,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{new\+\_\+data,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{ext\+\_\+softbuffer,  }\item[{uint32\+\_\+t}]{soft\+\_\+data\+\_\+len,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{cb\+\_\+index,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{absolute\+\_\+cb\+\_\+id,  }\item[{\mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&}]{logger }\end{DoxyParamCaption})}

Sets the contents of the bbdev input mbuffer structures for the hardware-\/accelerated LPDC decoder operations. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em op} & bbdev decoder operation configuration structure. \\
\hline
\mbox{\texttt{ in}}  & {\em in\+\_\+mbuf\+\_\+pool} & Input data mbuf pool for the hardware-\/accelerated LDPC decoder operations. \\
\hline
\mbox{\texttt{ in}}  & {\em harq\+\_\+in\+\_\+mbuf\+\_\+pool} & Input soft-\/data mbuf pool for the hardware-\/accelerated LDPC decoder operations. \\
\hline
\mbox{\texttt{ in}}  & {\em out\+\_\+mbuf\+\_\+pool} & Output data mbuf pool for the hardware-\/accelerated LDPC decoder operations. \\
\hline
\mbox{\texttt{ in}}  & {\em harq\+\_\+out\+\_\+mbuf\+\_\+pool} & Output soft-\/data mbuf pool for the hardware-\/accelerated LDPC decoder operations. \\
\hline
\mbox{\texttt{ in}}  & {\em data} & The input data to the hardware-\/accelerated LDPC decoder operations. \\
\hline
\mbox{\texttt{ in}}  & {\em soft\+\_\+data} & The input soft-\/data to the hardware-\/accelerated LDPC decoder operations. \\
\hline
\mbox{\texttt{ in}}  & {\em new\+\_\+data} & Indicates if the data is new or a retransmission. \\
\hline
\mbox{\texttt{ in}}  & {\em ext\+\_\+softbuffer} & Indicates if the soft-\/buffer implementation type. \\
\hline
\mbox{\texttt{ in}}  & {\em soft\+\_\+data\+\_\+len} & Length of the soft-\/combining input data. \\
\hline
\mbox{\texttt{ in}}  & {\em cb\+\_\+index} & Index of the CB (within the TB). \\
\hline
\mbox{\texttt{ in}}  & {\em absolute\+\_\+cb\+\_\+id} & Unique ID of associated to the CB in the soft-\/buffer and HARQ ACK context entry. \\
\hline
\mbox{\texttt{ in}}  & {\em logger} & SRS logger. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00116\ \{}
\DoxyCodeLine{00117\ \ \ \textcolor{comment}{//\ Allocate\ an\ mbuf\ for\ the\ input\ data\ from\ the\ received\ mempool.}}
\DoxyCodeLine{00118\ \ \ \textcolor{keywordtype}{char}*\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_data}};}
\DoxyCodeLine{00119\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_mbuf}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_in}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_alloc}}(\&in\_mbuf\_pool);}
\DoxyCodeLine{00120\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_in}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00121\ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}[bbdev]\ Not\ enough\ mbufs\ in\ the\ input\ ldpc\ decoder\ mbuf\ pool."{}});}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00123\ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \textcolor{comment}{//\ Set\ the\ memory\ pointers\ for\ the\ input\ data,\ accounting\ for\ the\ offset\ of\ the\ current\ segment.}}
\DoxyCodeLine{00126\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.input.data\ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_in}};}
\DoxyCodeLine{00127\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.input.offset\ =\ 0;\ \textcolor{comment}{//\ Note\ that\ a\ dedicated\ mbuf\ is\ used\ per\ CB.}}
\DoxyCodeLine{00128\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.input.length\ =\ 0;}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \textcolor{comment}{//\ Allocate\ the\ required\ bytes\ in\ the\ mbuf\ and\ update\ the\ memory\ pointers.}}
\DoxyCodeLine{00131\ \ \ uint16\_t\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cw\_len}}\ =\ data.size();}
\DoxyCodeLine{00132\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_data}}\ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_append}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_in}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cw\_len}});}
\DoxyCodeLine{00133\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_data}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{comment}{//\ Free\ the\ input\ mbuf\ back\ to\ its\ original\ mbuf\ pools.}}
\DoxyCodeLine{00135\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_in}});}
\DoxyCodeLine{00136\ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}[bbdev]\ Couldn't\ append\ \{\}\ bytes\ to\ the\ ldpc\ decoder\ input\ mbuf."{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cw\_len}});}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00138\ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \textcolor{comment}{//\ Copy\ the\ CB\ data.\ Note\ that\ a\ single\ copy\ operation\ is\ performed\ per\ CB.\ The\ copy\ assumes\ that\ the\ input\ data\ size}}
\DoxyCodeLine{00141\ \ \ \textcolor{comment}{//\ is\ below\ the\ requested\ mbuf\ size\ (by\ default\ set\ to\ the\ maximum\ supported\ value\ RTE\_BBDEV\_LDPC\_E\_MAX\_MBUF).}}
\DoxyCodeLine{00142\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_memcpy}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_data}},\ data.begin(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cw\_len}});}
\DoxyCodeLine{00143\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.input.length\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cw\_len}};}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \textcolor{comment}{//\ Harq\ offset\ for\ the\ current\ CB\ (based\ on\ its\ unique\ absolute\ ID).}}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_offset}}\ =\ srsran::hal::HARQ\_INCR\ *\ absolute\_cb\_id;}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \textcolor{comment}{//\ Input\ HARQ\ combining\ data\ is\ only\ needed\ in\ case\ of\ a\ retransmission.}}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{if}\ (!new\_data)\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{//\ Copy\ of\ HARQ\ input\ data\ is\ only\ needed\ if\ the\ soft-\/buffer\ is\ implemented\ in\ the\ host.}}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ext\_softbuffer)\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \textcolor{comment}{//\ Allocate\ an\ mbuf\ for\ the\ input\ soft-\/data\ from\ the\ received\ mempool.}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \textcolor{keywordtype}{char}*\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{soft\_input\_data}};}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_mbuf}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_soft\_in}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_alloc}}(\&harq\_in\_mbuf\_pool);}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_soft\_in}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}[bbdev]\ Not\ enough\ mbufs\ in\ the\ harq\ input\ ldpc\ decoder\ mbuf\ pool."{}});}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ memory\ pointers\ for\ the\ input\ soft-\/data.}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \textcolor{comment}{//\ When\ using\ the\ host\ memory\ the\ offset\ is\ provided\ by\ the\ input\ span\ pointers.}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_output\_len}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_output.length;}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_input.data\ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_soft\_in}};}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_input.offset\ =\ 0;}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_input.length\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_output\_len}};}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \ \ \textcolor{comment}{//\ Allocate\ the\ required\ bytes\ in\ the\ mbuf\ and\ update\ the\ memory\ pointers.}}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{soft\_input\_data}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_append}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_soft\_in}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_output\_len}});}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{soft\_input\_data}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Free\ the\ input\ and\ input\ soft-\/data\ mbufs\ back\ to\ its\ original\ mbuf\ pools.}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.input.data);}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_soft\_in}});}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}[bbdev]\ Couldn't\ append\ \{\}\ bytes\ to\ the\ ldpc\ decoder\ harq\ input\ mbuf."{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_output\_len}});}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ input\ soft-\/data\ located\ before\ the\ filler\ bits\ in\ the\ soft-\/buffer.\ Note\ that\ the\ copy\ assumes\ that\ the}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \textcolor{comment}{//\ input\ soft-\/data\ size\ is\ below\ the\ requested\ mbuf\ size\ (by\ default\ set\ to\ the\ maximum\ supported\ value}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \textcolor{comment}{//\ RTE\_BBDEV\_LDPC\_E\_MAX\_MBUF).}}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_memcpy}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{soft\_input\_data}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{soft\_data}}.begin(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_output\_len}});}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \ \ \textcolor{comment}{//\ \ Preload\ the\ accelerator\ HARQ\ memory\ and\ adjust\ the\ offset.}}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \textcolor{comment}{//\ \ Note\ this\ will\ introduce\ non-\/negligible\ latency.}}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_bbdev\_op\_data}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_hc\_in}}\ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_input;}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_bbdev\_op\_data}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_hc\_out}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_output;}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_flags}}\ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.op\_flags;}
\DoxyCodeLine{00187\ \ \ \ \ \ \ rte\_bbdev\_dec\_op*\ \ \ op\ \ \ \ \ \ \ \ \ \ \ =\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}};}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.op\_flags\ =}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_INTERNAL\_HARQ\_MEMORY\_LOOPBACK}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_INTERNAL\_HARQ\_MEMORY\_OUT\_ENABLE}};}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_bbdev\_enqueue\_ldpc\_dec\_ops}}(0,\ 0,\ \&op,\ 1);}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ret}}\ =\ 0;}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ret}}\ ==\ 0)\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ret}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_bbdev\_dequeue\_ldpc\_dec\_ops}}(0,\ 0,\ \&op,\ 1);}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.op\_flags\ \ \ \ \ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_flags}};}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_input\ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_hc\_in}};}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_output\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{saved\_hc\_out}};}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \textcolor{comment}{//\ When\ using\ the\ accelerator's\ HARQ\ memory\ only\ pointers\ need\ updating.}}
\DoxyCodeLine{00199\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ the\ HARQ\ input\ memory\ offset\ and\ length.}}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \textcolor{comment}{//\ When\ using\ the\ accelerator\ memory\ fixed\ CB\ offsets\ are\ employed.}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_input.offset\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_offset}};}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_input.length\ =\ soft\_data\_len;}
\DoxyCodeLine{00204\ \ \ \ \ \}}
\DoxyCodeLine{00205\ \ \ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \textcolor{comment}{//\ Allocate\ an\ mbuf\ for\ the\ output\ data\ from\ the\ received\ mempool.}}
\DoxyCodeLine{00208\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_mbuf}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_alloc}}(\&out\_mbuf\_pool);}
\DoxyCodeLine{00209\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{comment}{//\ Free\ the\ input\ and\ input\ soft-\/data\ mbufs\ back\ to\ its\ original\ mbuf\ pools.}}
\DoxyCodeLine{00211\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.input.data);}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_data\ \&\&\ !ext\_softbuffer)\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_input.data);}
\DoxyCodeLine{00214\ \ \ \ \ \}}
\DoxyCodeLine{00215\ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}[bbdev]\ Not\ enough\ mbufs\ in\ the\ output\ ldpc\ decoder\ mbuf\ pool."{}});}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00217\ \ \ \}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \textcolor{comment}{//\ Set\ the\ memory\ pointers\ for\ the\ output\ data,\ accounting\ for\ the\ offset\ of\ the\ current\ segment.}}
\DoxyCodeLine{00220\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.hard\_output.data\ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}};}
\DoxyCodeLine{00221\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.hard\_output.offset\ =\ 0;\ \textcolor{comment}{//\ Note\ that\ a\ dedicated\ mbuf\ is\ used\ per\ segment.}}
\DoxyCodeLine{00222\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.hard\_output.length\ =\ 0;}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \textcolor{comment}{//\ Update\ the\ HARQ\ output\ memory\ offset\ and\ length.}}
\DoxyCodeLine{00225\ \ \ \textcolor{comment}{//\ Host\ memory\ (offset\ is\ provided\ by\ the\ input\ span\ pointers).}}
\DoxyCodeLine{00226\ \ \ \textcolor{keywordflow}{if}\ (!ext\_softbuffer)\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_output.offset\ =\ 0;}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{comment}{//\ Accelerator\ memory\ (fixed\ CB\ offsets\ are\ used).}}
\DoxyCodeLine{00229\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_output.offset\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_offset}};}
\DoxyCodeLine{00231\ \ \ \}}
\DoxyCodeLine{00232\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_output.length\ =\ 0;}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \textcolor{comment}{//\ Reading\ of\ HARQ\ output\ data\ is\ only\ needed\ if\ the\ soft-\/buffer\ is\ implemented\ in\ the\ host.}}
\DoxyCodeLine{00235\ \ \ \textcolor{keywordflow}{if}\ (!ext\_softbuffer)\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{comment}{//\ Allocate\ an\ mbuf\ for\ the\ output\ soft-\/data\ from\ the\ received\ mempool.}}
\DoxyCodeLine{00237\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_mempool}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_out\_pool}}\ \ \ =\ \&harq\_out\_mbuf\_pool;}
\DoxyCodeLine{00238\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_mbuf}}*\ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_soft\_out}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_alloc}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_out\_pool}});}
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_soft\_out}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \textcolor{comment}{//\ Free\ the\ input\ and\ input\ soft-\/data\ mbufs\ back\ to\ its\ original\ mbuf\ pools.}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.input.data);}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_data\ \&\&\ !ext\_softbuffer)\ \{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_input.data);}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00245\ \ \ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}[bbdev]\ Not\ enough\ mbufs\ in\ the\ harq\ output\ ldpc\ decoder\ mbuf\ pool."{}});}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00247\ \ \ \ \ \}}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ memory\ pointers\ for\ the\ output\ data.}}
\DoxyCodeLine{00250\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dec\_op}}.ldpc\_dec.harq\_combined\_output.data\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_soft\_out}};}
\DoxyCodeLine{00251\ \ \ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00254\ \}}

\end{DoxyCode}
