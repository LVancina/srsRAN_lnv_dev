\doxysection{srsran\+::ra\+\_\+scheduler Class Reference}
\hypertarget{classsrsran_1_1ra__scheduler}{}\label{classsrsran_1_1ra__scheduler}\index{srsran::ra\_scheduler@{srsran::ra\_scheduler}}


Scheduler for PRACH occasions, RAR PDSCHs and Msg3 PUSCH grants.  




{\ttfamily \#include $<$ra\+\_\+scheduler.\+h$>$}



Collaboration diagram for srsran\+::ra\+\_\+scheduler\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=222pt]{d3/d2b/classsrsran_1_1ra__scheduler__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1ra__scheduler_a89578305f501d2e337f641499cb1a2cf}{ra\+\_\+scheduler}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1scheduler__ra__expert__config}{scheduler\+\_\+ra\+\_\+expert\+\_\+config}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sched\+\_\+cfg\+\_\+}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1cell__configuration}{cell\+\_\+configuration}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cfg\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1pdcch__resource__allocator}{pdcch\+\_\+resource\+\_\+allocator}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\+\_\+sched\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1scheduler__event__logger}{scheduler\+\_\+event\+\_\+logger}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ev\+\_\+logger\+\_\+}})
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ra__scheduler_a458acf6cb413052be3cfa62d81d67387}{handle\+\_\+rach\+\_\+indication}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1rach__indication__message}{rach\+\_\+indication\+\_\+message}} \&msg)
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ra__scheduler_a0e269324af31260a0a428f36e491a63c}{handle\+\_\+crc\+\_\+indication}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1ul__crc__indication}{ul\+\_\+crc\+\_\+indication}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{crc\+\_\+ind}})
\begin{DoxyCompactList}\small\item\em Handle UL CRC directed at Msg3 HARQ. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ra__scheduler_a218ba7f4d2fe7d8d8f3f6b6e8eb82066}{run\+\_\+slot}} (\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator}{cell\+\_\+resource\+\_\+allocator}} \&res\+\_\+alloc)
\begin{DoxyCompactList}\small\item\em Allocate pending RARs + Msg3s. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Scheduler for PRACH occasions, RAR PDSCHs and Msg3 PUSCH grants. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1ra__scheduler_a89578305f501d2e337f641499cb1a2cf}\label{classsrsran_1_1ra__scheduler_a89578305f501d2e337f641499cb1a2cf} 
\index{srsran::ra\_scheduler@{srsran::ra\_scheduler}!ra\_scheduler@{ra\_scheduler}}
\index{ra\_scheduler@{ra\_scheduler}!srsran::ra\_scheduler@{srsran::ra\_scheduler}}
\doxysubsubsection{\texorpdfstring{ra\_scheduler()}{ra\_scheduler()}}
{\footnotesize\ttfamily ra\+\_\+scheduler\+::ra\+\_\+scheduler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1scheduler__ra__expert__config}{scheduler\+\_\+ra\+\_\+expert\+\_\+config}} \&}]{sched\+\_\+cfg\+\_\+,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1cell__configuration}{cell\+\_\+configuration}} \&}]{cfg\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1pdcch__resource__allocator}{pdcch\+\_\+resource\+\_\+allocator}} \&}]{pdcch\+\_\+sched\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1scheduler__event__logger}{scheduler\+\_\+event\+\_\+logger}} \&}]{ev\+\_\+logger\+\_\+ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00089\ \ \ sched\_cfg(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sched\_cfg\_}}),}
\DoxyCodeLine{00090\ \ \ cell\_cfg(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cellcfg\_}}),}
\DoxyCodeLine{00091\ \ \ pdcch\_sch(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_sch\_}}),}
\DoxyCodeLine{00092\ \ \ ev\_logger(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ev\_logger\_}}),}
\DoxyCodeLine{00093\ \ \ ra\_win\_nof\_slots(cell\_cfg.ul\_cfg\_common.init\_ul\_bwp.rach\_cfg\_common-\/>rach\_cfg\_generic.ra\_resp\_window),}
\DoxyCodeLine{00094\ \ \ ra\_crb\_lims(}
\DoxyCodeLine{00095\ \ \ \ \ \ \ pdsch\_helper::get\_ra\_crb\_limits\_common(cell\_cfg.dl\_cfg\_common.init\_dl\_bwp,}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cell\_cfg.dl\_cfg\_common.init\_dl\_bwp.pdcch\_common.\mbox{\hyperlink{structsrsran_1_1pdcch__config__common_abb3e2d05a704bec469946b206ad200f7}{ra\_search\_space\_id}})),}
\DoxyCodeLine{00097\ \ \ prach\_format\_is\_long(\mbox{\hyperlink{namespacesrsran_aaea6c484cd5f8113a5b11434d68e371b}{is\_long\_preamble}}(}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58b0f14b15728d7d3d269968352a3ca8}{prach\_configuration\_get}}(band\_helper::get\_freq\_range(cell\_cfg.band),}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ band\_helper::get\_duplex\_mode(cell\_cfg.band),}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cell\_cfg.ul\_cfg\_common.init\_ul\_bwp.rach\_cfg\_common-\/>rach\_cfg\_generic.prach\_config\_index)}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ .\mbox{\hyperlink{structsrsran_1_1prach__configuration_a8514f238ece852fa1aac2ff106e4b720}{format}})),}
\DoxyCodeLine{00102\ \ \ pending\_msg3s(MAX\_NOF\_MSG3)}
\DoxyCodeLine{00103\ \{}
\DoxyCodeLine{00104\ \ \ \textcolor{comment}{//\ Precompute\ RAR\ PDSCH\ and\ DCI\ PDUs.}}
\DoxyCodeLine{00105\ \ \ precompute\_rar\_fields();}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \textcolor{comment}{//\ Precompute\ Msg3\ PUSCH\ and\ DCI\ PDUs.}}
\DoxyCodeLine{00108\ \ \ precompute\_msg3\_pdus();}
\DoxyCodeLine{00109\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1ra__scheduler_a0e269324af31260a0a428f36e491a63c}\label{classsrsran_1_1ra__scheduler_a0e269324af31260a0a428f36e491a63c} 
\index{srsran::ra\_scheduler@{srsran::ra\_scheduler}!handle\_crc\_indication@{handle\_crc\_indication}}
\index{handle\_crc\_indication@{handle\_crc\_indication}!srsran::ra\_scheduler@{srsran::ra\_scheduler}}
\doxysubsubsection{\texorpdfstring{handle\_crc\_indication()}{handle\_crc\_indication()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} ra\+\_\+scheduler\+::handle\+\_\+crc\+\_\+indication (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1ul__crc__indication}{ul\+\_\+crc\+\_\+indication}} \&}]{crc\+\_\+ind }\end{DoxyParamCaption})}



Handle UL CRC directed at Msg3 HARQ. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00277\ \{}
\DoxyCodeLine{00278\ \ \ pending\_crcs.push(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{crc\_ind}});}
\DoxyCodeLine{00279\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ra__scheduler_a458acf6cb413052be3cfa62d81d67387}\label{classsrsran_1_1ra__scheduler_a458acf6cb413052be3cfa62d81d67387} 
\index{srsran::ra\_scheduler@{srsran::ra\_scheduler}!handle\_rach\_indication@{handle\_rach\_indication}}
\index{handle\_rach\_indication@{handle\_rach\_indication}!srsran::ra\_scheduler@{srsran::ra\_scheduler}}
\doxysubsubsection{\texorpdfstring{handle\_rach\_indication()}{handle\_rach\_indication()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} ra\+\_\+scheduler\+::handle\+\_\+rach\+\_\+indication (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1rach__indication__message}{rach\+\_\+indication\+\_\+message}} \&}]{msg }\end{DoxyParamCaption})}

Enqueue RACH indication \begin{DoxyRemark}{Remarks}
See TS 38.\+321, 5.\+1.\+3 -\/ RAP transmission. 
\end{DoxyRemark}

\begin{DoxyCode}{0}
\DoxyCodeLine{00202\ \{}
\DoxyCodeLine{00203\ \ \ \textcolor{comment}{//\ Buffer\ detected\ RACHs\ to\ be\ handled\ in\ next\ slot.}}
\DoxyCodeLine{00204\ \ \ pending\_rachs.push(msg);}
\DoxyCodeLine{00205\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ra__scheduler_a218ba7f4d2fe7d8d8f3f6b6e8eb82066}\label{classsrsran_1_1ra__scheduler_a218ba7f4d2fe7d8d8f3f6b6e8eb82066} 
\index{srsran::ra\_scheduler@{srsran::ra\_scheduler}!run\_slot@{run\_slot}}
\index{run\_slot@{run\_slot}!srsran::ra\_scheduler@{srsran::ra\_scheduler}}
\doxysubsubsection{\texorpdfstring{run\_slot()}{run\_slot()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} ra\+\_\+scheduler\+::run\+\_\+slot (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator}{cell\+\_\+resource\+\_\+allocator}} \&}]{res\+\_\+alloc }\end{DoxyParamCaption})}



Allocate pending RARs + Msg3s. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00323\ \{}
\DoxyCodeLine{00324\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1slot__point}{slot\_point}}\ pdcch\_slot\ =\ res\_alloc.\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator_aa52169b8647ed214277cbc027f52f4bc}{slot\_tx}}();}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \ \ \textcolor{comment}{//\ Handle\ pending\ CRCs.}}
\DoxyCodeLine{00327\ \ \ handle\_pending\_crc\_indications\_impl(res\_alloc);}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \textcolor{comment}{//\ Pop\ pending\ RACHs\ and\ process\ them.}}
\DoxyCodeLine{00330\ \ \ pending\_rachs.slot\_indication();}
\DoxyCodeLine{00331\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ rach\_indication\_message>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{new\_rachs}}\ =\ pending\_rachs.get\_events();}
\DoxyCodeLine{00332\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1rach__indication__message}{rach\_indication\_message}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rach}}\ :\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{new\_rachs}})\ \{}
\DoxyCodeLine{00333\ \ \ \ \ handle\_rach\_indication\_impl(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rach}});}
\DoxyCodeLine{00334\ \ \ \}}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \textcolor{comment}{//\ Ensure\ slot\ for\ RAR\ PDCCH\ has\ DL\ enabled.}}
\DoxyCodeLine{00337\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ cell\_cfg.is\_dl\_enabled(pdcch\_slot))\ \{}
\DoxyCodeLine{00338\ \ \ \ \ \textcolor{comment}{//\ Early\ exit.}}
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00340\ \ \ \}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ \textcolor{comment}{//\ Ensure\ (i)\ RA\ SearchSpace\ PDCCH\ monitoring\ is\ active\ for\ this\ slot\ and\ (ii)\ there\ are\ enough\ UL\ symbols\ to\ allocate}}
\DoxyCodeLine{00343\ \ \ \textcolor{comment}{//\ the\ PDCCH.}}
\DoxyCodeLine{00344\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesrsran_afe2121fadc4c77d28089c1db677a67b6}{search\_space\_id}}\ \ \ \ \ \ \ \ \ \ \ \ \ ss\_id\ \ =\ cell\_cfg.dl\_cfg\_common.init\_dl\_bwp.pdcch\_common.\mbox{\hyperlink{structsrsran_1_1pdcch__config__common_abb3e2d05a704bec469946b206ad200f7}{ra\_search\_space\_id}};}
\DoxyCodeLine{00345\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1search__space__configuration}{search\_space\_configuration}}\&\ ss\_cfg\ =\ cell\_cfg.dl\_cfg\_common.init\_dl\_bwp.pdcch\_common.\mbox{\hyperlink{structsrsran_1_1pdcch__config__common_a2e3ed0017a58f05d4952d95ab804435e}{search\_spaces}}[ss\_id];}
\DoxyCodeLine{00346\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1coreset__configuration}{coreset\_configuration}}\&\ \ \ \ \ \ cs\_cfg\ =\ cell\_cfg.get\_common\_coreset(ss\_cfg.\mbox{\hyperlink{structsrsran_1_1search__space__configuration_ace03a709d08d7adb470672818f74a70d}{get\_coreset\_id}}());}
\DoxyCodeLine{00347\ \ \ \textcolor{comment}{//\ TODO:\ Handle\ the\ case\ when\ ra\_search\_space\_id\ is\ set\ to\ 0.}}
\DoxyCodeLine{00348\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ pdcch\_helper::is\_pdcch\_monitoring\_active(pdcch\_slot,\ ss\_cfg)\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{or}}}
\DoxyCodeLine{00349\ \ \ \ \ \ \ ss\_cfg.\mbox{\hyperlink{structsrsran_1_1search__space__configuration_ab5df7a88e860e0181fb1c5bd24dd0831}{get\_first\_symbol\_index}}()\ +\ cs\_cfg.\mbox{\hyperlink{structsrsran_1_1coreset__configuration_ac70faa1088f184a624da17749bc1c863}{duration}}\ >\ cell\_cfg.get\_nof\_dl\_symbol\_per\_slot(pdcch\_slot))\ \{}
\DoxyCodeLine{00350\ \ \ \ \ \textcolor{comment}{//\ Early\ exit.\ RAR\ scheduling\ only\ possible\ when\ PDCCH\ monitoring\ is\ active.}}
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00352\ \ \ \}}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ res\_alloc[0].result.dl.csi\_rs.empty())\ \{}
\DoxyCodeLine{00355\ \ \ \ \ \textcolor{comment}{//\ TODO:\ Remove\ this\ once\ multiplexing\ is\ possible.}}
\DoxyCodeLine{00356\ \ \ \ \ \textcolor{comment}{//\ Early\ exit.\ At\ the\ moment,\ we\ do\ not\ multiple\ PDSCH\ and\ CSI-\/RS.}}
\DoxyCodeLine{00357\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00358\ \ \ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \textcolor{comment}{//\ Ensure\ there\ are\ UL\ slots\ where\ Msg3s\ can\ be\ allocated.}}
\DoxyCodeLine{00361\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_slots\_available}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00362\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_alloc}}\ :\ \mbox{\hyperlink{namespacesrsran_a527321cf53dcccff60247ae85e43c5df}{get\_pusch\_time\_domain\_resource\_table}}(get\_pusch\_cfg()))\ \{}
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ msg3\_delay\ =\ \mbox{\hyperlink{namespacesrsran_a8c795956c8ae20343d8fa1ae8b30d29e}{get\_msg3\_delay}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_alloc}},\ get\_ul\_bwp\_cfg().scs)\ +\ res\_alloc.\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator_a569167b4165a6dcd93b36bc5cee15105}{cfg}}.ntn\_cs\_koffset;}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{start\_ul\_symbols}}\ =}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a2ec632168c0292dc5fd78c9bd35f159b}{NOF\_OFDM\_SYM\_PER\_SLOT\_NORMAL\_CP}}\ -\/\ cell\_cfg.get\_nof\_ul\_symbol\_per\_slot(pdcch\_slot\ +\ msg3\_delay);}
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{keywordflow}{if}\ (cell\_cfg.is\_ul\_enabled(pdcch\_slot\ +\ msg3\_delay)\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_alloc}}.symbols.start()\ >=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{start\_ul\_symbols}})\ \{}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_slots\_available}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00369\ \ \ \ \ \}}
\DoxyCodeLine{00370\ \ \ \}}
\DoxyCodeLine{00371\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_slots\_available}})\ \{}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{comment}{//\ Early\ exit.\ Msg3\ scheduling\ only\ possible\ when\ PUSCH\ is\ available.}}
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00374\ \ \ \}}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ it\ =\ pending\_rars.begin();\ it\ !=\ pending\_rars.end();)\ \{}
\DoxyCodeLine{00377\ \ \ \ \ pending\_rar\_t\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}\ =\ *it;}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{comment}{//\ In\ case\ of\ RAR\ being\ outside\ RAR\ window:}}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{comment}{//\ -\/\ if\ window\ has\ passed,\ discard\ RAR}}
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{comment}{//\ -\/\ if\ window\ hasn't\ started,\ stop\ loop,\ as\ RARs\ are\ ordered\ by\ slot}}
\DoxyCodeLine{00382\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.rar\_window.contains(pdcch\_slot))\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pdcch\_slot\ >=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.rar\_window.stop())\ \{}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ fmt::memory\_buffer\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{str\_buffer}};}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ fmt::format\_to(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{str\_buffer}},}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Could\ not\ transmit\ RAR\ within\ the\ window=\{\},\ prach\_slot=\{\},\ slot\_tx=\{\}"{}},}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.rar\_window,}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.prach\_slot\_rx,}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdcch\_slot);}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ fmt::print(\textcolor{stringliteral}{"{}\{\}\(\backslash\)n"{}},\ \mbox{\hyperlink{namespacesrsran_a13da72a4801a4409b00db614aadd511c}{to\_c\_str}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{str\_buffer}}));}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}\{\}"{}},\ \mbox{\hyperlink{namespacesrsran_a13da72a4801a4409b00db614aadd511c}{to\_c\_str}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{str\_buffer}}));}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ it\ =\ pending\_rars.erase(it);}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00396\ \ \ \ \ \}}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \ \ \ \ \textcolor{comment}{//\ Try\ to\ schedule\ DCIs\ +\ RBGs\ for\ RAR\ Grants}}
\DoxyCodeLine{00399\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_allocs}}\ =\ schedule\_rar(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}},\ res\_alloc);}
\DoxyCodeLine{00400\ \ \ \ \ srsran\_sanity\_check(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_allocs}}\ <=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.tc\_rntis.size(),\ \textcolor{stringliteral}{"{}Invalid\ number\ of\ RAR\ allocs"{}});}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_allocs}}\ >\ 0)\ \{}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ RAR\ allocation\ was\ successful:}}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \textcolor{comment}{//\ -\/\ in\ case\ all\ Msg3\ grants\ were\ allocated,\ remove\ pending\ RAR,\ and\ continue\ with\ following\ RAR}}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \textcolor{comment}{//\ -\/\ otherwise,\ erase\ only\ Msg3\ grants\ that\ were\ allocated,\ and\ stop\ iteration}}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_allocs}}\ ==\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.tc\_rntis.size())\ \{}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ it\ =\ pending\_rars.erase(it);}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ only\ allocated\ Msg3\ grants}}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ std::copy(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.tc\_rntis.begin()\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_allocs}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.tc\_rntis.end(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.tc\_rntis.begin());}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{new\_pending\_msg3s}}\ =}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.tc\_rntis.size()\ >\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_allocs}}\ ?\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.tc\_rntis.size()\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_allocs}}\ :\ 0;}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{new\_pending\_msg3s}}\ >\ MAX\_PREAMBLES\_PER\_PRACH\_OCCASION)\ \{}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note:\ This\ check\ must\ be\ added\ to\ avoid\ compilation\ issue\ in\ gcc9.4.0.\ Potentially\ a\ false\ alarm.}}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{compiler_8h_af4badefae68005d9942b30d26ccad03a}{SRSRAN\_UNREACHABLE}};}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rar\_req}}.tc\_rntis.resize(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{new\_pending\_msg3s}});}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00421\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ RAR\ allocation\ was\ not\ successful,\ try\ next\ pending\ RAR}}
\DoxyCodeLine{00423\ \ \ \ \ \ \ ++it;}
\DoxyCodeLine{00424\ \ \ \ \ \}}
\DoxyCodeLine{00425\ \ \ \}}
\DoxyCodeLine{00426\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/scheduler/common\+\_\+scheduling/ra\+\_\+scheduler.\+h\item 
lib/scheduler/common\+\_\+scheduling/ra\+\_\+scheduler.\+cpp\end{DoxyCompactItemize}
