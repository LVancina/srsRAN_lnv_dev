\doxysection{srsran\+::resource\+\_\+grid\+\_\+mapper\+\_\+impl Class Reference}
\hypertarget{classsrsran_1_1resource__grid__mapper__impl}{}\label{classsrsran_1_1resource__grid__mapper__impl}\index{srsran::resource\_grid\_mapper\_impl@{srsran::resource\_grid\_mapper\_impl}}


Implements a resource grid mapper.  




{\ttfamily \#include $<$resource\+\_\+grid\+\_\+mapper\+\_\+impl.\+h$>$}



Inheritance diagram for srsran\+::resource\+\_\+grid\+\_\+mapper\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=226pt]{d9/d45/classsrsran_1_1resource__grid__mapper__impl__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::resource\+\_\+grid\+\_\+mapper\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=226pt]{d0/d3e/classsrsran_1_1resource__grid__mapper__impl__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1resource__grid__mapper__impl_a2876b3ed1a2cc7936b19907df466d083}{resource\+\_\+grid\+\_\+mapper\+\_\+impl}} (\mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\+\_\+ports\+\_\+}}, \mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\+\_\+subc\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1resource__grid__writer}{resource\+\_\+grid\+\_\+writer}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{writer\+\_\+}}, std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1channel__precoder}{channel\+\_\+precoder}} $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoder\+\_\+}})
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1resource__grid__mapper__impl_a3f1e4cf477dd01ea2fcbeed922fb0259}{map}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1re__buffer__reader}{re\+\_\+buffer\+\_\+reader}} \&input, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1re__pattern}{re\+\_\+pattern}} \&pattern, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1precoding__configuration}{precoding\+\_\+configuration}} \&precoding) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Maps the input resource elements into the resource grid. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1resource__grid__mapper__impl_a1f52b7dcf26004e13a15791c6d9ece7d}{map}} (\mbox{\hyperlink{classsrsran_1_1resource__grid__mapper_1_1symbol__buffer}{symbol\+\_\+buffer}} \&buffer, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1re__pattern__list}{re\+\_\+pattern\+\_\+list}} \&pattern, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1re__pattern__list}{re\+\_\+pattern\+\_\+list}} \&reserved, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1precoding__configuration}{precoding\+\_\+configuration}} \&precoding, \mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\+\_\+skip}}) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Maps complex symbols onto the resource grid. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1resource__grid__mapper}{srsran\+::resource\+\_\+grid\+\_\+mapper}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{virtual}} {\bfseries \texorpdfstring{$\sim$}{\string~}resource\+\_\+grid\+\_\+mapper} ()=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{default}}
\begin{DoxyCompactList}\small\item\em Default destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implements a resource grid mapper. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1resource__grid__mapper__impl_a2876b3ed1a2cc7936b19907df466d083}\label{classsrsran_1_1resource__grid__mapper__impl_a2876b3ed1a2cc7936b19907df466d083} 
\index{srsran::resource\_grid\_mapper\_impl@{srsran::resource\_grid\_mapper\_impl}!resource\_grid\_mapper\_impl@{resource\_grid\_mapper\_impl}}
\index{resource\_grid\_mapper\_impl@{resource\_grid\_mapper\_impl}!srsran::resource\_grid\_mapper\_impl@{srsran::resource\_grid\_mapper\_impl}}
\doxysubsubsection{\texorpdfstring{resource\_grid\_mapper\_impl()}{resource\_grid\_mapper\_impl()}}
{\footnotesize\ttfamily resource\+\_\+grid\+\_\+mapper\+\_\+impl\+::resource\+\_\+grid\+\_\+mapper\+\_\+impl (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{nof\+\_\+ports\+\_\+,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{nof\+\_\+subc\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1resource__grid__writer}{resource\+\_\+grid\+\_\+writer}} \&}]{writer\+\_\+,  }\item[{std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1channel__precoder}{channel\+\_\+precoder}} $>$}]{precoder\+\_\+ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00153\ \ \ nof\_ports(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_ports\_}}),\ nof\_subc(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_}}),\ writer(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{writer\_}}),\ precoder(std::move(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoder\_}}))}
\DoxyCodeLine{00154\ \{}
\DoxyCodeLine{00155\ \ \ srsran\_assert(nof\_ports\ <=\ max\_nof\_ports,}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ number\ of\ ports\ (i.e.,\ \{\})\ exceeds\ the\ maximum\ number\ of\ ports\ (i.e.,\ \{\})."{}},}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nof\_ports,}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(max\_nof\_ports));}
\DoxyCodeLine{00159\ \ \ srsran\_assert(nof\_subc\ <=\ max\_nof\_subcarriers,}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ number\ of\ subcarriers\ (i.e.,\ \{\})\ exceeds\ the\ maximum\ number\ of\ subcarriers\ (i.e.,\ \{\})."{}},}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nof\_subc,}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(max\_nof\_subcarriers));}
\DoxyCodeLine{00163\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1resource__grid__mapper__impl_a3f1e4cf477dd01ea2fcbeed922fb0259}\label{classsrsran_1_1resource__grid__mapper__impl_a3f1e4cf477dd01ea2fcbeed922fb0259} 
\index{srsran::resource\_grid\_mapper\_impl@{srsran::resource\_grid\_mapper\_impl}!map@{map}}
\index{map@{map}!srsran::resource\_grid\_mapper\_impl@{srsran::resource\_grid\_mapper\_impl}}
\doxysubsubsection{\texorpdfstring{map()}{map()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} resource\+\_\+grid\+\_\+mapper\+\_\+impl\+::map (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1re__buffer__reader}{re\+\_\+buffer\+\_\+reader}} \&}]{input,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1re__pattern}{re\+\_\+pattern}} \&}]{pattern,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1precoding__configuration}{precoding\+\_\+configuration}} \&}]{precoding }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Maps the input resource elements into the resource grid. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em input} & Input data. \\
\hline
\mbox{\texttt{ in}}  & {\em pattern} & Data allocation pattern in the resource grid. \\
\hline
\mbox{\texttt{ in}}  & {\em precoding} & Precoding configuration. \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classsrsran_1_1resource__grid__mapper_a9fc1909c95b969acdd14de808d4cb0c2}{srsran\+::resource\+\_\+grid\+\_\+mapper}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00168\ \{}
\DoxyCodeLine{00169\ \ \ \textcolor{keywordtype}{unsigned}\ nof\_layers\ =\ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_a78eeca8376d722f128340ed3c58fbfbd}{get\_nof\_layers}}();}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ srsran\_assert(input.\mbox{\hyperlink{classsrsran_1_1detail_1_1re__buffer__dimensions_af9938dde244e7d21ee3280d29030c6d8}{get\_nof\_slices}}()\ ==\ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_a78eeca8376d722f128340ed3c58fbfbd}{get\_nof\_layers}}(),}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ input\ number\ of\ layers\ (i.e.,\ \{\})\ and\ the\ precoding\ number\ of\ layers\ (i.e.,\ \{\})\ are\ different."{}},}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input.\mbox{\hyperlink{classsrsran_1_1detail_1_1re__buffer__dimensions_af9938dde244e7d21ee3280d29030c6d8}{get\_nof\_slices}}(),}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nof\_layers);}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_precoding\_ports}}\ =\ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_acdca559896b9c54658537e244ce89085}{get\_nof\_ports}}();}
\DoxyCodeLine{00177\ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_precoding\_ports}}\ <=\ nof\_ports,}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ precoding\ number\ of\ ports\ (i.e.,\ \{\})\ exceeds\ the\ grid\ number\ of\ ports\ (i.e.,\ \{\})."{}},}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_acdca559896b9c54658537e244ce89085}{get\_nof\_ports}}(),}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nof\_ports);}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \textcolor{comment}{//\ Temporary\ intermediate\ buffer\ for\ storing\ precoded\ symbols.}}
\DoxyCodeLine{00183\ \ \ \mbox{\hyperlink{classsrsran_1_1static__re__buffer}{precoding\_buffer\_type}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}};}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{is\_dmrs\_type1}}\ =\ pattern.\mbox{\hyperlink{structsrsran_1_1re__pattern_ad54232b98e15d6169aad59093d196710}{prb\_mask}}.\mbox{\hyperlink{classsrsran_1_1bounded__bitset_a6063ce8435cbbc14fb1344e49ac3becf}{is\_contiguous}}(\textcolor{keyword}{true})\ \&\&}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (pattern.\mbox{\hyperlink{structsrsran_1_1re__pattern_af9f3399e9641474ffeea688fae30a731}{re\_mask}}\ ==\ get\_re\_mask\_type\_1(0)\ ||\ pattern.\mbox{\hyperlink{structsrsran_1_1re__pattern_af9f3399e9641474ffeea688fae30a731}{re\_mask}}\ ==\ get\_re\_mask\_type\_1(1));}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{is\_dmrs\_type1}})\ \{}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{comment}{//\ Optimized\ contiguous\ DM-\/RS\ Type\ 1\ mapping.}}
\DoxyCodeLine{00190\ \ \ \ \ map\_dmrs\_type1\_contiguous(writer,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}},\ input,\ pattern,\ precoding,\ *precoder);}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00192\ \ \ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \textcolor{comment}{//\ PRG\ size\ in\ number\ of\ subcarriers.}}
\DoxyCodeLine{00195\ \ \ \textcolor{keywordtype}{unsigned}\ prg\_size\ =\ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_a176decd1c24e563e4754c93e5f5b82a9}{get\_prg\_size}}()\ *\ NRE;}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \textcolor{keywordtype}{int}\ first\_symbol\ =\ pattern.\mbox{\hyperlink{structsrsran_1_1re__pattern_adb611adea4c54a4ad5c0ddbcc593cd99}{symbols}}.\mbox{\hyperlink{classsrsran_1_1bounded__bitset_aa2de3a0528dbe3ab78a6c764bef1eb0f}{find\_lowest}}(\textcolor{keyword}{true});}
\DoxyCodeLine{00198\ \ \ \textcolor{keywordtype}{int}\ end\_symbol\ \ \ =\ pattern.\mbox{\hyperlink{structsrsran_1_1re__pattern_adb611adea4c54a4ad5c0ddbcc593cd99}{symbols}}.\mbox{\hyperlink{classsrsran_1_1bounded__bitset_a4113d614afd53f3e204dce4ec89963b9}{find\_highest}}(\textcolor{keyword}{true})\ +\ 1;}
\DoxyCodeLine{00199\ \ \ srsran\_assert((first\_symbol\ >=\ 0)\ \&\&\ (end\_symbol\ >=\ 0),}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}At\ least\ one\ OFDM\ symbol\ must\ be\ used\ by\ the\ allocation\ pattern."{}});}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \textcolor{comment}{//\ Get\ the\ symbol\ RE\ mask.\ It\ is\ the\ same\ for\ all\ allocated\ OFDM\ symbols.}}
\DoxyCodeLine{00203\ \ \ \mbox{\hyperlink{classsrsran_1_1bounded__bitset}{bounded\_bitset<max\_nof\_subcarriers>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}}(nof\_subc);}
\DoxyCodeLine{00204\ \ \ pattern.\mbox{\hyperlink{structsrsran_1_1re__pattern_a51220cce79fd4314ad55ac7a1220e7f6}{get\_inclusion\_mask}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}},\ first\_symbol);}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \textcolor{comment}{//\ Find\ the\ highest\ used\ subcarrier.\ Skip\ symbol\ if\ no\ active\ subcarrier.}}
\DoxyCodeLine{00207\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_highest\_subc}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}}.find\_highest();}
\DoxyCodeLine{00208\ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_highest\_subc}}\ >=\ 0,\ \textcolor{stringliteral}{"{}At\ least\ one\ subcarrier\ must\ be\ used\ by\ the\ allocation\ pattern."{}});}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \textcolor{comment}{//\ Resize\ the\ mask\ to\ the\ highest\ subcarrier,\ ceiling\ to\ PRB.}}
\DoxyCodeLine{00211\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}}.resize(\mbox{\hyperlink{namespacesrsran_a6e5aee1d553dc6e825017842e4059adb}{divide\_ceil}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_highest\_subc}}\ +\ 1,\ NRE)\ *\ NRE);}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \textcolor{comment}{//\ Number\ of\ RE\ to\ be\ allocated\ for\ each\ OFDM\ symbol\ in\ the\ pattern.}}
\DoxyCodeLine{00214\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_symbol}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}}.count();}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_symbol}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}}.get\_nof\_re())\ ||\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_precoding\_ports}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}}.get\_nof\_slices()))\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{comment}{//\ Resize\ the\ output\ buffer\ if\ the\ input\ dimensions\ don't\ match.}}
\DoxyCodeLine{00218\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}}.resize(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_precoding\_ports}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_symbol}});}
\DoxyCodeLine{00219\ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \textcolor{comment}{//\ Counter\ for\ the\ number\ of\ RE\ read\ from\ the\ input\ and\ mapped\ to\ the\ grid.}}
\DoxyCodeLine{00222\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_re\_buffer}}\ =\ 0;}
\DoxyCodeLine{00223\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}}\ =\ first\_symbol;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}}\ !=\ end\_symbol;\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}})\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{comment}{//\ Skip\ symbol\ if\ it\ is\ not\ in\ the\ allocation\ pattern.}}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordflow}{if}\ (!pattern.\mbox{\hyperlink{structsrsran_1_1re__pattern_adb611adea4c54a4ad5c0ddbcc593cd99}{symbols}}.\mbox{\hyperlink{classsrsran_1_1bounded__bitset_a53b1498a7820972edb5b9c8db2fc94db}{test}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}}))\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00227\ \ \ \ \ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{comment}{//\ Bypass\ precoding\ if\ it\ has\ no\ effect\ on\ the\ signal.}}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keywordflow}{if}\ ((nof\_layers\ ==\ 1)\ \&\&\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_precoding\_ports}}\ ==\ 1)\ \&\&\ (precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_ad46543b1edc0bbec24b89f7a1c798e19}{get\_nof\_prg}}()\ ==\ 1)\ \&\&}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ (precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_ad5ce71c497de768ec0fd79336b8e5b23}{get\_coefficient}}(0,\ 0,\ 0)\ ==\ 1.0F))\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \textcolor{comment}{//\ View\ over\ the\ input\ RE\ belonging\ to\ the\ current\ symbol.}}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1re__buffer__reader__view}{re\_buffer\_reader\_view}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_re\_symbol}}(input,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_re\_buffer}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_symbol}});}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \ \ \ \ \textcolor{comment}{//\ Map\ directly\ to\ the\ grid.}}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ cf\_t>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{unmapped}}\ =\ writer.\mbox{\hyperlink{classsrsran_1_1resource__grid__writer_aaad19c2090c3824f52092dfcf251710c}{put}}(0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}},\ 0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_re\_symbol}}.get\_slice(0));}
\DoxyCodeLine{00237\ \ \ \ \ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{unmapped}}.empty(),\ \textcolor{stringliteral}{"{}Not\ all\ REs\ have\ been\ mapped\ to\ the\ grid."{}});}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_re\_buffer}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_symbol}};}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00240\ \ \ \ \ \}}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{comment}{//\ Counter\ for\ the\ number\ of\ precoded\ REs\ for\ the\ current\ symbol.}}
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_precoding\_buffer}}\ =\ 0;}
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_prg}}\ =\ 0,\ nof\_prg\ =\ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_ad46543b1edc0bbec24b89f7a1c798e19}{get\_nof\_prg}}(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_subc}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_prg}}\ !=\ nof\_prg;\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_prg}})\ \{}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ precoding\ matrix\ for\ the\ current\ PRG.}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1precoding__weight__matrix}{precoding\_weight\_matrix}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_weights}}\ =\ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_aed3b3de237d44a03bca4409970c4eb63}{get\_prg\_coefficients}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_prg}});}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ grid\ RE\ belonging\ to\ the\ current\ PRG\ for\ the\ provided\ allocation\ pattern\ dimensions.}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_prg}}\ =\ std::min(prg\_size,\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}}.size())\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_subc}});}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \ \ \ \ \textcolor{comment}{//\ Mask\ for\ the\ RE\ belonging\ to\ the\ current\ PRG.}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1bounded__bitset}{bounded\_bitset<max\_nof\_subcarriers>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_re\_mask}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}}.\mbox{\hyperlink{classsrsran_1_1bounded__bitset_afe1a0207f2e64504dfe8df1d6d7c163b}{slice}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_subc}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_subc}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_prg}});}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ allocated\ RE\ for\ the\ current\ PRG.}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_prg}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_re\_mask}}.count();}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \ \ \ \ \textcolor{comment}{//\ Views\ of\ the\ input\ and\ precoder\ buffers\ for\ the\ REs\ belonging\ to\ the\ current\ PRG.}}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1re__buffer__reader__view}{re\_buffer\_reader\_view}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_re\_prg}}(input,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_re\_buffer}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_prg}});}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1re__buffer__writer__view}{re\_buffer\_writer\_view}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{output\_re\_prg}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_precoding\_buffer}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_prg}});}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ \ \ \textcolor{comment}{//\ Apply\ precoding.}}
\DoxyCodeLine{00262\ \ \ \ \ \ \ precoder-\/>apply\_precoding(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{output\_re\_prg}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_re\_prg}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_weights}});}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ \ \ \textcolor{comment}{//\ Advance\ input\ and\ output\ buffers.}}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_re\_buffer}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_prg}};}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_precoding\_buffer}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_prg}};}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \ \ \textcolor{comment}{//\ Advance\ mask\ slice.}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_subc}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_prg}};}
\DoxyCodeLine{00270\ \ \ \ \ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{comment}{//\ Assert\ that\ the\ precoding\ buffer\ has\ been\ filled.}}
\DoxyCodeLine{00273\ \ \ \ \ srsran\_assert((\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_precoding\_buffer}}\ ==\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}}.get\_nof\_re()),}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ number\ of\ precoded\ RE\ (i.e.,\ \{\})\ does\ not\ match\ the\ precoding\ buffer\ size\ (i.e.,\ \{\})."{}},}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_precoding\_buffer}},}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}}.get\_nof\_re());}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_tx\_port}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_tx\_port}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_precoding\_ports}};\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_tx\_port}})\ \{}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \textcolor{comment}{//\ Map\ the\ precoded\ REs\ to\ each\ port\ for\ the\ current\ symbol.}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ cf\_t>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{port\_data}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}}.get\_slice(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_tx\_port}});}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ cf\_t>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{unmapped}}\ \ =\ writer.\mbox{\hyperlink{classsrsran_1_1resource__grid__writer_aaad19c2090c3824f52092dfcf251710c}{put}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_tx\_port}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}},\ 0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{port\_data}});}
\DoxyCodeLine{00282\ \ \ \ \ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{unmapped}}.empty(),\ \textcolor{stringliteral}{"{}Not\ all\ REs\ have\ been\ mapped\ to\ the\ grid."{}});}
\DoxyCodeLine{00283\ \ \ \ \ \}}
\DoxyCodeLine{00284\ \ \ \}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \textcolor{comment}{//\ Assert\ that\ all\ input\ REs\ have\ been\ processed.}}
\DoxyCodeLine{00287\ \ \ srsran\_assert((\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_re\_buffer}}\ ==\ input.\mbox{\hyperlink{classsrsran_1_1detail_1_1re__buffer__dimensions_a07437ee656d4110db488f06f63ff51dd}{get\_nof\_re}}()),}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ number\ of\ total\ precoded\ RE\ (i.e.,\ \{\})\ does\ not\ match\ the\ number\ of\ total\ input\ RE\ (i.e.,\ \{\})."{}},}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_re\_buffer}},}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input.\mbox{\hyperlink{classsrsran_1_1detail_1_1re__buffer__dimensions_a07437ee656d4110db488f06f63ff51dd}{get\_nof\_re}}());}
\DoxyCodeLine{00291\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1resource__grid__mapper__impl_a1f52b7dcf26004e13a15791c6d9ece7d}\label{classsrsran_1_1resource__grid__mapper__impl_a1f52b7dcf26004e13a15791c6d9ece7d} 
\index{srsran::resource\_grid\_mapper\_impl@{srsran::resource\_grid\_mapper\_impl}!map@{map}}
\index{map@{map}!srsran::resource\_grid\_mapper\_impl@{srsran::resource\_grid\_mapper\_impl}}
\doxysubsubsection{\texorpdfstring{map()}{map()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} resource\+\_\+grid\+\_\+mapper\+\_\+impl\+::map (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1resource__grid__mapper_1_1symbol__buffer}{symbol\+\_\+buffer}} \&}]{buffer,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1re__pattern__list}{re\+\_\+pattern\+\_\+list}} \&}]{pattern,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1re__pattern__list}{re\+\_\+pattern\+\_\+list}} \&}]{reserved,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1precoding__configuration}{precoding\+\_\+configuration}} \&}]{precoding,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{re\+\_\+skip }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Maps complex symbols onto the resource grid. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em buffer} & Buffer containing the complex symbols to map. \\
\hline
\mbox{\texttt{ in}}  & {\em pattern} & Data allocation pattern in the resource grid. \\
\hline
\mbox{\texttt{ in}}  & {\em reserved} & Reserved resource elements, to be excluded from the allocation pattern. \\
\hline
\mbox{\texttt{ in}}  & {\em precoding} & Precoding configuration. \\
\hline
\mbox{\texttt{ in}}  & {\em re\+\_\+skip} & Number of RE to skip before start mapping the buffer. \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classsrsran_1_1resource__grid__mapper_a8ee7b26f78f544f3ba3fc69260b3030c}{srsran\+::resource\+\_\+grid\+\_\+mapper}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00298\ \{}
\DoxyCodeLine{00299\ \ \ \textcolor{comment}{//\ Temporary\ intermediate\ buffer\ for\ storing\ precoded\ symbols.}}
\DoxyCodeLine{00300\ \ \ \mbox{\hyperlink{classsrsran_1_1static__re__buffer}{precoding\_buffer\_type}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}};}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \textcolor{comment}{//\ The\ number\ of\ layers\ is\ equal\ to\ the\ number\ of\ ports.}}
\DoxyCodeLine{00303\ \ \ \textcolor{keywordtype}{unsigned}\ nof\_layers\ =\ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_a78eeca8376d722f128340ed3c58fbfbd}{get\_nof\_layers}}();}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \textcolor{comment}{//\ Extract\ number\ of\ antennas.}}
\DoxyCodeLine{00306\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_antennas}}\ =\ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_acdca559896b9c54658537e244ce89085}{get\_nof\_ports}}();}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \ \ \textcolor{comment}{//\ Verify\ that\ the\ number\ of\ layers\ is\ consistent\ with\ the\ number\ of\ ports.}}
\DoxyCodeLine{00309\ \ \ \mbox{\hyperlink{classsrsran_1_1interval}{interval<unsigned,\ true>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_antennas\_range}}(1,\ nof\_ports);}
\DoxyCodeLine{00310\ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_antennas\_range}}.contains(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_antennas}}),}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ number\ of\ antennas\ (i.e.,\ \{\})\ must\ be\ in\ range\ \{\}"{}},}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_antennas}},}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_antennas\_range}});}
\DoxyCodeLine{00314\ \ \ \mbox{\hyperlink{classsrsran_1_1interval}{interval<unsigned,\ true>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_layers\_range}}(1,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_antennas}});}
\DoxyCodeLine{00315\ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_layers\_range}}.contains(nof\_layers),}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ number\ of\ layers\ (i.e.,\ \{\})\ must\ be\ in\ range\ \{\}"{}},}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nof\_layers,}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_layers\_range}});}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_count}}\ =\ 0;}
\DoxyCodeLine{00321\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}}\ !=\ MAX\_NSYMB\_PER\_SLOT;\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}})\ \{}
\DoxyCodeLine{00322\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ symbol\ RE\ mask.}}
\DoxyCodeLine{00323\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1bounded__bitset}{bounded\_bitset<max\_nof\_subcarriers>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}}(max\_nof\_subcarriers);}
\DoxyCodeLine{00324\ \ \ \ \ pattern.\mbox{\hyperlink{classsrsran_1_1re__pattern__list_a401dec364e6b970042f47fd775bb4139}{get\_inclusion\_mask}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}});}
\DoxyCodeLine{00325\ \ \ \ \ reserved.get\_exclusion\_mask(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}});}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{comment}{//\ Find\ the\ highest\ used\ subcarrier.\ Skip\ symbol\ if\ no\ active\ subcarrier.}}
\DoxyCodeLine{00328\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_highest\_subc}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}}.find\_highest();}
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_highest\_subc}}\ <\ 0)\ \{}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00331\ \ \ \ \ \}}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ number\ of\ active\ RE\ in\ the\ OFDM\ symbol.\ Skip\ symbol\ if\ the\ number\ of\ active\ RE\ does\ not\ reach\ the\ skip.}}
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_symbol}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}}.count();}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_count}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_symbol}}\ <\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_skip}})\ \{}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_count}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_symbol}};}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00338\ \ \ \ \ \}}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{comment}{//\ Iterate\ all\ precoding\ PRGs.}}
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ prg\_size\ =\ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_a176decd1c24e563e4754c93e5f5b82a9}{get\_prg\_size}}()\ *\ NRE;}
\DoxyCodeLine{00342\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_prg}}\ =\ 0,\ nof\_prg\ =\ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_ad46543b1edc0bbec24b89f7a1c798e19}{get\_nof\_prg}}();\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_prg}}\ !=\ nof\_prg;\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_prg}})\ \{}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ precoding\ matrix\ for\ the\ current\ PRG.}}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1precoding__weight__matrix}{precoding\_weight\_matrix}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_weights}}\ =\ precoding.\mbox{\hyperlink{classsrsran_1_1precoding__configuration_aed3b3de237d44a03bca4409970c4eb63}{get\_prg\_coefficients}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_prg}});}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ subcarrier\ interval\ for\ the\ PRG.}}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_subc}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_prg}}\ *\ prg\_size;}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ grid\ RE\ belonging\ to\ the\ current\ PRG\ for\ the\ provided\ allocation\ pattern\ dimensions.}}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_prg}}\ =\ std::min(prg\_size,\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_highest\_subc}}\ +\ 1)\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_subc}});}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \ \ \ \ \textcolor{comment}{//\ Mask\ for\ the\ RE\ belonging\ to\ the\ current\ PRG.}}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1bounded__bitset}{bounded\_bitset<max\_nof\_subcarriers>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_re\_mask}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symbol\_re\_mask}}.\mbox{\hyperlink{classsrsran_1_1bounded__bitset_afe1a0207f2e64504dfe8df1d6d7c163b}{slice}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_subc}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_subc}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_prg}});}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ PRG\ if\ no\ RE\ is\ selected.}}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_re\_mask}}.none())\ \{}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ number\ of\ active\ RE\ in\ the\ PRG.\ Skip\ PRG\ if\ the\ number\ of\ active\ RE\ does\ not\ reach\ the\ skip.}}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_prg}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_re\_mask}}.count();}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_count}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_prg}}\ <\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_skip}})\ \{}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_count}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_prg}};}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \ \ \ \ \textcolor{comment}{//\ Advance\ subcarrier\ offset\ to\ reach\ the\ skip\ count.}}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{subc\_offset}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_re\_mask}}.find\_lowest();}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_count}}\ <\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_skip}})\ \{}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ maximum\ number\ of\ subcarriers\ that\ can\ be\ processed\ in\ one\ block.}}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_nof\_subc\_block}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_skip}}\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_count}};}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ number\ of\ pending\ subcarriers\ to\ process.}}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_pending}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_prg}}\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{subc\_offset}};}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_pending}}\ !=\ 0,\ \textcolor{stringliteral}{"{}The\ number\ of\ pending\ subcarriers\ cannot\ be\ zero."{}});}
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ the\ number\ of\ subcarriers\ to\ process\ in\ a\ block.}}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_block}}\ =\ std::min(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_pending}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_nof\_subc\_block}});}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ allocation\ mask\ for\ the\ block.}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1bounded__bitset}{bounded\_bitset<max\_nof\_subcarriers>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{block\_mask}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_re\_mask}}.\mbox{\hyperlink{classsrsran_1_1bounded__bitset_afe1a0207f2e64504dfe8df1d6d7c163b}{slice}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{subc\_offset}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{subc\_offset}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_block}});}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Count\ the\ number\ of\ resource\ elements\ to\ map\ in\ the\ block.}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_block}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{block\_mask}}.count();}
\DoxyCodeLine{00385\ }
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{re\_count}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_block}};}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{subc\_offset}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_block}};}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ PRG\ in\ blocks\ smaller\ than\ or\ equal\ to\ max\_block\_size\ subcarriers.}}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{subc\_offset}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_prg}})\ \{}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ maximum\ number\ of\ subcarriers\ that\ can\ be\ processed\ in\ one\ block.}}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_nof\_subc\_block}}\ =\ buffer.get\_max\_block\_size()\ /\ nof\_layers;}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ number\ of\ pending\ subcarriers\ to\ process.}}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_pending}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_prg}}\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{subc\_offset}};}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ the\ number\ of\ subcarriers\ to\ process\ in\ a\ block.}}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_block}}\ =\ std::min(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_pending}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_nof\_subc\_block}});}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_block}}\ !=\ 0,\ \textcolor{stringliteral}{"{}The\ number\ of\ pending\ subcarriers\ cannot\ be\ zero."{}});}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ allocation\ mask\ for\ the\ block.}}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1bounded__bitset}{bounded\_bitset<max\_nof\_subcarriers>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{block\_mask}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_re\_mask}}.\mbox{\hyperlink{classsrsran_1_1bounded__bitset_afe1a0207f2e64504dfe8df1d6d7c163b}{slice}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{subc\_offset}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{subc\_offset}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_block}});}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Count\ the\ number\ of\ resource\ elements\ to\ map\ in\ the\ block.}}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_block}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{block\_mask}}.count();}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_block}}\ >\ 0)\ \{}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ number\ of\ symbols\ to\ generate.}}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_symbols\_block}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_block}}\ *\ nof\_layers;}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Prepare\ destination\ of\ the\ modulation\ buffer.}}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ ci8\_t>}}\ block\ =\ buffer.pop\_symbols(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_symbols\_block}});}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Prepare\ buffers.}}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}}.resize(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_antennas}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_re\_block}});}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Layer\ map\ and\ precoding.}}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \ \ precoder-\/>apply\_layer\_map\_and\_precoding(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}},\ block,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{prg\_weights}});}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Map\ for\ each\ port.}}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_antennas}};\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}})\ \{}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ writer.\mbox{\hyperlink{classsrsran_1_1resource__grid__writer_aaad19c2090c3824f52092dfcf251710c}{put}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_symbol}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_subc}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{subc\_offset}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{block\_mask}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{precoding\_buffer}}.get\_slice(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_port}}));}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Early\ return\ \ if\ the\ buffer\ is\ empty.}}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (buffer.empty())\ \{}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00430\ }
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Increment\ the\ subcarrier\ offset.}}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{subc\_offset}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_subc\_block}};}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00434\ \ \ \ \ \}}
\DoxyCodeLine{00435\ \ \ \}}
\DoxyCodeLine{00436\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/phy/support/resource\+\_\+grid\+\_\+mapper\+\_\+impl.\+h\item 
lib/phy/support/resource\+\_\+grid\+\_\+mapper\+\_\+impl.\+cpp\end{DoxyCompactItemize}
