\doxysection{srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool\texorpdfstring{$<$}{<} Id\+Tag, Debug\+Sanitize\+Address \texorpdfstring{$>$}{>} Class Template Reference}
\hypertarget{classsrsran_1_1fixed__size__memory__block__pool}{}\label{classsrsran_1_1fixed__size__memory__block__pool}\index{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}}


{\ttfamily \#include $<$fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool.\+h$>$}



Collaboration diagram for srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool\texorpdfstring{$<$}{<} Id\+Tag, Debug\+Sanitize\+Address \texorpdfstring{$>$}{>}\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=246pt]{dd/d77/classsrsran_1_1fixed__size__memory__block__pool__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_af5652333ed2390b8e064a8a47e9c52b2}\label{classsrsran_1_1fixed__size__memory__block__pool_af5652333ed2390b8e064a8a47e9c52b2} 
{\bfseries fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}} \&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_a0cbe77bbeee13dd8208b089787ae9188}\label{classsrsran_1_1fixed__size__memory__block__pool_a0cbe77bbeee13dd8208b089787ae9188} 
{\bfseries fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool} (\mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}} \&\&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_ae7b1f2487bcf190b3d469ab11d28dca6}\label{classsrsran_1_1fixed__size__memory__block__pool_ae7b1f2487bcf190b3d469ab11d28dca6} 
\mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}} \& {\bfseries operator=} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}} \&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_aa5108497caaa2047dea3d09d242c802a}\label{classsrsran_1_1fixed__size__memory__block__pool_aa5108497caaa2047dea3d09d242c802a} 
\mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}} \& {\bfseries operator=} (\mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}} \&\&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
size\+\_\+t \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool_adade3bf7e9aff4541725d76e420d6aa1}{memory\+\_\+block\+\_\+size}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\begin{DoxyCompactList}\small\item\em Memory block size in bytes. \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool_aa740c16913d89c23f766a051d9dbe69a}{nof\+\_\+memory\+\_\+blocks}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\begin{DoxyCompactList}\small\item\em Number of memory blocks contained in this memory pool. \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool_ac42ad85fb1309826074e303e2512889e}{max\+\_\+local\+\_\+cache\+\_\+size}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\begin{DoxyCompactList}\small\item\em Maximum number of blocks that can be stored in the thread-\/local memory block cache. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool_a36dcaf676f890701fdb05d5019f888c3}{allocate\+\_\+node}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{noexcept}}
\begin{DoxyCompactList}\small\item\em Allocate a node from the memory pool with the maximum size. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool_aee26f022975269f264f883a2047c695c}{allocate\+\_\+node}} (size\+\_\+t sz) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{noexcept}}
\begin{DoxyCompactList}\small\item\em Allocate a node from the memory pool with the provided size. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool_ae503bb341886bef39bac36225531d1ff}{deallocate\+\_\+node}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \texorpdfstring{$\ast$}{*}p)
\begin{DoxyCompactList}\small\item\em Deallocate node by returning it back to the memory pool. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool_ae5ecdfcda02a2d4fb2abe361de1673f6}{print\+\_\+all\+\_\+buffers}} ()
\end{DoxyCompactItemize}
\doxysubsubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{static}} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Debug\+Sanitize\+Address}} $>$ \& \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool_a0ca5df2697c29c7b931cdfd9834e77a5}{get\+\_\+instance}} (size\+\_\+t nof\+\_\+blocks=0, size\+\_\+t mem\+\_\+block\+\_\+size=0)
\begin{DoxyCompactList}\small\item\em Get instance of a memory pool singleton. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\subsubsection*{template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{classbool}{bool}} Debug\+Sanitize\+Address = false$>$\newline
class srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool$<$ Id\+Tag, Debug\+Sanitize\+Address $>$}
Concurrent memory pool of memory blocks of equal size. This pool is thread-\/safe. Each worker keeps a separate thread-\/local memory block cache that it uses for fast, non-\/contended allocation and deallocation. When accessing a thread-\/local cache, no locks are required.

When the local cache gets depleted, the worker tries to obtain a batch of segments from a central memory block cache. If the central cache is also depleted, the allocation fails.

Since there is no stealing of segments between workers\textquotesingle{} local caches, it is possible that a worker cannot allocate while another worker still has blocks in its own cache. To minimize the impact of this event, an upper bound is placed on a worker local cache size. Once a worker reaches that upper bound, it sends half of its stored blocks to the central cache.

Note1\+: Notice that the same memory block might be allocated and deallocated in different workers. So, it can happen that a worker is allocating many blocks and another worker just deallocating. The latter worker has to keep returning blocks back to the central cache every time its local cache grows beyond a given upper bound.

Note2\+: Taking into account the usage of thread\+\_\+local, this class is made a singleton. To be able to instantiate different pools, the user should use different Id\+Tag types.

Note3\+: No considerations were made regarding false sharing between workers. It is assumed that the blocks are big enough to fill a cache line.


\begin{DoxyTemplParams}{Template Parameters}
{\em Id\+Tag} & We use a ID type tag to be able to intantiate different pool objects. \\
\hline
{\em Debug\+Sanitize\+Address} & when set to true, the pool verifies that the addresses allocated and deallocated are valid. \\
\hline
\end{DoxyTemplParams}


\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_a7d294b48932483281e6c1e2720a1763f}\label{classsrsran_1_1fixed__size__memory__block__pool_a7d294b48932483281e6c1e2720a1763f} 
\index{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}!````~fixed\_size\_memory\_block\_pool@{\texorpdfstring{$\sim$}{\string~}fixed\_size\_memory\_block\_pool}}
\index{````~fixed\_size\_memory\_block\_pool@{\texorpdfstring{$\sim$}{\string~}fixed\_size\_memory\_block\_pool}!srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}}
\doxysubsubsection{\texorpdfstring{\texorpdfstring{$\sim$}{\string~}fixed\_size\_memory\_block\_pool()}{\string~fixed\_size\_memory\_block\_pool()}}
{\footnotesize\ttfamily template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}} , \mbox{\hyperlink{classbool}{bool}} Debug\+Sanitize\+Address = false$>$ \\
\mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Debug\+Sanitize\+Address}} $>$\+::\texorpdfstring{$\sim$}{\string~}\mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}} (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00127\ \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_a36dcaf676f890701fdb05d5019f888c3}\label{classsrsran_1_1fixed__size__memory__block__pool_a36dcaf676f890701fdb05d5019f888c3} 
\index{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}!allocate\_node@{allocate\_node}}
\index{allocate\_node@{allocate\_node}!srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}}
\doxysubsubsection{\texorpdfstring{allocate\_node()}{allocate\_node()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}} , \mbox{\hyperlink{classbool}{bool}} Debug\+Sanitize\+Address = false$>$ \\
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Debug\+Sanitize\+Address}} $>$\+::allocate\+\_\+node (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [noexcept]}}



Allocate a node from the memory pool with the maximum size. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00147\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool_a36dcaf676f890701fdb05d5019f888c3}{allocate\_node}}(\mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool_adade3bf7e9aff4541725d76e420d6aa1}{memory\_block\_size}}());\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_aee26f022975269f264f883a2047c695c}\label{classsrsran_1_1fixed__size__memory__block__pool_aee26f022975269f264f883a2047c695c} 
\index{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}!allocate\_node@{allocate\_node}}
\index{allocate\_node@{allocate\_node}!srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}}
\doxysubsubsection{\texorpdfstring{allocate\_node()}{allocate\_node()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}} , \mbox{\hyperlink{classbool}{bool}} Debug\+Sanitize\+Address = false$>$ \\
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Debug\+Sanitize\+Address}} $>$\+::allocate\+\_\+node (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{sz }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [noexcept]}}



Allocate a node from the memory pool with the provided size. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00151\ \ \ \{}
\DoxyCodeLine{00152\ \ \ \ \ srsran\_assert(sz\ <=\ mblock\_size,\ \textcolor{stringliteral}{"{}Allocated\ node\ size=\{\}\ exceeds\ max\ object\ size=\{\}"{}},\ sz,\ mblock\_size);}
\DoxyCodeLine{00153\ \ \ \ \ worker\_ctxt*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}\ =\ get\_worker\_cache();}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{//\ Attempt\ memory\ block\ pop\ from\ local\ cache.}}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{void}*\ node\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.empty())\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ node\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.back().try\_pop();}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (node\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.pop\_back();}
\DoxyCodeLine{00163\ \ \ \ \ \}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{comment}{//\ Local\ cache\ is\ empty.\ Attempt\ memory\ block\ pop\ from\ central\ cache.}}
\DoxyCodeLine{00166\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a5d57d4fb3f174a907dcea564ef28ff8b}{free\_memory\_block\_list}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{batch}};}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordflow}{if}\ (central\_mem\_cache.try\_dequeue(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>consumer\_token,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{batch}}))\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.push\_back(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{batch}});}
\DoxyCodeLine{00169\ \ \ \ \ \ \ node\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.back().try\_pop();}
\DoxyCodeLine{00170\ \ \ \ \ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00173\ \ \ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_ae503bb341886bef39bac36225531d1ff}\label{classsrsran_1_1fixed__size__memory__block__pool_ae503bb341886bef39bac36225531d1ff} 
\index{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}!deallocate\_node@{deallocate\_node}}
\index{deallocate\_node@{deallocate\_node}!srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}}
\doxysubsubsection{\texorpdfstring{deallocate\_node()}{deallocate\_node()}}
{\footnotesize\ttfamily template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}} , \mbox{\hyperlink{classbool}{bool}} Debug\+Sanitize\+Address = false$>$ \\
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Debug\+Sanitize\+Address}} $>$\+::deallocate\+\_\+node (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \texorpdfstring{$\ast$}{*}}]{p }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Deallocate node by returning it back to the memory pool. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00177\ \ \ \{}
\DoxyCodeLine{00178\ \ \ \ \ srsran\_assert(p\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{stringliteral}{"{}Deallocated\ nodes\ must\ have\ valid\ address"{}});}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ worker\_ctxt*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}\ =\ get\_worker\_cache();}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{DebugSanitizeAddress}})\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \textcolor{comment}{//\ For\ debug\ purposes.}}
\DoxyCodeLine{00184\ \ \ \ \ \ \ std::lock\_guard<std::mutex>\ lock(debug\_mutex);}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{found}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ i\ =\ 0;\ i\ !=\ nof\_blocks;\ ++i)\ \{}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (allocated\_memory.data()\ +\ i\ *\ mblock\_size\ ==\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint8__t}{uint8\_t}}*\textcolor{keyword}{>}(p))\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{found}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{found}})\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a630688b51219f81c5a47ec5650326afc}{report\_fatal\_error}}(\textcolor{stringliteral}{"{}Error\ dealloccating\ block\ with\ address\ \{:\#x\}"{}},\ p);}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00194\ \ \ \ \ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{comment}{//\ Verify\ if\ new\ batch\ needs\ to\ be\ created\ in\ local\ cache.}}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.empty()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{or}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.back().size()\ >=\ block\_batch\_size)\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.emplace\_back();}
\DoxyCodeLine{00199\ \ \ \ \ \}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{comment}{//\ Push\ block\ to\ local\ cache.}}
\DoxyCodeLine{00202\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.back().push(p);}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.size()\ >=\ max\_local\_batches\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.back().size()\ >=\ block\_batch\_size)\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \textcolor{comment}{//\ Local\ cache\ is\ full.\ Rebalance\ by\ sending\ batches\ of\ blocks\ to\ central\ cache.}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ leave\ one\ batch\ in\ the\ local\ cache.}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ i\ =\ 0;\ i\ !=\ max\_local\_batches\ -\/\ 1;\ ++i)\ \{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ report\_fatal\_error\_if\_not(central\_mem\_cache.enqueue(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>producer\_token,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.back()),}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Failed\ to\ push\ allocated\ batch\ back\ to\ central\ cache"{}});}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{w\_ctx}}-\/>local\_cache.pop\_back();}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00212\ \ \ \ \ \}}
\DoxyCodeLine{00213\ \ \ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_a0ca5df2697c29c7b931cdfd9834e77a5}\label{classsrsran_1_1fixed__size__memory__block__pool_a0ca5df2697c29c7b931cdfd9834e77a5} 
\index{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}!get\_instance@{get\_instance}}
\index{get\_instance@{get\_instance}!srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}}
\doxysubsubsection{\texorpdfstring{get\_instance()}{get\_instance()}}
{\footnotesize\ttfamily template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}} , \mbox{\hyperlink{classbool}{bool}} Debug\+Sanitize\+Address = false$>$ \\
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{static}} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Debug\+Sanitize\+Address}} $>$ \& \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Debug\+Sanitize\+Address}} $>$\+::get\+\_\+instance (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{nof\+\_\+blocks = {\ttfamily 0},  }\item[{size\+\_\+t}]{mem\+\_\+block\+\_\+size = {\ttfamily 0} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Get instance of a memory pool singleton. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00132\ \ \ \{}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{fixed\_size\_memory\_block\_pool<IdTag,\ DebugSanitizeAddress>}}\ pool(nof\_blocks,\ mem\_block\_size);}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordflow}{return}\ pool;}
\DoxyCodeLine{00135\ \ \ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_ac42ad85fb1309826074e303e2512889e}\label{classsrsran_1_1fixed__size__memory__block__pool_ac42ad85fb1309826074e303e2512889e} 
\index{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}!max\_local\_cache\_size@{max\_local\_cache\_size}}
\index{max\_local\_cache\_size@{max\_local\_cache\_size}!srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}}
\doxysubsubsection{\texorpdfstring{max\_local\_cache\_size()}{max\_local\_cache\_size()}}
{\footnotesize\ttfamily template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}} , \mbox{\hyperlink{classbool}{bool}} Debug\+Sanitize\+Address = false$>$ \\
size\+\_\+t \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Debug\+Sanitize\+Address}} $>$\+::max\+\_\+local\+\_\+cache\+\_\+size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Maximum number of blocks that can be stored in the thread-\/local memory block cache. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00144\ \{\ \textcolor{keywordflow}{return}\ max\_local\_batches\ *\ block\_batch\_size;\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_adade3bf7e9aff4541725d76e420d6aa1}\label{classsrsran_1_1fixed__size__memory__block__pool_adade3bf7e9aff4541725d76e420d6aa1} 
\index{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}!memory\_block\_size@{memory\_block\_size}}
\index{memory\_block\_size@{memory\_block\_size}!srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}}
\doxysubsubsection{\texorpdfstring{memory\_block\_size()}{memory\_block\_size()}}
{\footnotesize\ttfamily template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}} , \mbox{\hyperlink{classbool}{bool}} Debug\+Sanitize\+Address = false$>$ \\
size\+\_\+t \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Debug\+Sanitize\+Address}} $>$\+::memory\+\_\+block\+\_\+size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Memory block size in bytes. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00138\ \{\ \textcolor{keywordflow}{return}\ mblock\_size;\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_aa740c16913d89c23f766a051d9dbe69a}\label{classsrsran_1_1fixed__size__memory__block__pool_aa740c16913d89c23f766a051d9dbe69a} 
\index{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}!nof\_memory\_blocks@{nof\_memory\_blocks}}
\index{nof\_memory\_blocks@{nof\_memory\_blocks}!srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}}
\doxysubsubsection{\texorpdfstring{nof\_memory\_blocks()}{nof\_memory\_blocks()}}
{\footnotesize\ttfamily template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}} , \mbox{\hyperlink{classbool}{bool}} Debug\+Sanitize\+Address = false$>$ \\
size\+\_\+t \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Debug\+Sanitize\+Address}} $>$\+::nof\+\_\+memory\+\_\+blocks (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Number of memory blocks contained in this memory pool. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00141\ \{\ \textcolor{keywordflow}{return}\ nof\_blocks;\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1fixed__size__memory__block__pool_ae5ecdfcda02a2d4fb2abe361de1673f6}\label{classsrsran_1_1fixed__size__memory__block__pool_ae5ecdfcda02a2d4fb2abe361de1673f6} 
\index{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}!print\_all\_buffers@{print\_all\_buffers}}
\index{print\_all\_buffers@{print\_all\_buffers}!srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$@{srsran::fixed\_size\_memory\_block\_pool$<$ IdTag, DebugSanitizeAddress $>$}}
\doxysubsubsection{\texorpdfstring{print\_all\_buffers()}{print\_all\_buffers()}}
{\footnotesize\ttfamily template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}} , \mbox{\hyperlink{classbool}{bool}} Debug\+Sanitize\+Address = false$>$ \\
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool}{srsran\+::fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Id\+Tag}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Debug\+Sanitize\+Address}} $>$\+::print\+\_\+all\+\_\+buffers (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00216\ \ \ \{}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keyword}{auto}*\ \ \ \ worker\ =\ get\_worker\_cache();}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ count\ \ =\ 0;}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ l\ :\ worker-\/>local\_cache)\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \ \ count\ +=\ l.size();}
\DoxyCodeLine{00221\ \ \ \ \ \}}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \ \ fmt::print(\textcolor{stringliteral}{"{}There\ are\ \{\}/\{\}\ buffers\ in\ central\ memory\ block\ cache.\ This\ thread\ contains\ \{\}\ in\ its\ local\ cache.\(\backslash\)n"{}},}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ central\_mem\_cache.size\_approx()\ *\ block\_batch\_size,}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1fixed__size__memory__block__pool_aa740c16913d89c23f766a051d9dbe69a}{nof\_memory\_blocks}}(),}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ count);}
\DoxyCodeLine{00227\ \ \ \}}

\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
include/srsran/support/memory\+\_\+pool/fixed\+\_\+size\+\_\+memory\+\_\+block\+\_\+pool.\+h\end{DoxyCompactItemize}
