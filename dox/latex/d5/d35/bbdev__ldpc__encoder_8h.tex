\doxysection{lib/hal/dpdk/bbdev/ldpc/bbdev\+\_\+ldpc\+\_\+encoder.h File Reference}
\hypertarget{bbdev__ldpc__encoder_8h}{}\label{bbdev__ldpc__encoder_8h}\index{lib/hal/dpdk/bbdev/ldpc/bbdev\_ldpc\_encoder.h@{lib/hal/dpdk/bbdev/ldpc/bbdev\_ldpc\_encoder.h}}


Definition of the specific functions used by the bbdeb-\/based hardware-\/accelerated LDPC encoder implementations.  


{\ttfamily \#include "{}srsran/adt/static\+\_\+vector.\+h"{}}\newline
{\ttfamily \#include "{}srsran/hal/phy/upper/channel\+\_\+processors/hw\+\_\+accelerator\+\_\+pdsch\+\_\+enc.\+h"{}}\newline
{\ttfamily \#include $<$rte\+\_\+bbdev\+\_\+op.\+h$>$}\newline
Include dependency graph for bbdev\+\_\+ldpc\+\_\+encoder.\+h\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d9/d2b/bbdev__ldpc__encoder_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d0/dea/bbdev__ldpc__encoder_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Namespaces}
\begin{DoxyCompactItemize}
\item 
namespace \mbox{\hyperlink{namespacesrsran}{srsran}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{bbdev__ldpc__encoder_8h_a1a9c8e038963f0e8f36d3d679f025ed2}{srsran\+::dpdk\+::set\+\_\+ldpc\+\_\+enc\+\_\+bbdev\+\_\+config}} (\+::rte\+\_\+bbdev\+\_\+enc\+\_\+op \&op, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration}{srsran\+::hal\+::hw\+\_\+pdsch\+\_\+encoder\+\_\+configuration}} \&cfg)
\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{bbdev__ldpc__encoder_8h_ac61358b8a703b6629b3a493a047fcb95}{srsran\+::dpdk\+::set\+\_\+ldpc\+\_\+enc\+\_\+bbdev\+\_\+data}} (\+::rte\+\_\+bbdev\+\_\+enc\+\_\+op \&op, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&in\+\_\+mbuf\+\_\+pool, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&out\+\_\+mbuf\+\_\+pool, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ data, \mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&logger, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ tb\+\_\+crc=\{\})
\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{bbdev__ldpc__encoder_8h_ab16206ba56ea956376ee6344f908a308}{srsran\+::dpdk\+::enqueue\+\_\+ldpc\+\_\+enc\+\_\+operation}} (\+::rte\+\_\+bbdev\+\_\+enc\+\_\+op \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\+\_\+ops}}, uint16\+\_\+t \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ldpc\+\_\+enc\+\_\+ops}}, uint16\+\_\+t id, uint16\+\_\+t \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\+\_\+queue\+\_\+id}}, \mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&logger)
\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{bbdev__ldpc__encoder_8h_ad31425ce9d52f65b6114428a5b59749d}{srsran\+::dpdk\+::dequeue\+\_\+ldpc\+\_\+enc\+\_\+operation}} (\+::rte\+\_\+bbdev\+\_\+enc\+\_\+op \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\+\_\+ops}}, uint16\+\_\+t \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ldpc\+\_\+enc\+\_\+ops}}, uint16\+\_\+t id, uint16\+\_\+t \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\+\_\+queue\+\_\+id}}, \mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&logger)
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{bbdev__ldpc__encoder_8h_a214bea6828bd64573f8ce154bc6d5c85}{srsran\+::dpdk\+::read\+\_\+ldpc\+\_\+enc\+\_\+bbdev\+\_\+data}} (\+::rte\+\_\+bbdev\+\_\+enc\+\_\+op \&op, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ data, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{packed\+\_\+data}}, \mbox{\hyperlink{classbool}{bool}} cb\+\_\+mode=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{true}})
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Definition of the specific functions used by the bbdeb-\/based hardware-\/accelerated LDPC encoder implementations. 



\doxysubsection{Function Documentation}
\Hypertarget{bbdev__ldpc__encoder_8h_ad31425ce9d52f65b6114428a5b59749d}\label{bbdev__ldpc__encoder_8h_ad31425ce9d52f65b6114428a5b59749d} 
\index{bbdev\_ldpc\_encoder.h@{bbdev\_ldpc\_encoder.h}!dequeue\_ldpc\_enc\_operation@{dequeue\_ldpc\_enc\_operation}}
\index{dequeue\_ldpc\_enc\_operation@{dequeue\_ldpc\_enc\_operation}!bbdev\_ldpc\_encoder.h@{bbdev\_ldpc\_encoder.h}}
\doxysubsubsection{\texorpdfstring{dequeue\_ldpc\_enc\_operation()}{dequeue\_ldpc\_enc\_operation()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classbool}{bool}} srsran\+::dpdk\+::dequeue\+\_\+ldpc\+\_\+enc\+\_\+operation (\begin{DoxyParamCaption}\item[{\+::rte\+\_\+bbdev\+\_\+enc\+\_\+op \&}]{enc\+\_\+ops,  }\item[{uint16\+\_\+t}]{ldpc\+\_\+enc\+\_\+ops,  }\item[{uint16\+\_\+t}]{id,  }\item[{uint16\+\_\+t}]{enc\+\_\+queue\+\_\+id,  }\item[{\mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&}]{logger }\end{DoxyParamCaption})}

Dequeues processed operations from the hardware-\/accelerated LDPC encoder. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em enc\+\_\+ops} & Array of encoder operation configuration structures. \\
\hline
\mbox{\texttt{ in}}  & {\em num\+\_\+enc\+\_\+ops} & Number of encoder operations (to be dequeued -\/ to the array). \\
\hline
\mbox{\texttt{ in}}  & {\em id} & bbdev ID of the hardware-\/accelerator. \\
\hline
\mbox{\texttt{ in}}  & {\em enc\+\_\+queue\+\_\+id} & bbdev ID of the queue used by the hardrware-\/accelerator. \\
\hline
\mbox{\texttt{ in}}  & {\em logger} & SRS logger. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00174\ \{}
\DoxyCodeLine{00175\ \ \ \textcolor{comment}{//\ Dequeue\ processed\ operations\ from\ the\ hardware-\/accelerator\ LDPC\ encoder.}}
\DoxyCodeLine{00176\ \ \ ::rte\_bbdev\_enc\_op*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ops}}\ \ \ \ \ \ \ \ \ \ \ \ \ =\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_ops}};}
\DoxyCodeLine{00177\ \ \ uint16\_t\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_deq\_enc\_ops}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_bbdev\_dequeue\_ldpc\_enc\_ops}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bbdev\_id}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_queue\_id}},\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ops}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_enc\_ops}});}
\DoxyCodeLine{00178\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_deq\_enc\_ops}}\ <=\ 0)\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{comment}{//\ logger.error("{}[bbdev]\ Couldn't\ dequeue\ new\ operations\ from\ the\ ldpc\ encoder."{});}}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00181\ \ \ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00184\ \}}

\end{DoxyCode}
\Hypertarget{bbdev__ldpc__encoder_8h_ab16206ba56ea956376ee6344f908a308}\label{bbdev__ldpc__encoder_8h_ab16206ba56ea956376ee6344f908a308} 
\index{bbdev\_ldpc\_encoder.h@{bbdev\_ldpc\_encoder.h}!enqueue\_ldpc\_enc\_operation@{enqueue\_ldpc\_enc\_operation}}
\index{enqueue\_ldpc\_enc\_operation@{enqueue\_ldpc\_enc\_operation}!bbdev\_ldpc\_encoder.h@{bbdev\_ldpc\_encoder.h}}
\doxysubsubsection{\texorpdfstring{enqueue\_ldpc\_enc\_operation()}{enqueue\_ldpc\_enc\_operation()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classbool}{bool}} srsran\+::dpdk\+::enqueue\+\_\+ldpc\+\_\+enc\+\_\+operation (\begin{DoxyParamCaption}\item[{\+::rte\+\_\+bbdev\+\_\+enc\+\_\+op \&}]{enc\+\_\+ops,  }\item[{uint16\+\_\+t}]{ldpc\+\_\+enc\+\_\+ops,  }\item[{uint16\+\_\+t}]{id,  }\item[{uint16\+\_\+t}]{enc\+\_\+queue\+\_\+id,  }\item[{\mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&}]{logger }\end{DoxyParamCaption})}

Enqueues new operations in the hardware-\/accelerated LDPC encoder. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em enc\+\_\+ops} & Array of encoder operation configuration structures. \\
\hline
\mbox{\texttt{ in}}  & {\em num\+\_\+enc\+\_\+ops} & Number of encoder operations (to be enqueued -\/ from the array). \\
\hline
\mbox{\texttt{ in}}  & {\em id} & bbdev ID of the hardware-\/accelerator. \\
\hline
\mbox{\texttt{ in}}  & {\em enc\+\_\+queue\+\_\+id} & bbdev ID of the queue used by the hardrware-\/accelerator. \\
\hline
\mbox{\texttt{ in}}  & {\em logger} & SRS logger. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00152\ \{}
\DoxyCodeLine{00153\ \ \ \textcolor{comment}{//\ Enqueue\ new\ operations\ on\ the\ hardware-\/accelerator\ LDPC\ encoder.}}
\DoxyCodeLine{00154\ \ \ ::rte\_bbdev\_enc\_op*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ops}}\ \ \ \ \ \ \ \ \ \ \ \ \ =\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_ops}};}
\DoxyCodeLine{00155\ \ \ uint16\_t\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_enq\_enc\_ops}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_bbdev\_enqueue\_ldpc\_enc\_ops}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bbdev\_id}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_queue\_id}},\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ops}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_enc\_ops}});}
\DoxyCodeLine{00156\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_enq\_enc\_ops}}\ <=\ 0)\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{comment}{//\ Free\ the\ input\ and\ output\ mbuf\ back\ to\ its\ original\ mbuf\ pools.}}
\DoxyCodeLine{00158\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_ops}}.ldpc\_enc.input.data);}
\DoxyCodeLine{00159\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_ops}}.ldpc\_enc.output.data);}
\DoxyCodeLine{00160\ \ \ \ \ logger.error(}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[bbdev]\ Couldn't\ enqueue\ new\ operations\ in\ the\ ldpc\ encoder.\ The\ operation\ will\ be\ dropped:\ acc\ [queue=\{\}]."{}},}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_queue\_id}});}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00164\ \ \ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00167\ \}}

\end{DoxyCode}
\Hypertarget{bbdev__ldpc__encoder_8h_a214bea6828bd64573f8ce154bc6d5c85}\label{bbdev__ldpc__encoder_8h_a214bea6828bd64573f8ce154bc6d5c85} 
\index{bbdev\_ldpc\_encoder.h@{bbdev\_ldpc\_encoder.h}!read\_ldpc\_enc\_bbdev\_data@{read\_ldpc\_enc\_bbdev\_data}}
\index{read\_ldpc\_enc\_bbdev\_data@{read\_ldpc\_enc\_bbdev\_data}!bbdev\_ldpc\_encoder.h@{bbdev\_ldpc\_encoder.h}}
\doxysubsubsection{\texorpdfstring{read\_ldpc\_enc\_bbdev\_data()}{read\_ldpc\_enc\_bbdev\_data()}}
{\footnotesize\ttfamily void srsran\+::dpdk\+::read\+\_\+ldpc\+\_\+enc\+\_\+bbdev\+\_\+data (\begin{DoxyParamCaption}\item[{\+::rte\+\_\+bbdev\+\_\+enc\+\_\+op \&}]{op,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$}]{data,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$}]{packed\+\_\+data,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{cb\+\_\+mode = {\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{true}}} }\end{DoxyParamCaption})}

Reads the contents of the bbdev output mbuffer structures from the hardware-\/accelerated LPDC encoder operations. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em op} & bbdev encoder operation configuration structure. \\
\hline
\mbox{\texttt{ out}}  & {\em data} & The output data from the hardware-\/accelerated LDPC encoder operations. \\
\hline
\mbox{\texttt{ out}}  & {\em packed\+\_\+data} & Temporary storage for the packed outputs from the hardware-\/accelerator. \\
\hline
\mbox{\texttt{ in}}  & {\em cb\+\_\+mode} & Optional. Indicates if the encoder operates in CB mode (true) or TB mode (false). \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00190\ \{}
\DoxyCodeLine{00191\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_mbuf}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.output.data;}
\DoxyCodeLine{00192\ \ \ uint16\_t\ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_len}}\ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rte\_pktmbuf\_data\_len}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}});}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \textcolor{comment}{//\ Read\ the\ TB/CB\ data.\ Note\ that\ a\ single\ read\ operation\ is\ performed\ per\ TB/CB.\ The\ read\ assumes\ that\ the\ output}}
\DoxyCodeLine{00195\ \ \ \textcolor{comment}{//\ data\ size\ is\ below\ the\ requested\ mbuf\ size\ (by\ default\ set\ to\ the\ maximum\ supported\ value}}
\DoxyCodeLine{00196\ \ \ \textcolor{comment}{//\ RTE\_BBDEV\_LDPC\_E\_MAX\_MBUF).}}
\DoxyCodeLine{00197\ \ \ uint16\_t\ offset\ \ \ =\ 0;}
\DoxyCodeLine{00198\ \ \ \mbox{\hyperlink{classuint8__t}{uint8\_t}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_data}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rte\_pktmbuf\_mtod\_offset}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}},\ \mbox{\hyperlink{classuint8__t}{uint8\_t}}*,\ offset);}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \textcolor{comment}{//\ Recover\ the\ encoded\ data.}}
\DoxyCodeLine{00201\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_memcpy}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{packed\_data}}.data(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_data}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_len}});}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \textcolor{comment}{//\ Unpack\ the\ accelerator\ outputs,\ while\ avoiding\ (byte-\/alignment)\ padding\ bits.}}
\DoxyCodeLine{00204\ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_length}}\ \ \ \ \ \ \ \ \ =\ 0;}
\DoxyCodeLine{00205\ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_offset}}\ \ \ \ \ \ \ \ \ =\ 0;}
\DoxyCodeLine{00206\ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_byte\_offset}}\ \ \ \ =\ 0;}
\DoxyCodeLine{00207\ \ \ \mbox{\hyperlink{classuint8__t}{uint8\_t}}\ \ nof\_segments\ \ \ \ \ \ \ =\ 1;}
\DoxyCodeLine{00208\ \ \ \mbox{\hyperlink{classuint8__t}{uint8\_t}}\ \ nof\_short\_segments\ =\ 0;}
\DoxyCodeLine{00209\ \ \ \textcolor{comment}{//\ Check\ if\ CB\ mode\ is\ used.\ No\ data\ offset\ in\ this\ case\ (a\ dedicated\ mbuf\ is\ used).}}
\DoxyCodeLine{00210\ \ \ \textcolor{keywordflow}{if}\ (cb\_mode)\ \{}
\DoxyCodeLine{00211\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_length}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.cb\_params.e;}
\DoxyCodeLine{00212\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_length}}\ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.tb\_params.ea;}
\DoxyCodeLine{00214\ \ \ \ \ nof\_short\_segments\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.tb\_params.cab;}
\DoxyCodeLine{00215\ \ \ \ \ nof\_segments\ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.tb\_params.c;}
\DoxyCodeLine{00216\ \ \ \}}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uint}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_idx}}\ =\ 0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{end\_idx}}\ =\ nof\_segments;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_idx}}\ <\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{end\_idx}};\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_idx}})\ \{}
\DoxyCodeLine{00219\ \ \ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_byte\_length}}\ \ \ \ \ \ \ \ \ \ \ \ \ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint32__t}{uint32\_t}}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ceil}}(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_length}})\ /\ 8.0));}
\DoxyCodeLine{00220\ \ \ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_bit\_length\_with\_padding}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_byte\_length}}\ *\ 8;}
\DoxyCodeLine{00221\ \ \ \ \ srsvec::bit\_unpack(\mbox{\hyperlink{classsrsran_1_1span}{span<uint8\_t>}}(data.subspan(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_offset}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_bit\_length\_with\_padding}})),}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1bit__buffer_a69017e63cce99f1c0c6aaa79a4439a89}{::bit\_buffer::from\_bytes}}(\mbox{\hyperlink{classsrsran_1_1span}{span<uint8\_t>}}(\&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{packed\_data}}[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_byte\_offset}}],\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_byte\_length}})));}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{comment}{//\ In\ TB\ mode\ the\ segment\ offset\ needs\ to\ be\ udpated.}}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordflow}{if}\ (!cb\_mode)\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_offset}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_length}};}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_byte\_offset}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_byte\_length}};}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_idx}}\ +\ 1\ <\ nof\_short\_segments)\ \{}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_length}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.tb\_params.ea;}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg\_length}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.tb\_params.eb;}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00233\ \ \ \ \ \}}
\DoxyCodeLine{00234\ \ \ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \textcolor{comment}{//\ Free\ the\ input\ and\ output\ mbuf\ back\ to\ its\ original\ mbuf\ pools.}}
\DoxyCodeLine{00237\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.input.data);}
\DoxyCodeLine{00238\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.output.data);}
\DoxyCodeLine{00239\ \}}

\end{DoxyCode}
\Hypertarget{bbdev__ldpc__encoder_8h_a1a9c8e038963f0e8f36d3d679f025ed2}\label{bbdev__ldpc__encoder_8h_a1a9c8e038963f0e8f36d3d679f025ed2} 
\index{bbdev\_ldpc\_encoder.h@{bbdev\_ldpc\_encoder.h}!set\_ldpc\_enc\_bbdev\_config@{set\_ldpc\_enc\_bbdev\_config}}
\index{set\_ldpc\_enc\_bbdev\_config@{set\_ldpc\_enc\_bbdev\_config}!bbdev\_ldpc\_encoder.h@{bbdev\_ldpc\_encoder.h}}
\doxysubsubsection{\texorpdfstring{set\_ldpc\_enc\_bbdev\_config()}{set\_ldpc\_enc\_bbdev\_config()}}
{\footnotesize\ttfamily void srsran\+::dpdk\+::set\+\_\+ldpc\+\_\+enc\+\_\+bbdev\+\_\+config (\begin{DoxyParamCaption}\item[{\+::rte\+\_\+bbdev\+\_\+enc\+\_\+op \&}]{op,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration}{srsran\+::hal\+::hw\+\_\+pdsch\+\_\+encoder\+\_\+configuration}} \&}]{cfg }\end{DoxyParamCaption})}

Sets the contents of the bbdev configuration structure for the hardware-\/accelerated LPDC encoder operations. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em op} & bbdev encoder operation configuration structure. \\
\hline
\mbox{\texttt{ in}}  & {\em cfg} & PDSCH encoder configuration parameter-\/structure. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00032\ \{}
\DoxyCodeLine{00033\ \ \ \textcolor{comment}{//\ Base\ graph.}}
\DoxyCodeLine{00034\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.basegraph\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint8__t}{uint8\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_ab92871361c091803282f99ce1db60e38}{base\_graph\_index}});}
\DoxyCodeLine{00035\ \ \ \textcolor{comment}{//\ Modulation.}}
\DoxyCodeLine{00036\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.q\_m\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint8__t}{uint8\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_a255de834049c0aa2925e5ed076a525a3}{modulation}});}
\DoxyCodeLine{00037\ \ \ \textcolor{comment}{//\ RV\ index.}}
\DoxyCodeLine{00038\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.rv\_index\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint8__t}{uint8\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_afbc7c6fdfc9eeb5965191ab1ef2c5007}{rv}});}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \textcolor{comment}{//\ Check\ if\ CB\ mode\ or\ TB\ mode\ is\ to\ be\ used.}}
\DoxyCodeLine{00041\ \ \ \textcolor{keywordflow}{if}\ (cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_a05de4e373b50a547844c523e91277047}{cb\_mode}})\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{comment}{//\ CB\ mode\ is\ currently\ used.\ CB\ size\ is\ in\ bytes.}}
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.code\_block\_mode\ =\ 1;}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ CB-\/specific\ parameters.}}
\DoxyCodeLine{00046\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.cb\_params.e\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint32__t}{uint32\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_a1771b23b3af03255270cccfee5d2fa05}{rm\_length}});}
\DoxyCodeLine{00047\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{comment}{//\ TB\ mode\ is\ currently\ used.\ TB\ size\ is\ in\ bytes.}}
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.code\_block\_mode\ =\ 0;}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ TB-\/specific\ parameters.}}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.tb\_params.c\ \ \ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint8__t}{uint8\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_ae195af969a87e89fec882e2443279c45}{nof\_segments}});}
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.tb\_params.cab\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint8__t}{uint8\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_a07640605061fb34ada25620c2ea5258d}{nof\_short\_segments}});}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.tb\_params.ea\ \ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint32__t}{uint32\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_a3faacc820d25247d36c23d047b50fac7}{cw\_length\_a}});}
\DoxyCodeLine{00055\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.tb\_params.eb\ \ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint32__t}{uint32\_t}}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_a3381ffaf0821975ecf1ef4a4aa4bd083}{cw\_length\_b}});}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ The\ offset\ to\ first\ CB\ in\ inbound\ mbuf\ data\ is\ assumed\ to\ be\ 0.}}
\DoxyCodeLine{00057\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.tb\_params.r\ =\ 0;}
\DoxyCodeLine{00058\ \ \ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \textcolor{comment}{//\ Lifting\ size.}}
\DoxyCodeLine{00061\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.z\_c\ =\ \textcolor{keyword}{static\_cast<}uint16\_t\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_aecc533a6b8ad6469c7bf64e8cb3dd01d}{lifting\_size}});}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{unsigned}\ K\ \ \ \ \ \ \ \ \ \ =\ 0;}
\DoxyCodeLine{00063\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.basegraph\ ==\ 1)\ \{}
\DoxyCodeLine{00064\ \ \ \ \ K\ =\ 22\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.z\_c;}
\DoxyCodeLine{00065\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00066\ \ \ \ \ K\ =\ 10\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.z\_c;}
\DoxyCodeLine{00067\ \ \ \}}
\DoxyCodeLine{00068\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.n\_filler\ =\ cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_a7872a58cb8174accb342082f44d44c9c}{nof\_filler\_bits}};}
\DoxyCodeLine{00069\ \ \ \textcolor{comment}{//\ Filler\ bits.}}
\DoxyCodeLine{00070\ \ \ \textcolor{comment}{//\ Note\ that\ providing\ a\ byte-\/aligned\ 'K\ -\/\ n\_filler'\ value\ is\ a\ requirement.}}
\DoxyCodeLine{00071\ \ \ \textcolor{comment}{//\ Roundig\ up\ of\ 'n\_filler'\ to\ the\ nearest\ value\ is\ done\ if\ needed.}}
\DoxyCodeLine{00072\ \ \ \textcolor{keywordflow}{if}\ ((K\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.n\_filler)\ \%\ 8\ !=\ 0)\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.n\_filler\ =\ (cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_a7872a58cb8174accb342082f44d44c9c}{nof\_filler\_bits}}\ +\ 8\ -\/\ 1)\ \&\ -\/8;}
\DoxyCodeLine{00074\ \ \ \}}
\DoxyCodeLine{00075\ \ \ \textcolor{comment}{//\ Length\ of\ the\ circular\ buffer\ in\ bits,\ as\ described\ in\ TS38.212\ Section\ 5.4.2.1.}}
\DoxyCodeLine{00076\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.n\_cb\ =\ \textcolor{keyword}{static\_cast<}uint16\_t\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_a5aad33a7f73895772a97c0c567f26dca}{Ncb}});}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \textcolor{comment}{//\ Define\ the\ PDSCH\ encoder\ operation\ flags.}}
\DoxyCodeLine{00079\ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ =\ 0;}
\DoxyCodeLine{00080\ \ \ \textcolor{comment}{//\ Bit-\/level\ interleaver\ is\ always\ implemented\ by\ the\ accelerator\ (clear\ the\ bit).}}
\DoxyCodeLine{00081\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ \&=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\string~RTE\_BBDEV\_LDPC\_INTERLEAVER\_BYPASS}};}
\DoxyCodeLine{00082\ \ \ \textcolor{comment}{//\ Rate\ matching\ is\ always\ implemented\ by\ the\ accelerator\ (set\ the\ bit).}}
\DoxyCodeLine{00083\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ |=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_RATE\_MATCH}};}
\DoxyCodeLine{00084\ \ \ \textcolor{comment}{//\ In\ CB\ mode,\ both\ TB\ anc\ CB\ CRC\ attachment\ is\ implemented\ by\ the\ segmenter\ (and,\ thus,\ is\ disabled\ in\ the}}
\DoxyCodeLine{00085\ \ \ \textcolor{comment}{//\ accelerator).\ In\ TB\ mode,\ TB\ CRC\ attachment\ is\ not\ supported\ by\ the\ accelerator,\ but\ the\ CB\ one\ is\ for\ segmented}}
\DoxyCodeLine{00086\ \ \ \textcolor{comment}{//\ TBs.}}
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{if}\ (!cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_a05de4e373b50a547844c523e91277047}{cb\_mode}}\ \&\&\ cfg.\mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration_ae195af969a87e89fec882e2443279c45}{nof\_segments}}\ >\ 1)\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}}\ |=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{RTE\_BBDEV\_LDPC\_CRC\_24B\_ATTACH}};}
\DoxyCodeLine{00089\ \ \ \}}
\DoxyCodeLine{00090\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.op\_flags\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bitmask}};}
\DoxyCodeLine{00091\ \}}

\end{DoxyCode}
\Hypertarget{bbdev__ldpc__encoder_8h_ac61358b8a703b6629b3a493a047fcb95}\label{bbdev__ldpc__encoder_8h_ac61358b8a703b6629b3a493a047fcb95} 
\index{bbdev\_ldpc\_encoder.h@{bbdev\_ldpc\_encoder.h}!set\_ldpc\_enc\_bbdev\_data@{set\_ldpc\_enc\_bbdev\_data}}
\index{set\_ldpc\_enc\_bbdev\_data@{set\_ldpc\_enc\_bbdev\_data}!bbdev\_ldpc\_encoder.h@{bbdev\_ldpc\_encoder.h}}
\doxysubsubsection{\texorpdfstring{set\_ldpc\_enc\_bbdev\_data()}{set\_ldpc\_enc\_bbdev\_data()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classbool}{bool}} srsran\+::dpdk\+::set\+\_\+ldpc\+\_\+enc\+\_\+bbdev\+\_\+data (\begin{DoxyParamCaption}\item[{\+::rte\+\_\+bbdev\+\_\+enc\+\_\+op \&}]{op,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&}]{in\+\_\+mbuf\+\_\+pool,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+::rte\+\_\+mempool}} \&}]{out\+\_\+mbuf\+\_\+pool,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$}]{data,  }\item[{\mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&}]{logger,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$}]{tb\+\_\+crc = {\ttfamily \{\}} }\end{DoxyParamCaption})}

Sets the contents of the bbdev input mbuffer structures for the hardware-\/accelerated LPDC encoder operations. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em op} & bbdev encoder operation configuration structure. \\
\hline
\mbox{\texttt{ in}}  & {\em in\+\_\+mbuf\+\_\+pool} & Input data mbuf pool for the hardware-\/accelerated LDPC encoder operations. \\
\hline
\mbox{\texttt{ in}}  & {\em out\+\_\+mbuf\+\_\+pool} & Output data mbuf pool for the hardware-\/accelerated LDPC encoder operations. \\
\hline
\mbox{\texttt{ in}}  & {\em data} & The input data to the hardware-\/accelerated LDPC encoder operations. \\
\hline
\mbox{\texttt{ in}}  & {\em logger} & SRS logger. \\
\hline
\mbox{\texttt{ in}}  & {\em tb\+\_\+crc} & Optional. The TB CRC computed from \textquotesingle{}data\textquotesingle{}. Only required in TB mode. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00099\ \{}
\DoxyCodeLine{00100\ \ \ \textcolor{comment}{//\ Allocate\ an\ mbuf\ for\ the\ input\ data\ from\ the\ received\ mempool.}}
\DoxyCodeLine{00101\ \ \ \textcolor{keywordtype}{char}*\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_data}};}
\DoxyCodeLine{00102\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_mbuf}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_in}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_alloc}}(\&in\_mbuf\_pool);}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_in}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00104\ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}[bbdev]\ Not\ enough\ mbufs\ in\ the\ input\ ldpc\ encoder\ mbuf\ pool."{}});}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00106\ \ \ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{comment}{//\ Set\ the\ memory\ pointers\ for\ the\ input\ data.}}
\DoxyCodeLine{00109\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.input.data\ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_in}};}
\DoxyCodeLine{00110\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.input.offset\ =\ 0;\ \textcolor{comment}{//\ Note\ that\ a\ dedicated\ mbuf\ is\ used\ per\ operation.}}
\DoxyCodeLine{00111\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.input.length\ =\ 0;}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \textcolor{comment}{//\ Allocate\ the\ required\ bytes\ in\ the\ mbuf\ and\ update\ the\ memory\ pointers.}}
\DoxyCodeLine{00114\ \ \ uint16\_t\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_len}}\ \ \ =\ data.size();}
\DoxyCodeLine{00115\ \ \ uint16\_t\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_crc\_len}}\ =\ tb\_crc.\mbox{\hyperlink{classsrsran_1_1span_ad0e376d95ca916144eac76f27f0654ac}{size}}();}
\DoxyCodeLine{00116\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_data}}\ \ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_append}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_in}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_len}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_crc\_len}});}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_data}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ Free\ the\ input\ mbuf\ back\ to\ its\ original\ mbuf\ pools.}}
\DoxyCodeLine{00119\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_in}});}
\DoxyCodeLine{00120\ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}[bbdev]\ Couldn't\ append\ \{\}\ bytes\ to\ the\ ldpc\ encoder\ input\ mbuf."{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_len}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_crc\_len}});}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00122\ \ \ \}}
\DoxyCodeLine{00123\ \ \ \textcolor{comment}{//\ Copy\ the\ TB/CB\ data.\ Note\ that\ a\ single\ copy\ operation\ is\ performed\ per\ TB/CB.\ The\ copy\ assumes\ that\ the\ input\ data}}
\DoxyCodeLine{00124\ \ \ \textcolor{comment}{//\ size\ is\ below\ the\ requested\ mbuf\ size\ (by\ default\ set\ to\ the\ maximum\ supported\ value\ RTE\_BBDEV\_LDPC\_E\_MAX\_MBUF).}}
\DoxyCodeLine{00125\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_memcpy}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_data}},\ data.begin(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_len}});}
\DoxyCodeLine{00126\ \ \ \textcolor{comment}{//\ If\ required,\ copy\ the\ TB-\/CRC.}}
\DoxyCodeLine{00127\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_memcpy}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{input\_data}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_len}},\ \&tb\_crc[0],\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_crc\_len}});}
\DoxyCodeLine{00128\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.input.length\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_len}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_crc\_len}};}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \textcolor{comment}{//\ Allocate\ an\ mbuf\ for\ the\ output\ data\ from\ the\ received\ mempool.}}
\DoxyCodeLine{00131\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_mbuf}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_alloc}}(\&out\_mbuf\_pool);}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{comment}{//\ Free\ the\ input\ mbuf\ back\ to\ its\ original\ mbuf\ pools.}}
\DoxyCodeLine{00134\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::rte\_pktmbuf\_free}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_in}});}
\DoxyCodeLine{00135\ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}[bbdev]\ Not\ enough\ mbufs\ in\ the\ output\ ldpc\ encoder\ mbuf\ pool."{}});}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00137\ \ \ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \textcolor{comment}{//\ Set\ the\ memory\ pointers\ for\ the\ output\ data.}}
\DoxyCodeLine{00140\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.output.data\ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{m\_head\_out}};}
\DoxyCodeLine{00141\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.output.offset\ =\ 0;\ \textcolor{comment}{//\ Note\ that\ a\ dedicated\ mbuf\ is\ used\ per\ operation.}}
\DoxyCodeLine{00142\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enc\_op}}.ldpc\_enc.output.length\ =\ 0;}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00145\ \}}

\end{DoxyCode}
