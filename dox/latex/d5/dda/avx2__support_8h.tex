\doxysection{lib/phy/upper/channel\+\_\+coding/ldpc/avx2\+\_\+support.h File Reference}
\hypertarget{avx2__support_8h}{}\label{avx2__support_8h}\index{lib/phy/upper/channel\_coding/ldpc/avx2\_support.h@{lib/phy/upper/channel\_coding/ldpc/avx2\_support.h}}


AVX2 support for LDPC.  


{\ttfamily \#include "{}simd\+\_\+support.\+h"{}}\newline
Include dependency graph for avx2\+\_\+support.\+h\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/d48/avx2__support_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d4f/avx2__support_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Namespaces}
\begin{DoxyCompactItemize}
\item 
namespace \mbox{\hyperlink{namespacesrsran}{srsran}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{avx2__support_8h_a26db6ab4d32b3011129615b76c81fffd}\label{avx2__support_8h_a26db6ab4d32b3011129615b76c81fffd} 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{using}} {\bfseries srsran\+::mm256\+::avx2\+\_\+span} = \mbox{\hyperlink{classsrsran_1_1detail_1_1simd__span}{detail\+::simd\+\_\+span}}$<$\mbox{\hyperlink{structsrsran_1_1detail_1_1simd256__wrapper}{detail\+::simd256\+\_\+wrapper}}, int8\+\_\+t$>$
\item 
\Hypertarget{avx2__support_8h_ae603c78d96dfd368d0adc50924986725}\label{avx2__support_8h_ae603c78d96dfd368d0adc50924986725} 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{using}} {\bfseries srsran\+::mm256\+::avx2\+\_\+const\+\_\+span} = \mbox{\hyperlink{classsrsran_1_1detail_1_1simd__span}{detail\+::simd\+\_\+span}}$<$\mbox{\hyperlink{structsrsran_1_1detail_1_1simd256__wrapper}{detail\+::simd256\+\_\+wrapper}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} int8\+\_\+t$>$
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+\_\+\+\_\+m256i}} \mbox{\hyperlink{avx2__support_8h_a248288efc817de94b1ca5db6a88de735}{srsran\+::mm256\+::scale\+\_\+epi8}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+\_\+\+\_\+m256i}} a, \mbox{\hyperlink{classfloat}{float}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sf}}, \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} \mbox{\hyperlink{namespacesrsran_a2918c0347dde854fce1aaebb70a16c33}{max}})
\begin{DoxyCompactList}\small\item\em Scales packed 8-\/bit integers in {\ttfamily a} by the scaling factor {\ttfamily sf}. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
AVX2 support for LDPC. 

Builds upon \doxylink{simd__support_8h}{simd\+\_\+support.\+h} and specializes functions and templates for AVX2 registers. 

\doxysubsection{Function Documentation}
\Hypertarget{avx2__support_8h_a248288efc817de94b1ca5db6a88de735}\label{avx2__support_8h_a248288efc817de94b1ca5db6a88de735} 
\index{avx2\_support.h@{avx2\_support.h}!scale\_epi8@{scale\_epi8}}
\index{scale\_epi8@{scale\_epi8}!avx2\_support.h@{avx2\_support.h}}
\doxysubsubsection{\texorpdfstring{scale\_epi8()}{scale\_epi8()}}
{\footnotesize\ttfamily \+\_\+\+\_\+m256i srsran\+::mm256\+::scale\+\_\+epi8 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\+\_\+\+\_\+m256i}}}]{a,  }\item[{\mbox{\hyperlink{classfloat}{float}}}]{sf,  }\item[{\mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}}}]{max }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Scales packed 8-\/bit integers in {\ttfamily a} by the scaling factor {\ttfamily sf}. 

Values of {\ttfamily a} larger than {\ttfamily max} or smaller than {\ttfamily -\/max} are forwarded unaltered. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em a} & Vector of packed 8-\/bit integers. \\
\hline
\mbox{\texttt{ in}}  & {\em sf} & Scaling factor (0, 1\mbox{]}. \\
\hline
\mbox{\texttt{ in}}  & {\em max} & Maximum input value (in absolute value) to which the scaling is applied \mbox{[}0, 127). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Vector of packed 8-\/bit integers with the scaling result. 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{00066\ \{}
\DoxyCodeLine{00067\ \ \ srsran\_assert((sf\ >\ 0)\ \&\&\ (sf\ <=\ 1),\ \textcolor{stringliteral}{"{}Scaling\ factor\ out\ of\ range."{}});}
\DoxyCodeLine{00068\ \ \ srsran\_assert(max\ <\ 127,\ \textcolor{stringliteral}{"{}Parameter\ max\ out\ of\ range."{}});}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \textcolor{keywordflow}{if}\ (sf\ >=\ .9999)\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordflow}{return}\ a;}
\DoxyCodeLine{00072\ \ \ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \_\_m256i\ mask\_even\_epi8\ =\ \_mm256\_set1\_epi16(0x00ff);}
\DoxyCodeLine{00075\ \ \ \textcolor{comment}{//\ FLOAT2INT\ =\ 2\string^16\ =\ 65536}}
\DoxyCodeLine{00076\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{unsigned}\ FLOAT2INT\ =\ 1U\ <<\ 16U;}
\DoxyCodeLine{00077\ \ \ \textcolor{keyword}{const}\ \_\_m256i\ \ \ \ \ \ \ \ \ \ \ \ \ MAX\_epi8\ \ =\ \_mm256\_set1\_epi8(max);}
\DoxyCodeLine{00078\ \ \ \textcolor{keyword}{const}\ \_\_m256i\ \ \ \ \ \ \ \ \ \ \ \ \ MIN\_epi8\ \ =\ \_mm256\_set1\_epi8(-\/max);}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \textcolor{comment}{//\ Create\ a\ register\ filled\ with\ copies\ of\ the\ scaling\ factor\ times\ FLOAT2INT.\ Note\ that\ the\ upper\ bound\ on\ sf\ implies}}
\DoxyCodeLine{00081\ \ \ \textcolor{comment}{//\ that\ (sf\ *\ FLOAT2INT)\ can\ be\ represented\ over\ 16\ bits.}}
\DoxyCodeLine{00082\ \ \ \_\_m256i\ sf\_epi16\ =\ \_mm256\_set1\_epi16(\textcolor{keyword}{static\_cast<}uint16\_t\textcolor{keyword}{>}(sf\ *\ FLOAT2INT));}
\DoxyCodeLine{00083\ \ \ \textcolor{comment}{//\ Even\ bytes\ in\ a,\ alternated\ with\ a\ zero-\/valued\ byte.}}
\DoxyCodeLine{00084\ \ \ \_\_m256i\ even\_epi16\ =\ \_mm256\_and\_si256(a,\ mask\_even\_epi8);}
\DoxyCodeLine{00085\ \ \ \textcolor{comment}{//\ Odd\ bytes\ in\ a,\ moved\ to\ the\ even\ positions\ and\ alternated\ with\ a\ zero-\/valued\ byte.}}
\DoxyCodeLine{00086\ \ \ \_\_m256i\ odd\_epi16\ =\ \_mm256\_srli\_epi16(a,\ 8);}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ This\ is\ equivalent\ to\ multiply\ each\ byte\ by\ sf:\ indeed,\ we\ multiply\ each\ byte\ by\ (sf\ *\ FLOAT2INT),\ store\ the\ result}}
\DoxyCodeLine{00089\ \ \ \textcolor{comment}{//\ in\ over\ 32\ bit\ and\ pick\ only\ the\ 16\ most\ significant\ bits\ (i.e.,\ we\ divide\ by\ FLOAT2INT).}}
\DoxyCodeLine{00090\ \ \ \_\_m256i\ p\_even\_epi16\ =\ \_mm256\_mulhi\_epu16(even\_epi16,\ sf\_epi16);}
\DoxyCodeLine{00091\ \ \ \_\_m256i\ p\_odd\_epi16\ \ =\ \_mm256\_mulhi\_epu16(odd\_epi16,\ sf\_epi16);}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \textcolor{comment}{//\ Move\ the\ odd\ bits\ back\ to\ their\ original\ positions.}}
\DoxyCodeLine{00094\ \ \ p\_odd\_epi16\ =\ \_mm256\_slli\_epi16(p\_odd\_epi16,\ 8);}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \textcolor{comment}{//\ Combine\ even\ and\ odd\ bits.\ Note\ that\ the\ "{}odd"{}\ bytes\ of\ p\_even\_epi16\ are\ equal\ to\ 0\ (the\ result\ of\ multiplying\ a}}
\DoxyCodeLine{00097\ \ \ \textcolor{comment}{//\ byte\ by\ a\ 16-\/bit\ value\ will\ occupy\ at\ most\ 24\ of\ the\ 32\ bits).}}
\DoxyCodeLine{00098\ \ \ \_\_m256i\ product\_epi8\ =\ \_mm256\_xor\_si256(p\_even\_epi16,\ p\_odd\_epi16);}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \textcolor{comment}{//\ Replace\ values\ corresponding\ to\ "{}large"{}\ inputs\ with\ their\ original\ values.}}
\DoxyCodeLine{00101\ \ \ \_\_m256i\ mask\_epi8\ =\ \_mm256\_cmpgt\_epi8(a,\ MAX\_epi8);}
\DoxyCodeLine{00102\ \ \ product\_epi8\ \ \ \ \ \ =\ \_mm256\_blendv\_epi8(product\_epi8,\ a,\ mask\_epi8);}
\DoxyCodeLine{00103\ \ \ mask\_epi8\ \ \ \ \ \ \ \ \ =\ \_mm256\_cmpgt\_epi8(MIN\_epi8,\ a);}
\DoxyCodeLine{00104\ \ \ product\_epi8\ \ \ \ \ \ =\ \_mm256\_blendv\_epi8(product\_epi8,\ a,\ mask\_epi8);}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{return}\ product\_epi8;}
\DoxyCodeLine{00106\ \}}

\end{DoxyCode}
