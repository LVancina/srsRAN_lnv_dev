\doxysection{srsran\+::ue\+\_\+cell\+\_\+grid\+\_\+allocator Class Reference}
\hypertarget{classsrsran_1_1ue__cell__grid__allocator}{}\label{classsrsran_1_1ue__cell__grid__allocator}\index{srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}}


{\ttfamily \#include $<$ue\+\_\+cell\+\_\+grid\+\_\+allocator.\+h$>$}



Inheritance diagram for srsran\+::ue\+\_\+cell\+\_\+grid\+\_\+allocator\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d7e/classsrsran_1_1ue__cell__grid__allocator__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::ue\+\_\+cell\+\_\+grid\+\_\+allocator\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/dc8/classsrsran_1_1ue__cell__grid__allocator__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1ue__cell__grid__allocator_adb8863d8d70d9180925e31e2643675de}{ue\+\_\+cell\+\_\+grid\+\_\+allocator}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config}{scheduler\+\_\+ue\+\_\+expert\+\_\+config}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{expert\+\_\+cfg\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1ue__repository}{ue\+\_\+repository}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ues\+\_\+}}, \mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{logger\+\_\+}})
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ue__cell__grid__allocator_afca9a3b4314e663168a9b4067be1040e}{add\+\_\+cell}} (\mbox{\hyperlink{namespacesrsran_a5b995a7b11715f3042e18281c21991ff}{du\+\_\+cell\+\_\+index\+\_\+t}} cell\+\_\+index, \mbox{\hyperlink{classsrsran_1_1pdcch__resource__allocator}{pdcch\+\_\+resource\+\_\+allocator}} \&pdcch\+\_\+sched, \mbox{\hyperlink{classsrsran_1_1uci__allocator}{uci\+\_\+allocator}} \&uci\+\_\+alloc, \mbox{\hyperlink{structsrsran_1_1cell__resource__allocator}{cell\+\_\+resource\+\_\+allocator}} \&cell\+\_\+alloc)
\begin{DoxyCompactList}\small\item\em Adds a new cell to the UE allocator. \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{classsrsran_1_1ue__cell__grid__allocator_abe20d3757ae24b91489c800a86acf968}{nof\+\_\+cells}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ue__cell__grid__allocator_ab623952886cb3dd29d7c84a487c3ad01}{slot\+\_\+indication}} ()
\item 
\mbox{\hyperlink{namespacesrsran_adad52e6cbb57b4801efa5bf5b1c11b14}{alloc\+\_\+outcome}} \mbox{\hyperlink{classsrsran_1_1ue__cell__grid__allocator_a783c6fceaac6d90861eeead5b94f4e4f}{allocate\+\_\+dl\+\_\+grant}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1ue__pdsch__grant}{ue\+\_\+pdsch\+\_\+grant}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\item 
\mbox{\hyperlink{namespacesrsran_adad52e6cbb57b4801efa5bf5b1c11b14}{alloc\+\_\+outcome}} \mbox{\hyperlink{classsrsran_1_1ue__cell__grid__allocator_acc2a16bc1d10fb89a00d487e6d95b805}{allocate\+\_\+ul\+\_\+grant}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1ue__pusch__grant}{ue\+\_\+pusch\+\_\+grant}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
This class implements the \doxylink{classsrsran_1_1ue__pdsch__allocator}{ue\+\_\+pdsch\+\_\+allocator} and \doxylink{classsrsran_1_1ue__pusch__allocator}{ue\+\_\+pusch\+\_\+allocator} interfaces, namely the methods to allocate PDSCH and PUSCH grants in different cells, and the methods to fetch the current g\+NB resource grid DL and UL states. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1ue__cell__grid__allocator_adb8863d8d70d9180925e31e2643675de}\label{classsrsran_1_1ue__cell__grid__allocator_adb8863d8d70d9180925e31e2643675de} 
\index{srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}!ue\_cell\_grid\_allocator@{ue\_cell\_grid\_allocator}}
\index{ue\_cell\_grid\_allocator@{ue\_cell\_grid\_allocator}!srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}}
\doxysubsubsection{\texorpdfstring{ue\_cell\_grid\_allocator()}{ue\_cell\_grid\_allocator()}}
{\footnotesize\ttfamily ue\+\_\+cell\+\_\+grid\+\_\+allocator\+::ue\+\_\+cell\+\_\+grid\+\_\+allocator (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config}{scheduler\+\_\+ue\+\_\+expert\+\_\+config}} \&}]{expert\+\_\+cfg\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1ue__repository}{ue\+\_\+repository}} \&}]{ues\+\_\+,  }\item[{\mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&}]{logger\+\_\+ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00038\ \ \ expert\_cfg(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{expert\_cfg\_}}),\ ues(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ues\_}}),\ logger(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{logger\_}})}
\DoxyCodeLine{00039\ \{}
\DoxyCodeLine{00040\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1ue__cell__grid__allocator_afca9a3b4314e663168a9b4067be1040e}\label{classsrsran_1_1ue__cell__grid__allocator_afca9a3b4314e663168a9b4067be1040e} 
\index{srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}!add\_cell@{add\_cell}}
\index{add\_cell@{add\_cell}!srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}}
\doxysubsubsection{\texorpdfstring{add\_cell()}{add\_cell()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} ue\+\_\+cell\+\_\+grid\+\_\+allocator\+::add\+\_\+cell (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a5b995a7b11715f3042e18281c21991ff}{du\+\_\+cell\+\_\+index\+\_\+t}}}]{cell\+\_\+index,  }\item[{\mbox{\hyperlink{classsrsran_1_1pdcch__resource__allocator}{pdcch\+\_\+resource\+\_\+allocator}} \&}]{pdcch\+\_\+sched,  }\item[{\mbox{\hyperlink{classsrsran_1_1uci__allocator}{uci\+\_\+allocator}} \&}]{uci\+\_\+alloc,  }\item[{\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator}{cell\+\_\+resource\+\_\+allocator}} \&}]{cell\+\_\+alloc }\end{DoxyParamCaption})}



Adds a new cell to the UE allocator. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00046\ \{}
\DoxyCodeLine{00047\ \ \ cells.\mbox{\hyperlink{classsrsran_1_1slotted__array_acda4b221c7a9c1007a22571e63bc011f}{emplace}}(cell\_index,\ cell\_t\{cell\_index,\ \&pdcch\_sched,\ \&uci\_alloc,\ \&cell\_alloc\});}
\DoxyCodeLine{00048\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ue__cell__grid__allocator_a783c6fceaac6d90861eeead5b94f4e4f}\label{classsrsran_1_1ue__cell__grid__allocator_a783c6fceaac6d90861eeead5b94f4e4f} 
\index{srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}!allocate\_dl\_grant@{allocate\_dl\_grant}}
\index{allocate\_dl\_grant@{allocate\_dl\_grant}!srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}}
\doxysubsubsection{\texorpdfstring{allocate\_dl\_grant()}{allocate\_dl\_grant()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_adad52e6cbb57b4801efa5bf5b1c11b14}{alloc\+\_\+outcome}} ue\+\_\+cell\+\_\+grid\+\_\+allocator\+::allocate\+\_\+dl\+\_\+grant (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1ue__pdsch__grant}{ue\+\_\+pdsch\+\_\+grant}} \&}]{grant }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{classsrsran_1_1ue__pdsch__allocator}{srsran\+::ue\+\_\+pdsch\+\_\+allocator}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00057\ \{}
\DoxyCodeLine{00058\ \ \ srsran\_assert(ues.\mbox{\hyperlink{classsrsran_1_1ue__repository_a8d4b4805828ab1b0375fa323b73c3d6c}{contains}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.user-\/>ue\_index),\ \textcolor{stringliteral}{"{}Invalid\ UE\ candidate\ index=\{\}"{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.user-\/>ue\_index);}
\DoxyCodeLine{00059\ \ \ srsran\_assert(has\_cell(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index),\ \textcolor{stringliteral}{"{}Invalid\ UE\ candidate\ cell\_index=\{\}"{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index);}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{if}\ (dl\_attempts\_count++\ >=\ expert\_cfg.\mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config_a5c3949d57f4a7de1391f092b4288c352}{max\_pdcch\_alloc\_attempts\_per\_slot}})\ \{}
\DoxyCodeLine{00062\ \ \ \ \ logger.debug(\textcolor{stringliteral}{"{}Stopping\ DL\ allocations.\ Cause:\ Max\ number\ of\ DL\ PDCCH\ allocation\ attempts\ \{\}\ reached."{}},}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ expert\_cfg.\mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config_a5c3949d57f4a7de1391f092b4288c352}{max\_pdcch\_alloc\_attempts\_per\_slot}});}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_slot;}
\DoxyCodeLine{00065\ \ \ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \mbox{\hyperlink{classsrsran_1_1ue}{ue}}\&\ u\ =\ ues[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.user-\/>ue\_index];}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \textcolor{comment}{//\ Verify\ UE\ carrier\ is\ active.}}
\DoxyCodeLine{00070\ \ \ \mbox{\hyperlink{classsrsran_1_1ue__cell}{ue\_cell}}*\ ue\_cc\ =\ u.find\_cell(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index);}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{if}\ (ue\_cc\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00072\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}PDSCH\ allocation\ failed.\ Cause:\ The\ ue=\{\}\ carrier\ with\ cell\_index=\{\}\ is\ inactive"{}},}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.ue\_index,}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index);}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_ue;}
\DoxyCodeLine{00076\ \ \ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1ue__cell__configuration}{ue\_cell\_configuration}}\&\ ue\_cell\_cfg\ =\ ue\_cc-\/>cfg();}
\DoxyCodeLine{00079\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1cell__configuration}{cell\_configuration}}\&\ \ \ \ cell\_cfg\ \ \ \ =\ ue\_cell\_cfg.cell\_cfg\_common;}
\DoxyCodeLine{00080\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1bwp__downlink__common}{bwp\_downlink\_common}}\&\ \ \ init\_dl\_bwp\ =\ *ue\_cell\_cfg.bwp(\mbox{\hyperlink{namespacesrsran_a41c7236508881761bbd602d002833e8e}{to\_bwp\_id}}(0)).dl\_common;}
\DoxyCodeLine{00081\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1bwp__downlink__common}{bwp\_downlink\_common}}\&\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bwp\_dl\_cmn}}\ \ =\ *ue\_cell\_cfg.bwp(ue\_cc-\/>active\_bwp\_id()).dl\_common;}
\DoxyCodeLine{00082\ \ \ \mbox{\hyperlink{classsrsran_1_1dl__harq__process}{dl\_harq\_process}}\&\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}\ \ \ \ \ \ \ \ =\ ue\_cc-\/>harqs.dl\_harq(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.h\_id);}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ ue\_cc-\/>\mbox{\hyperlink{classsrsran_1_1ue__cell_a5547f22a9e862e932a494f187f17b61a}{is\_active}}()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.empty())\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ newTxs\ are\ not\ allowed\ for\ inactive\ UEs.}}
\DoxyCodeLine{00086\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}PDSCH\ allocation\ failed.\ Cause:\ The\ ue=\{\}\ carrier\ with\ cell\_index=\{\}\ is\ inactive.\ New\ DL\ Tx\ "{}}}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}transmissions\ are\ not\ allowed."{}},}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.ue\_index,}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index);}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_ue;}
\DoxyCodeLine{00091\ \ \ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \textcolor{comment}{//\ Find\ a\ SearchSpace\ candidate.}}
\DoxyCodeLine{00094\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1search__space__info}{search\_space\_info}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}\ =\ ue\_cell\_cfg.\mbox{\hyperlink{classsrsran_1_1ue__cell__configuration_ac98203b0c951eb022845bd8b85bb6613}{find\_search\_space}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id);}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00096\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PDSCH.\ Cause:\ No\ valid\ SearchSpace\ found."{}});}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>bwp-\/>bwp\_id\ !=\ ue\_cc-\/>active\_bwp\_id())\ \{}
\DoxyCodeLine{00100\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PDSCH.\ Cause:\ SearchSpace\ not\ valid\ for\ active\ BWP."{}});}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00102\ \ \ \}}
\DoxyCodeLine{00103\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1search__space__configuration}{search\_space\_configuration}}\&\ ss\_cfg\ =\ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>cfg;}
\DoxyCodeLine{00104\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1coreset__configuration}{coreset\_configuration}}\&\ \ \ \ \ \ cs\_cfg\ =\ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>coreset;}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \mbox{\hyperlink{namespacesrsran_ac0a93d3e0aa8452e32308d5038bcad49}{dci\_dl\_rnti\_config\_type}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}};}
\DoxyCodeLine{00107\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.empty())\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.last\_alloc\_params().dci\_cfg\_type;}
\DoxyCodeLine{00109\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (u.\mbox{\hyperlink{classsrsran_1_1ue_a009850d92300e2137c65a21030ec7c1c}{is\_conres\_ce\_pending}}())\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}}\ =\ dci\_dl\_rnti\_config\_type::tc\_rnti\_f1\_0;}
\DoxyCodeLine{00111\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>get\_dl\_dci\_format()\ ==\ dci\_dl\_format::f1\_0\ ?\ dci\_dl\_rnti\_config\_type::c\_rnti\_f1\_0}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ dci\_dl\_rnti\_config\_type::c\_rnti\_f1\_1;}
\DoxyCodeLine{00114\ \ \ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \textcolor{comment}{//\ See\ 3GPP\ TS\ 38.213,\ clause\ 10.1,}}
\DoxyCodeLine{00117\ \ \ \textcolor{comment}{//\ A\ UE\ monitors\ PDCCH\ candidates\ in\ one\ or\ more\ of\ the\ following\ search\ spaces\ sets}}
\DoxyCodeLine{00118\ \ \ \textcolor{comment}{//\ \ -\/\ a\ Type1-\/PDCCH\ CSS\ set\ configured\ by\ ra-\/SearchSpace\ in\ PDCCH-\/ConfigCommon\ for\ a\ DCI\ format\ with}}
\DoxyCodeLine{00119\ \ \ \textcolor{comment}{//\ \ \ \ CRC\ scrambled\ by\ a\ RA-\/RNTI,\ a\ MsgB-\/RNTI,\ or\ a\ TC-\/RNTI\ on\ the\ primary\ cell.}}
\DoxyCodeLine{00120\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}}\ ==\ dci\_dl\_rnti\_config\_type::tc\_rnti\_f1\_0\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id\ !=\ cell\_cfg.dl\_cfg\_common.init\_dl\_bwp.pdcch\_common.\mbox{\hyperlink{structsrsran_1_1pdcch__config__common_abb3e2d05a704bec469946b206ad200f7}{ra\_search\_space\_id}})\ \{}
\DoxyCodeLine{00122\ \ \ \ \ logger.info(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PDSCH.\ Cause:\ SearchSpace\ not\ valid\ for\ re-\/transmission\ of\ Msg4."{}});}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00124\ \ \ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \textcolor{comment}{//\ Note:\ Unable\ to\ multiplex\ CSI\ and\ SRB0\ retransmission.}}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}}\ ==\ dci\_dl\_rnti\_config\_type::tc\_rnti\_f1\_0\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ get\_res\_alloc(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index)[0].result.dl.csi\_rs.empty())\ \{}
\DoxyCodeLine{00129\ \ \ \ \ logger.info(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PDSCH.\ Cause:\ Multiplexing\ of\ CSI-\/RS\ and\ TC-\/RNTI\ retransmission\ is\ not\ allowed."{}});}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_ue;}
\DoxyCodeLine{00131\ \ \ \}}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ pdsch\_time\_domain\_resource\_allocation>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_list}}\ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>pdsch\_time\_domain\_list;}
\DoxyCodeLine{00134\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1pdsch__time__domain__resource__allocation}{pdsch\_time\_domain\_resource\_allocation}}\&\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_td\_cfg}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_list}}[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index];}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \textcolor{comment}{//\ Fetch\ PDCCH\ and\ PDSCH\ resource\ grid\ allocators.}}
\DoxyCodeLine{00137\ \ \ \mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\_slot\_resource\_allocator}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}}\ =\ get\_res\_alloc(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index)[0];}
\DoxyCodeLine{00138\ \ \ \mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\_slot\_resource\_allocator}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}\ =\ get\_res\_alloc(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index)[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_td\_cfg}}.k0];}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.result.dl.bc.sibs.size()\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.result.dl.paging\_grants.size()\ +}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.result.dl.rar\_grants.size()\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.result.dl.ue\_grants.size()\ >=}
\DoxyCodeLine{00142\ \ \ \ \ \ \ expert\_cfg.\mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config_a489ee2f731f31aa0d2f710253bd62541}{max\_pdschs\_per\_slot}})\ \{}
\DoxyCodeLine{00143\ \ \ \ \ logger.info(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PDSCH.\ Cause:\ Max\ number\ of\ PDSCHs\ per\ slot\ \{\}\ was\ reached."{}},}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ expert\_cfg.\mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config_a489ee2f731f31aa0d2f710253bd62541}{max\_pdschs\_per\_slot}});}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_slot;}
\DoxyCodeLine{00146\ \ \ \}}
\DoxyCodeLine{00147\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ cell\_cfg.is\_dl\_enabled(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}}.slot))\ \{}
\DoxyCodeLine{00148\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PDSCH\ in\ slot=\{\}.\ Cause:\ DL\ is\ not\ active\ in\ the\ PDCCH\ slot"{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.slot);}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_slot;}
\DoxyCodeLine{00150\ \ \ \}}
\DoxyCodeLine{00151\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ cell\_cfg.is\_dl\_enabled(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.slot))\ \{}
\DoxyCodeLine{00152\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PDSCH\ in\ slot=\{\}.\ Cause:\ DL\ is\ not\ active\ in\ the\ PDSCH\ slot"{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.slot);}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00154\ \ \ \}}
\DoxyCodeLine{00155\ \ \ \textcolor{comment}{//\ Check\ whether\ PDSCH\ time\ domain\ resource\ does\ not\ overlap\ with\ CORESET.}}
\DoxyCodeLine{00156\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_td\_cfg}}.symbols.start()\ <\ ss\_cfg.\mbox{\hyperlink{structsrsran_1_1search__space__configuration_ab5df7a88e860e0181fb1c5bd24dd0831}{get\_first\_symbol\_index}}()\ +\ cs\_cfg.\mbox{\hyperlink{structsrsran_1_1coreset__configuration_ac70faa1088f184a624da17749bc1c863}{duration}})\ \{}
\DoxyCodeLine{00157\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PDSCH\ in\ slot=\{\}.\ Cause:\ PDSCH\ time\ domain\ resource\ =\{\}\ is\ starting\ before\ the\ "{}}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}CORESET\ symbols"{}},}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.slot,}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index);}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00162\ \ \ \}}
\DoxyCodeLine{00163\ \ \ \textcolor{comment}{//\ Check\ whether\ PDSCH\ time\ domain\ resource\ fits\ in\ DL\ symbols\ of\ the\ slot.}}
\DoxyCodeLine{00164\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_td\_cfg}}.symbols.stop()\ >\ cell\_cfg.get\_nof\_dl\_symbol\_per\_slot(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.slot))\ \{}
\DoxyCodeLine{00165\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PDSCH\ in\ slot=\{\}.\ Cause:\ Nof.\ DL\ symbols\ in\ PDSCH\ slot\ shorter\ than\ PDSCH\ time\ "{}}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}domain\ resource\ =\{\}"{}},}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.slot,}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index);}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00170\ \ \ \}}
\DoxyCodeLine{00171\ \ \ \textcolor{comment}{//\ Verify\ there\ is\ space\ in\ PDSCH\ and\ PDCCH\ result\ lists\ for\ new\ allocations.}}
\DoxyCodeLine{00172\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.result.dl.ue\_grants.full()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{or}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}}.result.dl.dl\_pdcchs.full())\ \{}
\DoxyCodeLine{00173\ \ \ \ \ logger.info(\textcolor{stringliteral}{"{}ue=\{\}\ rnti=\{\}:\ Failed\ to\ allocate\ PDSCH.\ Cause:\ No\ space\ available\ in\ scheduler\ output\ list"{}},}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.ue\_index,}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti);}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_slot;}
\DoxyCodeLine{00177\ \ \ \}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \textcolor{comment}{//\ Verify\ CRBs\ fit\ in\ the\ chosen\ BWP.}}
\DoxyCodeLine{00180\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>dl\_crb\_lims.contains(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs))\ \{}
\DoxyCodeLine{00181\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}ue=\{\}\ rnti=\{\}:\ Failed\ to\ allocate\ PDSCH.\ Cause:\ CRBs=\{\}\ are\ outside\ the\ valid\ limits=\{\}."{}},}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.ue\_index,}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>dl\_crb\_lims);}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00187\ \ \ \}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \textcolor{comment}{//\ In\ case\ of\ retx,\ ensure\ the\ number\ of\ PRBs\ for\ the\ grant\ did\ not\ change.}}
\DoxyCodeLine{00190\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.empty()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs.length()\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.last\_alloc\_params().rbs.type1().length())\ \{}
\DoxyCodeLine{00191\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}ue=\{\}\ rnti=\{\}:\ Failed\ to\ allocate\ PDSCH.\ Cause:\ Number\ of\ CRBs\ has\ to\ remain\ constant\ during\ "{}}}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}retxs\ (Harq-\/id=\{\},\ nof\_prbs\ expected=\{\}\ !=\ actual=\{\})"{}},}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.ue\_index,}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.id,}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.last\_alloc\_params().rbs.type1().length(),}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs.length());}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00199\ \ \ \}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \textcolor{comment}{//\ Verify\ there\ is\ no\ RB\ collision.}}
\DoxyCodeLine{00202\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.dl\_res\_grid.collides(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bwp\_dl\_cmn}}.generic\_params.scs,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_td\_cfg}}.symbols,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs))\ \{}
\DoxyCodeLine{00203\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}ue=\{\}\ rnti=\{\}:\ Failed\ to\ allocate\ PDSCH.\ Cause:\ No\ space\ available\ in\ scheduler\ RB\ resource\ grid."{}},}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.ue\_index,}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti);}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00207\ \ \ \}}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \ \ \textcolor{comment}{//\ Allocate\ PDCCH\ position.}}
\DoxyCodeLine{00210\ \ \ \mbox{\hyperlink{structsrsran_1_1pdcch__dl__information}{pdcch\_dl\_information}}*\ pdcch\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00211\ \ \ \textcolor{keywordflow}{if}\ (ue\_cc-\/>is\_in\_fallback\_mode()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{or}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}}\ ==\ dci\_dl\_rnti\_config\_type::tc\_rnti\_f1\_0)\ \{}
\DoxyCodeLine{00212\ \ \ \ \ pdcch\ =}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ get\_pdcch\_sched(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index).\mbox{\hyperlink{classsrsran_1_1pdcch__resource__allocator_abcd74ac9c8620420686fcafa617a19a8}{alloc\_dl\_pdcch\_common}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}},\ u.crnti,\ ss\_cfg.\mbox{\hyperlink{structsrsran_1_1search__space__configuration_af62d83a85585b358f7626a3ccfe1005d}{get\_id}}(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.aggr\_lvl);}
\DoxyCodeLine{00214\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00215\ \ \ \ \ pdcch\ =\ get\_pdcch\_sched(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index)}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .\mbox{\hyperlink{classsrsran_1_1pdcch__resource__allocator_a78bb0ae89aa1fa10c939d72da8ccb1de}{alloc\_dl\_pdcch\_ue}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}},\ u.crnti,\ ue\_cell\_cfg,\ ss\_cfg.\mbox{\hyperlink{structsrsran_1_1search__space__configuration_af62d83a85585b358f7626a3ccfe1005d}{get\_id}}(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.aggr\_lvl);}
\DoxyCodeLine{00217\ \ \ \}}
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{if}\ (pdcch\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00219\ \ \ \ \ logger.info(\textcolor{stringliteral}{"{}ue=\{\}\ rnti=\{\}:\ Failed\ to\ allocate\ PDSCH.\ Cause:\ No\ space\ in\ PDCCH."{}},\ u.ue\_index,\ u.crnti);}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{comment}{//\ TODO:\ For\ now,\ given\ that\ only\ one\ searchSpace\ is\ used,\ we\ skip\ the\ UE.\ In\ the\ future,\ we\ might\ still\ try}}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{comment}{//\ different\ searchSpaces.}}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_ue;}
\DoxyCodeLine{00223\ \ \ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \textcolor{comment}{//\ Allocate\ UCI.\ UCI\ destination\ (i.e.,\ PUCCH\ or\ PUSCH)\ depends\ on\ whether\ there\ exist\ a\ PUSCH\ grant\ for\ the\ UE.}}
\DoxyCodeLine{00226\ \ \ \textcolor{keywordtype}{unsigned}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ k1\ \ \ \ \ \ =\ 0;}
\DoxyCodeLine{00227\ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ uint8\_t>}}\ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{k1\_list}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>get\_k1\_candidates();}
\DoxyCodeLine{00228\ \ \ \mbox{\hyperlink{classsrsran_1_1optional}{optional<uci\_allocation>}}\ uci\ \ \ \ \ =\ get\_uci\_alloc(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index)}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .\mbox{\hyperlink{classsrsran_1_1uci__allocator_a674277651ca609ca8e827986589305a3}{alloc\_uci\_harq\_ue}}(get\_res\_alloc(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index),}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.\mbox{\hyperlink{classsrsran_1_1ue_a731245d82c06b3498ca7808f6f308687}{get\_pcell}}().cfg(),}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_td\_cfg}}.k0,}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{k1\_list}},}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cc-\/>is\_in\_fallback\_mode()\ ?\ pdcch\ :\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nullptr}});}
\DoxyCodeLine{00235\ \ \ \textcolor{keywordflow}{if}\ (uci.\mbox{\hyperlink{classsrsran_1_1optional_a2f160539a76c3f4dd0b50b339b81202e}{has\_value}}())\ \{}
\DoxyCodeLine{00236\ \ \ \ \ k1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ uci.value().k1;}
\DoxyCodeLine{00237\ \ \ \ \ pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__dl__information_a9a8b5db2a28afcd115c3adc4c5d0212d}{ctx}}.context.\mbox{\hyperlink{structsrsran_1_1dci__context__information_1_1decision__context_a6c2c48e3d8dc6fab8da7bb0e3945166f}{harq\_feedback\_timing}}\ =\ k1;}
\DoxyCodeLine{00238\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00239\ \ \ \ \ logger.info(\textcolor{stringliteral}{"{}ue=\{\}\ rnti=\{\}:\ Failed\ to\ allocate\ PDSCH.\ Cause:\ No\ space\ in\ PUCCH."{}},\ u.ue\_index,\ u.crnti);}
\DoxyCodeLine{00240\ \ \ \ \ get\_pdcch\_sched(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index).\mbox{\hyperlink{classsrsran_1_1pdcch__resource__allocator_a2c7d3c611349eaa40e7e39a5fde0c9be}{cancel\_last\_pdcch}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}});}
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{comment}{//\ TODO:\ For\ now,\ given\ that\ only\ one\ searchSpace\ is\ used,\ we\ skip\ the\ UE.\ In\ the\ future,\ we\ might\ still\ try}}
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{comment}{//\ different\ searchSpaces.}}
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_ue;}
\DoxyCodeLine{00244\ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \mbox{\hyperlink{structsrsran_1_1pdsch__config__params}{pdsch\_config\_params}}\ pdsch\_cfg;}
\DoxyCodeLine{00247\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}})\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_dl\_rnti\_config\_type::tc\_rnti\_f1\_0:}
\DoxyCodeLine{00249\ \ \ \ \ \ \ pdsch\_cfg\ =\ \mbox{\hyperlink{namespacesrsran_afdd0020f677962611dc4750ff59adaf8}{get\_pdsch\_config\_f1\_0\_tc\_rnti}}(cell\_cfg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_list}}[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index]);}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_dl\_rnti\_config\_type::c\_rnti\_f1\_0:}
\DoxyCodeLine{00252\ \ \ \ \ \ \ pdsch\_cfg\ =\ \mbox{\hyperlink{namespacesrsran_ade749ce1cb6bc8a5dcbadb05bdb9453e}{get\_pdsch\_config\_f1\_0\_c\_rnti}}(ue\_cell\_cfg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_list}}[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index]);}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_dl\_rnti\_config\_type::c\_rnti\_f1\_1:}
\DoxyCodeLine{00255\ \ \ \ \ \ \ pdsch\_cfg\ =\ \mbox{\hyperlink{namespacesrsran_ad1f3c8f521e705599a853caca9257e16}{get\_pdsch\_config\_f1\_1\_c\_rnti}}(ue\_cell\_cfg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_list}}[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index],\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.nof\_layers);}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a630688b51219f81c5a47ec5650326afc}{report\_fatal\_error}}(\textcolor{stringliteral}{"{}Unsupported\ PDCCH\ DCI\ UL\ format"{}});}
\DoxyCodeLine{00259\ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \textcolor{comment}{//\ Reduce\ estimated\ MCS\ by\ 1\ whenever\ CSI-\/RS\ is\ sent\ over\ a\ particular\ slot\ to\ account\ for\ the\ overhead\ of\ CSI-\/RS\ REs.}}
\DoxyCodeLine{00262\ \ \ \mbox{\hyperlink{classsrsran_1_1bounded__integer}{sch\_mcs\_index}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{adjusted\_mcs}}\{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.mcs\};}
\DoxyCodeLine{00263\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.result.dl.csi\_rs.empty())\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{comment}{//\ [Implementation-\/defined]\ The\ max\ MCS\ values\ below\ are\ set\ empirically\ and\ should\ avoid\ the\ effective\ code\ rate\ to}}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{comment}{//\ exceed\ 0.95\ due\ to\ the\ overhead\ of\ CSI-\/RS\ REs.}}
\DoxyCodeLine{00266\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{adjusted\_mcs}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{adjusted\_mcs}}\ ==\ 0\ ?\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{adjusted\_mcs}}\ :\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{adjusted\_mcs}}\ -\/\ 1;}
\DoxyCodeLine{00267\ \ \ \ \ \mbox{\hyperlink{classuint8__t}{uint8\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_mcs\_with\_csi\_rs}}\ =\ 28;}
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{keywordflow}{if}\ (pdsch\_cfg.mcs\_table\ ==\ \mbox{\hyperlink{namespacesrsran_a7360cbf57f4cd82cfda032d47fa58e81afe97d5927e34d78b68330ae92f2773cb}{pdsch\_mcs\_table::qam64}})\ \{}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_mcs\_with\_csi\_rs}}\ =\ 26U;}
\DoxyCodeLine{00270\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (pdsch\_cfg.mcs\_table\ ==\ \mbox{\hyperlink{namespacesrsran_a7360cbf57f4cd82cfda032d47fa58e81ad6020165a82bfc26499c2cd4dd812255}{pdsch\_mcs\_table::qam256}})\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_mcs\_with\_csi\_rs}}\ =\ 24U;}
\DoxyCodeLine{00272\ \ \ \ \ \}}
\DoxyCodeLine{00273\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{adjusted\_mcs}}\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classsrsran_1_1bounded__integer}{sch\_mcs\_index}}\textcolor{keyword}{>}(std::min(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{adjusted\_mcs}}.to\_uint(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_mcs\_with\_csi\_rs}}));}
\DoxyCodeLine{00274\ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \mbox{\hyperlink{classsrsran_1_1optional}{optional<sch\_mcs\_tbs>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}};}
\DoxyCodeLine{00277\ \ \ \textcolor{comment}{//\ If\ it's\ a\ new\ Tx,\ compute\ the\ MCS\ and\ TBS.}}
\DoxyCodeLine{00278\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.empty())\ \{}
\DoxyCodeLine{00279\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}\ =\ \mbox{\hyperlink{namespacesrsran_a564f9dc3d69e5afaec20c66366331b40}{compute\_dl\_mcs\_tbs}}(pdsch\_cfg,\ ue\_cell\_cfg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{adjusted\_mcs}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs.length());}
\DoxyCodeLine{00280\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{comment}{//\ It\ is\ a\ retx.}}
\DoxyCodeLine{00282\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.emplace(}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1sch__mcs__tbs}{sch\_mcs\_tbs}}\{.\mbox{\hyperlink{structsrsran_1_1sch__mcs__tbs_a0e39436a73718f7c879b0df8cbdb6810}{mcs}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.last\_alloc\_params().tb[0]-\/>mcs,\ .tbs\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.last\_alloc\_params().tb[0]-\/>tbs\_bytes\});}
\DoxyCodeLine{00284\ \ \ \}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \textcolor{comment}{//\ If\ there\ is\ not\ MCS-\/TBS\ info,\ it\ means\ no\ MCS\ exists\ such\ that\ the\ effective\ code\ rate\ is\ <=\ 0.95.}}
\DoxyCodeLine{00287\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.has\_value())\ \{}
\DoxyCodeLine{00288\ \ \ \ \ logger.warning(}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}ue=\{\}\ rnti=\{\}:\ Failed\ to\ allocate\ PDSCH.\ Cause:\ no\ MCS\ such\ that\ code\ rate\ <=\ 0.95."{}},\ u.ue\_index,\ u.crnti);}
\DoxyCodeLine{00290\ \ \ \ \ get\_pdcch\_sched(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index).\mbox{\hyperlink{classsrsran_1_1pdcch__resource__allocator_a2c7d3c611349eaa40e7e39a5fde0c9be}{cancel\_last\_pdcch}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}});}
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00292\ \ \ \}}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \textcolor{comment}{//\ In\ case\ of\ retx,\ ensure\ the\ TBS\ does\ not\ change.}}
\DoxyCodeLine{00295\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.empty()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}-\/>tbs\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.last\_alloc\_params().tb[0]-\/>tbs\_bytes)\ \{}
\DoxyCodeLine{00296\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}ue=\{\}\ rnti=\{\}:\ Failed\ to\ allocate\ PDSCH.\ Cause:\ TBS\ has\ to\ remain\ constant\ during\ retxs\ "{}}}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}(Harq-\/id=\{\},\ tbs\ expected=\{\}\ !=\ actual=\{\})"{}},}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.ue\_index,}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.id,}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.last\_alloc\_params().tb[0]-\/>tbs\_bytes,}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}-\/>tbs);}
\DoxyCodeLine{00303\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00304\ \ \ \}}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \textcolor{comment}{//\ Mark\ resources\ as\ occupied\ in\ the\ ResourceGrid.}}
\DoxyCodeLine{00307\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.dl\_res\_grid.fill(\mbox{\hyperlink{structsrsran_1_1grant__info}{grant\_info}}\{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bwp\_dl\_cmn}}.generic\_params.scs,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_td\_cfg}}.symbols,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs\});}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \textcolor{comment}{//\ Allocate\ UE\ DL\ HARQ.}}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.empty())\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{comment}{//\ It\ is\ a\ new\ tx.}}
\DoxyCodeLine{00312\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.new\_tx(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.slot,}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ k1,}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ expert\_cfg.max\_nof\_harq\_retxs,}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uci.value().harq\_bit\_idx,}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cc-\/>\mbox{\hyperlink{classsrsran_1_1ue__cell_a9ec269dbea62873f276ab52989a5df1d}{channel\_state\_manager}}().get\_wideband\_cqi(),}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.nof\_layers);}
\DoxyCodeLine{00318\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00319\ \ \ \ \ \textcolor{comment}{//\ It\ is\ a\ retx.}}
\DoxyCodeLine{00320\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.new\_retx(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.slot,\ k1,\ uci.value().harq\_bit\_idx);}
\DoxyCodeLine{00321\ \ \ \}}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \ \ \textcolor{comment}{//\ Fill\ DL\ PDCCH\ DCI\ PDU.}}
\DoxyCodeLine{00324\ \ \ \textcolor{comment}{//\ Number\ of\ possible\ Downlink\ Assignment\ Indexes\ \{0,\ ...,\ 3\}\ as\ per\ TS38.213\ Section\ 9.1.3.}}
\DoxyCodeLine{00325\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{DAI\_MOD}}\ =\ 4U;}
\DoxyCodeLine{00326\ \ \ \mbox{\hyperlink{classuint8__t}{uint8\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rv\ \ \ \ \ \ =\ ue\_cc-\/>get\_pdsch\_rv(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}});}
\DoxyCodeLine{00327\ \ \ \textcolor{comment}{//\ For\ allocation\ on\ PUSCH,\ we\ use\ a\ PUCCH\ resource\ indicator\ set\ to\ 0,\ as\ it\ will\ get\ ignored\ by\ the\ UE.}}
\DoxyCodeLine{00328\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ pucch\_res\_indicator\ =}
\DoxyCodeLine{00329\ \ \ \ \ \ \ uci.value().pucch\_res\_indicator.has\_value()\ ?\ uci.value().pucch\_res\_indicator.value()\ :\ 0U;}
\DoxyCodeLine{00330\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}})\ \{}
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_dl\_rnti\_config\_type::tc\_rnti\_f1\_0:}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_af1d1b499db60acdab5d6433159f3992a}{build\_dci\_f1\_0\_tc\_rnti}}(pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__dl__information_a7d58e4814244671ba0903fe9c58fa337}{dci}},}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ init\_dl\_bwp,}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index,}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ k1,}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pucch\_res\_indicator,}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value().mcs,}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rv,}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}});}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00342\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_dl\_rnti\_config\_type::c\_rnti\_f1\_0:}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a70794355f71104c5cc1e5e91ed8b968e}{build\_dci\_f1\_0\_c\_rnti}}(pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__dl__information_a7d58e4814244671ba0903fe9c58fa337}{dci}},}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cell\_cfg,}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id,}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index,}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ k1,}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pucch\_res\_indicator,}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uci.value().harq\_bit\_idx\ \%\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{DAI\_MOD}},}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value().mcs,}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rv,}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}});}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00355\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_dl\_rnti\_config\_type::c\_rnti\_f1\_1:}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a08aa5fe6b74e470b76e7417d4d5e1d1e}{build\_dci\_f1\_1\_c\_rnti}}(pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__dl__information_a7d58e4814244671ba0903fe9c58fa337}{dci}},}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cell\_cfg,}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id,}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a2de764a7c1baa17f5288a9fef373aca4}{crb\_to\_prb}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>dl\_crb\_lims,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs),}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index,}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ k1,}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pucch\_res\_indicator,}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uci.value().harq\_bit\_idx\ \%\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{DAI\_MOD}},}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value().mcs,}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rv,}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}},}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.nof\_layers);}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a630688b51219f81c5a47ec5650326afc}{report\_fatal\_error}}(\textcolor{stringliteral}{"{}Unsupported\ RNTI\ type\ for\ PDSCH\ allocation"{}});}
\DoxyCodeLine{00371\ \ \ \}}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \textcolor{comment}{//\ Fill\ PDSCH\ PDU.}}
\DoxyCodeLine{00374\ \ \ \mbox{\hyperlink{structsrsran_1_1dl__msg__alloc}{dl\_msg\_alloc}}\&\ msg\ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdsch\_alloc}}.result.dl.ue\_grants.emplace\_back();}
\DoxyCodeLine{00375\ \ \ msg.context.\mbox{\hyperlink{structsrsran_1_1dl__msg__alloc_1_1decision__context_a5a87ff9870306599830438972d164a5d}{ue\_index}}\ \ =\ u.ue\_index;}
\DoxyCodeLine{00376\ \ \ msg.context.\mbox{\hyperlink{structsrsran_1_1dl__msg__alloc_1_1decision__context_a24fc0edcea4d8aa5e41b32289a25f7c3}{k1}}\ \ \ \ \ \ \ \ =\ k1;}
\DoxyCodeLine{00377\ \ \ msg.context.\mbox{\hyperlink{structsrsran_1_1dl__msg__alloc_1_1decision__context_acd34d6a236d696dac52ab0fbd08f8f22}{ss\_id}}\ \ \ \ \ =\ ss\_cfg.\mbox{\hyperlink{structsrsran_1_1search__space__configuration_af62d83a85585b358f7626a3ccfe1005d}{get\_id}}();}
\DoxyCodeLine{00378\ \ \ msg.context.\mbox{\hyperlink{structsrsran_1_1dl__msg__alloc_1_1decision__context_a2dc690ee43db0d22302da6ec57964c6d}{nof\_retxs}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.tb(0).nof\_retxs;}
\DoxyCodeLine{00379\ \ \ \textcolor{keywordflow}{if}\ (msg.context.\mbox{\hyperlink{structsrsran_1_1dl__msg__alloc_1_1decision__context_a2dc690ee43db0d22302da6ec57964c6d}{nof\_retxs}}\ ==\ 0\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ ue\_cc-\/>link\_adaptation\_controller().\mbox{\hyperlink{classsrsran_1_1ue__link__adaptation__controller_a878dc8c69b88ace04843eedf866a691e}{is\_dl\_olla\_enabled}}())\ \{}
\DoxyCodeLine{00380\ \ \ \ \ msg.context.\mbox{\hyperlink{structsrsran_1_1dl__msg__alloc_1_1decision__context_a2114ff853966185998cc2dfc5295d92b}{olla\_offset}}\ =\ ue\_cc-\/>link\_adaptation\_controller().\mbox{\hyperlink{classsrsran_1_1ue__link__adaptation__controller_ae9a0a43b2798fe6bc0af75ec69f40422}{dl\_cqi\_offset}}();}
\DoxyCodeLine{00381\ \ \ \}}
\DoxyCodeLine{00382\ \ \ \textcolor{keywordflow}{switch}\ (pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__dl__information_a7d58e4814244671ba0903fe9c58fa337}{dci}}.type)\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_dl\_rnti\_config\_type::tc\_rnti\_f1\_0:}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a7f508cb4c31e0e1fe5c716f7302e4c72}{build\_pdsch\_f1\_0\_tc\_rnti}}(msg.pdsch\_cfg,}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdsch\_cfg,}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value().tbs,}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cell\_cfg,}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__dl__information_a7d58e4814244671ba0903fe9c58fa337}{dci}}.tc\_rnti\_f1\_0,}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.tb(0).nof\_retxs\ ==\ 0);}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00393\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_dl\_rnti\_config\_type::c\_rnti\_f1\_0:}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_af25dbfb9ea9d3abf2f4a0c62f0035da8}{build\_pdsch\_f1\_0\_c\_rnti}}(msg.pdsch\_cfg,}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdsch\_cfg,}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value().tbs,}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cell\_cfg,}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id,}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__dl__information_a7d58e4814244671ba0903fe9c58fa337}{dci}}.c\_rnti\_f1\_0,}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.tb(0).nof\_retxs\ ==\ 0);}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_dl\_rnti\_config\_type::c\_rnti\_f1\_1:}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a7d67c23151a68f37ce240b7ab88aa542}{build\_pdsch\_f1\_1\_c\_rnti}}(msg.pdsch\_cfg,}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdsch\_cfg,}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value(),}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cell\_cfg,}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id,}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__dl__information_a7d58e4814244671ba0903fe9c58fa337}{dci}}.c\_rnti\_f1\_1,}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}},}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cc-\/>\mbox{\hyperlink{classsrsran_1_1ue__cell_a9ec269dbea62873f276ab52989a5df1d}{channel\_state\_manager}}());}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a630688b51219f81c5a47ec5650326afc}{report\_fatal\_error}}(\textcolor{stringliteral}{"{}Unsupported\ PDCCH\ DL\ DCI\ format"{}});}
\DoxyCodeLine{00418\ \ \ \}}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00420\ \ \ \textcolor{comment}{//\ Save\ set\ PDCCH\ and\ PDSCH\ PDU\ parameters\ in\ HARQ\ process.}}
\DoxyCodeLine{00421\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.save\_alloc\_params(pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__dl__information_a7d58e4814244671ba0903fe9c58fa337}{dci}}.type,\ msg.pdsch\_cfg);}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_dl}}.tb(0).nof\_retxs\ ==\ 0)\ \{}
\DoxyCodeLine{00424\ \ \ \ \ \textcolor{comment}{//\ Set\ MAC\ logical\ channels\ to\ schedule\ in\ this\ PDU\ if\ it\ is\ a\ newtx.}}
\DoxyCodeLine{00425\ \ \ \ \ u.\mbox{\hyperlink{classsrsran_1_1ue_a66338f2e37d78c01ea60b844d27fd806}{build\_dl\_transport\_block\_info}}(msg.tb\_list.emplace\_back(),\ msg.pdsch\_cfg.codewords[0].tb\_size\_bytes);}
\DoxyCodeLine{00426\ \ \ \}}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::success;}
\DoxyCodeLine{00429\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ue__cell__grid__allocator_acc2a16bc1d10fb89a00d487e6d95b805}\label{classsrsran_1_1ue__cell__grid__allocator_acc2a16bc1d10fb89a00d487e6d95b805} 
\index{srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}!allocate\_ul\_grant@{allocate\_ul\_grant}}
\index{allocate\_ul\_grant@{allocate\_ul\_grant}!srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}}
\doxysubsubsection{\texorpdfstring{allocate\_ul\_grant()}{allocate\_ul\_grant()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_adad52e6cbb57b4801efa5bf5b1c11b14}{alloc\+\_\+outcome}} ue\+\_\+cell\+\_\+grid\+\_\+allocator\+::allocate\+\_\+ul\+\_\+grant (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1ue__pusch__grant}{ue\+\_\+pusch\+\_\+grant}} \&}]{grant }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{classsrsran_1_1ue__pusch__allocator}{srsran\+::ue\+\_\+pusch\+\_\+allocator}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00432\ \{}
\DoxyCodeLine{00433\ \ \ srsran\_assert(ues.\mbox{\hyperlink{classsrsran_1_1ue__repository_a8d4b4805828ab1b0375fa323b73c3d6c}{contains}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.user-\/>ue\_index),\ \textcolor{stringliteral}{"{}Invalid\ UE\ candidate\ index=\{\}"{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.user-\/>ue\_index);}
\DoxyCodeLine{00434\ \ \ srsran\_assert(has\_cell(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index),\ \textcolor{stringliteral}{"{}Invalid\ UE\ candidate\ cell\_index=\{\}"{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index);}
\DoxyCodeLine{00435\ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_delay\_in\_slots}}\ =\ 0;}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ \textcolor{keywordflow}{if}\ (ul\_attempts\_count++\ >=\ expert\_cfg.\mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config_a5c3949d57f4a7de1391f092b4288c352}{max\_pdcch\_alloc\_attempts\_per\_slot}})\ \{}
\DoxyCodeLine{00438\ \ \ \ \ logger.debug(\textcolor{stringliteral}{"{}Stopping\ UL\ allocations.\ Cause:\ Max\ number\ of\ UL\ PDCCH\ allocation\ attempts\ \{\}\ reached."{}},}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ expert\_cfg.\mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config_a5c3949d57f4a7de1391f092b4288c352}{max\_pdcch\_alloc\_attempts\_per\_slot}});}
\DoxyCodeLine{00440\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_slot;}
\DoxyCodeLine{00441\ \ \ \}}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \mbox{\hyperlink{classsrsran_1_1ue}{ue}}\&\ u\ =\ ues[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.user-\/>ue\_index];}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \textcolor{comment}{//\ Verify\ UE\ carrier\ is\ active.}}
\DoxyCodeLine{00446\ \ \ \mbox{\hyperlink{classsrsran_1_1ue__cell}{ue\_cell}}*\ ue\_cc\ =\ u.find\_cell(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index);}
\DoxyCodeLine{00447\ \ \ \textcolor{keywordflow}{if}\ (ue\_cc\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00448\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}PUSCH\ allocation\ failed.\ Cause:\ The\ ue=\{\}\ carrier\ with\ cell\_index=\{\}\ is\ inactive"{}},}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.ue\_index,}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index);}
\DoxyCodeLine{00451\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_ue;}
\DoxyCodeLine{00452\ \ \ \}}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1ue__cell__configuration}{ue\_cell\_configuration}}\&\ ue\_cell\_cfg\ =\ ue\_cc-\/>cfg();}
\DoxyCodeLine{00455\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1cell__configuration}{cell\_configuration}}\&\ \ \ \ cell\_cfg\ \ \ \ =\ ue\_cell\_cfg.cell\_cfg\_common;}
\DoxyCodeLine{00456\ \ \ \mbox{\hyperlink{classsrsran_1_1ul__harq__process}{ul\_harq\_process}}\&\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}\ \ \ \ \ \ \ \ =\ ue\_cc-\/>harqs.ul\_harq(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.h\_id);}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ ue\_cc-\/>\mbox{\hyperlink{classsrsran_1_1ue__cell_a5547f22a9e862e932a494f187f17b61a}{is\_active}}()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.empty())\ \{}
\DoxyCodeLine{00459\ \ \ \ \ \textcolor{comment}{//\ newTxs\ are\ not\ allowed\ for\ inactive\ UEs.}}
\DoxyCodeLine{00460\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}PUSCH\ allocation\ failed.\ Cause:\ The\ ue=\{\}\ carrier\ with\ cell\_index=\{\}\ is\ inactive"{}},}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.ue\_index,}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index);}
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_ue;}
\DoxyCodeLine{00464\ \ \ \}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \ \ \textcolor{comment}{//\ Find\ a\ SearchSpace\ candidate.}}
\DoxyCodeLine{00467\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1search__space__info}{search\_space\_info}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}\ =\ ue\_cell\_cfg.\mbox{\hyperlink{classsrsran_1_1ue__cell__configuration_ac98203b0c951eb022845bd8b85bb6613}{find\_search\_space}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id);}
\DoxyCodeLine{00468\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00469\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PUSCH.\ Cause:\ No\ valid\ SearchSpace\ found."{}});}
\DoxyCodeLine{00470\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00471\ \ \ \}}
\DoxyCodeLine{00472\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>bwp-\/>bwp\_id\ !=\ ue\_cc-\/>active\_bwp\_id())\ \{}
\DoxyCodeLine{00473\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PUSCH.\ Cause:\ Chosen\ SearchSpace\ \{\}\ does\ not\ belong\ to\ the\ active\ BWP\ \{\}"{}},}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id,}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cc-\/>active\_bwp\_id());}
\DoxyCodeLine{00476\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00477\ \ \ \}}
\DoxyCodeLine{00478\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1search__space__configuration}{search\_space\_configuration}}\&\ \ \ \ \ \ \ \ \ \ \ \ ss\_cfg\ \ \ \ \ \ \ =\ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>cfg;}
\DoxyCodeLine{00479\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1bwp__uplink__common}{bwp\_uplink\_common}}\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bwp\_ul\_cmn}}\ \ \ =\ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>bwp-\/>ul\_common;}
\DoxyCodeLine{00480\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesrsran_aca64228c7486db8ce1f0a3118e8cedc8}{subcarrier\_spacing}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ scs\ \ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bwp\_ul\_cmn}}.generic\_params.scs;}
\DoxyCodeLine{00481\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1pusch__time__domain__resource__allocation}{pusch\_time\_domain\_resource\_allocation}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_cfg}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>pusch\_time\_domain\_list[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index];}
\DoxyCodeLine{00482\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesrsran_a635cecd3b3b6716ab9f4b6043d603f9f}{dci\_ul\_rnti\_config\_type}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_supported\_crnti\_dci\_type}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>get\_ul\_dci\_format()\ ==\ dci\_ul\_format::f0\_0}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ dci\_ul\_rnti\_config\_type::c\_rnti\_f0\_0}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ dci\_ul\_rnti\_config\_type::c\_rnti\_f0\_1;}
\DoxyCodeLine{00485\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesrsran_a635cecd3b3b6716ab9f4b6043d603f9f}{dci\_ul\_rnti\_config\_type}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}}\ =}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.empty()\ ?\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_supported\_crnti\_dci\_type}}\ :\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.last\_tx\_params().dci\_cfg\_type;}
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00488\ \ \ \textcolor{comment}{//\ See\ 3GPP\ TS\ 38.213,\ clause\ 10.1,}}
\DoxyCodeLine{00489\ \ \ \textcolor{comment}{//\ A\ UE\ monitors\ PDCCH\ candidates\ in\ one\ or\ more\ of\ the\ following\ search\ spaces\ sets}}
\DoxyCodeLine{00490\ \ \ \textcolor{comment}{//\ \ -\/\ a\ Type1-\/PDCCH\ CSS\ set\ configured\ by\ ra-\/SearchSpace\ in\ PDCCH-\/ConfigCommon\ for\ a\ DCI\ format\ with}}
\DoxyCodeLine{00491\ \ \ \textcolor{comment}{//\ \ \ \ CRC\ scrambled\ by\ a\ RA-\/RNTI,\ a\ MsgB-\/RNTI,\ or\ a\ TC-\/RNTI\ on\ the\ primary\ cell.}}
\DoxyCodeLine{00492\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}}\ ==\ dci\_ul\_rnti\_config\_type::tc\_rnti\_f0\_0\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id\ !=\ cell\_cfg.dl\_cfg\_common.init\_dl\_bwp.pdcch\_common.\mbox{\hyperlink{structsrsran_1_1pdcch__config__common_abb3e2d05a704bec469946b206ad200f7}{ra\_search\_space\_id}})\ \{}
\DoxyCodeLine{00494\ \ \ \ \ logger.info(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PUSCH.\ Cause:\ SearchSpace\ not\ valid\ for\ re-\/transmission."{}});}
\DoxyCodeLine{00495\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00496\ \ \ \}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \ \ \textcolor{comment}{//\ In\ case\ of\ re-\/transmission\ DCI\ format\ must\ remain\ same\ and\ therefore\ its\ necessary\ to\ find\ the\ SS\ which\ support}}
\DoxyCodeLine{00499\ \ \ \textcolor{comment}{//\ that\ DCI\ format.}}
\DoxyCodeLine{00500\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}}\ !=\ dci\_ul\_rnti\_config\_type::tc\_rnti\_f0\_0\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_supported\_crnti\_dci\_type}})\ \{}
\DoxyCodeLine{00501\ \ \ \ \ logger.info(}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}rnti=\{\}\ Failed\ to\ allocate\ PUSCH.\ Cause:\ DCI\ format\ \{\}\ in\ HARQ\ retx\ is\ not\ supported\ in\ SearchSpace\ \{\}."{}},}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ dci\_ul\_rnti\_config\_format(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.last\_tx\_params().dci\_cfg\_type),}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id);}
\DoxyCodeLine{00506\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00507\ \ \ \}}
\DoxyCodeLine{00508\ }
\DoxyCodeLine{00509\ \ \ \textcolor{comment}{//\ Fetch\ PDCCH\ and\ PDSCH\ resource\ grid\ allocators.}}
\DoxyCodeLine{00510\ \ \ \mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\_slot\_resource\_allocator}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}}\ =\ get\_res\_alloc(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index)[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_delay\_in\_slots}}];}
\DoxyCodeLine{00511\ \ \ \mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\_slot\_resource\_allocator}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}\ =}
\DoxyCodeLine{00512\ \ \ \ \ \ \ get\_res\_alloc(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index)[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_delay\_in\_slots}}\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_cfg}}.k2\ +\ cell\_cfg.ntn\_cs\_koffset];}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ cell\_cfg.is\_dl\_enabled(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}}.slot))\ \{}
\DoxyCodeLine{00515\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}rnti=\{\}\ Failed\ to\ allocate\ PUSCH\ in\ slot=\{\}.\ Cause:\ DL\ is\ not\ active\ in\ the\ PDCCH\ slot"{}},}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.slot);}
\DoxyCodeLine{00518\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_slot;}
\DoxyCodeLine{00519\ \ \ \}}
\DoxyCodeLine{00520\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ cell\_cfg.is\_ul\_enabled(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.slot))\ \{}
\DoxyCodeLine{00521\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}rnti=\{\}\ Failed\ to\ allocate\ PUSCH\ in\ slot=\{\}.\ Cause:\ UL\ is\ not\ active\ in\ the\ PUSCH\ slot\ (k2=\{\})"{}},}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.slot,}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_cfg}}.k2);}
\DoxyCodeLine{00525\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00526\ \ \ \}}
\DoxyCodeLine{00527\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.result.ul.puschs.size()\ >=\ expert\_cfg.\mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config_abe1697c6e83cc3f0a870688b71d1764d}{max\_puschs\_per\_slot}})\ \{}
\DoxyCodeLine{00528\ \ \ \ \ logger.info(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PUSCH.\ Cause:\ Max\ number\ of\ PUSCHs\ per\ slot\ \{\}\ was\ reached."{}},}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ expert\_cfg.\mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config_abe1697c6e83cc3f0a870688b71d1764d}{max\_puschs\_per\_slot}});}
\DoxyCodeLine{00530\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_slot;}
\DoxyCodeLine{00531\ \ \ \}}
\DoxyCodeLine{00532\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.result.ul.puschs.size()\ >=}
\DoxyCodeLine{00533\ \ \ \ \ \ \ expert\_cfg.\mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config_acd5a312b18e77ecdcb45c36c450a407b}{max\_ul\_grants\_per\_slot}}\ -\/\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.result.ul.pucchs.size()))\ \{}
\DoxyCodeLine{00534\ \ \ \ \ logger.info(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ PUSCH.\ Cause:\ Max\ number\ of\ UL\ grants\ per\ slot\ \{\}\ was\ reached."{}},}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ expert\_cfg.\mbox{\hyperlink{structsrsran_1_1scheduler__ue__expert__config_abe1697c6e83cc3f0a870688b71d1764d}{max\_puschs\_per\_slot}});}
\DoxyCodeLine{00536\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_slot;}
\DoxyCodeLine{00537\ \ \ \}}
\DoxyCodeLine{00538\ }
\DoxyCodeLine{00539\ \ \ \textcolor{comment}{//\ Verify\ there\ is\ space\ in\ PUSCH\ and\ PDCCH\ result\ lists\ for\ new\ allocations.}}
\DoxyCodeLine{00540\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.result.ul.puschs.full()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{or}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}}.result.dl.ul\_pdcchs.full())\ \{}
\DoxyCodeLine{00541\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}rnti=\{\}\ Failed\ to\ allocate\ PUSCH\ in\ slot=\{\}.\ Cause:\ No\ space\ available\ in\ scheduler\ output\ list"{}},}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.slot);}
\DoxyCodeLine{00544\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_slot;}
\DoxyCodeLine{00545\ \ \ \}}
\DoxyCodeLine{00546\ }
\DoxyCodeLine{00547\ \ \ \textcolor{comment}{//\ [Implementation-\/defined]\ We\ skip\ allocation\ of\ PUSCH\ if\ there\ is\ already\ a\ PUCCH\ grant\ scheduled\ over\ the\ same\ slot}}
\DoxyCodeLine{00548\ \ \ \textcolor{comment}{//\ and\ the\ UE\ is\ in\ fallback\ mode.}}
\DoxyCodeLine{00549\ \ \ \textcolor{comment}{//\ NOTE:\ This\ is\ due\ to\ the\ lack\ of\ clarity\ of\ the\ TS\ when\ it\ comes\ to\ define\ what\ \(\backslash\)c\ betaOffsets\ to\ use\ for\ PUSCH}}
\DoxyCodeLine{00550\ \ \ \textcolor{comment}{//\ when\ the\ UE\ does\ not\ have\ a\ dedicated\ configuration.}}
\DoxyCodeLine{00551\ \ \ \textcolor{keywordflow}{if}\ (ue\_cc-\/>is\_in\_fallback\_mode())\ \{}
\DoxyCodeLine{00552\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_grant\_it}}\ =}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ std::find\_if(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.result.ul.pucchs.begin(),}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.result.ul.pucchs.end(),}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\&u](\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1pucch__info}{pucch\_info}}\&\ pucch\_grant)\ \{\ return\ pucch\_grant.crnti\ ==\ u.crnti;\ \});}
\DoxyCodeLine{00556\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_grant\_it}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.result.ul.pucchs.end())\ \{}
\DoxyCodeLine{00557\ \ \ \ \ \ \ logger.debug(\textcolor{stringliteral}{"{}rnti=\{\}\ Allocation\ of\ PUSCH\ in\ slot=\{\}\ skipped.\ Cause:\ this\ UE\ is\ in\ fallback\ mode\ and\ has\ "{}}}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}PUCCH\ grants\ scheduled"{}},}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.slot);}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_ue;}
\DoxyCodeLine{00562\ \ \ \ \ \}}
\DoxyCodeLine{00563\ \ \ \}}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \ \ \textcolor{comment}{//\ Verify\ CRBs\ allocation.}}
\DoxyCodeLine{00566\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>ul\_crb\_lims.contains(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs))\ \{}
\DoxyCodeLine{00567\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}rnti=\{\}\ Failed\ to\ allocate\ PUSCH.\ Cause:\ CRBs\ \{\}\ allocated\ outside\ the\ BWP\ \{\}"{}},}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ss\_info}}-\/>ul\_crb\_lims);}
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00572\ \ \ \}}
\DoxyCodeLine{00573\ }
\DoxyCodeLine{00574\ \ \ \textcolor{comment}{//\ In\ case\ of\ retx,\ ensure\ the\ number\ of\ PRBs\ for\ the\ grant\ did\ not\ change.}}
\DoxyCodeLine{00575\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.empty()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs.length()\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.last\_tx\_params().rbs.type1().length())\ \{}
\DoxyCodeLine{00576\ \ \ \ \ logger.warning(}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}rnti=\{\}\ Failed\ to\ allocate\ PUSCH.\ Cause:\ Number\ of\ CRBs\ has\ to\ remain\ constant\ during\ retxs\ (harq-\/id=\{\},\ "{}}}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}nof\_prbs=\{\}!=\{\})"{}},}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.id,}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.last\_tx\_params().rbs.type1().length(),}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs.length());}
\DoxyCodeLine{00583\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00584\ \ \ \}}
\DoxyCodeLine{00585\ }
\DoxyCodeLine{00586\ \ \ \textcolor{comment}{//\ Verify\ there\ is\ no\ RB\ collision.}}
\DoxyCodeLine{00587\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.ul\_res\_grid.collides(scs,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_cfg}}.symbols,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs))\ \{}
\DoxyCodeLine{00588\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}rnti=\{\}\ Failed\ to\ allocate\ PUSCH.\ Cause:\ No\ space\ available\ in\ scheduler\ RB\ resource\ grid."{}},}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti);}
\DoxyCodeLine{00590\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00591\ \ \ \}}
\DoxyCodeLine{00592\ }
\DoxyCodeLine{00593\ \ \ \textcolor{comment}{//\ Allocate\ PDCCH\ position.}}
\DoxyCodeLine{00594\ \ \ \mbox{\hyperlink{structsrsran_1_1pdcch__ul__information}{pdcch\_ul\_information}}*\ pdcch\ =}
\DoxyCodeLine{00595\ \ \ \ \ \ \ get\_pdcch\_sched(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index)}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \ \ .\mbox{\hyperlink{classsrsran_1_1pdcch__resource__allocator_a47d0018eefa65c2aa4e726e93fb05a16}{alloc\_ul\_pdcch\_ue}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}},\ u.crnti,\ ue\_cell\_cfg,\ ss\_cfg.\mbox{\hyperlink{structsrsran_1_1search__space__configuration_af62d83a85585b358f7626a3ccfe1005d}{get\_id}}(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.aggr\_lvl);}
\DoxyCodeLine{00597\ \ \ \textcolor{keywordflow}{if}\ (pdcch\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00598\ \ \ \ \ logger.info(\textcolor{stringliteral}{"{}rnti=\{\}:\ Failed\ to\ allocate\ PUSCH.\ Cause:\ No\ space\ in\ PDCCH."{}},\ u.crnti);}
\DoxyCodeLine{00599\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::skip\_ue;}
\DoxyCodeLine{00600\ \ \ \}}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00602\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ nof\_harq\_ack\_bits\ =}
\DoxyCodeLine{00603\ \ \ \ \ \ \ get\_uci\_alloc(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index).\mbox{\hyperlink{classsrsran_1_1uci__allocator_a9c7a7c379c79a8815d14d4a0daa17435}{get\_scheduled\_pdsch\_counter\_in\_ue\_uci}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}},\ u.crnti);}
\DoxyCodeLine{00604\ }
\DoxyCodeLine{00605\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{is\_csi\_report\_slot}}\ =}
\DoxyCodeLine{00606\ \ \ \ \ \ \ csi\_helper::is\_csi\_reporting\_slot(u.\mbox{\hyperlink{classsrsran_1_1ue_a731245d82c06b3498ca7808f6f308687}{get\_pcell}}().cfg().cfg\_dedicated(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.slot);}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00608\ \ \ \textcolor{comment}{//\ Fetch\ PUSCH\ parameters\ based\ on\ type\ of\ transmission.}}
\DoxyCodeLine{00609\ \ \ \mbox{\hyperlink{structsrsran_1_1pusch__config__params}{pusch\_config\_params}}\ pusch\_cfg;}
\DoxyCodeLine{00610\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}})\ \{}
\DoxyCodeLine{00611\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_ul\_rnti\_config\_type::tc\_rnti\_f0\_0:}
\DoxyCodeLine{00612\ \ \ \ \ \ \ pusch\_cfg\ =\ \mbox{\hyperlink{namespacesrsran_a188c8322d8c26fc620cee9cc2579d2a7}{get\_pusch\_config\_f0\_0\_tc\_rnti}}(cell\_cfg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_cfg}});}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00614\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_ul\_rnti\_config\_type::c\_rnti\_f0\_0:}
\DoxyCodeLine{00615\ \ \ \ \ \ \ pusch\_cfg\ =}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a1b99f8650ec705314f82f2cf2eea6794}{get\_pusch\_config\_f0\_0\_c\_rnti}}(ue\_cell\_cfg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bwp\_ul\_cmn}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_cfg}},\ nof\_harq\_ack\_bits,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{is\_csi\_report\_slot}});}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00618\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_ul\_rnti\_config\_type::c\_rnti\_f0\_1:}
\DoxyCodeLine{00619\ \ \ \ \ \ \ pusch\_cfg\ =\ \mbox{\hyperlink{namespacesrsran_a79c60f1a36e31fb93f87c74488a9dfc4}{get\_pusch\_config\_f0\_1\_c\_rnti}}(ue\_cell\_cfg,}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_cfg}},}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cc-\/>\mbox{\hyperlink{classsrsran_1_1ue__cell_a9ec269dbea62873f276ab52989a5df1d}{channel\_state\_manager}}().\mbox{\hyperlink{classsrsran_1_1ue__channel__state__manager_abf82a4f102d9f9b559edb435cbbfeb43}{get\_nof\_ul\_layers}}(),}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nof\_harq\_ack\_bits,}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{is\_csi\_report\_slot}});}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00625\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a630688b51219f81c5a47ec5650326afc}{report\_fatal\_error}}(\textcolor{stringliteral}{"{}Unsupported\ PDCCH\ DCI\ UL\ format"{}});}
\DoxyCodeLine{00627\ \ \ \}}
\DoxyCodeLine{00628\ }
\DoxyCodeLine{00629\ \ \ \textcolor{comment}{//\ Compute\ MCS\ and\ TBS\ for\ this\ transmission.}}
\DoxyCodeLine{00630\ \ \ \mbox{\hyperlink{classsrsran_1_1optional}{optional<sch\_mcs\_tbs>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}};}
\DoxyCodeLine{00631\ \ \ \textcolor{comment}{//\ If\ it's\ a\ new\ Tx,\ compute\ the\ MCS\ and\ TBS\ from\ SNR,\ payload\ size,\ and\ available\ RBs.}}
\DoxyCodeLine{00632\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.empty())\ \{}
\DoxyCodeLine{00633\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}\ =\ \mbox{\hyperlink{namespacesrsran_af8840579fc38bd5b2f9605e73f2e2ee0}{compute\_ul\_mcs\_tbs}}(pusch\_cfg,\ ue\_cell\_cfg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.mcs,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs.length());}
\DoxyCodeLine{00634\ \ \ \}}
\DoxyCodeLine{00635\ \ \ \textcolor{comment}{//\ If\ it's\ a\ reTx,\ fetch\ the\ MCS\ and\ TBS\ from\ the\ previous\ transmission.}}
\DoxyCodeLine{00636\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00637\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.emplace(\mbox{\hyperlink{structsrsran_1_1sch__mcs__tbs}{sch\_mcs\_tbs}}\{.\mbox{\hyperlink{structsrsran_1_1sch__mcs__tbs_a0e39436a73718f7c879b0df8cbdb6810}{mcs}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.last\_tx\_params().mcs,\ .tbs\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.last\_tx\_params().tbs\_bytes\});}
\DoxyCodeLine{00638\ \ \ \}}
\DoxyCodeLine{00639\ }
\DoxyCodeLine{00640\ \ \ \textcolor{comment}{//\ If\ there\ is\ not\ MCS-\/TBS\ info,\ it\ means\ no\ MCS\ exists\ such\ that\ the\ effective\ code\ rate\ is\ <=\ 0.95.}}
\DoxyCodeLine{00641\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.has\_value())\ \{}
\DoxyCodeLine{00642\ \ \ \ \ logger.warning(}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}rnti=\{\}\ Failed\ to\ allocate\ PUSCH.\ Cause:\ no\ MCS\ such\ that\ code\ rate\ <=\ 0.95\ with\ this\ "{}}}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}configuration:\ mcs=\{\}\ crbs=\{\}\ symbols=\{\}\ nof\_oh=\{\}\ tb-\/sc-\/field=\{\}\ layers=\{\}\ pi2bpsk=\{\}\ "{}}}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}harq\_bits=\{\}\ csi1\_bits=\{\}\ csi2\_bits=\{\}\ mcs\_table\_idx=\{\}\ dmrs\_A\_pos=\{\}\ is\_dmrs\_type2=\{\}\ dmrs\_add\_pos\_idx=\{\}"{}},}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.mcs.to\_uint(),}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ pusch\_cfg.symbols,}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ pusch\_cfg.nof\_oh\_prb,}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ pusch\_cfg.tb\_scaling\_field,}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ pusch\_cfg.nof\_layers,}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ pusch\_cfg.tp\_pi2bpsk\_present\ ?\ \textcolor{stringliteral}{"{}yes"{}}\ :\ \textcolor{stringliteral}{"{}no"{}},}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ pusch\_cfg.nof\_harq\_ack\_bits,}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ pusch\_cfg.nof\_csi\_part1\_bits,}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ pusch\_cfg.max\_nof\_csi\_part2\_bits,}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{static\_cast}}<\mbox{\hyperlink{classunsigned}{unsigned}}>(pusch\_cfg.mcs\_table),}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ ue\_cell\_cfg.cell\_cfg\_common.dmrs\_typeA\_pos\ ==\ \mbox{\hyperlink{namespacesrsran_a3c5416bf7ff59c183bb2047d936b55ef}{dmrs\_typeA\_position}}::pos2\ ?\ \textcolor{stringliteral}{"{}pos2"{}}\ :\ \textcolor{stringliteral}{"{}pos3"{}},}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ ue\_cell\_cfg.cfg\_dedicated().ul\_config-\/>init\_ul\_bwp.pusch\_cfg-\/>pusch\_mapping\_type\_a\_dmrs.value().is\_dmrs\_type2}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \textcolor{stringliteral}{"{}yes"{}}}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}no"{}},}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{static\_cast}}<\mbox{\hyperlink{classunsigned}{unsigned}}>(ue\_cell\_cfg.cfg\_dedicated()}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .ul\_config-\/>init\_ul\_bwp.pusch\_cfg-\/>pusch\_mapping\_type\_a\_dmrs.value()}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .additional\_positions));}
\DoxyCodeLine{00665\ \ \ \ \ get\_pdcch\_sched(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index).\mbox{\hyperlink{classsrsran_1_1pdcch__resource__allocator_a2c7d3c611349eaa40e7e39a5fde0c9be}{cancel\_last\_pdcch}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdcch\_alloc}});}
\DoxyCodeLine{00666\ \ \ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::invalid\_params;}
\DoxyCodeLine{00667\ \ \ \}}
\DoxyCodeLine{00668\ }
\DoxyCodeLine{00669\ \ \ \textcolor{comment}{//\ Mark\ resources\ as\ occupied\ in\ the\ ResourceGrid.}}
\DoxyCodeLine{00670\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.ul\_res\_grid.fill(\mbox{\hyperlink{structsrsran_1_1grant__info}{grant\_info}}\{scs,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_cfg}}.symbols,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs\});}
\DoxyCodeLine{00671\ }
\DoxyCodeLine{00672\ \ \ \textcolor{comment}{//\ Remove\ NTN\ offset\ when\ adding\ slot\ to\ HARQ\ process.}}
\DoxyCodeLine{00673\ \ \ \mbox{\hyperlink{classsrsran_1_1slot__point}{slot\_point}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_slot}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.slot\ -\/\ ue\_cell\_cfg.cell\_cfg\_common.ntn\_cs\_koffset;}
\DoxyCodeLine{00674\ \ \ \textcolor{comment}{//\ Allocate\ UE\ UL\ HARQ.}}
\DoxyCodeLine{00675\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.empty())\ \{}
\DoxyCodeLine{00676\ \ \ \ \ \textcolor{comment}{//\ It\ is\ a\ new\ tx.}}
\DoxyCodeLine{00677\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.new\_tx(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_slot}},\ expert\_cfg.max\_nof\_harq\_retxs);}
\DoxyCodeLine{00678\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00679\ \ \ \ \ \textcolor{comment}{//\ It\ is\ a\ retx.}}
\DoxyCodeLine{00680\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.new\_retx(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_slot}});}
\DoxyCodeLine{00681\ \ \ \}}
\DoxyCodeLine{00682\ }
\DoxyCodeLine{00683\ \ \ \textcolor{comment}{//\ Compute\ total\ DAI.\ See\ TS\ 38.213,\ 9.1.3.2.}}
\DoxyCodeLine{00684\ \ \ \textcolor{comment}{//\ Total\ DAI\ provides\ total\ number\ of\ transmissions\ at\ the\ end\ of\ each\ interval\ (slot\ in\ a\ cell).\ Values\ range\ from\ 1}}
\DoxyCodeLine{00685\ \ \ \textcolor{comment}{//\ to\ 4.}}
\DoxyCodeLine{00686\ \ \ \textcolor{comment}{//\ If\ a\ UE\ is\ not\ provided\ PDSCH-\/CodeBlockGroupTransmission\ and\ the\ UE\ is\ scheduled\ for\ a\ PUSCH\ transmission\ by}}
\DoxyCodeLine{00687\ \ \ \textcolor{comment}{//\ DCI\ format\ 0\_1\ with\ DAI\ field\ value\ V\_T\_DAI\_UL\ =\ 4\ and\ the\ UE\ has\ not\ received\ any\ PDCCH\ within\ the\ monitoring}}
\DoxyCodeLine{00688\ \ \ \textcolor{comment}{//\ occasions\ for\ PDCCH\ with\ DCI\ format\ 1\_0\ or\ DCI\ format\ 1\_1\ for\ scheduling\ PDSCH\ receptions\ or\ SPS\ PDSCH}}
\DoxyCodeLine{00689\ \ \ \textcolor{comment}{//\ release\ on\ any\ serving\ cell\ c\ and\ the\ UE\ does\ not\ have\ HARQ-\/ACK\ information\ in\ response\ to\ a\ SPS\ PDSCH}}
\DoxyCodeLine{00690\ \ \ \textcolor{comment}{//\ reception\ to\ multiplex\ in\ the\ PUSCH,\ the\ UE\ does\ not\ multiplex\ HARQ-\/ACK\ information\ in\ the\ PUSCH\ transmission.}}
\DoxyCodeLine{00691\ \ \ \textcolor{comment}{//\ NOTE:\ DAI\ is\ encoded\ as\ per\ left\ most\ column\ in\ Table\ 9.1.3-\/2\ of\ TS\ 38.213.}}
\DoxyCodeLine{00692\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dai}}\ =\ 3;}
\DoxyCodeLine{00693\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}}\ ==\ dci\_ul\_rnti\_config\_type::c\_rnti\_f0\_1)\ \{}
\DoxyCodeLine{00694\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{total\_harq\_ack\_in\_uci}}\ =\ nof\_harq\_ack\_bits;}
\DoxyCodeLine{00695\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{total\_harq\_ack\_in\_uci}}\ !=\ 0)\ \{}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \textcolor{comment}{//\ See\ TS\ 38.213,\ Table\ 9.1.3-\/2.\ dai\ value\ below\ maps\ to\ the\ leftmost\ column\ in\ the\ table.}}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dai}}\ =\ ((\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{total\_harq\_ack\_in\_uci}}\ -\/\ 1)\ \%\ 4);}
\DoxyCodeLine{00698\ \ \ \ \ \}}
\DoxyCodeLine{00699\ \ \ \}}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \ \ \textcolor{comment}{//\ Fill\ UL\ PDCCH\ DCI.}}
\DoxyCodeLine{00702\ \ \ \mbox{\hyperlink{classuint8__t}{uint8\_t}}\ rv\ =\ ue\_cc-\/>get\_pusch\_rv(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}});}
\DoxyCodeLine{00703\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dci\_type}})\ \{}
\DoxyCodeLine{00704\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_ul\_rnti\_config\_type::tc\_rnti\_f0\_0:}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_adbe5af22eaca44589440aa0edb4b8bc0}{build\_dci\_f0\_0\_tc\_rnti}}(pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__ul__information_acf8a1b3025449226cbe3703229c1137e}{dci}},}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *ue\_cell\_cfg.bwp(\mbox{\hyperlink{namespacesrsran_a41c7236508881761bbd602d002833e8e}{to\_bwp\_id}}(0)).dl\_common,}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cell\_cfg.bwp(ue\_cc-\/>active\_bwp\_id()).ul\_common-\/>generic\_params,}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.\mbox{\hyperlink{structsrsran_1_1bwp__configuration_ad7e6a6961052ba5b05ecb93aa0b9510f}{crbs}},}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index,}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value().mcs,}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rv,}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}});}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00714\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_ul\_rnti\_config\_type::c\_rnti\_f0\_0:}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a5a5a682002e7df26aafe0563da08cf74}{build\_dci\_f0\_0\_c\_rnti}}(}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__ul__information_acf8a1b3025449226cbe3703229c1137e}{dci}},\ ue\_cell\_cfg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value().mcs,\ rv,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}});}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00718\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_ul\_rnti\_config\_type::c\_rnti\_f0\_1:}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a17d42ddb858609995659056831889226}{build\_dci\_f0\_1\_c\_rnti}}(pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__ul__information_acf8a1b3025449226cbe3703229c1137e}{dci}},}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cell\_cfg,}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.ss\_id,}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.time\_res\_index,}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value().mcs,}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rv,}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}},}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dai}},}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cc-\/>\mbox{\hyperlink{classsrsran_1_1ue__cell_a9ec269dbea62873f276ab52989a5df1d}{channel\_state\_manager}}().\mbox{\hyperlink{classsrsran_1_1ue__channel__state__manager_abf82a4f102d9f9b559edb435cbbfeb43}{get\_nof\_ul\_layers}}());}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00730\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a630688b51219f81c5a47ec5650326afc}{report\_fatal\_error}}(\textcolor{stringliteral}{"{}Unsupported\ PDCCH\ UL\ DCI\ format"{}});}
\DoxyCodeLine{00732\ \ \ \}}
\DoxyCodeLine{00733\ }
\DoxyCodeLine{00734\ \ \ \textcolor{comment}{//\ Fill\ PUSCH.}}
\DoxyCodeLine{00735\ \ \ \mbox{\hyperlink{structsrsran_1_1ul__sched__info}{ul\_sched\_info}}\&\ msg\ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}}.result.ul.puschs.emplace\_back();}
\DoxyCodeLine{00736\ \ \ msg.context.ue\_index\ \ =\ u.ue\_index;}
\DoxyCodeLine{00737\ \ \ msg.context.ss\_id\ \ \ \ \ =\ ss\_cfg.\mbox{\hyperlink{structsrsran_1_1search__space__configuration_af62d83a85585b358f7626a3ccfe1005d}{get\_id}}();}
\DoxyCodeLine{00738\ \ \ msg.context.\mbox{\hyperlink{structsrsran_1_1ul__sched__info_1_1decision__context_a7eaef783726e75630a1ed8cad748813f}{k2}}\ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_td\_cfg}}.k2;}
\DoxyCodeLine{00739\ \ \ msg.context.\mbox{\hyperlink{structsrsran_1_1ul__sched__info_1_1decision__context_a72d92f4c61ac0bb88f22a59c2e36e813}{nof\_retxs}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.tb().nof\_retxs;}
\DoxyCodeLine{00740\ \ \ \textcolor{keywordflow}{if}\ (msg.context.\mbox{\hyperlink{structsrsran_1_1ul__sched__info_1_1decision__context_a72d92f4c61ac0bb88f22a59c2e36e813}{nof\_retxs}}\ ==\ 0\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ ue\_cc-\/>link\_adaptation\_controller().\mbox{\hyperlink{classsrsran_1_1ue__link__adaptation__controller_a57ba034a9544eacfde3ad60284e71cab}{is\_ul\_olla\_enabled}}())\ \{}
\DoxyCodeLine{00741\ \ \ \ \ msg.context.\mbox{\hyperlink{structsrsran_1_1ul__sched__info_1_1decision__context_a546397d33dc6fa0fc9b325cf3761e482}{olla\_offset}}\ =\ ue\_cc-\/>link\_adaptation\_controller().\mbox{\hyperlink{classsrsran_1_1ue__link__adaptation__controller_a8bf5045f421cf50f3c87c366ca7865fa}{ul\_snr\_offset\_db}}();}
\DoxyCodeLine{00742\ \ \ \}}
\DoxyCodeLine{00743\ \ \ \textcolor{keywordflow}{switch}\ (pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__ul__information_acf8a1b3025449226cbe3703229c1137e}{dci}}.type)\ \{}
\DoxyCodeLine{00744\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_ul\_rnti\_config\_type::tc\_rnti\_f0\_0:}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a7bc02b56e3a9fe3f95b6bf6b634c79a2}{build\_pusch\_f0\_0\_tc\_rnti}}(msg.pusch\_cfg,}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pusch\_cfg,}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value().tbs,}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cell\_cfg,}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__ul__information_acf8a1b3025449226cbe3703229c1137e}{dci}}.tc\_rnti\_f0\_0,}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.tb().nof\_retxs\ ==\ 0);}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00754\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_ul\_rnti\_config\_type::c\_rnti\_f0\_0:}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_aed9e662a0981f4eba5c749e0dde3f927}{build\_pusch\_f0\_0\_c\_rnti}}(msg.pusch\_cfg,}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pusch\_cfg,}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value().tbs,}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cell\_cfg,}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{bwp\_ul\_cmn}},}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__ul__information_acf8a1b3025449226cbe3703229c1137e}{dci}}.c\_rnti\_f0\_0,}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.tb().nof\_retxs\ ==\ 0);}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00765\ \ \ \ \ \textcolor{keywordflow}{case}\ dci\_ul\_rnti\_config\_type::c\_rnti\_f0\_1:}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a65abbade9591ee4957e7d80f33791e39}{build\_pusch\_f0\_1\_c\_rnti}}(msg.pusch\_cfg,}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u.crnti,}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pusch\_cfg,}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{mcs\_tbs\_info}}.value(),}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cell\_cfg,}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ss\_cfg.\mbox{\hyperlink{structsrsran_1_1search__space__configuration_af62d83a85585b358f7626a3ccfe1005d}{get\_id}}(),}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__ul__information_acf8a1b3025449226cbe3703229c1137e}{dci}}.c\_rnti\_f0\_1,}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.crbs,}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}});}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00776\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a630688b51219f81c5a47ec5650326afc}{report\_fatal\_error}}(\textcolor{stringliteral}{"{}Unsupported\ PDCCH\ UL\ DCI\ format"{}});}
\DoxyCodeLine{00778\ \ \ \}}
\DoxyCodeLine{00779\ }
\DoxyCodeLine{00780\ \ \ \textcolor{comment}{//\ Check\ if\ there\ is\ any\ UCI\ grant\ allocated\ on\ the\ PUCCH\ that\ can\ be\ moved\ to\ the\ PUSCH.}}
\DoxyCodeLine{00781\ \ \ get\_uci\_alloc(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}.cell\_index).\mbox{\hyperlink{classsrsran_1_1uci__allocator_a7dc8ff45c9cfad1a418ce24f2c06d1ff}{multiplex\_uci\_on\_pusch}}(msg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pusch\_alloc}},\ ue\_cell\_cfg,\ u.crnti);}
\DoxyCodeLine{00782\ }
\DoxyCodeLine{00783\ \ \ \textcolor{comment}{//\ Save\ set\ PDCCH\ and\ PUSCH\ PDU\ parameters\ in\ HARQ\ process.}}
\DoxyCodeLine{00784\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{h\_ul}}.save\_alloc\_params(pdcch-\/>\mbox{\hyperlink{structsrsran_1_1pdcch__ul__information_acf8a1b3025449226cbe3703229c1137e}{dci}}.type,\ msg.pusch\_cfg);}
\DoxyCodeLine{00785\ }
\DoxyCodeLine{00786\ \ \ \textcolor{comment}{//\ In\ case\ there\ is\ a\ SR\ pending.\ Reset\ it.}}
\DoxyCodeLine{00787\ \ \ u.\mbox{\hyperlink{classsrsran_1_1ue_a8f374bc3743fcdd79b84df74c242ae06}{reset\_sr\_indication}}();}
\DoxyCodeLine{00788\ }
\DoxyCodeLine{00789\ \ \ \textcolor{keywordflow}{return}\ alloc\_outcome::success;}
\DoxyCodeLine{00790\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ue__cell__grid__allocator_abe20d3757ae24b91489c800a86acf968}\label{classsrsran_1_1ue__cell__grid__allocator_abe20d3757ae24b91489c800a86acf968} 
\index{srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}!nof\_cells@{nof\_cells}}
\index{nof\_cells@{nof\_cells}!srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}}
\doxysubsubsection{\texorpdfstring{nof\_cells()}{nof\_cells()}}
{\footnotesize\ttfamily size\+\_\+t srsran\+::ue\+\_\+cell\+\_\+grid\+\_\+allocator\+::nof\+\_\+cells (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00049\ \{\ \textcolor{keywordflow}{return}\ cells.\mbox{\hyperlink{classsrsran_1_1slotted__array_ada775fc23021dc2c35d3b2339a9b42a1}{size}}();\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ue__cell__grid__allocator_ab623952886cb3dd29d7c84a487c3ad01}\label{classsrsran_1_1ue__cell__grid__allocator_ab623952886cb3dd29d7c84a487c3ad01} 
\index{srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}!slot\_indication@{slot\_indication}}
\index{slot\_indication@{slot\_indication}!srsran::ue\_cell\_grid\_allocator@{srsran::ue\_cell\_grid\_allocator}}
\doxysubsubsection{\texorpdfstring{slot\_indication()}{slot\_indication()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} ue\+\_\+cell\+\_\+grid\+\_\+allocator\+::slot\+\_\+indication (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00051\ \{}
\DoxyCodeLine{00052\ \ \ dl\_attempts\_count\ =\ 0;}
\DoxyCodeLine{00053\ \ \ ul\_attempts\_count\ =\ 0;}
\DoxyCodeLine{00054\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/scheduler/ue\+\_\+scheduling/ue\+\_\+cell\+\_\+grid\+\_\+allocator.\+h\item 
lib/scheduler/ue\+\_\+scheduling/ue\+\_\+cell\+\_\+grid\+\_\+allocator.\+cpp\end{DoxyCompactItemize}
