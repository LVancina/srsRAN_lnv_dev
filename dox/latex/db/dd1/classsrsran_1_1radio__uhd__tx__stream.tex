\doxysection{srsran\+::radio\+\_\+uhd\+\_\+tx\+\_\+stream Class Reference}
\hypertarget{classsrsran_1_1radio__uhd__tx__stream}{}\label{classsrsran_1_1radio__uhd__tx__stream}\index{srsran::radio\_uhd\_tx\_stream@{srsran::radio\_uhd\_tx\_stream}}


Implements a gateway transmitter based on UHD transmit stream.  




{\ttfamily \#include $<$radio\+\_\+uhd\+\_\+tx\+\_\+stream.\+h$>$}



Inheritance diagram for srsran\+::radio\+\_\+uhd\+\_\+tx\+\_\+stream\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dd/d9c/classsrsran_1_1radio__uhd__tx__stream__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::radio\+\_\+uhd\+\_\+tx\+\_\+stream\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/d8b/classsrsran_1_1radio__uhd__tx__stream__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structsrsran_1_1radio__uhd__tx__stream_1_1stream__description}{stream\+\_\+description}}
\begin{DoxyCompactList}\small\item\em Describes the necessary parameters to create an UHD transmit stream. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream_a1f5d7a33b05b509d71fed714e983f382}{radio\+\_\+uhd\+\_\+tx\+\_\+stream}} (uhd\+::usrp\+::multi\+\_\+usrp\+::sptr \&usrp, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1radio__uhd__tx__stream_1_1stream__description}{stream\+\_\+description}} \&description, \mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{async\+\_\+executor\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1radio__notification__handler}{radio\+\_\+notification\+\_\+handler}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{notifier\+\_\+}})
\begin{DoxyCompactList}\small\item\em Constructs an UHD transmit stream. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream_a7d781365e20ccc4f258c9e580411b53c}{get\+\_\+buffer\+\_\+size}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\begin{DoxyCompactList}\small\item\em Gets the optimal transmitter buffer size. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream_a877e375e9e38819603deba5ef1f8cc03}{transmit}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1baseband__gateway__buffer__reader}{baseband\+\_\+gateway\+\_\+buffer\+\_\+reader}} \&data, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1baseband__gateway__transmitter__metadata}{baseband\+\_\+gateway\+\_\+transmitter\+\_\+metadata}} \&metadata) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Transmits a set of baseband samples at the time instant provided in the metadata. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream_a03f3b4aa01cf226094f5774462c0cb5c}{stop}} ()
\begin{DoxyCompactList}\small\item\em Stop the transmission. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream_aaff45befebde956b712a35893c6ebdb0}{wait\+\_\+stop}} ()
\begin{DoxyCompactList}\small\item\em Wait until radio is notify\+\_\+stop. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1baseband__gateway__base}{srsran\+::baseband\+\_\+gateway\+\_\+base}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{virtual}} {\bfseries \texorpdfstring{$\sim$}{\string~}baseband\+\_\+gateway\+\_\+base} ()=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{default}}
\begin{DoxyCompactList}\small\item\em Provides default destructor. \end{DoxyCompactList}\item 
{\bfseries baseband\+\_\+gateway\+\_\+base} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1baseband__gateway__base}{baseband\+\_\+gateway\+\_\+base}} \&\mbox{\hyperlink{namespacesrsran_aaf684a2cfa98b7f333de7041525a5b29a795f3202b17cb6bc3d4b771d8c6c9eaf}{other}})=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\begin{DoxyCompactList}\small\item\em Forbid copy constructor. \end{DoxyCompactList}\item 
{\bfseries baseband\+\_\+gateway\+\_\+base} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1baseband__gateway__base}{baseband\+\_\+gateway\+\_\+base}} \&\&\mbox{\hyperlink{namespacesrsran_aaf684a2cfa98b7f333de7041525a5b29a795f3202b17cb6bc3d4b771d8c6c9eaf}{other}})=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\begin{DoxyCompactList}\small\item\em Forbid move constructor. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classsrsran_1_1baseband__gateway__base}{baseband\+\_\+gateway\+\_\+base}} \& {\bfseries operator=} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1baseband__gateway__base}{baseband\+\_\+gateway\+\_\+base}} \&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\begin{DoxyCompactList}\small\item\em Forbid copy assigment operator. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classsrsran_1_1baseband__gateway__base}{baseband\+\_\+gateway\+\_\+base}} \& {\bfseries operator=} (\mbox{\hyperlink{classsrsran_1_1baseband__gateway__base}{baseband\+\_\+gateway\+\_\+base}} \&\&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\begin{DoxyCompactList}\small\item\em Forbid move assigment operator. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1uhd__exception__handler}{srsran\+::uhd\+\_\+exception\+\_\+handler}}}
\begin{DoxyCompactItemize}
\item 
{\footnotesize template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} S , typename... Args$>$ }\\\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1uhd__exception__handler_a8f6f77cc15719b76196b3466f446be7c}{on\+\_\+error}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} S \&format\+\_\+str, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{Args}} \&\&... args)
\item 
{\footnotesize template$<$\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{typename}} F $>$ }\\\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{classsrsran_1_1uhd__exception__handler_ac3e01af04c1c394cb27d1150cfa7e492}{safe\+\_\+execution}} (F task)
\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{classsrsran_1_1uhd__exception__handler_a3660e50d52ecd1fa3d426a805030a646}{is\+\_\+successful}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} std\+::string \& \mbox{\hyperlink{classsrsran_1_1uhd__exception__handler_a9d9c51ab907c347c37e0d339fe9e88d2}{get\+\_\+error\+\_\+message}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Additional Inherited Members}
\doxysubsection*{Protected Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1baseband__gateway__base}{srsran\+::baseband\+\_\+gateway\+\_\+base}}}
\begin{DoxyCompactItemize}
\item 
{\bfseries baseband\+\_\+gateway\+\_\+base} ()=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{default}}
\begin{DoxyCompactList}\small\item\em Allow default constructor for child. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implements a gateway transmitter based on UHD transmit stream. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1radio__uhd__tx__stream_a1f5d7a33b05b509d71fed714e983f382}\label{classsrsran_1_1radio__uhd__tx__stream_a1f5d7a33b05b509d71fed714e983f382} 
\index{srsran::radio\_uhd\_tx\_stream@{srsran::radio\_uhd\_tx\_stream}!radio\_uhd\_tx\_stream@{radio\_uhd\_tx\_stream}}
\index{radio\_uhd\_tx\_stream@{radio\_uhd\_tx\_stream}!srsran::radio\_uhd\_tx\_stream@{srsran::radio\_uhd\_tx\_stream}}
\doxysubsubsection{\texorpdfstring{radio\_uhd\_tx\_stream()}{radio\_uhd\_tx\_stream()}}
{\footnotesize\ttfamily radio\+\_\+uhd\+\_\+tx\+\_\+stream\+::radio\+\_\+uhd\+\_\+tx\+\_\+stream (\begin{DoxyParamCaption}\item[{uhd\+::usrp\+::multi\+\_\+usrp\+::sptr \&}]{usrp,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1radio__uhd__tx__stream_1_1stream__description}{stream\+\_\+description}} \&}]{description,  }\item[{\mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&}]{async\+\_\+executor\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1radio__notification__handler}{radio\+\_\+notification\+\_\+handler}} \&}]{notifier\+\_\+ }\end{DoxyParamCaption})}



Constructs an UHD transmit stream. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em usrp} & Provides the USRP context. \\
\hline
\mbox{\texttt{ in}}  & {\em description} & Provides the stream configuration parameters. \\
\hline
\mbox{\texttt{ in}}  & {\em async\+\_\+executor\+\_\+} & Provides the asynchronous task executor. \\
\hline
\mbox{\texttt{ in}}  & {\em notifier\+\_\+} & Provides the radio event notification handler. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00130\ \ \ stream\_id(description.id),}
\DoxyCodeLine{00131\ \ \ async\_executor(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{async\_executor\_}}),}
\DoxyCodeLine{00132\ \ \ notifier(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{notifier\_}}),}
\DoxyCodeLine{00133\ \ \ srate\_hz(description.srate\_hz),}
\DoxyCodeLine{00134\ \ \ nof\_channels(description.ports.size()),}
\DoxyCodeLine{00135\ \ \ discontinuous\_tx(description.discontiuous\_tx),}
\DoxyCodeLine{00136\ \ \ last\_tx\_timespec(0.0),}
\DoxyCodeLine{00137\ \ \ power\_ramping\_buffer(nof\_channels,\ 0)}
\DoxyCodeLine{00138\ \{}
\DoxyCodeLine{00139\ \ \ srsran\_assert(std::isnormal(srate\_hz)\ \&\&\ (srate\_hz\ >\ 0.0),\ \textcolor{stringliteral}{"{}Invalid\ sampling\ rate\ \{\}."{}},\ srate\_hz);}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \textcolor{comment}{//\ Build\ stream\ arguments.}}
\DoxyCodeLine{00142\ \ \ uhd::stream\_args\_t\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{stream\_args}}\ =\ \{\};}
\DoxyCodeLine{00143\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{stream\_args}}.cpu\_format\ \ \ \ \ \ \ \ \ =\ \textcolor{stringliteral}{"{}fc32"{}};}
\DoxyCodeLine{00144\ \ \ \textcolor{keywordflow}{switch}\ (description.otw\_format)\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::over\_the\_wire\_format::DEFAULT:}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::over\_the\_wire\_format::SC16:}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{stream\_args}}.otw\_format\ =\ \textcolor{stringliteral}{"{}sc16"{}};}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::over\_the\_wire\_format::SC12:}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{stream\_args}}.otw\_format\ =\ \textcolor{stringliteral}{"{}sc12"{}};}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordflow}{case}\ radio\_configuration::over\_the\_wire\_format::SC8:}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{stream\_args}}.otw\_format\ =\ \textcolor{stringliteral}{"{}sc8"{}};}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00155\ \ \ \}}
\DoxyCodeLine{00156\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{stream\_args}}.args\ \ \ \ \ =\ description.args;}
\DoxyCodeLine{00157\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{stream\_args}}.channels\ =\ description.ports;}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{if}\ (!safe\_execution([\textcolor{keyword}{this},\ usrp,\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{stream\_args}}]()\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ stream\ \ \ \ \ \ \ \ \ \ =\ usrp-\/>get\_tx\_stream(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{stream\_args}});}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ max\_packet\_size\ =\ stream-\/>get\_max\_num\_samps();}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \}))\ \{}
\DoxyCodeLine{00163\ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error:\ \ failed\ to\ create\ transmit\ stream\ \%d.\ \%s.\(\backslash\)n"{}},\ stream\_id,\ get\_error\_message().c\_str());}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00165\ \ \ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \textcolor{comment}{//\ Use\ zero\ padding\ to\ absorb\ power\ ramping\ on\ each\ new\ burst.}}
\DoxyCodeLine{00168\ \ \ \textcolor{keywordflow}{if}\ (discontinuous\_tx)\ \{}
\DoxyCodeLine{00169\ \ \ \ \ power\_ramping\_nof\_samples\ =\ description.srate\_hz\ *\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(description.power\_ramping\_us)\ /\ 1\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{e6}};}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{comment}{//\ Align\ the\ number\ of\ padding\ samples\ to\ the\ TX\ buffer\ size.}}
\DoxyCodeLine{00172\ \ \ \ \ power\_ramping\_nof\_samples\ =\ (power\_ramping\_nof\_samples\ /\ max\_packet\_size)\ *\ max\_packet\_size;}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{aligned\_guard\_time}}\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(power\_ramping\_nof\_samples)\ *\ 1000000.0\ /\ srate\_hz;}
\DoxyCodeLine{00174\ \ \ \ \ fmt::print(}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Aligning\ TX\ power\ ramping\ guard\ time\ to\ the\ UHD\ buffer\ size,\ i.e.,\ \{\}.\ Aligned\ guard\ time:\ \{:.1f\}\ us.\(\backslash\)n"{}},}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ max\_packet\_size,}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{aligned\_guard\_time}});}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ power\_ramping\_buffer.\mbox{\hyperlink{classsrsran_1_1baseband__gateway__buffer__dynamic_ad15aacbac76716c26fd606e69d28b995}{resize}}(power\_ramping\_nof\_samples);}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_channel}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_channel}}\ !=\ nof\_channels;\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_channel}})\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ srsvec::zero(power\_ramping\_buffer.\mbox{\hyperlink{classsrsran_1_1baseband__gateway__buffer__dynamic_aa806221b1a14076dbc8115adabb05b43}{get\_writer}}()[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_channel}}]);}
\DoxyCodeLine{00182\ \ \ \ \ \}}
\DoxyCodeLine{00183\ \ \ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \textcolor{comment}{//\ Notify\ FSM\ that\ it\ was\ successfully\ initialized.}}
\DoxyCodeLine{00186\ \ \ state\_fsm.\mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream__fsm_ab30bd8e3336a855e4c2bcc4cbf01748a}{init\_successful}}();}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \textcolor{comment}{//\ Create\ asynchronous\ task.}}
\DoxyCodeLine{00189\ \ \ run\_recv\_async\_msg();}
\DoxyCodeLine{00190\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1radio__uhd__tx__stream_a7d781365e20ccc4f258c9e580411b53c}\label{classsrsran_1_1radio__uhd__tx__stream_a7d781365e20ccc4f258c9e580411b53c} 
\index{srsran::radio\_uhd\_tx\_stream@{srsran::radio\_uhd\_tx\_stream}!get\_buffer\_size@{get\_buffer\_size}}
\index{get\_buffer\_size@{get\_buffer\_size}!srsran::radio\_uhd\_tx\_stream@{srsran::radio\_uhd\_tx\_stream}}
\doxysubsubsection{\texorpdfstring{get\_buffer\_size()}{get\_buffer\_size()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classunsigned}{unsigned}} radio\+\_\+uhd\+\_\+tx\+\_\+stream\+::get\+\_\+buffer\+\_\+size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Gets the optimal transmitter buffer size. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00360\ \{}
\DoxyCodeLine{00361\ \ \ \textcolor{keywordflow}{return}\ max\_packet\_size;}
\DoxyCodeLine{00362\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1radio__uhd__tx__stream_a03f3b4aa01cf226094f5774462c0cb5c}\label{classsrsran_1_1radio__uhd__tx__stream_a03f3b4aa01cf226094f5774462c0cb5c} 
\index{srsran::radio\_uhd\_tx\_stream@{srsran::radio\_uhd\_tx\_stream}!stop@{stop}}
\index{stop@{stop}!srsran::radio\_uhd\_tx\_stream@{srsran::radio\_uhd\_tx\_stream}}
\doxysubsubsection{\texorpdfstring{stop()}{stop()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} radio\+\_\+uhd\+\_\+tx\+\_\+stream\+::stop (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Stop the transmission. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00320\ \{}
\DoxyCodeLine{00321\ \ \ uhd::tx\_metadata\_t\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{md}};}
\DoxyCodeLine{00322\ \ \ state\_fsm.stop(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{md}});}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \textcolor{comment}{//\ Send\ end-\/of-\/burst\ if\ it\ is\ in\ the\ middle\ of\ a\ burst.}}
\DoxyCodeLine{00325\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{md}}.end\_of\_burst)\ \{}
\DoxyCodeLine{00326\ \ \ \ \ std::unique\_lock<std::mutex>\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{transmit\_lock}}(stream\_transmit\_mutex);}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ \ \ \textcolor{comment}{//\ Notify\ end\ of\ burst.}}
\DoxyCodeLine{00329\ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description}{radio\_notification\_handler::event\_description}}\ event\_description\ =\ \{\};}
\DoxyCodeLine{00330\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_a3f49f91a7ca868389088332fd4a16386}{stream\_id}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ stream\_id;}
\DoxyCodeLine{00331\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_a580d960a54861ba14530a9e6ffb077d9}{channel\_id}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ 0;}
\DoxyCodeLine{00332\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_af4d280f079f4f65848159b4858dd245d}{source}}\ =\ \mbox{\hyperlink{classsrsran_1_1radio__notification__handler_1_1event__source_a7f23df937678f1d803ac52f8af7d91b3a149b528ca682d08b0e3789e03d050fd8}{radio\_notification\_handler::event\_source::TRANSMIT}};}
\DoxyCodeLine{00333\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_a1482c13a2ae59d37645e16c95165a630}{type}}\ \ \ =\ \mbox{\hyperlink{classsrsran_1_1radio__notification__handler_1_1event__type_ada92c8b313b55717e4f4f4be58a1ab58a255d970f7b22582d202136011c492b37}{radio\_notification\_handler::event\_type::END\_OF\_BURST}};}
\DoxyCodeLine{00334\ \ \ \ \ notifier.\mbox{\hyperlink{classsrsran_1_1radio__notification__handler_a8b4a990b42877a8054ac67c85543c541}{on\_radio\_rt\_event}}(event\_description);}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{comment}{//\ Flatten\ buffers.}}
\DoxyCodeLine{00337\ \ \ \ \ std::array<cf\_t,\ 4>\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffer;}
\DoxyCodeLine{00338\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1static__vector}{static\_vector<void*,\ RADIO\_MAX\_NOF\_CHANNELS>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{buffs\_flat\_ptr}}(nof\_channels);}
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ channel\ =\ 0;\ channel\ !=\ nof\_channels;\ ++channel)\ \{}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{buffs\_flat\_ptr}}[channel]\ =\ (\textcolor{keywordtype}{void}*)buffer.data();}
\DoxyCodeLine{00341\ \ \ \ \ \}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{comment}{//\ Make\ UHD\ buffers.}}
\DoxyCodeLine{00344\ \ \ \ \ uhd::tx\_streamer::buffs\_type\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{buffs\_cpp}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{buffs\_flat\_ptr}}.data(),\ nof\_channels);}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{comment}{//\ Safe\ transmission.\ Ignore\ return.}}
\DoxyCodeLine{00347\ \ \ \ \ safe\_execution([\textcolor{keyword}{this},\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{buffs\_cpp}},\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{md}}]()\ \{}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \textcolor{comment}{//\ Actual\ transmission.\ Ignore\ number\ of\ transmitted\ samples.}}
\DoxyCodeLine{00349\ \ \ \ \ \ \ stream-\/>send(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{buffs\_cpp}},\ 0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{md}},\ TRANSMIT\_TIMEOUT\_S);}
\DoxyCodeLine{00350\ \ \ \ \ \});}
\DoxyCodeLine{00351\ \ \ \}}
\DoxyCodeLine{00352\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1radio__uhd__tx__stream_a877e375e9e38819603deba5ef1f8cc03}\label{classsrsran_1_1radio__uhd__tx__stream_a877e375e9e38819603deba5ef1f8cc03} 
\index{srsran::radio\_uhd\_tx\_stream@{srsran::radio\_uhd\_tx\_stream}!transmit@{transmit}}
\index{transmit@{transmit}!srsran::radio\_uhd\_tx\_stream@{srsran::radio\_uhd\_tx\_stream}}
\doxysubsubsection{\texorpdfstring{transmit()}{transmit()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} radio\+\_\+uhd\+\_\+tx\+\_\+stream\+::transmit (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1baseband__gateway__buffer__reader}{baseband\+\_\+gateway\+\_\+buffer\+\_\+reader}} \&}]{data,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1baseband__gateway__transmitter__metadata}{baseband\+\_\+gateway\+\_\+transmitter\+\_\+metadata}} \&}]{metadata }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Transmits a set of baseband samples at the time instant provided in the metadata. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em data} & Buffer of baseband samples to transmit. \\
\hline
\mbox{\texttt{ in}}  & {\em metadata} & Additional parameters for transmission. \\
\hline
\end{DoxyParams}
\begin{DoxyRemark}{Remarks}
The data buffers must have the same number of channels as the stream. 
\end{DoxyRemark}


Implements \mbox{\hyperlink{classsrsran_1_1baseband__gateway__transmitter_ac3f8ab3290997985e26afbaec57f8119}{srsran\+::baseband\+\_\+gateway\+\_\+transmitter}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00194\ \{}
\DoxyCodeLine{00195\ \ \ \textcolor{comment}{//\ Protect\ stream\ transmitter.}}
\DoxyCodeLine{00196\ \ \ std::unique\_lock<std::mutex>\ lock(stream\_transmit\_mutex);}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ uhd::tx\_metadata\_t\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uhd\_metadata}};}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_start\_padding}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_md}}.tx\_start.has\_value();}
\DoxyCodeLine{00201\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_end\_padding}}\ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_md}}.tx\_end.has\_value();}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ uhd::time\_spec\_t\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{time\_spec}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{time\_spec}}.from\_ticks(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_md}}.ts,\ srate\_hz);}
\DoxyCodeLine{00204\ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream_a877e375e9e38819603deba5ef1f8cc03}{transmit}};}
\DoxyCodeLine{00205\ \ \ \textcolor{keywordflow}{if}\ (discontinuous\_tx)\ \{}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_start\_padding}})\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ timespec\ to\ the\ start\ of\ the\ actual\ transmission\ if\ there\ is\ head\ padding\ in\ the\ buffer.}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{time\_spec}}\ =}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{time\_spec}}.from\_ticks(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_md}}.ts\ +\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{namespacesrsran_a4057ba65348ba48e6202d60aea8e6235}{baseband\_gateway\_timestamp}}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_md}}.tx\_start.value()),\ srate\_hz);}
\DoxyCodeLine{00210\ \ \ \ \ \}}
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{comment}{//\ Update\ state.}}
\DoxyCodeLine{00212\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream_a877e375e9e38819603deba5ef1f8cc03}{transmit}}\ =\ state\_fsm.\mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream__fsm_a0011309fb1566c196ca2e119f37b4994}{on\_transmit}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uhd\_metadata}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{time\_spec}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_md}}.is\_empty,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_end\_padding}});}
\DoxyCodeLine{00213\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream_a877e375e9e38819603deba5ef1f8cc03}{transmit}}\ =\ state\_fsm.\mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream__fsm_a0011309fb1566c196ca2e119f37b4994}{on\_transmit}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uhd\_metadata}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{time\_spec}},\ \textcolor{keyword}{false},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00215\ \ \ \}}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \textcolor{comment}{//\ Return\ if\ no\ transmission\ is\ required.}}
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classsrsran_1_1radio__uhd__tx__stream_a877e375e9e38819603deba5ef1f8cc03}{transmit}})\ \{}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00220\ \ \ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \textcolor{comment}{//\ Notify\ start\ of\ burst.}}
\DoxyCodeLine{00223\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uhd\_metadata}}.start\_of\_burst)\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description}{radio\_notification\_handler::event\_description}}\ event\_description;}
\DoxyCodeLine{00225\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_a3f49f91a7ca868389088332fd4a16386}{stream\_id}}\ \ =\ stream\_id;}
\DoxyCodeLine{00226\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_a580d960a54861ba14530a9e6ffb077d9}{channel\_id}}\ =\ 0;}
\DoxyCodeLine{00227\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_af4d280f079f4f65848159b4858dd245d}{source}}\ \ \ \ \ =\ \mbox{\hyperlink{classsrsran_1_1radio__notification__handler_1_1event__source_a7f23df937678f1d803ac52f8af7d91b3a149b528ca682d08b0e3789e03d050fd8}{radio\_notification\_handler::event\_source::TRANSMIT}};}
\DoxyCodeLine{00228\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_a1482c13a2ae59d37645e16c95165a630}{type}}\ \ \ \ \ \ \ =\ \mbox{\hyperlink{classsrsran_1_1radio__notification__handler_1_1event__type_ada92c8b313b55717e4f4f4be58a1ab58a1ffc0a168c5d1746f80928dbfe6d0342}{radio\_notification\_handler::event\_type::START\_OF\_BURST}};}
\DoxyCodeLine{00229\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_a795d0b5dda3e26354a1150841b702641}{timestamp}}.\mbox{\hyperlink{classsrsran_1_1optional_ace23a99aaa630fa921abca90844f8bb3}{emplace}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{time\_spec}}.to\_ticks(srate\_hz));}
\DoxyCodeLine{00230\ \ \ \ \ notifier.\mbox{\hyperlink{classsrsran_1_1radio__notification__handler_a8b4a990b42877a8054ac67c85543c541}{on\_radio\_rt\_event}}(event\_description);}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{comment}{//\ Transmit\ zeros\ before\ the\ actual\ transmission\ to\ absorb\ power\ ramping\ effects.}}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keywordflow}{if}\ (discontinuous\_tx)\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ time\ in\ number\ of\ samples\ between\ the\ end\ of\ the\ last\ transmission\ and\ the\ start\ of\ the\ current}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \textcolor{comment}{//\ one.}}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{transmission\_gap}}\ =\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{time\_spec}}\ -\/\ last\_tx\_timespec).\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{to\_ticks}}(srate\_hz);}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ that\ the\ power\ ramping\ padding\ starts\ at\ least\ 10\ microseconds\ after\ the\ last\ transmission\ end.}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{minimum\_gap\_before\_power\_ramping}}\ =\ srate\_hz\ /\ 100000.0;}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_padding\_samples}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ 0;}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{transmission\_gap}}\ >\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{minimum\_gap\_before\_power\_ramping}})\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_padding\_samples}}\ =\ std::min(power\_ramping\_nof\_samples,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{transmission\_gap}}\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{minimum\_gap\_before\_power\_ramping}});}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_padding\_samples}}\ >\ 0)\ \{}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_padding\_sps\_total}}\ =\ 0;}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ uhd::tx\_metadata\_t\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{power\_ramping\_metadata}};}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{power\_ramping\_metadata}}.has\_time\_spec\ \ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{power\_ramping\_metadata}}.start\_of\_burst\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{power\_ramping\_metadata}}.end\_of\_burst\ \ \ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{power\_ramping\_metadata}}.time\_spec\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uhd\_metadata}}.time\_spec\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{time\_spec}}.from\_ticks(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_padding\_samples}},\ srate\_hz);}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Modify\ the\ actual\ trasnmission\ metadata,\ since\ we\ have\ already\ started\ the\ burst\ with\ padding.}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uhd\_metadata}}.start\_of\_burst\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uhd\_metadata}}.has\_time\_spec\ \ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples}}\ =\ 0;}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1baseband__gateway__buffer__reader__view}{baseband\_gateway\_buffer\_reader\_view}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_padding}}\ =}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1baseband__gateway__buffer__reader__view}{baseband\_gateway\_buffer\_reader\_view}}(power\_ramping\_buffer.\mbox{\hyperlink{classsrsran_1_1baseband__gateway__buffer__dynamic_a8559899f828ab9d4ed93e08ce22cd56a}{get\_reader}}(),\ 0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_padding\_samples}});}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!transmit\_block(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_padding}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_padding\_sps\_total}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{power\_ramping\_metadata}}))\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error:\ failed\ transmitting\ power\ ramping\ padding.\ \%s.\(\backslash\)n"{}},\ get\_error\_message().c\_str());}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{power\_ramping\_metadata}}.time\_spec\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples}}\ *\ srate\_hz;}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_padding\_sps\_total}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples}};}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_padding\_sps\_total}}\ <\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_padding\_samples}});}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00273\ \ \ \ \ \}}
\DoxyCodeLine{00274\ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \textcolor{comment}{//\ Notify\ end\ of\ burst.}}
\DoxyCodeLine{00277\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uhd\_metadata}}.end\_of\_burst)\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description}{radio\_notification\_handler::event\_description}}\ event\_description;}
\DoxyCodeLine{00279\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_a3f49f91a7ca868389088332fd4a16386}{stream\_id}}\ \ =\ stream\_id;}
\DoxyCodeLine{00280\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_a580d960a54861ba14530a9e6ffb077d9}{channel\_id}}\ =\ 0;}
\DoxyCodeLine{00281\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_af4d280f079f4f65848159b4858dd245d}{source}}\ \ \ \ \ =\ \mbox{\hyperlink{classsrsran_1_1radio__notification__handler_1_1event__source_a7f23df937678f1d803ac52f8af7d91b3a149b528ca682d08b0e3789e03d050fd8}{radio\_notification\_handler::event\_source::TRANSMIT}};}
\DoxyCodeLine{00282\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_a1482c13a2ae59d37645e16c95165a630}{type}}\ \ \ \ \ \ \ =\ \mbox{\hyperlink{classsrsran_1_1radio__notification__handler_1_1event__type_ada92c8b313b55717e4f4f4be58a1ab58a255d970f7b22582d202136011c492b37}{radio\_notification\_handler::event\_type::END\_OF\_BURST}};}
\DoxyCodeLine{00283\ \ \ \ \ event\_description.\mbox{\hyperlink{structsrsran_1_1radio__notification__handler_1_1event__description_a795d0b5dda3e26354a1150841b702641}{timestamp}}.\mbox{\hyperlink{classsrsran_1_1optional_ace23a99aaa630fa921abca90844f8bb3}{emplace}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{time\_spec}}.to\_ticks(srate\_hz));}
\DoxyCodeLine{00284\ \ \ \ \ notifier.\mbox{\hyperlink{classsrsran_1_1radio__notification__handler_a8b4a990b42877a8054ac67c85543c541}{on\_radio\_rt\_event}}(event\_description);}
\DoxyCodeLine{00285\ \ \ \}}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \textcolor{comment}{//\ Determine\ actual\ transmission\ range.}}
\DoxyCodeLine{00288\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_start}}\ =\ discontinuous\_tx\ \&\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_start\_padding}}\ ?\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_md}}.tx\_start.value()\ :\ 0;}
\DoxyCodeLine{00289\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_nof\_samples}}\ =}
\DoxyCodeLine{00290\ \ \ \ \ \ \ discontinuous\_tx\ \&\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_end\_padding}}\ ?\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_md}}.tx\_end.value()\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_start}}\ :\ data.get\_nof\_samples()\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_start}};}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \textcolor{comment}{//\ Don't\ pass\ the\ transmission\ data\ to\ UHD\ if\ the\ transmit\ buffer\ is\ empty.}}
\DoxyCodeLine{00293\ \ \ \mbox{\hyperlink{classsrsran_1_1baseband__gateway__buffer__reader__view}{baseband\_gateway\_buffer\_reader\_view}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_data}}\ =}
\DoxyCodeLine{00294\ \ \ \ \ \ \ discontinuous\_tx\ \&\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_md}}.is\_empty\ ?\ \mbox{\hyperlink{classsrsran_1_1baseband__gateway__buffer__reader__view}{baseband\_gateway\_buffer\_reader\_view}}(data,\ 0,\ 0)}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classsrsran_1_1baseband__gateway__buffer__reader__view}{baseband\_gateway\_buffer\_reader\_view}}(data,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_start}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{data\_nof\_samples}});}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nsamples}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_data}}.\mbox{\hyperlink{classsrsran_1_1baseband__gateway__buffer__reader__view_a4471be1f5b3f68a86cd60770b0982628}{get\_nof\_samples}}();}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \ \ \textcolor{comment}{//\ Transmit\ stream\ in\ multiple\ blocks.}}
\DoxyCodeLine{00300\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples\_total}}\ =\ 0;}
\DoxyCodeLine{00301\ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples}}\ =\ 0;}
\DoxyCodeLine{00303\ \ \ \ \ \textcolor{keywordflow}{if}\ (!transmit\_block(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tx\_data}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples\_total}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uhd\_metadata}}))\ \{}
\DoxyCodeLine{00304\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error:\ failed\ transmitting\ packet.\ \%s.\(\backslash\)n"{}},\ get\_error\_message().c\_str());}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00306\ \ \ \ \ \}}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{comment}{//\ Increment\ timespec.}}
\DoxyCodeLine{00309\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uhd\_metadata}}.time\_spec\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples}}\ *\ srate\_hz;}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{comment}{//\ Increment\ the\ total\ amount\ of\ received\ samples.}}
\DoxyCodeLine{00312\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples\_total}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples}};}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \}\ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples\_total}}\ <\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nsamples}});}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \ \ last\_tx\_timespec\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{time\_spec}}\ +\ uhd::time\_spec\_t::from\_ticks(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{txd\_samples\_total}},\ srate\_hz);}
\DoxyCodeLine{00317\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1radio__uhd__tx__stream_aaff45befebde956b712a35893c6ebdb0}\label{classsrsran_1_1radio__uhd__tx__stream_aaff45befebde956b712a35893c6ebdb0} 
\index{srsran::radio\_uhd\_tx\_stream@{srsran::radio\_uhd\_tx\_stream}!wait\_stop@{wait\_stop}}
\index{wait\_stop@{wait\_stop}!srsran::radio\_uhd\_tx\_stream@{srsran::radio\_uhd\_tx\_stream}}
\doxysubsubsection{\texorpdfstring{wait\_stop()}{wait\_stop()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} radio\+\_\+uhd\+\_\+tx\+\_\+stream\+::wait\+\_\+stop (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Wait until radio is notify\+\_\+stop. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00355\ \{}
\DoxyCodeLine{00356\ \ \ state\_fsm.wait\_stop();}
\DoxyCodeLine{00357\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/radio/uhd/radio\+\_\+uhd\+\_\+tx\+\_\+stream.\+h\item 
lib/radio/uhd/radio\+\_\+uhd\+\_\+tx\+\_\+stream.\+cpp\end{DoxyCompactItemize}
