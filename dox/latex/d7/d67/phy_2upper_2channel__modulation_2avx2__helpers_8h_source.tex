\doxysection{avx2\+\_\+helpers.\+h}
\hypertarget{phy_2upper_2channel__modulation_2avx2__helpers_8h_source}{}\label{phy_2upper_2channel__modulation_2avx2__helpers_8h_source}\index{lib/phy/upper/channel\_modulation/avx2\_helpers.h@{lib/phy/upper/channel\_modulation/avx2\_helpers.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Copyright\ 2021-\/2024\ Software\ Radio\ Systems\ Limited}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ This\ file\ is\ part\ of\ srsRAN.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ srsRAN\ is\ free\ software:\ you\ can\ redistribute\ it\ and/or\ modify}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ it\ under\ the\ terms\ of\ the\ GNU\ Affero\ General\ Public\ License\ as}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *\ published\ by\ the\ Free\ Software\ Foundation,\ either\ version\ 3\ of}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *\ the\ License,\ or\ (at\ your\ option)\ any\ later\ version.}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *\ srsRAN\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ but\ WITHOUT\ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ MERCHANTABILITY\ or\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ GNU\ Affero\ General\ Public\ License\ for\ more\ details.}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ A\ copy\ of\ the\ GNU\ Affero\ General\ Public\ License\ can\ be\ found\ in}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ the\ LICENSE\ file\ in\ the\ top-\/level\ directory\ of\ this\ distribution}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ and\ at\ http://www.gnu.org/licenses/.}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{pragma}\ \textcolor{preprocessor}{once}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{<}\textcolor{preprocessor}{immintrin}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{namespace}\ \mbox{\hyperlink{namespacesrsran}{srsran}}\ \{}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{namespace}\ mm256\ \{}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{comment}{///\ \(\backslash\)brief\ Absolute\ values.}}
\DoxyCodeLine{00032\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value\ Input\ single-\/precision\ AVX\ register.}}
\DoxyCodeLine{00033\ \textcolor{comment}{///\ \(\backslash\)return\ A\ single-\/precision\ AVX\ register\ with\ the\ absolute\ value.}}
\DoxyCodeLine{00034\ \textcolor{keyword}{inline}\ \_\_m256\ abs\_ps(\_\_m256\ value)}
\DoxyCodeLine{00035\ \{}
\DoxyCodeLine{00036\ \ \ \textcolor{keyword}{const}\ \_\_m256\ mask\ =\ \_mm256\_castsi256\_ps(\_mm256\_set1\_epi32(0x7fffffff));}
\DoxyCodeLine{00037\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_and\_ps(value,\ mask);}
\DoxyCodeLine{00038\ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{comment}{///\ \(\backslash\)brief\ Copy\ sign\ from\ a\ single-\/precision\ AVX\ register.}}
\DoxyCodeLine{00041\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value0\ Single-\/precision\ AVX\ register.}}
\DoxyCodeLine{00042\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value1\ Single-\/precision\ AVX\ register.}}
\DoxyCodeLine{00043\ \textcolor{comment}{///\ \(\backslash\)return\ A\ single-\/precision\ AVX\ register\ with\ the\ magnitudes\ of\ \(\backslash\)c\ value0\ and\ the\ signs\ of\ \(\backslash\)c\ value1.}}
\DoxyCodeLine{00044\ \textcolor{comment}{///\ \(\backslash\)remark\ A\ zero\ in\ the\ second\ argument\ is\ considered\ as\ a\ positive\ number,\ following\ the\ convention\ of\ \(\backslash\)c}}
\DoxyCodeLine{00045\ \textcolor{comment}{///\ std::copysign.}}
\DoxyCodeLine{00046\ \textcolor{keyword}{inline}\ \_\_m256\ copysign\_ps(\_\_m256\ value0,\ \_\_m256\ value1)}
\DoxyCodeLine{00047\ \{}
\DoxyCodeLine{00048\ \ \ \_\_m256\ abs\_value0\ \ =\ abs\_ps(value0);}
\DoxyCodeLine{00049\ \ \ \_\_m256\ sign\_value1\ =\ \_mm256\_and\_ps(value1,\ \_mm256\_set1\_ps(-\/0.0));}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_or\_ps(abs\_value0,\ sign\_value1);}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{comment}{///\ \(\backslash\)brief\ Clips\ the\ values\ of\ a\ single-\/precision\ AVX\ register.}}
\DoxyCodeLine{00054\ \textcolor{comment}{///}}
\DoxyCodeLine{00055\ \textcolor{comment}{///\ The\ values\ greater\ than\ \(\backslash\)c\ range\_ceil\ or\ lower\ than\ \(\backslash\)c\ range\_floor\ are\ substituted\ by\ their\ corresponding\ range}}
\DoxyCodeLine{00056\ \textcolor{comment}{///\ limits.}}
\DoxyCodeLine{00057\ \textcolor{comment}{///}}
\DoxyCodeLine{00058\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value\ \ \ \ \ \ \ Input\ values.}}
\DoxyCodeLine{00059\ \textcolor{comment}{///\ \(\backslash\)param[in]\ range\_ceil\ \ Ceiling\ values.}}
\DoxyCodeLine{00060\ \textcolor{comment}{///\ \(\backslash\)param[in]\ range\_floor\ Floor\ values.}}
\DoxyCodeLine{00061\ \textcolor{comment}{///\ \(\backslash\)return\ A\ single-\/precision\ AVX\ register\ containing\ the\ clipped\ values.}}
\DoxyCodeLine{00062\ \textcolor{keyword}{inline}\ \_\_m256\ clip\_ps(\_\_m256\ value,\ \_\_m256\ range\_ceil,\ \_\_m256\ range\_floor)}
\DoxyCodeLine{00063\ \{}
\DoxyCodeLine{00064\ \ \ value\ =\ \_mm256\_blendv\_ps(value,\ range\_ceil,\ \_mm256\_cmp\_ps(value,\ range\_ceil,\ \_CMP\_GT\_OS));}
\DoxyCodeLine{00065\ \ \ value\ =\ \_mm256\_blendv\_ps(value,\ range\_floor,\ \_mm256\_cmp\_ps(value,\ range\_floor,\ \_CMP\_LT\_OS));}
\DoxyCodeLine{00066\ \ \ \textcolor{keywordflow}{return}\ value;}
\DoxyCodeLine{00067\ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \textcolor{comment}{///\ \(\backslash\)brief\ Clips\ the\ values\ of\ an\ AVX\ register\ carrying\ eight\ signed\ 32-\/bit\ integers.}}
\DoxyCodeLine{00070\ \textcolor{comment}{///}}
\DoxyCodeLine{00071\ \textcolor{comment}{///\ The\ values\ greater\ than\ \(\backslash\)c\ range\_ceil\ or\ lower\ than\ \(\backslash\)c\ range\_floor\ are\ substituted\ by\ their\ corresponding\ range}}
\DoxyCodeLine{00072\ \textcolor{comment}{///\ limits.}}
\DoxyCodeLine{00073\ \textcolor{comment}{///}}
\DoxyCodeLine{00074\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value\ \ \ \ \ \ \ Input\ values.}}
\DoxyCodeLine{00075\ \textcolor{comment}{///\ \(\backslash\)param[in]\ range\_ceil\ \ Ceiling\ values.}}
\DoxyCodeLine{00076\ \textcolor{comment}{///\ \(\backslash\)param[in]\ range\_floor\ Floor\ values.}}
\DoxyCodeLine{00077\ \textcolor{comment}{///\ \(\backslash\)return\ An\ AVX\ register\ containing\ the\ clipped\ values.}}
\DoxyCodeLine{00078\ \textcolor{keyword}{inline}\ \_\_m256i\ clip\_epi32(\_\_m256i\ value,\ \_\_m256i\ range\_ceil,\ \_\_m256i\ range\_floor)}
\DoxyCodeLine{00079\ \{}
\DoxyCodeLine{00080\ \ \ value\ =\ \_mm256\_blendv\_epi8(value,\ range\_ceil,\ \_mm256\_cmpgt\_epi32(value,\ range\_ceil));}
\DoxyCodeLine{00081\ \ \ value\ =\ \_mm256\_blendv\_epi8(value,\ range\_floor,\ \_mm256\_cmpgt\_epi32(range\_floor,\ value));}
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{return}\ value;}
\DoxyCodeLine{00083\ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \textcolor{comment}{///\ \(\backslash\)brief\ Ensures\ that\ 32-\/bit\ integers\ are\ bounded,\ otherwise\ set\ them\ to\ zero.}}
\DoxyCodeLine{00086\ \textcolor{comment}{///}}
\DoxyCodeLine{00087\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value\ \ \ \ \ \ Integers\ to\ be\ tested.}}
\DoxyCodeLine{00088\ \textcolor{comment}{///\ \(\backslash\)param[in]\ bound\_up\ \ \ Upper\ bound.}}
\DoxyCodeLine{00089\ \textcolor{comment}{///\ \(\backslash\)param[in]\ bound\_low\ \ Lower\ bound.}}
\DoxyCodeLine{00090\ \textcolor{comment}{///\ \(\backslash\)return\ The\ input\ integers\ with\ zeros\ in\ place\ of\ the\ out-\/of-\/bound\ values.}}
\DoxyCodeLine{00091\ \textcolor{keyword}{inline}\ \_\_m256i\ check\_bounds\_epi32(\_\_m256i\ value,\ \_\_m256i\ bound\_up,\ \_\_m256i\ bound\_low)}
\DoxyCodeLine{00092\ \{}
\DoxyCodeLine{00093\ \ \ \_\_m256i\ ZEROS\ =\ \_mm256\_set1\_epi8(0);}
\DoxyCodeLine{00094\ \ \ \_\_m256i\ mask\ \ =\ \_mm256\_cmpgt\_epi32(value,\ bound\_up);}
\DoxyCodeLine{00095\ \ \ \textcolor{comment}{//\ Since\ the\ mask\ is\ set\ for\ all\ bytes\ of\ the\ int32\_t\ integers,\ we\ can\ use\ the\ byte-\/wise\ blend.}}
\DoxyCodeLine{00096\ \ \ value\ =\ \_mm256\_blendv\_epi8(value,\ ZEROS,\ mask);}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ mask\ =\ \_mm256\_cmpgt\_epi32(bound\_low,\ value);}
\DoxyCodeLine{00099\ \ \ \textcolor{comment}{//\ Since\ the\ mask\ is\ set\ for\ all\ bytes\ of\ the\ int32\_t\ integers,\ we\ can\ use\ the\ byte-\/wise\ blend.}}
\DoxyCodeLine{00100\ \ \ value\ =\ \_mm256\_blendv\_epi8(value,\ ZEROS,\ mask);}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \textcolor{keywordflow}{return}\ value;}
\DoxyCodeLine{00103\ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \textcolor{comment}{///\ \(\backslash\)brief\ Clips\ and\ quantizes\ four\ single-\/precision\ AVX\ registers,\ continuous\ log-\/likelihood\ ratio\ to\ the\ discrete}}
\DoxyCodeLine{00106\ \textcolor{comment}{///\ representation\ of\ type\ \(\backslash\)c\ log\_likelihood\_ratio\ in\ a\ single\ AVX\ register.}}
\DoxyCodeLine{00107\ \textcolor{comment}{///}}
\DoxyCodeLine{00108\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value\_0\ \ \ \ \ \ Single-\/precision\ AVX\ register\ with\ the\ first\ eight\ continuous\ log-\/likelihood\ ratio.}}
\DoxyCodeLine{00109\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value\_1\ \ \ \ \ \ Single-\/precision\ AVX\ register\ with\ the\ second\ eight\ continuous\ log-\/likelihood\ ratio.}}
\DoxyCodeLine{00110\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value\_2\ \ \ \ \ \ Single-\/precision\ AVX\ register\ with\ the\ third\ eight\ continuous\ log-\/likelihood\ ratio.}}
\DoxyCodeLine{00111\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value\_3\ \ \ \ \ \ Single-\/precision\ AVX\ register\ with\ the\ fourth\ eight\ continuous\ log-\/likelihood\ ratio.}}
\DoxyCodeLine{00112\ \textcolor{comment}{///\ \(\backslash\)param[in]\ range\_limit\ \ The\ input\ value\ mapped\ to\ \(\backslash\)ref\ log\_likelihood\_ratio::max().}}
\DoxyCodeLine{00113\ \textcolor{comment}{///\ \(\backslash\)return\ A\ quantized\ representation\ of\ the\ input\ values\ as\ \(\backslash\)c\ log\_likelihood\_ratio\ quantity.}}
\DoxyCodeLine{00114\ \textcolor{comment}{///\ \(\backslash\)note\ The\ quantization\ in\ the\ range\ <tt>(-\/range\_limit,\ range\_limit)</tt>\ is\ [mid-\/tread}}
\DoxyCodeLine{00115\ \textcolor{comment}{///\ uniform](https://en.wikipedia.org/wiki/Quantization\_(signal\_processing)\#Mid-\/riser\_and\_mid-\/tread\_uniform\_quantizers),}}
\DoxyCodeLine{00116\ \textcolor{comment}{///\ with\ quantization\ step\ <tt>\ range\_limit\ /\ LLR\_MAX\ </tt>.}}
\DoxyCodeLine{00117\ \textcolor{comment}{///\ \(\backslash\)note\ All\ values\ larger\ (in\ magnitude)\ than\ \(\backslash\)c\ range\_limit,\ will\ be\ clipped\ and\ mapped\ to}}
\DoxyCodeLine{00118\ \textcolor{comment}{///\ <tt>\&plusmn;LLR\_MAX</tt>,\ depending\ on\ their\ sign.}}
\DoxyCodeLine{00119\ \textcolor{keyword}{inline}\ \_\_m256i\ quantize\_ps(\_\_m256\ value\_0,\ \_\_m256\ value\_1,\ \_\_m256\ value\_2,\ \_\_m256\ value\_3,\ \textcolor{keywordtype}{float}\ range\_limit)}
\DoxyCodeLine{00120\ \{}
\DoxyCodeLine{00121\ \ \ \textcolor{comment}{//\ Scale.}}
\DoxyCodeLine{00122\ \ \ \_\_m256\ SCALE\ =\ \_mm256\_set1\_ps(\textcolor{keyword}{static\_cast}<\textcolor{keywordtype}{float}>(log\_likelihood\_ratio::max().to\_int())\ /\ range\_limit);}
\DoxyCodeLine{00123\ \ \ value\_0\ \ \ \ \ \ =\ \_mm256\_mul\_ps(value\_0,\ SCALE);}
\DoxyCodeLine{00124\ \ \ value\_1\ \ \ \ \ \ =\ \_mm256\_mul\_ps(value\_1,\ SCALE);}
\DoxyCodeLine{00125\ \ \ value\_2\ \ \ \ \ \ =\ \_mm256\_mul\_ps(value\_2,\ SCALE);}
\DoxyCodeLine{00126\ \ \ value\_3\ \ \ \ \ \ =\ \_mm256\_mul\_ps(value\_3,\ SCALE);}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \textcolor{comment}{//\ Clip\ and\ round\ to\ the\ nearest\ integer.}}
\DoxyCodeLine{00129\ \ \ \_\_m256\ RANGE\_CEIL\ \ =\ \_mm256\_set1\_ps(log\_likelihood\_ratio::max().to\_int());}
\DoxyCodeLine{00130\ \ \ \_\_m256\ RANGE\_FLOOR\ =\ \_mm256\_set1\_ps(log\_likelihood\_ratio::min().to\_int());}
\DoxyCodeLine{00131\ \ \ value\_0\ \ \ \ \ \ \ \ \ \ \ \ =\ \_mm256\_round\_ps(clip\_ps(value\_0,\ RANGE\_CEIL,\ RANGE\_FLOOR),\ \_MM\_FROUND\_NINT);}
\DoxyCodeLine{00132\ \ \ value\_1\ \ \ \ \ \ \ \ \ \ \ \ =\ \_mm256\_round\_ps(clip\_ps(value\_1,\ RANGE\_CEIL,\ RANGE\_FLOOR),\ \_MM\_FROUND\_NINT);}
\DoxyCodeLine{00133\ \ \ value\_2\ \ \ \ \ \ \ \ \ \ \ \ =\ \_mm256\_round\_ps(clip\_ps(value\_2,\ RANGE\_CEIL,\ RANGE\_FLOOR),\ \_MM\_FROUND\_NINT);}
\DoxyCodeLine{00134\ \ \ value\_3\ \ \ \ \ \ \ \ \ \ \ \ =\ \_mm256\_round\_ps(clip\_ps(value\_3,\ RANGE\_CEIL,\ RANGE\_FLOOR),\ \_MM\_FROUND\_NINT);}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \textcolor{comment}{//\ Convert\ to\ 32\ bit.}}
\DoxyCodeLine{00137\ \ \ \_\_m256i\ llr\_i32\_0\ =\ \_mm256\_cvtps\_epi32(value\_0);}
\DoxyCodeLine{00138\ \ \ \_\_m256i\ llr\_i32\_1\ =\ \_mm256\_cvtps\_epi32(value\_1);}
\DoxyCodeLine{00139\ \ \ \_\_m256i\ llr\_i32\_2\ =\ \_mm256\_cvtps\_epi32(value\_2);}
\DoxyCodeLine{00140\ \ \ \_\_m256i\ llr\_i32\_3\ =\ \_mm256\_cvtps\_epi32(value\_3);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \textcolor{comment}{//\ Check\ bounds\ one\ more\ time:\ if\ value\_X\ contains\ a\ NaN,\ its\ casting\ to\ int32\_t\ is\ indeterminate\ -\/\ set\ it\ to\ zero.}}
\DoxyCodeLine{00143\ \ \ \_\_m256i\ BOUND\_UP\ \ =\ \_mm256\_set1\_epi32(log\_likelihood\_ratio::max().to\_int());}
\DoxyCodeLine{00144\ \ \ \_\_m256i\ BOUND\_LOW\ =\ \_mm256\_set1\_epi32(log\_likelihood\_ratio::min().to\_int());}
\DoxyCodeLine{00145\ \ \ llr\_i32\_0\ \ \ \ \ \ \ \ \ =\ check\_bounds\_epi32(llr\_i32\_0,\ BOUND\_UP,\ BOUND\_LOW);}
\DoxyCodeLine{00146\ \ \ llr\_i32\_1\ \ \ \ \ \ \ \ \ =\ check\_bounds\_epi32(llr\_i32\_1,\ BOUND\_UP,\ BOUND\_LOW);}
\DoxyCodeLine{00147\ \ \ llr\_i32\_2\ \ \ \ \ \ \ \ \ =\ check\_bounds\_epi32(llr\_i32\_2,\ BOUND\_UP,\ BOUND\_LOW);}
\DoxyCodeLine{00148\ \ \ llr\_i32\_3\ \ \ \ \ \ \ \ \ =\ check\_bounds\_epi32(llr\_i32\_3,\ BOUND\_UP,\ BOUND\_LOW);}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \textcolor{comment}{//\ Re-\/collocate\ SSE\ registers.}}
\DoxyCodeLine{00151\ \ \ \_\_m256i\ llr\_i32\_0\_\ =\ \_mm256\_permute2f128\_si256(llr\_i32\_0,\ llr\_i32\_1,\ 0x20);}
\DoxyCodeLine{00152\ \ \ \_\_m256i\ llr\_i32\_1\_\ =\ \_mm256\_permute2f128\_si256(llr\_i32\_0,\ llr\_i32\_1,\ 0x31);}
\DoxyCodeLine{00153\ \ \ \_\_m256i\ llr\_i32\_2\_\ =\ \_mm256\_permute2f128\_si256(llr\_i32\_2,\ llr\_i32\_3,\ 0x20);}
\DoxyCodeLine{00154\ \ \ \_\_m256i\ llr\_i32\_3\_\ =\ \_mm256\_permute2f128\_si256(llr\_i32\_2,\ llr\_i32\_3,\ 0x31);}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \textcolor{comment}{//\ Conversion\ to\ 16\ bit.}}
\DoxyCodeLine{00157\ \ \ \_\_m256i\ llr\_i16\_0\ =\ \_mm256\_packs\_epi32(llr\_i32\_0\_,\ llr\_i32\_1\_);}
\DoxyCodeLine{00158\ \ \ \_\_m256i\ llr\_i16\_1\ =\ \_mm256\_packs\_epi32(llr\_i32\_2\_,\ llr\_i32\_3\_);}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \textcolor{comment}{//\ Re-\/collocate\ SSE\ registers.}}
\DoxyCodeLine{00161\ \ \ \_\_m256i\ llr\_i16\_0\_\ =\ \_mm256\_permute2f128\_si256(llr\_i16\_0,\ llr\_i16\_1,\ 0x20);}
\DoxyCodeLine{00162\ \ \ \_\_m256i\ llr\_i16\_1\_\ =\ \_mm256\_permute2f128\_si256(llr\_i16\_0,\ llr\_i16\_1,\ 0x31);}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \textcolor{comment}{//\ Conversion\ to\ 8\ bit.}}
\DoxyCodeLine{00165\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_packs\_epi16(llr\_i16\_0\_,\ llr\_i16\_1\_);}
\DoxyCodeLine{00166\ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \textcolor{comment}{///\ \(\backslash\)brief\ Helper\ function\ to\ calculate\ an\ interval\ index\ from\ single-\/precision\ AVX\ register\ values.}}
\DoxyCodeLine{00169\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value\ \ \ \ \ \ \ \ \ \ Input\ AVX\ register.}}
\DoxyCodeLine{00170\ \textcolor{comment}{///\ \(\backslash\)param[in]\ interval\_width\ Interval\ width.}}
\DoxyCodeLine{00171\ \textcolor{comment}{///\ \(\backslash\)param[in]\ nof\_intervals\ \ Number\ of\ intervals.}}
\DoxyCodeLine{00172\ \textcolor{comment}{///\ \(\backslash\)return\ An\ AVX\ register\ carrying\ eight\ signed\ 32-\/bit\ integers\ with\ the\ corresponding\ interval\ indexes.}}
\DoxyCodeLine{00173\ \textcolor{keyword}{inline}\ \_\_m256i\ compute\_interval\_idx(\_\_m256\ value,\ \textcolor{keywordtype}{float}\ interval\_width,\ \textcolor{keywordtype}{int}\ nof\_intervals)}
\DoxyCodeLine{00174\ \{}
\DoxyCodeLine{00175\ \ \ \textcolor{comment}{//\ Scale.}}
\DoxyCodeLine{00176\ \ \ value\ =\ \_mm256\_mul\_ps(value,\ \_mm256\_set1\_ps(1.0F\ /\ interval\_width));}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \textcolor{comment}{//\ Round\ to\ the\ lowest\ integer.}}
\DoxyCodeLine{00179\ \ \ value\ =\ \_mm256\_round\_ps(value,\ \_MM\_FROUND\_FLOOR);}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \textcolor{comment}{//\ Convert\ to\ int32.}}
\DoxyCodeLine{00182\ \ \ \_\_m256i\ idx\ =\ \_mm256\_cvtps\_epi32(value);}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \textcolor{comment}{//\ Add\ interval\ offset.}}
\DoxyCodeLine{00185\ \ \ idx\ =\ \_mm256\_add\_epi32(idx,\ \_mm256\_set1\_epi32(nof\_intervals\ /\ 2));}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \textcolor{comment}{//\ Clip\ index.}}
\DoxyCodeLine{00188\ \ \ idx\ =\ clip\_epi32(idx,\ \_mm256\_set1\_epi32(nof\_intervals\ -\/\ 1),\ \_mm256\_setzero\_si256());}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \textcolor{comment}{//\ Clip\ integer\ and\ return.}}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{return}\ idx;}
\DoxyCodeLine{00192\ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \textcolor{comment}{///\ \(\backslash\)brief\ Get\ values\ from\ a\ look-\/up\ table.}}
\DoxyCodeLine{00195\ \textcolor{comment}{///\ \(\backslash\)param[in]\ table\ \ \ Look-\/up\ table\ containing\ eight\ single-\/precision\ values.}}
\DoxyCodeLine{00196\ \textcolor{comment}{///\ \(\backslash\)param[in]\ indexes\ AVX\ register\ containing\ eight\ indexes.}}
\DoxyCodeLine{00197\ \textcolor{comment}{///\ \(\backslash\)return\ A\ single-\/precision\ AVX\ register\ containing\ the\ eight\ values\ corresponding\ to\ the\ indexes.}}
\DoxyCodeLine{00198\ \textcolor{keyword}{inline}\ \_\_m256\ look\_up\_table(\textcolor{keyword}{const}\ std::array<\textcolor{keywordtype}{float},\ 8>\&\ table,\ \_\_m256i\ indexes)}
\DoxyCodeLine{00199\ \{}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_permutevar8x32\_ps(\_mm256\_loadu\_ps(table.data()),\ indexes);}
\DoxyCodeLine{00201\ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \textcolor{comment}{///\ \(\backslash\)brief\ Get\ values\ from\ a\ look-\/up\ table.}}
\DoxyCodeLine{00204\ \textcolor{comment}{///\ \(\backslash\)param[in]\ table\ \ \ Look-\/up\ table\ containing\ sixteen\ single-\/precision\ values.}}
\DoxyCodeLine{00205\ \textcolor{comment}{///\ \(\backslash\)param[in]\ indexes\ AVX\ register\ containing\ eight\ indexes.}}
\DoxyCodeLine{00206\ \textcolor{comment}{///\ \(\backslash\)return\ A\ single-\/precision\ AVX\ register\ containing\ the\ eight\ values\ corresponding\ to\ the\ indexes.}}
\DoxyCodeLine{00207\ \textcolor{keyword}{inline}\ \_\_m256\ look\_up\_table(\textcolor{keyword}{const}\ std::array<\textcolor{keywordtype}{float},\ 16>\&\ table,\ \_\_m256i\ indexes)}
\DoxyCodeLine{00208\ \{}
\DoxyCodeLine{00209\ \ \ \textcolor{comment}{//\ Get\ lower\ part\ of\ the\ table.}}
\DoxyCodeLine{00210\ \ \ \_\_m256\ lower\ =\ \_mm256\_permutevar8x32\_ps(\_mm256\_loadu\_ps(table.data()),\ indexes);}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \textcolor{comment}{//\ Get\ upper\ part\ of\ the\ table.}}
\DoxyCodeLine{00213\ \ \ \_\_m256\ upper\ =\ \_mm256\_permutevar8x32\_ps(\_mm256\_loadu\_ps(table.data()\ +\ 8),\ indexes);}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \textcolor{comment}{//\ Generate\ mask.\ Set\ to\ true\ if\ the\ MSB\ of\ the\ index\ is\ greater\ than\ zero.}}
\DoxyCodeLine{00216\ \ \ \_\_m256i\ mask\ =\ \_mm256\_cmpgt\_epi32(indexes,\ \_mm256\_set1\_epi32(0b111));}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \textcolor{comment}{//\ Select\ upper\ or\ lower\ value.}}
\DoxyCodeLine{00219\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_blendv\_ps(lower,\ upper,\ (\_\_m256)mask);}
\DoxyCodeLine{00220\ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \textcolor{comment}{///\ \(\backslash\)brief\ Applies\ an\ interval\ function\ to\ a\ series\ of\ values.}}
\DoxyCodeLine{00223\ \textcolor{comment}{///\ \(\backslash\)tparam\ Table\ \ \ \ \ \ \ \ \ \ \ \ \ Look-\/up\ table\ type.\ All\ tables\ mut\ be\ of\ the\ same\ type.}}
\DoxyCodeLine{00224\ \textcolor{comment}{///\ \(\backslash\)param[in]\ value\ \ \ \ \ \ \ \ \ \ Single-\/precision\ AVX\ register\ with\ eight\ input\ values.}}
\DoxyCodeLine{00225\ \textcolor{comment}{///\ \(\backslash\)param[in]\ rcp\_noise\ \ \ \ \ \ Single-\/precision\ AVX\ register\ with\ the\ reciprocal\ noise\ corresponding\ to\ the\ values.}}
\DoxyCodeLine{00226\ \textcolor{comment}{///\ \(\backslash\)param[in]\ nof\_intervals\ \ Number\ of\ intervals.}}
\DoxyCodeLine{00227\ \textcolor{comment}{///\ \(\backslash\)param[in]\ interval\_width\ Interval\ width\ to\ quantify\ the\ interval\ indexes.}}
\DoxyCodeLine{00228\ \textcolor{comment}{///\ \(\backslash\)param[in]\ slopes\ \ \ \ \ \ \ \ \ Table\ with\ the\ slope\ of\ each\ interval.}}
\DoxyCodeLine{00229\ \textcolor{comment}{///\ \(\backslash\)param[in]\ intercepts\ \ \ \ \ Table\ with\ the\ interception\ points\ of\ each\ interval.}}
\DoxyCodeLine{00230\ \textcolor{comment}{///\ \(\backslash\)return\ A\ single-\/precision\ AVX\ register\ containing\ the\ results\ of\ the\ interval\ function.}}
\DoxyCodeLine{00231\ \textcolor{comment}{///\ \(\backslash\)remark\ The\ number\ of\ intervals\ must\ be\ lower\ than\ or\ equal\ to\ \(\backslash\)c\ Table\ size.}}
\DoxyCodeLine{00232\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Table>}
\DoxyCodeLine{00233\ \textcolor{keyword}{inline}\ \_\_m256\ interval\_function(\_\_m256\ \ \ \ \ \ \ value,}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_\_m256\ \ \ \ \ \ \ rcp\_noise,}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ \ \ \ \ \ \ \ interval\_width,}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \ \ \ \ nof\_intervals,}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Table\&\ slopes,}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Table\&\ intercepts)}
\DoxyCodeLine{00239\ \{}
\DoxyCodeLine{00240\ \ \ \_\_m256i\ interval\_index\ =\ mm256::compute\_interval\_idx(value,\ interval\_width,\ nof\_intervals);}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \_\_m256\ slope\ \ \ \ \ =\ mm256::look\_up\_table(slopes,\ interval\_index);}
\DoxyCodeLine{00243\ \ \ \_\_m256\ intercept\ =\ mm256::look\_up\_table(intercepts,\ interval\_index);}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_mul\_ps(\_mm256\_add\_ps(\_mm256\_mul\_ps(slope,\ value),\ intercept),\ rcp\_noise);}
\DoxyCodeLine{00246\ \}}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \textcolor{comment}{///\ \(\backslash\)brief\ Safe\ division.}}
\DoxyCodeLine{00249\ \textcolor{comment}{///}}
\DoxyCodeLine{00250\ \textcolor{comment}{///\ \(\backslash\)return\ <tt>dividend\ /\ divisor</tt>\ if\ \(\backslash\)c\ divisor\ is\ greater\ than\ zero,\ \(\backslash\)c\ 0\ otherwise.}}
\DoxyCodeLine{00251\ \textcolor{keyword}{inline}\ \_\_m256\ safe\_div(\_\_m256\ dividend,\ \_\_m256\ divisor)}
\DoxyCodeLine{00252\ \{}
\DoxyCodeLine{00253\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \_\_m256\ all\_zero\ =\ \_mm256\_setzero\_ps();}
\DoxyCodeLine{00254\ \ \ \textcolor{comment}{//\ \_CMP\_GT\_OQ:\ compare\ greater\ than,\ ordered\ (nan\ is\ false)\ and\ quite\ (no\ exceptions\ raised).}}
\DoxyCodeLine{00255\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{if}\ \textcolor{preprocessor}{defined}\textcolor{preprocessor}{(}\textcolor{preprocessor}{\_\_AVX512F\_\_}\textcolor{preprocessor}{)}\ \textcolor{preprocessor}{\&\&}\ \textcolor{preprocessor}{defined}\textcolor{preprocessor}{(}\textcolor{preprocessor}{\_\_AVX512VL\_\_}\textcolor{preprocessor}{)}}
\DoxyCodeLine{00256\ \ \ \_\_mmask8\ mask\ =\ \_mm256\_cmp\_ps\_mask(divisor,\ all\_zero,\ \_CMP\_GT\_OQ);}
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_maskz\_div\_ps(mask,\ dividend,\ divisor);}
\DoxyCodeLine{00258\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{else}}
\DoxyCodeLine{00259\ \ \ \_\_m256\ mask\ \ \ =\ \_mm256\_cmp\_ps(divisor,\ all\_zero,\ \_CMP\_GT\_OQ);}
\DoxyCodeLine{00260\ \ \ \_\_m256\ result\ =\ \_mm256\_div\_ps(dividend,\ divisor);}
\DoxyCodeLine{00261\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_blendv\_ps(all\_zero,\ result,\ mask);}
\DoxyCodeLine{00262\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{endif}}
\DoxyCodeLine{00263\ \}}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \}\ \textcolor{comment}{//\ namespace\ mm256}}
\DoxyCodeLine{00266\ \}\ \textcolor{comment}{//\ namespace\ srsran}}

\end{DoxyCode}
