\doxysection{srsran\+::ssb\+\_\+scheduler Class Reference}
\hypertarget{classsrsran_1_1ssb__scheduler}{}\label{classsrsran_1_1ssb__scheduler}\index{srsran::ssb\_scheduler@{srsran::ssb\_scheduler}}


Collaboration diagram for srsran\+::ssb\+\_\+scheduler\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=196pt]{db/d9a/classsrsran_1_1ssb__scheduler__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1ssb__scheduler_a322878a22c8aea8d332621e5e1dec49b}{ssb\+\_\+scheduler}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1cell__configuration}{cell\+\_\+configuration}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cfg\+\_\+}})
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ssb__scheduler_abb5bdddf271195e8451e12728073560d}{run\+\_\+slot}} (\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator}{cell\+\_\+resource\+\_\+allocator}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{res\+\_\+allocator}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1slot__point}{slot\+\_\+point}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sl\+\_\+point}})
\begin{DoxyCompactList}\small\item\em Schedule grant(s) for SSB. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ssb__scheduler_a87f39c689bd5523dc304bc3361447ccf}{schedule\+\_\+ssb}} (\mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\+\_\+slot\+\_\+resource\+\_\+allocator}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\+\_\+allocator}})
\begin{DoxyCompactList}\small\item\em Schedule grant for SSB. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1ssb__scheduler_a322878a22c8aea8d332621e5e1dec49b}\label{classsrsran_1_1ssb__scheduler_a322878a22c8aea8d332621e5e1dec49b} 
\index{srsran::ssb\_scheduler@{srsran::ssb\_scheduler}!ssb\_scheduler@{ssb\_scheduler}}
\index{ssb\_scheduler@{ssb\_scheduler}!srsran::ssb\_scheduler@{srsran::ssb\_scheduler}}
\doxysubsubsection{\texorpdfstring{ssb\_scheduler()}{ssb\_scheduler()}}
{\footnotesize\ttfamily ssb\+\_\+scheduler\+::ssb\+\_\+scheduler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1cell__configuration}{cell\+\_\+configuration}} \&}]{cfg\+\_\+ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00031\ \ \ cell\_cfg(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cfg\_}}),\ logger(srslog::fetch\_basic\_logger(\textcolor{stringliteral}{"{}SCHED"{}}))}
\DoxyCodeLine{00032\ \{}
\DoxyCodeLine{00033\ \ \ ssb\_period\ =\ \mbox{\hyperlink{namespacesrsran_aef1093c4104acd5c53f60c41afea8b13}{ssb\_periodicity\_to\_value}}(cell\_cfg.ssb\_cfg.\mbox{\hyperlink{structsrsran_1_1ssb__configuration_a5a506461ac7bebfc2ee44697cbd3e04a}{ssb\_period}});}
\DoxyCodeLine{00034\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1ssb__scheduler_abb5bdddf271195e8451e12728073560d}\label{classsrsran_1_1ssb__scheduler_abb5bdddf271195e8451e12728073560d} 
\index{srsran::ssb\_scheduler@{srsran::ssb\_scheduler}!run\_slot@{run\_slot}}
\index{run\_slot@{run\_slot}!srsran::ssb\_scheduler@{srsran::ssb\_scheduler}}
\doxysubsubsection{\texorpdfstring{run\_slot()}{run\_slot()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} ssb\+\_\+scheduler\+::run\+\_\+slot (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator}{cell\+\_\+resource\+\_\+allocator}} \&}]{res\+\_\+allocator,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1slot__point}{slot\+\_\+point}} \&}]{sl\+\_\+point }\end{DoxyParamCaption})}



Schedule grant(s) for SSB. 

The functions schedules the SSB according to a given periodicity, depending on the frequency and SSB case for up to N slots when run for first time. In subsequent runs schedules SSB on N + 1 slot.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em res\+\_\+allocator} & Cell resource grid. \\
\hline
\mbox{\texttt{ in}}  & {\em sl\+\_\+point} & Slot point carrying information about current slot.\\
\hline
\end{DoxyParams}
\begin{DoxyRemark}{Remarks}
This function only works for FR1, or L\+\_\+max = 4 or 8. 
\end{DoxyRemark}

\begin{DoxyCode}{0}
\DoxyCodeLine{00037\ \{}
\DoxyCodeLine{00038\ \ \ \textcolor{comment}{//\ Only\ FR1\ are\ supported\ in\ this\ implementation.}}
\DoxyCodeLine{00039\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{freq\_arfcn}}\ =\ cell\_cfg.\mbox{\hyperlink{classsrsran_1_1cell__configuration_a1e568d8f825fe6ca58264c2f0e6e0af4}{dl\_carrier}}.\mbox{\hyperlink{structsrsran_1_1carrier__configuration_af29be6b1dec86469590752458495670c}{arfcn}};}
\DoxyCodeLine{00040\ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{freq\_arfcn}}\ <\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classuint32__t}{uint32\_t}}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_af94a07f1ac035ad487b12798f348fca8}{FR1\_MAX\_FREQUENCY\_ARFCN}}),}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Frenquencies\ in\ the\ range\ FR2\ not\ supported"{}});}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{if}\ (first\_run\_slot)\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ssb\_period\_slots}}\ =\ ssb\_period\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sl\_point}}.nof\_slots\_per\_subframe();}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{comment}{//\ First\ call\ to\ run\_slot.\ Schedule\ SSBs\ when\ relevant\ across\ cell\ resource\ grid.}}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ i\ =\ 0;\ i\ <\ res\_alloc.max\_dl\_slot\_alloc\_delay\ +\ 1;\ i\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ssb\_period\_slots}})\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1ssb__scheduler_a87f39c689bd5523dc304bc3361447ccf}{schedule\_ssb}}(res\_alloc[i]);}
\DoxyCodeLine{00048\ \ \ \ \ \}}
\DoxyCodeLine{00049\ \ \ \ \ first\_run\_slot\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00050\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{comment}{//\ Schedule\ SSB\ in\ last\ scheduled\ slot\ +\ 1\ slot\ if\ relevant.}}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1ssb__scheduler_a87f39c689bd5523dc304bc3361447ccf}{schedule\_ssb}}(res\_alloc[res\_alloc.max\_dl\_slot\_alloc\_delay]);}
\DoxyCodeLine{00053\ \ \ \}}
\DoxyCodeLine{00054\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ssb__scheduler_a87f39c689bd5523dc304bc3361447ccf}\label{classsrsran_1_1ssb__scheduler_a87f39c689bd5523dc304bc3361447ccf} 
\index{srsran::ssb\_scheduler@{srsran::ssb\_scheduler}!schedule\_ssb@{schedule\_ssb}}
\index{schedule\_ssb@{schedule\_ssb}!srsran::ssb\_scheduler@{srsran::ssb\_scheduler}}
\doxysubsubsection{\texorpdfstring{schedule\_ssb()}{schedule\_ssb()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} ssb\+\_\+scheduler\+::schedule\+\_\+ssb (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\+\_\+slot\+\_\+resource\+\_\+allocator}} \&}]{slot\+\_\+allocator }\end{DoxyParamCaption})}



Schedule grant for SSB. 

The functions schedules the SSB per slot according to a given periodicity, depending on the frequency and SSB case.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em slot\+\_\+allocator} & Slot allocator object with SSB grants and DL PRBs.\\
\hline
\end{DoxyParams}
\begin{DoxyRemark}{Remarks}
This function only works for FR1, or L\+\_\+max = 4 or 8. 
\end{DoxyRemark}

\begin{DoxyCode}{0}
\DoxyCodeLine{00057\ \{}
\DoxyCodeLine{00058\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1slot__point}{slot\_point}}\&\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sl\_point}}\ =\ res\_grid.slot;}
\DoxyCodeLine{00059\ \ \ \mbox{\hyperlink{classsrsran_1_1static__vector}{ssb\_information\_list}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ssb\_list}}\ =\ res\_grid.result.dl.bc.ssb\_info;}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ssb\_list}}.full())\ \{}
\DoxyCodeLine{00062\ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}Failed\ to\ allocate\ SSB"{}});}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00064\ \ \ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \textcolor{comment}{//\ Perform\ mod\ operation\ of\ slot\ index\ by\ ssb\_periodicity;}}
\DoxyCodeLine{00067\ \ \ \textcolor{comment}{//\ "{}ssb\_periodicity\ *\ nof\_slots\_per\_subframe"{}\ gives\ the\ number\ of\ slots\ in\ 1\ ssb\_periodicity\ time\ interval.}}
\DoxyCodeLine{00068\ \ \ \mbox{\hyperlink{classsrsran_1_1slot__point}{slot\_point}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sl\_point\_mod}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sl\_point}}.numerology(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sl\_point}}.to\_uint()\ \%\ (ssb\_period\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sl\_point}}.nof\_slots\_per\_subframe()));}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \textcolor{comment}{//\ Select\ SSB\ case\ with\ reference\ to\ TS\ 38.213,\ Section\ 4.1.}}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{switch}\ (cell\_cfg.ssb\_case)\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{namespacesrsran_a4b8eb97251264b1aee7123a8765e1d3ea7fc56270e7a70fa81a5935b72eacbe29}{ssb\_pattern\_case::A}}:}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{namespacesrsran_a4b8eb97251264b1aee7123a8765e1d3ea0d61f8370cad1d412f80b84d143e1257}{ssb\_pattern\_case::C}}:\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \mbox{\hyperlink{classuint32__t}{uint32\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ssb\_cut\_off\_freq}}\ =}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ cell\_cfg.paired\_spectrum\ ?\ \mbox{\hyperlink{namespacesrsran_a065d4c6baebff478fcda521f9f0f6585}{CUTOFF\_FREQ\_ARFCN\_CASE\_A\_B\_C}}\ :\ \mbox{\hyperlink{namespacesrsran_a5fa437bea795a8c16c23ba5cd8152d2e}{CUTOFF\_FREQ\_ARFCN\_CASE\_C\_UNPAIRED}};}
\DoxyCodeLine{00076\ \ \ \ \ \ \ ssb\_alloc\_case\_A\_C(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ssb\_list}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ssb\_cut\_off\_freq}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sl\_point\_mod}});}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00078\ \ \ \ \ \}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{namespacesrsran_a4b8eb97251264b1aee7123a8765e1d3ea9d5ed678fe57bcca610140957afab571}{ssb\_pattern\_case::B}}:}
\DoxyCodeLine{00080\ \ \ \ \ \ \ ssb\_alloc\_case\_B(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ssb\_list}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sl\_point\_mod}});}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00083\ \ \ \ \ \ \ srsran\_assert(cell\_cfg.ssb\_case\ <\ \mbox{\hyperlink{namespacesrsran_a4b8eb97251264b1aee7123a8765e1d3eafedb2d84cafe20862cb4399751a8a7e3}{ssb\_pattern\_case::invalid}},\ \textcolor{stringliteral}{"{}Only\ SSB\ case\ A,\ B\ and\ C\ are\ currently\ supported"{}});}
\DoxyCodeLine{00084\ \ \ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \textcolor{comment}{//\ Update\ the\ used\ DL\ PRBs\ with\ those\ allocated\ to\ the\ SSBs.}}
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ ssb\ :\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ssb\_list}})\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{comment}{//\ TODO:\ In\ case,\ SSB\ SCS\ !=\ init\ DL\ BWP\ SCS,\ we\ should\ do\ an\ adaptation\ of\ symbols\ and\ CRBs\ to\ the\ numerology}}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ of\ the\ latter.}}
\DoxyCodeLine{00090\ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1grant__info}{grant\_info}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}}\{cell\_cfg.dl\_cfg\_common.init\_dl\_bwp.generic\_params.scs,\ ssb.symbols,\ ssb.crbs\};}
\DoxyCodeLine{00091\ \ \ \ \ res\_grid.dl\_res\_grid.fill(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant}});}
\DoxyCodeLine{00092\ \ \ \}}
\DoxyCodeLine{00093\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/scheduler/common\+\_\+scheduling/ssb\+\_\+scheduler.\+h\item 
lib/scheduler/common\+\_\+scheduling/ssb\+\_\+scheduler.\+cpp\end{DoxyCompactItemize}
