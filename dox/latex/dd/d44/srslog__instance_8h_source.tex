\doxysection{srslog\+\_\+instance.\+h}
\hypertarget{srslog__instance_8h_source}{}\label{srslog__instance_8h_source}\index{lib/srslog/srslog\_instance.h@{lib/srslog/srslog\_instance.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Copyright\ 2021-\/2024\ Software\ Radio\ Systems\ Limited}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ This\ file\ is\ part\ of\ srsRAN.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ srsRAN\ is\ free\ software:\ you\ can\ redistribute\ it\ and/or\ modify}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ it\ under\ the\ terms\ of\ the\ GNU\ Affero\ General\ Public\ License\ as}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *\ published\ by\ the\ Free\ Software\ Foundation,\ either\ version\ 3\ of}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *\ the\ License,\ or\ (at\ your\ option)\ any\ later\ version.}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *\ srsRAN\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ but\ WITHOUT\ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ MERCHANTABILITY\ or\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ GNU\ Affero\ General\ Public\ License\ for\ more\ details.}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ A\ copy\ of\ the\ GNU\ Affero\ General\ Public\ License\ can\ be\ found\ in}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ the\ LICENSE\ file\ in\ the\ top-\/level\ directory\ of\ this\ distribution}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ and\ at\ http://www.gnu.org/licenses/.}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{pragma}\ \textcolor{preprocessor}{once}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}formatters/text\_formatter.h"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{log__backend__impl_8h}{"{}log\_backend\_impl.h"{}}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{object__repository_8h}{"{}object\_repository.h"{}}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}sinks/stream\_sink.h"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/srslog/log\_channel.h"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/srslog/sink\_repository.h"{}}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{namespace}\ srslog\ \{}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{comment}{///\ Singleton\ of\ the\ framework\ containing\ all\ the\ required\ classes.}}
\DoxyCodeLine{00035\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrslog_1_1srslog__instance}{srslog\_instance}}\ :\ \textcolor{keyword}{public}\ sink\_repository}
\DoxyCodeLine{00036\ \{}
\DoxyCodeLine{00037\ \ \ srslog\_instance()}
\DoxyCodeLine{00038\ \ \ \{}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{comment}{//\ stdout\ and\ stderr\ sinks\ are\ always\ present.}}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{auto}\&\ stdout\_sink\ =}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ sink\_repo.emplace(std::piecewise\_construct,}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::forward\_as\_tuple(\textcolor{stringliteral}{"{}stdout"{}}),}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::forward\_as\_tuple(\textcolor{keyword}{new}\ stream\_sink(sink\_stream\_type::stdout,}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<log\_formatter>(\textcolor{keyword}{new}\ text\_formatter))));}
\DoxyCodeLine{00045\ \ \ \ \ default\_sink\ =\ stdout\_sink.get();}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ sink\_repo.emplace(std::piecewise\_construct,}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::forward\_as\_tuple(\textcolor{stringliteral}{"{}stderr"{}}),}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::forward\_as\_tuple(\textcolor{keyword}{new}\ stream\_sink(sink\_stream\_type::stderr,}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<log\_formatter>(\textcolor{keyword}{new}\ text\_formatter))));}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{comment}{//\ Initialize\ the\ default\ formatter\ pointer\ with\ a\ text\ formatter.}}
\DoxyCodeLine{00053\ \ \ \ \ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrslog_1_1detail}{detail}}::\mbox{\hyperlink{classsrslog_1_1detail_1_1scoped__lock}{scoped\_lock}}\ lock(formatter\_mutex);}
\DoxyCodeLine{00055\ \ \ \ \ \ \ default\_formatter\ =\ std::unique\_ptr<log\_formatter>(\textcolor{keyword}{new}\ text\_formatter);}
\DoxyCodeLine{00056\ \ \ \ \ \}}
\DoxyCodeLine{00057\ \ \ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00060\ \ \ srslog\_instance(\textcolor{keyword}{const}\ \mbox{\hyperlink{classsrslog_1_1srslog__instance}{srslog\_instance}}\&\ other)\ \ \ \ \ \ \ \ \ \ \ \ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00061\ \ \ \mbox{\hyperlink{classsrslog_1_1srslog__instance}{srslog\_instance}}\&\ operator=(\textcolor{keyword}{const}\ \mbox{\hyperlink{classsrslog_1_1srslog__instance}{srslog\_instance}}\&\ other)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \textcolor{comment}{///\ Access\ function\ to\ the\ singleton\ instance.}}
\DoxyCodeLine{00064\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classsrslog_1_1srslog__instance}{srslog\_instance}}\&\ \mbox{\hyperlink{classsrslog_1_1srslog__instance_a6b144da95f02598fd19c10f1c11dc7d4}{get}}()}
\DoxyCodeLine{00065\ \ \ \{}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classsrslog_1_1srslog__instance}{srslog\_instance}}\ instance;}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordflow}{return}\ instance;}
\DoxyCodeLine{00068\ \ \ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \textcolor{comment}{///\ Logger\ repository\ accessor.}}
\DoxyCodeLine{00071\ \ \ \textcolor{keyword}{using}\ logger\_repo\_type\ =\ \mbox{\hyperlink{classsrslog_1_1object__repository}{object\_repository}}<std::string,\ \mbox{\hyperlink{namespacesrslog_1_1detail}{detail}}::\mbox{\hyperlink{classsrslog_1_1detail_1_1any}{any}}>;}
\DoxyCodeLine{00072\ \ \ logger\_repo\_type\&\ \ \ \ \ \ \ get\_logger\_repo()\ \{\ \textcolor{keywordflow}{return}\ logger\_repo;\ \}}
\DoxyCodeLine{00073\ \ \ \textcolor{keyword}{const}\ logger\_repo\_type\&\ get\_logger\_repo()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ logger\_repo;\ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \textcolor{comment}{///\ Log\ channel\ repository\ accessor.}}
\DoxyCodeLine{00076\ \ \ \textcolor{keyword}{using}\ channel\_repo\_type\ =\ \mbox{\hyperlink{classsrslog_1_1object__repository}{object\_repository}}<std::string,\ \mbox{\hyperlink{classsrslog_1_1log__channel}{log\_channel}}>;}
\DoxyCodeLine{00077\ \ \ channel\_repo\_type\&\ \ \ \ \ \ \ get\_channel\_repo()\ \{\ \textcolor{keywordflow}{return}\ channel\_repo;\ \}}
\DoxyCodeLine{00078\ \ \ \textcolor{keyword}{const}\ channel\_repo\_type\&\ get\_channel\_repo()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ channel\_repo;\ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \textcolor{comment}{///\ Sink\ repository\ accessor.}}
\DoxyCodeLine{00081\ \ \ \textcolor{keyword}{using}\ \mbox{\hyperlink{classsrslog_1_1srslog__instance}{sink\_repo\_type}}\ =\ \mbox{\hyperlink{classsrslog_1_1srslog__instance}{object\_repository}}<\mbox{\hyperlink{classsrslog_1_1srslog__instance}{std}}::\mbox{\hyperlink{classsrslog_1_1srslog__instance}{string}},\ \mbox{\hyperlink{classsrslog_1_1srslog__instance}{std}}::\mbox{\hyperlink{classsrslog_1_1srslog__instance}{unique\_ptr}}<\mbox{\hyperlink{classsrslog_1_1srslog__instance}{sink}}>>;}
\DoxyCodeLine{00082\ \ \ sink\_repo\_type\&\ \ \ \ \ \ \ get\_sink\_repo()\ \{\ \textcolor{keywordflow}{return}\ sink\_repo;\ \}}
\DoxyCodeLine{00083\ \ \ \textcolor{keyword}{const}\ sink\_repo\_type\&\ get\_sink\_repo()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ sink\_repo;\ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \textcolor{comment}{///\ Backend\ accessor.}}
\DoxyCodeLine{00086\ \ \ \mbox{\hyperlink{namespacesrslog_1_1detail}{detail}}::\mbox{\hyperlink{classsrslog_1_1detail_1_1log__backend}{log\_backend}}\&\ \ \ \ \ \ \ \mbox{\hyperlink{classsrslog_1_1srslog__instance_aa19dd0b32c2f4d55342320a6a130a5b5}{get\_backend}}()\ \{\ \textcolor{keywordflow}{return}\ backend;\ \}}
\DoxyCodeLine{00087\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesrslog_1_1detail}{detail}}::\mbox{\hyperlink{classsrslog_1_1detail_1_1log__backend}{log\_backend}}\&\ get\_backend()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ backend;\ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \textcolor{comment}{///\ Installs\ the\ specified\ error\ handler\ into\ the\ backend.}}
\DoxyCodeLine{00090\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrslog_1_1srslog__instance_aa82dd9ebd8a40c7ba868a6f6d138efd1}{set\_error\_handler}}(error\_handler\ callback)\ \{\ backend.set\_error\_handler(std::move(callback));\ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \textcolor{comment}{///\ Set\ the\ specified\ sink\ as\ the\ default\ one.}}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrslog_1_1srslog__instance_a3a38c15d68e7121787425ec998ee3ee7}{set\_default\_sink}}(\mbox{\hyperlink{classsrslog_1_1sink}{sink}}\&\ s)\ \{\ default\_sink\ =\ \&s;\ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \textcolor{comment}{///\ Returns\ the\ default\ sink.}}
\DoxyCodeLine{00096\ \ \ \mbox{\hyperlink{classsrslog_1_1sink}{sink}}\&\ \mbox{\hyperlink{classsrslog_1_1srslog__instance_a0729088a871bb627429df5c51a7e2ba7}{get\_default\_sink}}()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ *default\_sink;\ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \textcolor{comment}{///\ Set\ the\ specified\ formatter\ as\ the\ default\ one.}}
\DoxyCodeLine{00099\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrslog_1_1srslog__instance_ab6742b8508816486a54e11a8714af99c}{set\_default\_formatter}}(std::unique\_ptr<log\_formatter>\ f)}
\DoxyCodeLine{00100\ \ \ \{}
\DoxyCodeLine{00101\ \ \ \ \ \mbox{\hyperlink{namespacesrslog_1_1detail}{detail}}::\mbox{\hyperlink{classsrslog_1_1detail_1_1scoped__lock}{scoped\_lock}}\ lock(formatter\_mutex);}
\DoxyCodeLine{00102\ \ \ \ \ default\_formatter\ =\ std::move(f);}
\DoxyCodeLine{00103\ \ \ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{///\ Returns\ the\ default\ formatter.}}
\DoxyCodeLine{00106\ \ \ \mbox{\hyperlink{classsrslog_1_1srslog__instance_a0784f691d86678f1c5c5f1ebdae51fea}{std}}::\mbox{\hyperlink{classsrslog_1_1srslog__instance_a0784f691d86678f1c5c5f1ebdae51fea}{unique\_ptr}}<\mbox{\hyperlink{classsrslog_1_1srslog__instance_a0784f691d86678f1c5c5f1ebdae51fea}{log\_formatter}}>\ \mbox{\hyperlink{classsrslog_1_1srslog__instance_a0784f691d86678f1c5c5f1ebdae51fea}{get\_default\_formatter}}()\ \textcolor{keyword}{const}}
\DoxyCodeLine{00107\ \ \ \{}
\DoxyCodeLine{00108\ \ \ \ \ \mbox{\hyperlink{namespacesrslog_1_1detail}{detail}}::\mbox{\hyperlink{classsrslog_1_1detail_1_1scoped__lock}{scoped\_lock}}\ lock(formatter\_mutex);}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordflow}{return}\ default\_formatter-\/>clone();}
\DoxyCodeLine{00110\ \ \ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \mbox{\hyperlink{classsrslog_1_1srslog__instance_ae13203e66821eed9b878ebe752c5cbb7}{std}}::\mbox{\hyperlink{classsrslog_1_1srslog__instance_ae13203e66821eed9b878ebe752c5cbb7}{vector}}<\mbox{\hyperlink{classsrslog_1_1srslog__instance_ae13203e66821eed9b878ebe752c5cbb7}{sink}}*>\ \mbox{\hyperlink{classsrslog_1_1srslog__instance_ae13203e66821eed9b878ebe752c5cbb7}{contents}}()\ \textcolor{keyword}{override}}
\DoxyCodeLine{00113\ \ \ \{}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keyword}{auto}\ temp\_contents\ =\ sink\_repo.contents();}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ std::vector<sink*>\ contents;}
\DoxyCodeLine{00117\ \ \ \ \ contents.reserve(temp\_contents.size());}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ elem\ :\ temp\_contents)\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ contents.push\_back(elem-\/>get());}
\DoxyCodeLine{00120\ \ \ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordflow}{return}\ contents;}
\DoxyCodeLine{00123\ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00126\ \ \ \textcolor{comment}{///\ NOTE:\ The\ order\ of\ declaration\ of\ each\ member\ is\ important\ here\ for\ proper}}
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{///\ destruction.}}
\DoxyCodeLine{00128\ \ \ sink\_repo\_type\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sink\_repo;}
\DoxyCodeLine{00129\ \ \ log\_backend\_impl\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ backend\{*\textcolor{keyword}{this}\};}
\DoxyCodeLine{00130\ \ \ channel\_repo\_type\ \ \ \ \ \ \ \ \ \ \ \ \ \ channel\_repo;}
\DoxyCodeLine{00131\ \ \ logger\_repo\_type\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ logger\_repo;}
\DoxyCodeLine{00132\ \ \ \mbox{\hyperlink{namespacesrslog_1_1detail}{detail}}::\mbox{\hyperlink{classsrslog_1_1detail_1_1shared__variable}{shared\_variable}}<\mbox{\hyperlink{classsrslog_1_1sink}{sink}}*>\ default\_sink\{\textcolor{keywordtype}{nullptr}\};}
\DoxyCodeLine{00133\ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{namespacesrslog_1_1detail}{detail}}::\mbox{\hyperlink{classsrslog_1_1detail_1_1mutex}{mutex}}\ \ \ \ \ \ \ \ \ \ formatter\_mutex;}
\DoxyCodeLine{00134\ \ \ std::unique\_ptr<log\_formatter>\ default\_formatter;}
\DoxyCodeLine{00135\ \};}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \}\ \textcolor{comment}{//\ namespace\ srslog}}

\end{DoxyCode}
