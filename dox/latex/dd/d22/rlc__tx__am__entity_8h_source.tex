\doxysection{rlc\+\_\+tx\+\_\+am\+\_\+entity.\+h}
\hypertarget{rlc__tx__am__entity_8h_source}{}\label{rlc__tx__am__entity_8h_source}\index{lib/rlc/rlc\_tx\_am\_entity.h@{lib/rlc/rlc\_tx\_am\_entity.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Copyright\ 2021-\/2024\ Software\ Radio\ Systems\ Limited}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ This\ file\ is\ part\ of\ srsRAN.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ srsRAN\ is\ free\ software:\ you\ can\ redistribute\ it\ and/or\ modify}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ it\ under\ the\ terms\ of\ the\ GNU\ Affero\ General\ Public\ License\ as}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *\ published\ by\ the\ Free\ Software\ Foundation,\ either\ version\ 3\ of}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *\ the\ License,\ or\ (at\ your\ option)\ any\ later\ version.}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *\ srsRAN\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ but\ WITHOUT\ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ MERCHANTABILITY\ or\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ GNU\ Affero\ General\ Public\ License\ for\ more\ details.}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ A\ copy\ of\ the\ GNU\ Affero\ General\ Public\ License\ can\ be\ found\ in}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ the\ LICENSE\ file\ in\ the\ top-\/level\ directory\ of\ this\ distribution}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ and\ at\ http://www.gnu.org/licenses/.}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{pragma}\ \textcolor{preprocessor}{once}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{rlc__am__interconnect_8h}{"{}rlc\_am\_interconnect.h"{}}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{rlc__am__pdu_8h}{"{}rlc\_am\_pdu.h"{}}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{rlc__pdu__recycler_8h}{"{}rlc\_pdu\_recycler.h"{}}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{rlc__retx__queue_8h}{"{}rlc\_retx\_queue.h"{}}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{rlc__sdu__queue__lockfree_8h}{"{}rlc\_sdu\_queue\_lockfree.h"{}}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \mbox{\hyperlink{rlc__tx__entity_8h}{"{}rlc\_tx\_entity.h"{}}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/support/executors/task\_executor.h"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/support/sdu\_window.h"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/support/timers.h"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}fmt/format.h"{}}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{namespace}\ \mbox{\hyperlink{namespacesrsran}{srsran}}\ \{}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{comment}{///\ Container\ to\ hold\ a\ SDU\ for\ transmission,\ the\ progress\ in\ case\ of\ segmentation,\ and\ associated\ meta\ data}}
\DoxyCodeLine{00039\ \textcolor{keyword}{struct}\ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__sdu__info}{rlc\_tx\_am\_sdu\_info}}\ \{}
\DoxyCodeLine{00040\ \ \ \mbox{\hyperlink{classsrsran_1_1byte__buffer}{byte\_buffer}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sdu\ =\ \{\};}
\DoxyCodeLine{00041\ \ \ std::chrono::system\_clock::time\_point\ time\_of\_arrival;}
\DoxyCodeLine{00042\ \ \ \mbox{\hyperlink{classsrsran_1_1optional}{optional}}<uint32\_t>\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdcp\_sn;}
\DoxyCodeLine{00043\ \ \ uint32\_t\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ next\_so\ \ \ \ =\ 0;}
\DoxyCodeLine{00044\ \ \ uint32\_t\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ retx\_count\ =\ \mbox{\hyperlink{namespacesrsran_acea2ff23187308de439123dce2c7edfe}{RETX\_COUNT\_NOT\_STARTED}};}
\DoxyCodeLine{00045\ \};}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{comment}{///\ \(\backslash\)brief\ TX\ state\ variables}}
\DoxyCodeLine{00048\ \textcolor{comment}{///\ Ref:\ 3GPP\ TS\ 38.322\ version\ 16.2.0\ Section\ 7.1}}
\DoxyCodeLine{00049\ \textcolor{keyword}{struct}\ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state}{rlc\_tx\_am\_state}}\ \{}
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ TX\_Next\_Ack\ –\ Acknowledgement\ state\ variable}}
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{///\ It\ holds\ the\ value\ of\ the\ SN\ of\ the\ next\ RLC\ SDU\ for\ which\ a\ positive\ acknowledgment\ is\ to\ be\ received}}
\DoxyCodeLine{00052\ \ \ \textcolor{comment}{///\ in-\/sequence,\ and\ it\ serves\ as\ the\ lower\ edge\ of\ the\ transmitting\ window.\ It\ is\ initially\ set\ to\ 0,\ and\ is}}
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{///\ updated\ whenever\ the\ AM\ RLC\ entity\ receives\ a\ positive\ acknowledgment\ for\ an\ RLC\ SDU\ with\ SN\ =\ TX\_Next\_Ack.}}
\DoxyCodeLine{00054\ \ \ uint32\_t\ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a6c1488e36449c9f9ac0c8dd369768a56}{tx\_next\_ack}}\ =\ 0;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ \ TX\_Next\ –\ AM\ send\ state\ variable}}
\DoxyCodeLine{00057\ \ \ \textcolor{comment}{///\ It\ holds\ the\ value\ of\ the\ SN\ to\ be\ assigned\ for\ the\ next\ newly\ generated\ AMD\ PDU.\ It\ is}}
\DoxyCodeLine{00058\ \ \ \textcolor{comment}{///\ initially\ set\ to\ 0,\ and\ is\ updated\ whenever\ the\ AM\ RLC\ entity\ constructs\ an\ AMD\ PDU}}
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{///\ with\ SN\ =\ TX\_Next\ and\ contains\ an\ RLC\ SDU\ or\ the\ last\ segment\ of\ a\ RLC\ SDU.}}
\DoxyCodeLine{00060\ \ \ uint32\_t\ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a8afd76c4255ae07376ad530e4a0af3fe}{tx\_next}}\ =\ 0;}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ POLL\_SN\ –\ Poll\ send\ state\ variable}}
\DoxyCodeLine{00063\ \ \ \textcolor{comment}{///\ It\ holds\ the\ value\ of\ the\ highest\ SN\ of\ the\ AMD\ PDU\ among\ the\ AMD\ PDUs\ submitted\ to\ lower\ layer\ when\ POLL\_SN\ is}}
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{///\ set\ according\ to\ sub\ clause\ 5.3.3.2.\ It\ is\ initially\ set\ to\ 0.}}
\DoxyCodeLine{00065\ \ \ uint32\_t\ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a92f1c0516ab5a0c69ffb84dac79fb547}{poll\_sn}}\ =\ 0;}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ PDU\_WITHOUT\_POLL\ –\ Counter}}
\DoxyCodeLine{00068\ \ \ \textcolor{comment}{///\ This\ counter\ is\ initially\ set\ to\ 0.\ It\ counts\ the\ number\ of\ AMD\ PDUs\ sent\ since\ the\ most\ recent\ poll\ bit\ was}}
\DoxyCodeLine{00069\ \ \ \textcolor{comment}{///\ transmitted.}}
\DoxyCodeLine{00070\ \ \ uint32\_t\ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a1fe4038eb48d43f3f270c99adc34e062}{pdu\_without\_poll}}\ =\ 0;}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ BYTE\_WITHOUT\_POLL\ –\ Counter}}
\DoxyCodeLine{00073\ \ \ \textcolor{comment}{///\ This\ counter\ is\ initially\ set\ to\ 0.\ It\ counts\ the\ number\ of\ data\ bytes\ sent\ since\ the\ most\ recent\ poll\ bit\ was}}
\DoxyCodeLine{00074\ \ \ \textcolor{comment}{///\ transmitted.}}
\DoxyCodeLine{00075\ \ \ uint32\_t\ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_ad8cf1bf9fa17def7d77ace344cf50b06}{byte\_without\_poll}}\ =\ 0;}
\DoxyCodeLine{00076\ \};}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity}{rlc\_tx\_am\_entity}}\ :\ \textcolor{keyword}{public}\ rlc\_tx\_entity,\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__status__handler}{rlc\_tx\_am\_status\_handler}},\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__status__notifier}{rlc\_tx\_am\_status\_notifier}}}
\DoxyCodeLine{00079\ \{}
\DoxyCodeLine{00080\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00081\ \ \ \textcolor{comment}{//\ Config\ storage}}
\DoxyCodeLine{00082\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config}{rlc\_tx\_am\_config}}\ cfg;}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \textcolor{comment}{//\ Status\ interface}}
\DoxyCodeLine{00085\ \ \ \mbox{\hyperlink{classsrsran_1_1rlc__rx__am__status__provider}{rlc\_rx\_am\_status\_provider}}*\ status\_provider\ =\ \textcolor{keywordtype}{nullptr};}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{comment}{//\ TX\ state\ variables}}
\DoxyCodeLine{00088\ \ \ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state}{rlc\_tx\_am\_state}}\ st;}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \textcolor{comment}{//\ TX\ SDU\ buffers}}
\DoxyCodeLine{00091\ \ \ \mbox{\hyperlink{classsrsran_1_1rlc__sdu__queue__lockfree}{rlc\_sdu\_queue\_lockfree}}\ sdu\_queue;}
\DoxyCodeLine{00092\ \ \ uint32\_t\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sn\_under\_segmentation\ =\ \mbox{\hyperlink{namespacesrsran_a7330c0b829cb3d3717bb70ab14ec3e3c}{INVALID\_RLC\_SN}};\ \textcolor{comment}{//\ SN\ of\ the\ SDU\ currently\ being\ segmented}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \textcolor{comment}{//\ RETX\ buffers}}
\DoxyCodeLine{00095\ \ \ \mbox{\hyperlink{classsrsran_1_1rlc__retx__queue}{rlc\_retx\_queue}}\ retx\_queue;}
\DoxyCodeLine{00096\ \ \ uint32\_t\ \ \ \ \ \ \ retx\_sn\ =\ \mbox{\hyperlink{namespacesrsran_a7330c0b829cb3d3717bb70ab14ec3e3c}{INVALID\_RLC\_SN}};\ \textcolor{comment}{//\ SN\ of\ the\ most\ recent\ ReTx\ since\ last\ status\ report}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \textcolor{comment}{//\ Mutexes}}
\DoxyCodeLine{00099\ \ \ std::mutex\ mutex;}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \textcolor{comment}{///\ TX\ counter\ modulus}}
\DoxyCodeLine{00102\ \ \ \textcolor{keyword}{const}\ uint32\_t\ \ \ \ \ mod;}
\DoxyCodeLine{00103\ \ \ \textcolor{keyword}{constexpr}\ uint32\_t\ tx\_mod\_base(uint32\_t\ x)\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ (x\ -\/\ st\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a6c1488e36449c9f9ac0c8dd369768a56}{.}}\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a6c1488e36449c9f9ac0c8dd369768a56}{tx\_next\_ack}})\ \%\ mod;\ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{///\ AM\ window\ size}}
\DoxyCodeLine{00106\ \ \ \textcolor{keyword}{const}\ uint32\_t\ am\_window\_size;}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{comment}{///\ TX\ window}}
\DoxyCodeLine{00109\ \ \ std::unique\_ptr<sdu\_window<rlc\_tx\_am\_sdu\_info>>\ tx\_window;}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \textcolor{comment}{///\ Recycler\ for\ discarded\ PDUs\ (from\ tx\_window)\ that\ shall\ be\ deleted\ by\ a\ different\ executor\ off\ the\ critical\ path}}
\DoxyCodeLine{00112\ \ \ rlc\_pdu\_recycler\ pdu\_recycler;}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \textcolor{comment}{//\ Header\ sizes\ are\ computed\ upon\ construction\ based\ on\ SN\ length}}
\DoxyCodeLine{00115\ \ \ \textcolor{keyword}{const}\ uint32\_t\ head\_min\_size;}
\DoxyCodeLine{00116\ \ \ \textcolor{keyword}{const}\ uint32\_t\ head\_max\_size;}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ t-\/PollRetransmit}}
\DoxyCodeLine{00119\ \ \ \textcolor{comment}{///\ This\ timer\ is\ used\ by\ the\ transmitting\ side\ of\ an\ AM\ RLC\ entity\ in\ order\ to\ retransmit\ a\ poll\ (see\ sub}}
\DoxyCodeLine{00120\ \ \ \textcolor{comment}{///\ clause\ 5.3.3).}}
\DoxyCodeLine{00121\ \ \ \textcolor{comment}{///\ Ref:\ TS\ 38.322\ Sec.\ 7.3}}
\DoxyCodeLine{00122\ \ \ \mbox{\hyperlink{classsrsran_1_1unique__timer}{unique\_timer}}\ \ \ \ \ \ poll\_retransmit\_timer;}
\DoxyCodeLine{00123\ \ \ std::atomic<\textcolor{keywordtype}{bool}>\ is\_poll\_retransmit\_timer\_expired;}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \mbox{\hyperlink{classsrsran_1_1task__executor}{task\_executor}}\&\ pcell\_executor;}
\DoxyCodeLine{00126\ \ \ \mbox{\hyperlink{classsrsran_1_1task__executor}{task\_executor}}\&\ ue\_executor;}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \mbox{\hyperlink{structsrsran_1_1pcap__rlc__pdu__context}{pcap\_rlc\_pdu\_context}}\ pcap\_context;}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \textcolor{comment}{//\ Storage\ for\ previous\ buffer\ state}}
\DoxyCodeLine{00131\ \ \ \textcolor{keywordtype}{unsigned}\ prev\_buffer\_state\ =\ 0;}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \textcolor{comment}{///\ This\ atomic\_flag\ indicates\ whether\ a\ buffer\ state\ update\ task\ has\ been\ queued\ but\ not\ yet\ run\ by\ pcell\_executor.}}
\DoxyCodeLine{00134\ \ \ \textcolor{comment}{///\ It\ helps\ to\ avoid\ queuing\ of\ redundant\ notification\ tasks\ in\ case\ of\ frequent\ changes\ of\ the\ buffer\ status.}}
\DoxyCodeLine{00135\ \ \ \textcolor{comment}{///\ If\ the\ flag\ is\ set,\ no\ further\ notification\ needs\ to\ be\ scheduled,\ because\ the\ already\ queued\ task\ will\ pick\ the}}
\DoxyCodeLine{00136\ \ \ \textcolor{comment}{///\ latest\ buffer\ state\ upon\ execution.}}
\DoxyCodeLine{00137\ \ \ std::atomic\_flag\ pending\_buffer\_state\ =\ ATOMIC\_FLAG\_INIT;}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00140\ \ \ rlc\_tx\_am\_entity(uint32\_t\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ du\_index,}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a511ed22603607d4a784c0f1807648b47}{du\_ue\_index\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_index,}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1rb__id__t}{rb\_id\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rb\_id,}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config}{rlc\_tx\_am\_config}}\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ config,}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__notifier}{rlc\_tx\_upper\_layer\_data\_notifier}}\&\ \ \ \ upper\_dn\_,}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__control__notifier}{rlc\_tx\_upper\_layer\_control\_notifier}}\&\ upper\_cn\_,}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__notifier}{rlc\_tx\_lower\_layer\_notifier}}\&\ \ \ \ \ \ \ \ \ lower\_dn\_,}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1timer__factory}{timer\_factory}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ timers,}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1task__executor}{task\_executor}}\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pcell\_executor\_,}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1task__executor}{task\_executor}}\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_executor\_,}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ metrics\_enabled\_,}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1rlc__pcap}{rlc\_pcap}}\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pcap\_);}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \textcolor{comment}{//\ TX/RX\ interconnect}}
\DoxyCodeLine{00154\ \ \ \textcolor{keywordtype}{void}\ set\_status\_provider(\mbox{\hyperlink{classsrsran_1_1rlc__rx__am__status__provider}{rlc\_rx\_am\_status\_provider}}*\ status\_provider\_)\ \{\ status\_provider\ =\ status\_provider\_;\ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \textcolor{comment}{//\ Interfaces\ for\ higher\ layers}}
\DoxyCodeLine{00157\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_aefd48f6a90b1f4de6f701feea72d50b9}{handle\_sdu}}(\mbox{\hyperlink{structsrsran_1_1rlc__sdu}{rlc\_sdu}}\ sdu)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00158\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a9cfef999318ce4118427cfe154c28e49}{discard\_sdu}}(uint32\_t\ pdcp\_sn)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \textcolor{comment}{//\ Interfaces\ for\ lower\ layers}}
\DoxyCodeLine{00161\ \ \ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_aae545ee2d475205ef89cefae7931cbab}{size\_t}}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_aae545ee2d475205ef89cefae7931cbab}{pull\_pdu}}(\mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_aae545ee2d475205ef89cefae7931cbab}{span}}<\mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_aae545ee2d475205ef89cefae7931cbab}{uint8\_t}}>\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_aae545ee2d475205ef89cefae7931cbab}{rlc\_pdu\_buf}})\ \textcolor{keyword}{override};}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ uint32\_t\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_ac610ab8a5e2fd8da6bfcf7e5007988a7}{get\_buffer\_state}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \textcolor{comment}{//\ Status\ handler\ interface}}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_ae730ee9d83bf14c7ff3d4e1e377da8df}{on\_status\_pdu}}(\mbox{\hyperlink{classsrsran_1_1rlc__am__status__pdu}{rlc\_am\_status\_pdu}}\ status)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00167\ \ \ \textcolor{comment}{//\ Status\ notifier\ interface}}
\DoxyCodeLine{00168\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a274119bec2d36e23f0f1adfcd65fe8df}{on\_status\_report\_changed}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Determines\ whether\ the\ polling\ bit\ in\ a\ PDU\ header\ has\ to\ be\ set\ or\ not}}
\DoxyCodeLine{00171\ \ \ \textcolor{comment}{///\ Ref:\ TS\ 38.322,\ Sec.\ 5.3.3.2}}
\DoxyCodeLine{00172\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ sn\ Sequence\ number\ of\ PDU\ to\ be\ transmitted}}
\DoxyCodeLine{00173\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ is\_retx\ Flags\ whether\ this\ PDU\ is\ a\ retransmission\ or\ not}}
\DoxyCodeLine{00174\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ payload\_size\ Length\ of\ the\ data\ field\ mapped\ to\ the\ AMD\ PDU}}
\DoxyCodeLine{00175\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ 1\ if\ the\ polling\ bit\ has\ to\ be\ set,\ otherwise\ 0}}
\DoxyCodeLine{00176\ \ \ uint8\_t\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a2bba6bbf36fd7f28fd9aeb624fa3f085}{get\_polling\_bit}}(uint32\_t\ sn,\ \textcolor{keywordtype}{bool}\ is\_retx,\ uint32\_t\ payload\_size);}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \textcolor{comment}{//\ Timers}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ on\_expired\_poll\_retransmit\_timer\ Handler\ for\ expired\ poll\_retransmit\_timer}}
\DoxyCodeLine{00181\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00182\ \ \ \textcolor{comment}{///\ Note:\ This\ function\ shall\ be\ executed\ by\ the\ same\ executor\ that\ calls\ pull\_pdu(),\ i.e.\ the\ pcell\_executor,}}
\DoxyCodeLine{00183\ \ \ \textcolor{comment}{///\ in\ order\ to\ avoid\ incidential\ blocking\ of\ those\ critical\ paths.}}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a398c38e0e19f66404a5627757628615e}{on\_expired\_poll\_retransmit\_timer}}();}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \textcolor{comment}{//\ Window\ helpers}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Checks\ if\ a\ sequence\ number\ is\ inside\ the\ TX\ window}}
\DoxyCodeLine{00189\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ sn\ Sequence\ Number\ to\ check}}
\DoxyCodeLine{00190\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ true\ if\ sn\ is\ inside\ the\ TX\ window,\ false\ otherwise}}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_ad14e9baeb52141c5d802dd39f8b1c0fc}{inside\_tx\_window}}(uint32\_t\ sn)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Checks\ if\ the\ TX\ window\ is\ currently\ full.}}
\DoxyCodeLine{00194\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00195\ \ \ \textcolor{comment}{///\ Note\ "{}full"{}\ may\ be\ smaller\ than\ the\ full\ window\ size\ to\ try\ to\ limit}}
\DoxyCodeLine{00196\ \ \ \textcolor{comment}{///\ memory\ usage.\ A\ virtual\ full\ window\ configuration\ parameter\ can\ be\ used}}
\DoxyCodeLine{00197\ \ \ \textcolor{comment}{///\ to\ avoid\ many\ UEs\ with\ 2\string^18\ windows\ full\ of\ PDUs.}}
\DoxyCodeLine{00198\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00199\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ true\ if\ the\ window\ is\ full.}}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_adc069ac771957d3729e8573efb49cd4c}{is\_tx\_window\_full}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ This\ function\ is\ used\ to\ check\ if\ a\ received\ status\ report\ as\ a\ valid\ ACK\_SN.}}
\DoxyCodeLine{00203\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00204\ \ \ \textcolor{comment}{///\ ACK\_SN\ may\ be\ equal\ to\ TX\_NEXT\ +\ AM\_Window\_Size\ if\ the\ PDU\ with\ SN=TX\_NEXT+AM\_Window\_Size\ has\ been\ received\ by\ the}}
\DoxyCodeLine{00205\ \ \ \textcolor{comment}{///\ RX\ An\ ACK\_SN\ ==\ Tx\_Next\_Ack\ doesn't\ ACK\ or\ NACKs\ any\ PDUs,\ as\ such,\ such\ a\ status\ report\ can\ be\ discarded.}}
\DoxyCodeLine{00206\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00207\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ sn\ Sequence\ Number\ to\ check}}
\DoxyCodeLine{00208\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ true\ if\ sn\ is\ valid,\ false\ otherwise}}
\DoxyCodeLine{00209\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_ac53a40aec1318896858134351fa92342}{valid\_ack\_sn}}(uint32\_t\ sn)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ This\ function\ is\ used\ to\ check\ if\ a\ received\ NACK\ within\ a\ status\ report\ is\ valid.}}
\DoxyCodeLine{00212\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00213\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ ack\_sn\ ACK\_SN\ of\ status\ report}}
\DoxyCodeLine{00214\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ nack\ NACK\ to\ check\ validity\ of}}
\DoxyCodeLine{00215\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ true\ if\ NACK\ is\ valid,\ false\ otherwise}}
\DoxyCodeLine{00216\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a4e69c79d75db0e3b54f569a69a4022f0}{valid\_nack}}(uint32\_t\ ack\_sn,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1rlc__am__status__nack}{rlc\_am\_status\_nack}}\&\ nack\_sn)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00217\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00218\ \textcolor{comment}{\ \ \ *\ Testing\ helpers}}
\DoxyCodeLine{00219\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \textcolor{comment}{///\ Set\ the\ internal\ state\ variables}}
\DoxyCodeLine{00222\ \ \ \textcolor{comment}{///\ Note:\ This\ function\ should\ only\ be\ used\ for\ testing}}
\DoxyCodeLine{00223\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00224\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ st\_\ The\ state\ variables\ to\ be\ set}}
\DoxyCodeLine{00225\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a3d2de9e02babb81d2dc715f8a0e7ea94}{set\_state}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state}{rlc\_tx\_am\_state}}\&\ st\_)\ \{\ \textcolor{keyword}{this}-\/>st\ =\ st\_;\ \}}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \textcolor{comment}{///\ Get\ the\ internal\ state\ variables}}
\DoxyCodeLine{00228\ \ \ \textcolor{comment}{///\ Note:\ This\ function\ should\ only\ be\ used\ for\ testing}}
\DoxyCodeLine{00229\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00230\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ A\ copy\ of\ the\ internal\ state\ variables}}
\DoxyCodeLine{00231\ \ \ \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state}{rlc\_tx\_am\_state}}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a0ff975bf2fd8655389c38483c2234fe2}{get\_state}}()\ \{\ \textcolor{keywordflow}{return}\ st;\ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00234\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Builds\ a\ new\ RLC\ PDU.}}
\DoxyCodeLine{00235\ \ \ \textcolor{comment}{///\ This\ will\ be\ called\ after\ checking\ whether\ control,\ retransmission,}}
\DoxyCodeLine{00236\ \ \ \textcolor{comment}{///\ or\ segment\ PDUs\ needed\ to\ be\ transmitted\ first.}}
\DoxyCodeLine{00237\ \ \ \textcolor{comment}{///\ It\ will\ read\ an\ SDU\ from\ the\ SDU\ queue,\ build\ a\ new\ PDU,\ and\ add\ it\ to\ the\ tx\_window.}}
\DoxyCodeLine{00238\ \ \ \textcolor{comment}{///\ SDU\ segmentation\ is\ applied\ if\ necessary.}}
\DoxyCodeLine{00239\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00240\ \ \ \textcolor{comment}{///\ No\ PDU\ is\ written\ if\ the\ size\ of\ \(\backslash\)c\ rlc\_pdu\_buf\ is\ insufficient\ or\ the\ TX\ buffer\ is\ empty.}}
\DoxyCodeLine{00241\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00242\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ rlc\_pdu\_buf\ TX\ buffer\ where\ to\ encode\ an\ RLC\ Tx\ PDU.\ The\ encoded\ PDU\ size\ cannot\ exceed\ the\ size\ of\ the}}
\DoxyCodeLine{00243\ \ \ \textcolor{comment}{///\ buffer.}}
\DoxyCodeLine{00244\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ Number\ of\ bytes\ taken\ by\ the\ written\ RLC\ PDU.}}
\DoxyCodeLine{00245\ \ \ size\_t\ build\_new\_pdu(span<uint8\_t>\ rlc\_pdu\_buf);}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Builds\ a\ RLC\ PDU\ containing\ the\ first\ segment\ of\ a\ new\ SDU.}}
\DoxyCodeLine{00248\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00249\ \ \ \textcolor{comment}{///\ This\ function\ will\ set\ sn\_under\_segmentation\ to\ the\ sequence\ number\ of\ the\ SDU\ under\ segmentation.}}
\DoxyCodeLine{00250\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00251\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ rlc\_pdu\_buf\ TX\ buffer\ where\ to\ encode\ an\ RLC\ Tx\ PDU.\ The\ encoded\ PDU\ size\ cannot\ exceed\ the\ size\ of\ the}}
\DoxyCodeLine{00252\ \ \ \textcolor{comment}{///\ buffer.}}
\DoxyCodeLine{00253\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ sdu\_info\ The\ tx\_pdu\ info\ contained\ in\ the\ tx\_window.}}
\DoxyCodeLine{00254\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ Number\ of\ bytes\ taken\ by\ the\ written\ RLC\ PDU.}}
\DoxyCodeLine{00255\ \ \ size\_t\ build\_first\_sdu\_segment(span<uint8\_t>\ rlc\_pdu\_buf,\ rlc\_tx\_am\_sdu\_info\&\ sdu\_info);}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Builds\ a\ RLC\ PDU\ containing\ an\ SDU\ segment\ for\ an\ SDU\ that\ is\ undergoing\ segmentation.}}
\DoxyCodeLine{00258\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00259\ \ \ \textcolor{comment}{///\ This\ function\ will\ reset\ sn\_under\_segmentation\ to\ RLC\_INVALID\_SN\ if\ the\ produced\ PDU\ contains}}
\DoxyCodeLine{00260\ \ \ \textcolor{comment}{///\ the\ last\ segment\ of\ the\ SDU\ under\ segmentation.}}
\DoxyCodeLine{00261\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00262\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ rlc\_pdu\_buf\ TX\ buffer\ where\ to\ encode\ an\ RLC\ Tx\ PDU.\ The\ encoded\ PDU\ size\ cannot\ exceed\ the\ size\ of\ the}}
\DoxyCodeLine{00263\ \ \ \textcolor{comment}{///\ buffer.}}
\DoxyCodeLine{00264\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ sdu\_info\ The\ tx\_pdu\ info\ contained\ in\ the\ tx\_window.}}
\DoxyCodeLine{00265\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ Number\ of\ bytes\ taken\ by\ the\ written\ RLC\ PDU.}}
\DoxyCodeLine{00266\ \ \ size\_t\ build\_continued\_sdu\_segment(span<uint8\_t>\ rlc\_pdu\_buf,\ rlc\_tx\_am\_sdu\_info\&\ sdu\_info);}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Builds\ a\ RETX\ RLC\ PDU.}}
\DoxyCodeLine{00269\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00270\ \ \ \textcolor{comment}{///\ This\ will\ use\ the\ retx\_queue\ to\ get\ information\ about\ the\ RLC\ PDU}}
\DoxyCodeLine{00271\ \ \ \textcolor{comment}{///\ being\ RETX'ed.\ The\ RETX\ may\ have\ been\ previously\ transmitted\ as}}
\DoxyCodeLine{00272\ \ \ \textcolor{comment}{///\ a\ full\ PDU\ or\ an\ PDU\ segment(s).}}
\DoxyCodeLine{00273\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00274\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ sdu\_info\ The\ tx\_pdu\ info\ contained\ in\ the\ tx\_window.}}
\DoxyCodeLine{00275\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ Number\ of\ bytes\ taken\ by\ the\ written\ RLC\ PDU.}}
\DoxyCodeLine{00276\ \ \ size\_t\ build\_retx\_pdu(span<uint8\_t>\ rlc\_pdu\_buf);}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \textcolor{keyword}{constexpr}\ uint32\_t\ get\_retx\_expected\_hdr\_len(\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1rlc__tx__amd__retx}{rlc\_tx\_amd\_retx}}\ retx)}
\DoxyCodeLine{00279\ \ \ \{}
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{keywordflow}{return}\ retx\mbox{\hyperlink{structsrsran_1_1rlc__tx__amd__retx_a80ab73a1ffc00ff6c965b75673542d08}{.}}\mbox{\hyperlink{structsrsran_1_1rlc__tx__amd__retx_a80ab73a1ffc00ff6c965b75673542d08}{so}}\ ==\ 0\ ?\ head\_min\_size\ :\ head\_max\_size;}
\DoxyCodeLine{00281\ \ \ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Evaluates\ a\ status\ PDU,\ schedules\ RETX\ and\ removes\ ACK'ed\ SDUs\ from\ TX\ window}}
\DoxyCodeLine{00284\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ status\ The\ status\ PDU}}
\DoxyCodeLine{00285\ \ \ \textcolor{keywordtype}{void}\ handle\_status\_pdu(\mbox{\hyperlink{classsrsran_1_1rlc__am__status__pdu}{rlc\_am\_status\_pdu}}\ status);}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Schedules\ RETX\ for\ NACK'ed\ PDUs}}
\DoxyCodeLine{00288\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00289\ \ \ \textcolor{comment}{///\ NACKs\ will\ be\ dropped\ if\ the\ SN\ falls\ out\ of\ the\ tx\ window\ or\ if\ the\ NACK'ed}}
\DoxyCodeLine{00290\ \ \ \textcolor{comment}{///\ PDU\ or\ PDU\ segment\ is\ already\ queued\ for\ RETX\ or\ the\ RETX\ queue\ is\ full.}}
\DoxyCodeLine{00291\ \ \ \textcolor{comment}{///\ Invalid\ or\ out\ of\ bounds\ segment\ offsets\ are\ adjusted\ to\ SDU\ boundaries}}
\DoxyCodeLine{00292\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00293\ \ \ \textcolor{comment}{///\ Note:\ This\ function\ must\ not\ be\ called\ with\ NACKs\ that\ have\ a\ nack\ range.}}
\DoxyCodeLine{00294\ \ \ \textcolor{comment}{///\ Instead,\ nacks\ with\ nack\ range\ must\ be\ decomposed\ into\ individual\ NACKs.}}
\DoxyCodeLine{00295\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00296\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ nack\ The\ NACK\ to\ be\ processed.\ The\ NACK\ must\ not\ have\ a\ nack\ range.}}
\DoxyCodeLine{00297\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ true\ if\ NACK\ was\ handled\ and\ queued\ successfully,\ false\ if\ NACK\ has\ been\ ignored}}
\DoxyCodeLine{00298\ \ \ \textcolor{keywordtype}{bool}\ handle\_nack(\mbox{\hyperlink{structsrsran_1_1rlc__am__status__nack}{rlc\_am\_status\_nack}}\ nack);}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Increments\ the\ retx\_count\ for\ a\ given\ SN\ and\ checks\ if\ max\_retx\ is\ reached.}}
\DoxyCodeLine{00301\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00302\ \ \ \textcolor{comment}{///\ Caller\ \_must\_\ hold\ the\ mutex\ when\ calling\ the\ function.}}
\DoxyCodeLine{00303\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ sn\ The\ SN\ of\ the\ SDU\ for\ which\ the\ retx\_counter\ shall\ be\ incremented.}}
\DoxyCodeLine{00304\ \ \ \textcolor{keywordtype}{void}\ increment\_retx\_count(uint32\_t\ sn);}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Decrements\ the\ retx\_count\ for\ a\ given\ SN\ if\ applicable.}}
\DoxyCodeLine{00307\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00308\ \ \ \textcolor{comment}{///\ Caller\ \_must\_\ hold\ the\ mutex\ when\ calling\ the\ function.}}
\DoxyCodeLine{00309\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ sn\ The\ SN\ of\ the\ SDU\ for\ which\ the\ retx\_counter\ shall\ be\ decremented.}}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordtype}{void}\ decrement\_retx\_count(uint32\_t\ sn);}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Helper\ to\ check\ if\ a\ SN\ has\ reached\ the\ max\ RETX\ threshold}}
\DoxyCodeLine{00313\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00314\ \ \ \textcolor{comment}{///\ Caller\ \_must\_\ hold\ the\ mutex\ when\ calling\ the\ function.}}
\DoxyCodeLine{00315\ \ \ \textcolor{comment}{///\ If\ the\ RETX\ has\ been\ reached\ for\ a\ SN\ the\ upper\ layers\ (i.e.\ RRC/PDCP)\ will\ be\ informed.}}
\DoxyCodeLine{00316\ \ \ \textcolor{comment}{///\ The\ SN\ is\ \_not\_\ removed\ from\ the\ TX\ window,\ so\ retransmissions\ of\ that\ SN\ can\ still\ occur.}}
\DoxyCodeLine{00317\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ sn\ The\ SN\ of\ the\ PDU\ to\ check}}
\DoxyCodeLine{00318\ \ \ \textcolor{keywordtype}{void}\ check\_sn\_reached\_max\_retx(uint32\_t\ sn);}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \textcolor{comment}{///\ Called\ whenever\ the\ buffer\ state\ has\ been\ changed\ by\ upper\ layers\ (i.e\ new\ SDU\ or\ SDU\ discard)\ or\ the\ size\ of\ the}}
\DoxyCodeLine{00321\ \ \ \textcolor{comment}{///\ own\ status\ PDU\ has\ changed\ so\ that\ lower\ layers\ need\ to\ be\ informed\ about\ the\ new\ buffer\ state.\ This\ function}}
\DoxyCodeLine{00322\ \ \ \textcolor{comment}{///\ defers\ the\ actual\ notification\ \(\backslash\)c\ handle\_changed\_buffer\_state\ to\ pcell\_executor.\ The\ notification\ is\ discarded\ if}}
\DoxyCodeLine{00323\ \ \ \textcolor{comment}{///\ another\ notification\ is\ already\ queued\ for\ execution.\ This\ function\ should\ not\ be\ called\ from\ \(\backslash\)c\ pull\_pdu,\ since}}
\DoxyCodeLine{00324\ \ \ \textcolor{comment}{///\ the\ lower\ layer\ accounts\ for\ the\ amount\ of\ extracted\ data\ itself.}}
\DoxyCodeLine{00325\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00326\ \ \ \textcolor{comment}{///\ Safe\ execution\ from:\ Any\ executor}}
\DoxyCodeLine{00327\ \ \ \textcolor{keywordtype}{void}\ handle\_changed\_buffer\_state();}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \textcolor{comment}{///\ Immediately\ informs\ the\ lower\ layer\ of\ the\ current\ buffer\ state.\ This\ function\ must\ be\ called\ from\ pcell\_executor.}}
\DoxyCodeLine{00330\ \ \ \textcolor{comment}{///\ It\ is\ used\ for\ buffer\ update\ notifications\ by\ non-\/excessive\ internal\ RLC\ events\ (i.e.\ expired\ poll\ retransmit}}
\DoxyCodeLine{00331\ \ \ \textcolor{comment}{///\ timer\ or\ handled\ received\ status\ report),\ and\ for\ defered\ handling\ of\ \(\backslash\)c\ handle\_changed\_buffer\_state.\ This}}
\DoxyCodeLine{00332\ \ \ \textcolor{comment}{///\ function\ should\ not\ be\ called\ from\ \(\backslash\)c\ pull\_pdu,\ since\ the\ lower\ layer\ accounts\ for\ the\ amount\ of\ extracted\ data}}
\DoxyCodeLine{00333\ \ \ \textcolor{comment}{///\ itself.}}
\DoxyCodeLine{00334\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00335\ \ \ \textcolor{comment}{///\ Safe\ execution\ from:\ pcell\_executor}}
\DoxyCodeLine{00336\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ is\_locked\ provides\ info\ whether\ the\ \(\backslash\)c\ mutex\ is\ already\ locked\ or\ not.}}
\DoxyCodeLine{00337\ \ \ \textcolor{keywordtype}{void}\ update\_mac\_buffer\_state(\textcolor{keywordtype}{bool}\ is\_locked);}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \textcolor{comment}{///\ Lock-\/free\ version\ of\ \(\backslash\)c\ get\_buffer\_state()}}
\DoxyCodeLine{00340\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ Provides\ the\ current\ buffer\ state}}
\DoxyCodeLine{00341\ \ \ uint32\_t\ get\_buffer\_state\_nolock();}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \textcolor{comment}{///\ Creates\ the\ tx\_window\ according\ to\ sn\_size}}
\DoxyCodeLine{00344\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ sn\_size\ Size\ of\ the\ sequence\ number\ (SN)}}
\DoxyCodeLine{00345\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ unique\ pointer\ to\ tx\_window\ instance}}
\DoxyCodeLine{00346\ \ \ std::unique\_ptr<sdu\_window<rlc\_tx\_am\_sdu\_info>>\ create\_tx\_window(rlc\_am\_sn\_size\ sn\_size);}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \textcolor{keywordtype}{void}\ log\_state(srslog::basic\_levels\ level)}
\DoxyCodeLine{00349\ \ \ \{}
\DoxyCodeLine{00350\ \ \ \ \ \textcolor{keywordflow}{if}\ (sn\_under\_segmentation\ ==\ \mbox{\hyperlink{namespacesrsran_a7330c0b829cb3d3717bb70ab14ec3e3c}{INVALID\_RLC\_SN}})\ \{}
\DoxyCodeLine{00351\ \ \ \ \ \ \ logger.log(level,\ \textcolor{stringliteral}{"{}TX\ entity\ state.\ \{\}\ sn\_under\_segmentation=none"{}},\ st,\ sn\_under\_segmentation);}
\DoxyCodeLine{00352\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ logger.log(level,\ \textcolor{stringliteral}{"{}TX\ entity\ state.\ \{\}\ sn\_under\_segmentation=\{\}"{}},\ st,\ sn\_under\_segmentation);}
\DoxyCodeLine{00354\ \ \ \ \ \}}
\DoxyCodeLine{00355\ \ \ \}}
\DoxyCodeLine{00356\ \};}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ \}\ \textcolor{comment}{//\ namespace\ srsran}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \textcolor{keyword}{namespace}\ fmt\ \{}
\DoxyCodeLine{00361\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{00362\ \textcolor{keyword}{struct}\ formatter<srsran::rlc\_tx\_am\_state>\ \{}
\DoxyCodeLine{00363\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ ParseContext>}
\DoxyCodeLine{00364\ \ \ \textcolor{keyword}{auto}\ parse(ParseContext\&\ ctx)\ -\/>\ \textcolor{keyword}{decltype}(ctx.begin())}
\DoxyCodeLine{00365\ \ \ \{}
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{keywordflow}{return}\ ctx.begin();}
\DoxyCodeLine{00367\ \ \ \}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ FormatContext>}
\DoxyCodeLine{00370\ \ \ \textcolor{keyword}{auto}\ format(\textcolor{keyword}{const}\ srsran::rlc\_tx\_am\_state\&\ st,\ FormatContext\&\ ctx)\ -\/>\ \textcolor{keyword}{decltype}(std::declval<FormatContext>().out())}
\DoxyCodeLine{00371\ \ \ \{}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{keywordflow}{return}\ format\_to(ctx.out(),}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}tx\_next\_ack=\{\}\ tx\_next=\{\}\ poll\_sn=\{\}\ pdu\_without\_poll=\{\}\ byte\_without\_poll=\{\}"{}},}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ st.tx\_next\_ack,}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ st.tx\_next,}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ st.poll\_sn,}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ st.pdu\_without\_poll,}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ st.byte\_without\_poll);}
\DoxyCodeLine{00379\ \ \ \}}
\DoxyCodeLine{00380\ \};}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \}\ \textcolor{comment}{//\ namespace\ fmt}}

\end{DoxyCode}
