\doxysection{srsran\+::pucch\+\_\+allocator\+\_\+impl Class Reference}
\hypertarget{classsrsran_1_1pucch__allocator__impl}{}\label{classsrsran_1_1pucch__allocator__impl}\index{srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}}


Implementation of the PUCCH allocator interface.  




{\ttfamily \#include $<$pucch\+\_\+allocator\+\_\+impl.\+h$>$}



Inheritance diagram for srsran\+::pucch\+\_\+allocator\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=258pt]{d6/d35/classsrsran_1_1pucch__allocator__impl__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::pucch\+\_\+allocator\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=258pt]{d5/d81/classsrsran_1_1pucch__allocator__impl__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1pucch__allocator__impl_a86ef92b6a8786d956edfbcfe5f55aea3}{pucch\+\_\+allocator\+\_\+impl}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1cell__configuration}{cell\+\_\+configuration}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\+\_\+cfg\+\_\+}}, \mbox{\hyperlink{classunsigned}{unsigned}} max\+\_\+pucchs\+\_\+per\+\_\+slot, \mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\+\_\+ul\+\_\+grants\+\_\+per\+\_\+slot\+\_\+}})
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1pucch__allocator__impl_a28afae114a35aaba7930a38598c46c3f}{slot\+\_\+indication}} (\mbox{\hyperlink{classsrsran_1_1slot__point}{slot\+\_\+point}} sl\+\_\+tx) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Updates the internal \doxylink{classsrsran_1_1slot__point}{slot\+\_\+point} and tracking of PUCCH resource usage; and resets the PUCCH common allocation grid. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classsrsran_1_1optional}{optional}}$<$ \mbox{\hyperlink{classunsigned}{unsigned}} $>$ \mbox{\hyperlink{classsrsran_1_1pucch__allocator__impl_a74663837422d0ac62894b89cb40faef3}{alloc\+\_\+common\+\_\+pucch\+\_\+harq\+\_\+ack\+\_\+ue}} (\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator}{cell\+\_\+resource\+\_\+allocator}} \&res\+\_\+alloc, \mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tcrnti}}, \mbox{\hyperlink{classunsigned}{unsigned}} k0, \mbox{\hyperlink{classunsigned}{unsigned}} k1, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1pdcch__dl__information}{pdcch\+\_\+dl\+\_\+information}} \&dci\+\_\+info) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\item 
\mbox{\hyperlink{classsrsran_1_1optional}{optional}}$<$ \mbox{\hyperlink{classunsigned}{unsigned}} $>$ \mbox{\hyperlink{classsrsran_1_1pucch__allocator__impl_a6fae0845bff2c61358fda211f2027f47}{alloc\+\_\+ded\+\_\+pucch\+\_\+harq\+\_\+ack\+\_\+ue}} (\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator}{cell\+\_\+resource\+\_\+allocator}} \&res\+\_\+alloc, \mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}} crnti, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1ue__cell__configuration}{ue\+\_\+cell\+\_\+configuration}} \&ue\+\_\+cell\+\_\+cfg, \mbox{\hyperlink{classunsigned}{unsigned}} k0, \mbox{\hyperlink{classunsigned}{unsigned}} k1) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1pucch__allocator__impl_a46d030a6ee2e11fb68bc409bda34a83b}{pucch\+\_\+allocate\+\_\+sr\+\_\+opportunity}} (\mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\+\_\+slot\+\_\+resource\+\_\+allocator}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\+\_\+alloc}}, \mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}} crnti, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1ue__cell__configuration}{ue\+\_\+cell\+\_\+configuration}} \&ue\+\_\+cell\+\_\+cfg) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1pucch__allocator__impl_ab45b45d5e5dea4ce06c8aa310065989a}{pucch\+\_\+allocate\+\_\+csi\+\_\+opportunity}} (\mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\+\_\+slot\+\_\+resource\+\_\+allocator}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\+\_\+slot\+\_\+alloc}}, \mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}} crnti, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1ue__cell__configuration}{ue\+\_\+cell\+\_\+configuration}} \&ue\+\_\+cell\+\_\+cfg, \mbox{\hyperlink{classunsigned}{unsigned}} csi\+\_\+part1\+\_\+nof\+\_\+bits) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\item 
\mbox{\hyperlink{structsrsran_1_1pucch__uci__bits}{pucch\+\_\+uci\+\_\+bits}} \mbox{\hyperlink{classsrsran_1_1pucch__allocator__impl_a92265d35e1cd584bde9d48d7cb9998d3}{remove\+\_\+ue\+\_\+uci\+\_\+from\+\_\+pucch}} (\mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\+\_\+slot\+\_\+resource\+\_\+allocator}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\+\_\+alloc}}, \mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}} crnti, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1ue__cell__configuration}{ue\+\_\+cell\+\_\+configuration}} \&ue\+\_\+cell\+\_\+cfg) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implementation of the PUCCH allocator interface. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1pucch__allocator__impl_a86ef92b6a8786d956edfbcfe5f55aea3}\label{classsrsran_1_1pucch__allocator__impl_a86ef92b6a8786d956edfbcfe5f55aea3} 
\index{srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}!pucch\_allocator\_impl@{pucch\_allocator\_impl}}
\index{pucch\_allocator\_impl@{pucch\_allocator\_impl}!srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}}
\doxysubsubsection{\texorpdfstring{pucch\_allocator\_impl()}{pucch\_allocator\_impl()}}
{\footnotesize\ttfamily pucch\+\_\+allocator\+\_\+impl\+::pucch\+\_\+allocator\+\_\+impl (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1cell__configuration}{cell\+\_\+configuration}} \&}]{cell\+\_\+cfg\+\_\+,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{max\+\_\+pucchs\+\_\+per\+\_\+slot,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{max\+\_\+ul\+\_\+grants\+\_\+per\+\_\+slot\+\_\+ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00097\ \ \ cell\_cfg(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_}}),}
\DoxyCodeLine{00098\ \ \ max\_pucch\_grants\_per\_slot(max\_pucchs\_per\_slot),}
\DoxyCodeLine{00099\ \ \ max\_ul\_grants\_per\_slot(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_ul\_grants\_per\_slot\_}}),}
\DoxyCodeLine{00100\ \ \ logger(srslog::fetch\_basic\_logger(\textcolor{stringliteral}{"{}SCHED"{}}))}
\DoxyCodeLine{00101\ \{}
\DoxyCodeLine{00102\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1pucch__allocator__impl_a74663837422d0ac62894b89cb40faef3}\label{classsrsran_1_1pucch__allocator__impl_a74663837422d0ac62894b89cb40faef3} 
\index{srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}!alloc\_common\_pucch\_harq\_ack\_ue@{alloc\_common\_pucch\_harq\_ack\_ue}}
\index{alloc\_common\_pucch\_harq\_ack\_ue@{alloc\_common\_pucch\_harq\_ack\_ue}!srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}}
\doxysubsubsection{\texorpdfstring{alloc\_common\_pucch\_harq\_ack\_ue()}{alloc\_common\_pucch\_harq\_ack\_ue()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classsrsran_1_1optional}{optional}}$<$ \mbox{\hyperlink{classunsigned}{unsigned}} $>$ pucch\+\_\+allocator\+\_\+impl\+::alloc\+\_\+common\+\_\+pucch\+\_\+harq\+\_\+ack\+\_\+ue (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator}{cell\+\_\+resource\+\_\+allocator}} \&}]{res\+\_\+alloc,  }\item[{\mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}}}]{tcrnti,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{k0,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{k1,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1pdcch__dl__information}{pdcch\+\_\+dl\+\_\+information}} \&}]{dci\+\_\+info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Allocate the common PUCCH resource for HARQ-\/\+ACK for a given UE. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in,out}}  & {\em slot\+\_\+alloc} & struct with scheduling results. \\
\hline
\mbox{\texttt{ in}}  & {\em tcrnti} & temporary RNTI of the UE. \\
\hline
\mbox{\texttt{ in}}  & {\em k0} & k0 value, or delay (in slots) of PDSCH slot vs the corresponding PDCCH slot. \\
\hline
\mbox{\texttt{ in}}  & {\em k1} & delay in slots of the UE\textquotesingle{}s PUCCH HARQ-\/\+ACK report with respect to the PDSCH. \\
\hline
\mbox{\texttt{ in}}  & {\em dci\+\_\+info} & information with DL DCI, needed for HARQ-\/(N)-\/ACK scheduling info. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The PUCCH resource indicator, if the allocation is successful; a {\ttfamily nullopt} otherwise. 
\end{DoxyReturn}
\begin{DoxyRemark}{Remarks}
{\ttfamily pucch\+\_\+res\+\_\+indicator}, or $\Delta_{PRI}$, is the {\itshape PUCCH resource indicator\texorpdfstring{$<$}{<}{\itshape } \texorpdfstring{$>$}{>} field for DCI 1\+\_\+0 and 1\+\_\+1 as per TS 38.\+213, Section 9.\+2.\+1. It indicates the UE which PUCCH resource should be used for HACK-\/(N)ACK reporting. }
\end{DoxyRemark}


Implements \mbox{\hyperlink{classsrsran_1_1pucch__allocator_a34b8be1ccd48883f10507cfff3b64fff}{srsran\+::pucch\+\_\+allocator}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00111\ \{}
\DoxyCodeLine{00112\ \ \ \textcolor{comment}{//\ Get\ the\ slot\ allocation\ grid\ considering\ the\ PDSCH\ delay\ (k0)\ and\ the\ PUCCH\ delay\ wrt\ PDSCH\ (k1).}}
\DoxyCodeLine{00113\ \ \ \mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\_slot\_resource\_allocator}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_alloc}}[k0\ +\ k1\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_alloc}}.cfg.ntn\_cs\_koffset];}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \textcolor{comment}{//\ [Implementation-\/defined]\ We\ only\ allow\ a\ max\ number\ of\ PUCCH\ +\ PUSCH\ grants\ per\ slot.}}
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.result.ul.pucchs.size()\ >=}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ get\_max\_pucch\_grants(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.result.ul.puschs.size()))\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{or}}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ pucch\_common\_alloc\_grid[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_alloc}}[k0\ +\ k1\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_alloc}}.cfg.ntn\_cs\_koffset].slot.to\_uint()].full())\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a2e817fa4d4a8084eb1746ee8d1440679}{nullopt}};}
\DoxyCodeLine{00120\ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ cell\_cfg.is\_fully\_ul\_enabled(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.slot))\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a2e817fa4d4a8084eb1746ee8d1440679}{nullopt}};}
\DoxyCodeLine{00124\ \ \ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \textcolor{comment}{//\ Get\ the\ PUCCH\ resources,\ either\ from\ default\ tables.}}
\DoxyCodeLine{00127\ \ \ \mbox{\hyperlink{classsrsran_1_1optional}{optional<pucch\_res\_alloc\_cfg>}}\ pucch\_res\ =\ alloc\_pucch\_common\_res\_harq(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}},\ dci\_info.\mbox{\hyperlink{structsrsran_1_1pdcch__dl__information_a9a8b5db2a28afcd115c3adc4c5d0212d}{ctx}});}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \textcolor{comment}{//\ No\ resources\ available\ for\ PUCCH.}}
\DoxyCodeLine{00130\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ pucch\_res.\mbox{\hyperlink{classsrsran_1_1optional_a2f160539a76c3f4dd0b50b339b81202e}{has\_value}}())\ \{}
\DoxyCodeLine{00131\ \ \ \ \ logger.debug(\textcolor{stringliteral}{"{}tc-\/rnti=\{\}:\ PUCCH\ not\ allocated\ due\ to\ resources\ not\ available"{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tcrnti}});}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a2e817fa4d4a8084eb1746ee8d1440679}{nullopt}};}
\DoxyCodeLine{00133\ \ \ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \textcolor{comment}{//\ Fill\ Slot\ grid.}}
\DoxyCodeLine{00136\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.ul\_res\_grid.fill(pucch\_res.value().first\_hop\_res);}
\DoxyCodeLine{00137\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.ul\_res\_grid.fill(pucch\_res.value().second\_hop\_res);}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \textcolor{comment}{//\ Fill\ scheduler\ output.}}
\DoxyCodeLine{00140\ \ \ \mbox{\hyperlink{structsrsran_1_1pucch__info}{pucch\_info}}\&\ \mbox{\hyperlink{structsrsran_1_1pucch__info}{pucch\_info}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.result.ul.pucchs.emplace\_back();}
\DoxyCodeLine{00141\ \ \ fill\_pucch\_harq\_common\_grant(\mbox{\hyperlink{structsrsran_1_1pucch__info}{pucch\_info}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tcrnti}},\ pucch\_res.value());}
\DoxyCodeLine{00142\ \ \ \textcolor{keywordtype}{unsigned}\ pucch\_res\_indicator\ =\ pucch\_res.value().pucch\_res\_indicator;}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ pucch\_common\_alloc\_grid[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_alloc}}[k0\ +\ k1\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_alloc}}.cfg.ntn\_cs\_koffset].slot.to\_uint()].emplace\_back(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tcrnti}});}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ logger.debug(\textcolor{stringliteral}{"{}tc-\/rnti=\{\}:\ PUCCH\ HARQ-\/ACK\ common\ with\ res\_ind=\{\}\ allocated\ for\ slot=\{\}"{}},}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tcrnti}},}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pucch\_res\_indicator,}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.slot);}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \textcolor{keywordflow}{return}\ pucch\_res\_indicator;}
\DoxyCodeLine{00152\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1pucch__allocator__impl_a6fae0845bff2c61358fda211f2027f47}\label{classsrsran_1_1pucch__allocator__impl_a6fae0845bff2c61358fda211f2027f47} 
\index{srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}!alloc\_ded\_pucch\_harq\_ack\_ue@{alloc\_ded\_pucch\_harq\_ack\_ue}}
\index{alloc\_ded\_pucch\_harq\_ack\_ue@{alloc\_ded\_pucch\_harq\_ack\_ue}!srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}}
\doxysubsubsection{\texorpdfstring{alloc\_ded\_pucch\_harq\_ack\_ue()}{alloc\_ded\_pucch\_harq\_ack\_ue()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classsrsran_1_1optional}{optional}}$<$ \mbox{\hyperlink{classunsigned}{unsigned}} $>$ pucch\+\_\+allocator\+\_\+impl\+::alloc\+\_\+ded\+\_\+pucch\+\_\+harq\+\_\+ack\+\_\+ue (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator}{cell\+\_\+resource\+\_\+allocator}} \&}]{res\+\_\+alloc,  }\item[{\mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}}}]{crnti,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1ue__cell__configuration}{ue\+\_\+cell\+\_\+configuration}} \&}]{ue\+\_\+cell\+\_\+cfg,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{k0,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{k1 }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Allocate a PUCCH HARQ-\/\+ACK grant for a given UE using dedicated resources.

\begin{DoxyRemark}{Remarks}
This function does not check whether there are PUSCH grants allocated for the same UE. The check needs to be performed by the caller.
\end{DoxyRemark}

\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in,out}}  & {\em res\+\_\+alloc} & struct with scheduling results. \\
\hline
\mbox{\texttt{ in}}  & {\em crnti} & RNTI of the UE. \\
\hline
\mbox{\texttt{ in}}  & {\em ue\+\_\+cell\+\_\+cfg} & user configuration. \\
\hline
\mbox{\texttt{ in}}  & {\em k0} & k0 value, or delay (in slots) of PDSCH slot vs the corresponding PDCCH slot. \\
\hline
\mbox{\texttt{ in}}  & {\em k1} & delay in slots of the UE\textquotesingle{}s PUCCH HARQ-\/\+ACK report with respect to the PDSCH. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The PUCCH resource indicator, if the allocation is successful; a {\ttfamily nullopt} otherwise. 
\end{DoxyReturn}


Implements \mbox{\hyperlink{classsrsran_1_1pucch__allocator_a882a0e32658d80eb8835b062cc520835}{srsran\+::pucch\+\_\+allocator}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00159\ \{}
\DoxyCodeLine{00160\ \ \ \textcolor{comment}{//\ TS\ 38.213,\ Section\ 9.2.3,\ explains\ the\ UE's\ procedure\ to\ multiplex\ HARQ-\/ACK\ reporting\ of\ multiple\ slot\ and\ for}}
\DoxyCodeLine{00161\ \ \ \textcolor{comment}{//\ different\ cells.}}
\DoxyCodeLine{00162\ \ \ \textcolor{comment}{//\ "{}The\ PUCCH\ resource\ determination\ is\ based\ on\ a\ PUCCH\ resource\ indicator\ field\ [5,\ TS\ 38.212]\ in\ a\ last\ DCI}}
\DoxyCodeLine{00163\ \ \ \textcolor{comment}{//\ format\ 1\_0\ or\ DCI\ format\ 1\_1,\ among\ the\ DCI\ formats\ 1\_0\ or\ DCI\ formats\ 1\_1\ that\ have\ a\ value\ of\ a}}
\DoxyCodeLine{00164\ \ \ \textcolor{comment}{//\ PDSCH-\/to-\/HARQ\_feedback\ timing\ indicator\ field\ indicating\ a\ same\ slot\ for\ the\ PUCCH\ transmission,\ that\ the\ UE}}
\DoxyCodeLine{00165\ \ \ \textcolor{comment}{//\ detects\ and\ for\ which\ the\ UE\ transmits\ corresponding\ HARQ-\/ACK\ information\ in\ the\ PUCCH\ where,\ for\ PUCCH\ resource}}
\DoxyCodeLine{00166\ \ \ \textcolor{comment}{//\ determination,\ detected\ DCI\ formats\ are\ first\ indexed\ in\ an\ ascending\ order\ across\ serving\ cells\ indexes\ for\ a}}
\DoxyCodeLine{00167\ \ \ \textcolor{comment}{//\ same\ PDCCH\ monitoring\ occasion\ and\ are\ then\ indexed\ in\ an\ ascending\ order\ across\ PDCCH\ monitoring\ occasion}}
\DoxyCodeLine{00168\ \ \ \textcolor{comment}{//\ indexes"{}.\ As\ a\ result\ of\ this,\ and\ depending\ on\ whether\ there\ is\ any\ scheduled\ SRs,\ the\ PUCCH\ allocator\ can}}
\DoxyCodeLine{00169\ \ \ \textcolor{comment}{//\ either\ allocate\ a\ new\ PUCCH\ grant\ or\ update\ an\ existing\ one\ by\ changing\ the\ number\ of\ HARQ-\/ACK\ bits\ to\ be}}
\DoxyCodeLine{00170\ \ \ \textcolor{comment}{//\ reported.}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \textcolor{comment}{//\ NOTE:\ This\ function\ does\ not\ check\ whether\ there\ are\ PUSCH\ grants\ allocated\ for\ the\ same\ UE.\ The\ check\ needs\ to}}
\DoxyCodeLine{00173\ \ \ \textcolor{comment}{//\ be\ performed\ by\ the\ caller.}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \textcolor{comment}{//\ Get\ the\ slot\ allocation\ grid\ considering\ the\ PDSCH\ delay\ (k0)\ and\ the\ PUCCH\ delay\ wrt\ PDSCH\ (k1).}}
\DoxyCodeLine{00176\ \ \ \mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\_slot\_resource\_allocator}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}\ =\ res\_alloc[k0\ +\ k1\ +\ res\_alloc.\mbox{\hyperlink{structsrsran_1_1cell__resource__allocator_a569167b4165a6dcd93b36bc5cee15105}{cfg}}.ntn\_cs\_koffset];}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \textcolor{keyword}{auto}\&\ pucchs\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.result.ul.pucchs;}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \textcolor{comment}{//\ Retrieve\ the\ existing\ PUCCH\ grants.}}
\DoxyCodeLine{00181\ \ \ \textcolor{keyword}{const}\ existing\_pucch\_grants\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}\ =\ get\_existing\_pucch\_grants(pucchs,\ crnti,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.slot);}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_ack\_bits\_increment}}\ =\ 1;}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \textcolor{comment}{//\ Case\ 1)\ If\ there\ is\ a\ PUCCH\ format\ 2\ grant,\ update\ it.}}
\DoxyCodeLine{00186\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format2\_grant\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{comment}{//\ Case\ 1-\/A)\ If\ the\ allocated\ resource\ is\ the\ one\ specific\ for\ CSI,\ change\ resource\ and\ allocate\ grant.}}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format2\_grant-\/>format\_2.harq\_ack\_nof\_bits\ ==\ 0\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format2\_grant-\/>format\_2.csi\_part1\_bits\ >\ 0)\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ change\_format2\_resource(}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}},\ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format2\_grant,\ crnti,\ ue\_cell\_cfg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_ack\_bits\_increment}});}
\DoxyCodeLine{00192\ \ \ \ \ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{comment}{//\ Case\ 1-\/B)\ If\ the\ allocated\ resource\ is\ for\ HARQ\ too,\ just\ update\ the\ resource.}}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordflow}{return}\ add\_harq\_bits\_to\_harq\_f2\_grant(}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format2\_grant,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.slot,\ crnti,\ ue\_cell\_cfg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_ack\_bits\_increment}});}
\DoxyCodeLine{00197\ \ \ \}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \textcolor{comment}{//\ Case\ 2)\ An\ HARQ\ Format\ 1\ is\ already\ scheduled.\ Update\ the\ existing\ HARQ\ grant\ and\ the\ SR\ grant,\ if\ present.}}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_harq\_grant\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_sr\_grant\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ srsran\_sanity\_check(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_harq\_grant-\/>format\_1.harq\_ack\_nof\_bits\ ==}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_sr\_grant-\/>format\_1.harq\_ack\_nof\_bits,}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Mismatch\ HARQ\ bits\ mismatch\ between\ SR\ and\ HARQ\ grants"{}});}
\DoxyCodeLine{00205\ \ \ \ \ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{comment}{//\ Case\ 2-\/A)\ If\ the\ existing\ grant\ is\ for\ at\ least\ 2\ HARQ-\/ACK\ bits,\ then\ the\ PUCCH\ needs\ to\ be\ converted\ to}}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{comment}{//\ format\ 2.}}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_harq\_grant-\/>format\_1.harq\_ack\_nof\_bits\ >\ 1)\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ convert\_to\_format2\_harq(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}},}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_harq\_grant,}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_sr\_grant,}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ crnti,}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_cell\_cfg,}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_ack\_bits\_increment}});}
\DoxyCodeLine{00216\ \ \ \ \ \}}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{comment}{//\ Case\ 2-\/B)}}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordflow}{return}\ add\_harq\_ack\_bit\_to\_format1\_grant(}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_harq\_grant,}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_sr\_grant,}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ crnti,}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.slot,}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ ue\_cell\_cfg.cfg\_dedicated().\mbox{\hyperlink{structsrsran_1_1serving__cell__config_a2fe7ab17cda5bafb76bcabb1e526e556}{ul\_config}}.value().init\_ul\_bwp.pucch\_cfg.value());}
\DoxyCodeLine{00225\ \ \ \}}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \textcolor{comment}{//\ Case\ C)\ If\ there\ is\ no\ existing\ HARQ\_ACK\ grant,\ allocate\ a\ new\ one\ and\ update\ the\ SR\ grant,\ if\ present.}}
\DoxyCodeLine{00228\ \ \ \textcolor{keywordflow}{return}\ allocate\_new\_format1\_harq\_grant(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}},\ crnti,\ ue\_cell\_cfg,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_sr\_grant);}
\DoxyCodeLine{00229\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1pucch__allocator__impl_ab45b45d5e5dea4ce06c8aa310065989a}\label{classsrsran_1_1pucch__allocator__impl_ab45b45d5e5dea4ce06c8aa310065989a} 
\index{srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}!pucch\_allocate\_csi\_opportunity@{pucch\_allocate\_csi\_opportunity}}
\index{pucch\_allocate\_csi\_opportunity@{pucch\_allocate\_csi\_opportunity}!srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}}
\doxysubsubsection{\texorpdfstring{pucch\_allocate\_csi\_opportunity()}{pucch\_allocate\_csi\_opportunity()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} pucch\+\_\+allocator\+\_\+impl\+::pucch\+\_\+allocate\+\_\+csi\+\_\+opportunity (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\+\_\+slot\+\_\+resource\+\_\+allocator}} \&}]{pucch\+\_\+slot\+\_\+alloc,  }\item[{\mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}}}]{crnti,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1ue__cell__configuration}{ue\+\_\+cell\+\_\+configuration}} \&}]{ue\+\_\+cell\+\_\+cfg,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{csi\+\_\+part1\+\_\+nof\+\_\+bits }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Allocate the PUCCH grant for a UE\textquotesingle{}s CSI opportunity. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in,out}}  & {\em slot\+\_\+alloc} & struct with scheduling results. \\
\hline
\mbox{\texttt{ in}}  & {\em crnti} & C-\/\+RNTI of the UE. \\
\hline
\mbox{\texttt{ in}}  & {\em ue\+\_\+cell\+\_\+cfg} & user configuration. \\
\hline
\mbox{\texttt{ in}}  & {\em csi\+\_\+part1\+\_\+nof\+\_\+bits} & Number of CSI Part 1 bits that need to be reported. \\
\hline
\mbox{\texttt{ in}}  & {\em is\+\_\+fallback\+\_\+mode} & Indicates whether the UE is in fallback mode. \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classsrsran_1_1pucch__allocator_aaac1e5eeb05f561f15cba9f4e00fd2cd}{srsran\+::pucch\+\_\+allocator}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00274\ \{}
\DoxyCodeLine{00275\ \ \ \textcolor{keyword}{auto}\&\ pucchs\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.result.ul.pucchs;}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \textcolor{keyword}{const}\ existing\_pucch\_grants\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}\ =\ get\_existing\_pucch\_grants(pucchs,\ crnti,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.slot);}
\DoxyCodeLine{00278\ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format2\_grant\ ==\ \textcolor{keyword}{nullptr}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_harq\_grant\ ==\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ CSI\ is\ the\ first\ dedicated\ PUCCH\ grant\ that\ is\ expected\ to\ be\ allocated."{}});}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_sr\_grant\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{keywordflow}{return}\ convert\_to\_format2\_csi(}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}},\ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_sr\_grant,\ crnti,\ ue\_cell\_cfg,\ csi\_part1\_nof\_bits);}
\DoxyCodeLine{00284\ \ \ \}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \textcolor{keywordflow}{return}\ allocate\_new\_csi\_grant(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}},\ crnti,\ ue\_cell\_cfg,\ csi\_part1\_nof\_bits);}
\DoxyCodeLine{00287\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1pucch__allocator__impl_a46d030a6ee2e11fb68bc409bda34a83b}\label{classsrsran_1_1pucch__allocator__impl_a46d030a6ee2e11fb68bc409bda34a83b} 
\index{srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}!pucch\_allocate\_sr\_opportunity@{pucch\_allocate\_sr\_opportunity}}
\index{pucch\_allocate\_sr\_opportunity@{pucch\_allocate\_sr\_opportunity}!srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}}
\doxysubsubsection{\texorpdfstring{pucch\_allocate\_sr\_opportunity()}{pucch\_allocate\_sr\_opportunity()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} pucch\+\_\+allocator\+\_\+impl\+::pucch\+\_\+allocate\+\_\+sr\+\_\+opportunity (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\+\_\+slot\+\_\+resource\+\_\+allocator}} \&}]{pucch\+\_\+slot\+\_\+alloc,  }\item[{\mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}}}]{crnti,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1ue__cell__configuration}{ue\+\_\+cell\+\_\+configuration}} \&}]{ue\+\_\+cell\+\_\+cfg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Allocate the PUCCH resource for a UE\textquotesingle{}s SR opportunity. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in,out}}  & {\em slot\+\_\+alloc} & struct with scheduling results. \\
\hline
\mbox{\texttt{ in}}  & {\em crnti} & C-\/\+RNTI of the UE. \\
\hline
\mbox{\texttt{ in}}  & {\em ue\+\_\+cell\+\_\+cfg} & user configuration. \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classsrsran_1_1pucch__allocator_a756012774ab9d566cd8231211c769df9}{srsran\+::pucch\+\_\+allocator}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00234\ \{}
\DoxyCodeLine{00235\ \ \ \textcolor{comment}{//\ [Implementation-\/defined]\ We\ only\ allow\ a\ max\ number\ of\ PUCCH\ +\ PUSCH\ grants\ per\ slot.}}
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.result.ul.pucchs.size()\ >=}
\DoxyCodeLine{00237\ \ \ \ \ \ \ get\_max\_pucch\_grants(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.result.ul.puschs.size())))\ \{}
\DoxyCodeLine{00238\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}rnti=\{\}:\ SR\ occasion\ allocation\ for\ slot=\{\}\ skipped.\ Cause:\ max\ number\ of\ UL\ grants\ reached"{}},}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ crnti,}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.slot);}
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00242\ \ \ \}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \textcolor{keyword}{const}\ existing\_pucch\_grants\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}\ =}
\DoxyCodeLine{00245\ \ \ \ \ \ \ get\_existing\_pucch\_grants(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.result.ul.pucchs,\ crnti,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.slot);}
\DoxyCodeLine{00246\ \ \ srsran\_assert(}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_harq\_grant\ ==\ \textcolor{keyword}{nullptr}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format1\_sr\_grant\ ==\ \textcolor{keyword}{nullptr}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{existing\_grants}}.format2\_grant\ ==\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ SR\ is\ the\ first\ dedicated\ PUCCH\ grant\ that\ is\ expected\ to\ be\ allocated;\ no\ grants\ expected\ at\ this\ point."{}});}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \textcolor{comment}{//\ Get\ the\ index\ of\ the\ PUCCH\ resource\ to\ be\ used\ for\ SR.}}
\DoxyCodeLine{00252\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1pucch__resource}{pucch\_resource}}*\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_sr\_res}}\ =\ resource\_manager.\mbox{\hyperlink{classsrsran_1_1pucch__resource__manager_a59b1a37f315491278aa7aad2c290a8c5}{reserve\_sr\_res\_available}}(}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.slot,\ crnti,\ ue\_cell\_cfg.cfg\_dedicated().\mbox{\hyperlink{structsrsran_1_1serving__cell__config_a2fe7ab17cda5bafb76bcabb1e526e556}{ul\_config}}.value().init\_ul\_bwp.pucch\_cfg.value());}
\DoxyCodeLine{00254\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_sr\_res}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00255\ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}rnti=\{\}:\ SR\ occasion\ allocation\ for\ slot=\{\}\ skipped.\ Cause:\ PUCCH\ F1\ ded.\ resource\ not\ available"{}},}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ crnti,}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.slot);}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00259\ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \textcolor{comment}{//\ Allocate\ PUCCH\ SR\ grant\ only.}}
\DoxyCodeLine{00262\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_ack\_bits\_increment}}\ =\ 0U;}
\DoxyCodeLine{00263\ \ \ fill\_pucch\_ded\_format1\_grant(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_slot\_alloc}}.result.ul.pucchs.emplace\_back(),}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ crnti,}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_sr\_res}},}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{harq\_ack\_bits\_increment}},}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sr\_nof\_bits::one);}
\DoxyCodeLine{00268\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1pucch__allocator__impl_a92265d35e1cd584bde9d48d7cb9998d3}\label{classsrsran_1_1pucch__allocator__impl_a92265d35e1cd584bde9d48d7cb9998d3} 
\index{srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}!remove\_ue\_uci\_from\_pucch@{remove\_ue\_uci\_from\_pucch}}
\index{remove\_ue\_uci\_from\_pucch@{remove\_ue\_uci\_from\_pucch}!srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}}
\doxysubsubsection{\texorpdfstring{remove\_ue\_uci\_from\_pucch()}{remove\_ue\_uci\_from\_pucch()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structsrsran_1_1pucch__uci__bits}{pucch\+\_\+uci\+\_\+bits}} pucch\+\_\+allocator\+\_\+impl\+::remove\+\_\+ue\+\_\+uci\+\_\+from\+\_\+pucch (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1cell__slot__resource__allocator}{cell\+\_\+slot\+\_\+resource\+\_\+allocator}} \&}]{slot\+\_\+alloc,  }\item[{\mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}}}]{crnti,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1ue__cell__configuration}{ue\+\_\+cell\+\_\+configuration}} \&}]{ue\+\_\+cell\+\_\+cfg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Remove UCI allocations on PUCCH for a given UE. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in,out}}  & {\em slot\+\_\+alloc} & struct with scheduling results. \\
\hline
\mbox{\texttt{ in}}  & {\em crnti} & RNTI of the UE. \\
\hline
\mbox{\texttt{ in}}  & {\em pucch\+\_\+cfg} & User\textquotesingle{}s PUCCH configuration. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
struct with the number of HARQ-\/\+ACK and CSI info bits from the removed PUCCH grants. If there was no PUCCH to be removed, return 0 for both HARQ-\/\+ACK and CSI info bits. 
\end{DoxyReturn}


Implements \mbox{\hyperlink{classsrsran_1_1pucch__allocator_ac72002185e4401aa842da529b8aa8e3c}{srsran\+::pucch\+\_\+allocator}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00292\ \{}
\DoxyCodeLine{00293\ \ \ \mbox{\hyperlink{structsrsran_1_1pucch__uci__bits}{pucch\_uci\_bits}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{removed\_uci\_info}};}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \textcolor{keyword}{auto}\&\ pucchs\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_alloc}}.result.ul.pucchs;}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \textcolor{comment}{//\ Remove\ HARQ-\/ACK\ grant\ first.}}
\DoxyCodeLine{00298\ \ \ \textcolor{keyword}{auto}*\ it\ =\ std::find\_if(pucchs.begin(),\ pucchs.end(),\ [crnti](\mbox{\hyperlink{structsrsran_1_1pucch__info}{pucch\_info}}\&\ pucch)\ \{}
\DoxyCodeLine{00299\ \ \ \ \ return\ pucch.crnti\ ==\ crnti\ and}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ ((pucch.format\ ==\ pucch\_format::FORMAT\_1\ and\ pucch.format\_1.sr\_bits\ ==\ sr\_nof\_bits::no\_sr\ and}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ pucch.format\_1.harq\_ack\_nof\_bits\ >\ 0)\ or}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ (pucch.format\ ==\ pucch\_format::FORMAT\_2));}
\DoxyCodeLine{00303\ \ \ \});}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1pucch__config}{pucch\_config}}\&\ pucch\_cfg\ =\ ue\_cell\_cfg.cfg\_dedicated().\mbox{\hyperlink{structsrsran_1_1serving__cell__config_a2fe7ab17cda5bafb76bcabb1e526e556}{ul\_config}}.value().init\_ul\_bwp.pucch\_cfg.value();}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ pucchs.end())\ \{}
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{comment}{//\ Search\ for\ Format\ 2\ first;\ if\ present,\ then\ remove\ only\ that\ resource\ and\ exit.}}
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{keywordflow}{if}\ (it-\/>format\ ==\ pucch\_format::FORMAT\_2)\ \{}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{removed\_uci\_info}}.harq\_ack\_nof\_bits\ =\ it-\/>format\_2.harq\_ack\_nof\_bits;}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{removed\_uci\_info}}.sr\_bits\ \ \ \ \ \ \ \ \ \ \ =\ it-\/>format\_2.sr\_bits;}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{removed\_uci\_info}}.csi\_part1\_bits\ \ \ \ =\ it-\/>format\_2.csi\_part1\_bits;}
\DoxyCodeLine{00313\ \ \ \ \ \ \ pucchs.erase(it);}
\DoxyCodeLine{00314\ \ \ \ \ \ \ resource\_manager.\mbox{\hyperlink{classsrsran_1_1pucch__resource__manager_a9f4da9b7594802e4c1c66248f2bdd88a}{release\_harq\_f2\_resource}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_alloc}}.slot,\ crnti,\ pucch\_cfg);}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{removed\_uci\_info}}.csi\_part1\_bits\ >\ 0)\ \{}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ resource\_manager.\mbox{\hyperlink{classsrsran_1_1pucch__resource__manager_abf167b75a5c55bf75860448daf6a4920}{release\_csi\_resource}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_alloc}}.slot,\ crnti,\ ue\_cell\_cfg);}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ there\ is\ a\ PUCCH\ resource\ Format\ 2,\ then\ no\ Format\ 1\ should\ be\ present.}}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{removed\_uci\_info}};}
\DoxyCodeLine{00320\ \ \ \ \ \}}
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{comment}{//\ Proceed\ with\ Format\ 1.}}
\DoxyCodeLine{00322\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ remove\ HARQ-\/ACK\ grant,\ handle\ SR\ grant\ separately.}}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{removed\_uci\_info}}.harq\_ack\_nof\_bits\ =\ it-\/>format\_1.harq\_ack\_nof\_bits;}
\DoxyCodeLine{00325\ \ \ \ \ \ \ pucchs.erase(it);}
\DoxyCodeLine{00326\ \ \ \ \ \ \ resource\_manager.\mbox{\hyperlink{classsrsran_1_1pucch__resource__manager_acfcd84de6b5b859c51c68d219a8a4098}{release\_harq\_f1\_resource}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_alloc}}.slot,\ crnti,\ pucch\_cfg);}
\DoxyCodeLine{00327\ \ \ \ \ \}}
\DoxyCodeLine{00328\ \ \ \}}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \ \ \textcolor{comment}{//\ Remove\ SR\ grant,\ if\ any.}}
\DoxyCodeLine{00331\ \ \ it\ =\ std::find\_if(pucchs.begin(),\ pucchs.end(),\ [crnti](\mbox{\hyperlink{structsrsran_1_1pucch__info}{pucch\_info}}\&\ pucch)\ \{}
\DoxyCodeLine{00332\ \ \ \ \ return\ pucch.crnti\ ==\ crnti\ and\ pucch.format\ ==\ pucch\_format::FORMAT\_1\ and}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ pucch.format\_1.sr\_bits\ ==\ sr\_nof\_bits::one;}
\DoxyCodeLine{00334\ \ \ \});}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ pucchs.end())\ \{}
\DoxyCodeLine{00337\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{removed\_uci\_info}}.sr\_bits\ =\ it-\/>format\_1.sr\_bits;}
\DoxyCodeLine{00338\ \ \ \ \ pucchs.erase(it);}
\DoxyCodeLine{00339\ \ \ \ \ resource\_manager.\mbox{\hyperlink{classsrsran_1_1pucch__resource__manager_a15b5a050479f5e214eba5caa2592b2c3}{release\_sr\_resource}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_alloc}}.slot,\ crnti,\ pucch\_cfg);}
\DoxyCodeLine{00340\ \ \ \}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{removed\_uci\_info}};}
\DoxyCodeLine{00343\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1pucch__allocator__impl_a28afae114a35aaba7930a38598c46c3f}\label{classsrsran_1_1pucch__allocator__impl_a28afae114a35aaba7930a38598c46c3f} 
\index{srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}!slot\_indication@{slot\_indication}}
\index{slot\_indication@{slot\_indication}!srsran::pucch\_allocator\_impl@{srsran::pucch\_allocator\_impl}}
\doxysubsubsection{\texorpdfstring{slot\_indication()}{slot\_indication()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} pucch\+\_\+allocator\+\_\+impl\+::slot\+\_\+indication (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1slot__point}{slot\+\_\+point}}}]{sl\+\_\+tx }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Updates the internal \doxylink{classsrsran_1_1slot__point}{slot\+\_\+point} and tracking of PUCCH resource usage; and resets the PUCCH common allocation grid. 



Implements \mbox{\hyperlink{classsrsran_1_1pucch__allocator_abd5e232603ce43d7b29d445dc9c7f90e}{srsran\+::pucch\+\_\+allocator}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00346\ \{}
\DoxyCodeLine{00347\ \ \ \textcolor{comment}{//\ If\ last\_sl\_ind\ is\ not\ valid\ (not\ initialized),\ then\ the\ check\ sl\_tx\ ==\ last\_sl\_ind\ +\ 1\ does\ not\ matter.}}
\DoxyCodeLine{00348\ \ \ srsran\_sanity\_check(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ last\_sl\_ind.\mbox{\hyperlink{classsrsran_1_1slot__point_a988d40945efc785f48725c857852c922}{valid}}()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{or}}\ sl\_tx\ ==\ last\_sl\_ind\ +\ 1,\ \textcolor{stringliteral}{"{}Detected\ a\ skipped\ slot"{}});}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \textcolor{comment}{//\ Update\ Slot.}}
\DoxyCodeLine{00351\ \ \ last\_sl\_ind\ =\ sl\_tx;}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ resource\_manager.\mbox{\hyperlink{classsrsran_1_1pucch__resource__manager_a81a16bc8a6f73d1d6877b6ef2b973e25}{slot\_indication}}(sl\_tx);}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \textcolor{comment}{//\ Clear\ previous\ slot\ PUCCH\ common\ allocations.}}
\DoxyCodeLine{00356\ \ \ pucch\_common\_alloc\_grid[(sl\_tx\ -\/\ 1).to\_uint()].clear();}
\DoxyCodeLine{00357\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/scheduler/pucch\+\_\+scheduling/pucch\+\_\+allocator\+\_\+impl.\+h\item 
lib/scheduler/pucch\+\_\+scheduling/pucch\+\_\+allocator\+\_\+impl.\+cpp\end{DoxyCompactItemize}
