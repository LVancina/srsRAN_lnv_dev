\doxysection{srsran\+::pdsch\+\_\+encoder\+\_\+hw\+\_\+impl Class Reference}
\hypertarget{classsrsran_1_1pdsch__encoder__hw__impl}{}\label{classsrsran_1_1pdsch__encoder__hw__impl}\index{srsran::pdsch\_encoder\_hw\_impl@{srsran::pdsch\_encoder\_hw\_impl}}


Generic hardware-\/accelerated implementation of the PDSCH encoder.  




{\ttfamily \#include $<$pdsch\+\_\+encoder\+\_\+hw\+\_\+impl.\+h$>$}



Inheritance diagram for srsran\+::pdsch\+\_\+encoder\+\_\+hw\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=228pt]{d1/dab/classsrsran_1_1pdsch__encoder__hw__impl__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::pdsch\+\_\+encoder\+\_\+hw\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=228pt]{d4/da6/classsrsran_1_1pdsch__encoder__hw__impl__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structsrsran_1_1pdsch__encoder__hw__impl_1_1sch__crc}{sch\+\_\+crc}}
\begin{DoxyCompactList}\small\item\em CRC calculators used in shared channels. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1pdsch__encoder__hw__impl_aeef0ad6026726eef581c2da29ae4b078}{pdsch\+\_\+encoder\+\_\+hw\+\_\+impl}} (\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\+\_\+mode\+\_\+}}, \mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\+\_\+tb\+\_\+size\+\_\+}}, \mbox{\hyperlink{structsrsran_1_1pdsch__encoder__hw__impl_1_1sch__crc}{sch\+\_\+crc}} \&c, std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__tx}{ldpc\+\_\+segmenter\+\_\+tx}} $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg}}, std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1hal_1_1hw__accelerator__pdsch__enc}{hal\+::hw\+\_\+accelerator\+\_\+pdsch\+\_\+enc}} $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{hw}})
\begin{DoxyCompactList}\small\item\em PDSCH encoder constructor. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1pdsch__encoder__hw__impl_a99f3f8cd895b9de3b4bf65dd809264c5}{encode}} (\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ codeword, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ transport\+\_\+block, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1pdsch__encoder_1_1configuration}{configuration}} \&config) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Full PDSCH encoding. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1pdsch__encoder}{srsran\+::pdsch\+\_\+encoder}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{virtual}} {\bfseries \texorpdfstring{$\sim$}{\string~}pdsch\+\_\+encoder} ()=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{default}}
\begin{DoxyCompactList}\small\item\em Default destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Generic hardware-\/accelerated implementation of the PDSCH encoder. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1pdsch__encoder__hw__impl_aeef0ad6026726eef581c2da29ae4b078}\label{classsrsran_1_1pdsch__encoder__hw__impl_aeef0ad6026726eef581c2da29ae4b078} 
\index{srsran::pdsch\_encoder\_hw\_impl@{srsran::pdsch\_encoder\_hw\_impl}!pdsch\_encoder\_hw\_impl@{pdsch\_encoder\_hw\_impl}}
\index{pdsch\_encoder\_hw\_impl@{pdsch\_encoder\_hw\_impl}!srsran::pdsch\_encoder\_hw\_impl@{srsran::pdsch\_encoder\_hw\_impl}}
\doxysubsubsection{\texorpdfstring{pdsch\_encoder\_hw\_impl()}{pdsch\_encoder\_hw\_impl()}}
{\footnotesize\ttfamily srsran\+::pdsch\+\_\+encoder\+\_\+hw\+\_\+impl\+::pdsch\+\_\+encoder\+\_\+hw\+\_\+impl (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classbool}{bool}}}]{cb\+\_\+mode\+\_\+,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{max\+\_\+tb\+\_\+size\+\_\+,  }\item[{\mbox{\hyperlink{structsrsran_1_1pdsch__encoder__hw__impl_1_1sch__crc}{sch\+\_\+crc}} \&}]{c,  }\item[{std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__tx}{ldpc\+\_\+segmenter\+\_\+tx}} $>$}]{seg,  }\item[{std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1hal_1_1hw__accelerator__pdsch__enc}{hal\+::hw\+\_\+accelerator\+\_\+pdsch\+\_\+enc}} $>$}]{hw }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



PDSCH encoder constructor. 

Sets up the internal components, namely LDPC segmenter, all the CRC calculators and the hardware accelerator.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em cb\+\_\+mode} & Defines if the PDSCH encoder operates in CB mode (true) or TB mode (false). \\
\hline
\mbox{\texttt{ in}}  & {\em max\+\_\+cb\+\_\+size} & Defines the maximum supported TB size in bytes (CB mode will be forced for larger TBs). Only used in TB mode. \\
\hline
\mbox{\texttt{ in}}  & {\em seg} & Unique pointer to an LDPC segmenter. \\
\hline
\mbox{\texttt{ in}}  & {\em crcs} & Structure with pointers to three CRC calculator objects, with generator polynomials of type {\ttfamily CRC16}, {\ttfamily CRC24A} and {\ttfamily CRC24B}. \\
\hline
\mbox{\texttt{ in}}  & {\em hw} & Unique pointer to a hardware-\/accelerator. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00068\ \ \ \ \ cb\_mode(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_mode\_}}),}
\DoxyCodeLine{00069\ \ \ \ \ max\_tb\_size(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_tb\_size\_}}),}
\DoxyCodeLine{00070\ \ \ \ \ crc\_set(\{std::move(c.crc16),\ std::move(c.crc24A),\ std::move(c.crc24B)\}),}
\DoxyCodeLine{00071\ \ \ \ \ segmenter(std::move(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{seg}})),}
\DoxyCodeLine{00072\ \ \ \ \ encoder(std::move(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{hw}}))}
\DoxyCodeLine{00073\ \ \ \{}
\DoxyCodeLine{00074\ \ \ \ \ srsran\_assert(crc\_set.\mbox{\hyperlink{structsrsran_1_1pdsch__encoder__hw__impl_1_1sch__crc_ac93905c18440177988c12a7742d89c13}{crc16}},\ \textcolor{stringliteral}{"{}Invalid\ CRC16\ calculator."{}});}
\DoxyCodeLine{00075\ \ \ \ \ srsran\_assert(crc\_set.\mbox{\hyperlink{structsrsran_1_1pdsch__encoder__hw__impl_1_1sch__crc_a785f813c6dcc4abd5099ab3089d552d5}{crc24A}},\ \textcolor{stringliteral}{"{}Invalid\ CRC24A\ calculator."{}});}
\DoxyCodeLine{00076\ \ \ \ \ srsran\_assert(crc\_set.\mbox{\hyperlink{structsrsran_1_1pdsch__encoder__hw__impl_1_1sch__crc_a2416e8bf353dadfc4a8c4b1d3de0b9e8}{crc24B}},\ \textcolor{stringliteral}{"{}Invalid\ CRC24B\ calculator."{}});}
\DoxyCodeLine{00077\ \ \ \ \ srsran\_assert(crc\_set.\mbox{\hyperlink{structsrsran_1_1pdsch__encoder__hw__impl_1_1sch__crc_ac93905c18440177988c12a7742d89c13}{crc16}}-\/>get\_generator\_poly()\ ==\ crc\_generator\_poly::CRC16,}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Not\ a\ CRC\ generator\ of\ type\ CRC16."{}});}
\DoxyCodeLine{00079\ \ \ \ \ srsran\_assert(crc\_set.\mbox{\hyperlink{structsrsran_1_1pdsch__encoder__hw__impl_1_1sch__crc_a785f813c6dcc4abd5099ab3089d552d5}{crc24A}}-\/>get\_generator\_poly()\ ==\ crc\_generator\_poly::CRC24A,}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Not\ a\ CRC\ generator\ of\ type\ CRC24A."{}});}
\DoxyCodeLine{00081\ \ \ \ \ srsran\_assert(crc\_set.\mbox{\hyperlink{structsrsran_1_1pdsch__encoder__hw__impl_1_1sch__crc_a2416e8bf353dadfc4a8c4b1d3de0b9e8}{crc24B}}-\/>get\_generator\_poly()\ ==\ crc\_generator\_poly::CRC24B,}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Not\ a\ CRC\ generator\ of\ type\ CRC24B."{}});}
\DoxyCodeLine{00083\ \ \ \ \ srsran\_assert(segmenter,\ \textcolor{stringliteral}{"{}Invalid\ LDPC\ segmenter\ factory."{}});}
\DoxyCodeLine{00084\ \ \ \ \ srsran\_assert(encoder,\ \textcolor{stringliteral}{"{}Invalid\ hardware-\/accelerated\ PDSCH\ encoder."{}});}
\DoxyCodeLine{00085\ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=222pt]{d6/d3c/classsrsran_1_1pdsch__encoder__hw__impl_aeef0ad6026726eef581c2da29ae4b078_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=222pt]{d6/d3c/classsrsran_1_1pdsch__encoder__hw__impl_aeef0ad6026726eef581c2da29ae4b078_icgraph}
\end{center}
\end{figure}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1pdsch__encoder__hw__impl_a99f3f8cd895b9de3b4bf65dd809264c5}\label{classsrsran_1_1pdsch__encoder__hw__impl_a99f3f8cd895b9de3b4bf65dd809264c5} 
\index{srsran::pdsch\_encoder\_hw\_impl@{srsran::pdsch\_encoder\_hw\_impl}!encode@{encode}}
\index{encode@{encode}!srsran::pdsch\_encoder\_hw\_impl@{srsran::pdsch\_encoder\_hw\_impl}}
\doxysubsubsection{\texorpdfstring{encode()}{encode()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} pdsch\+\_\+encoder\+\_\+hw\+\_\+impl\+::encode (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$}]{codeword,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$}]{transport\+\_\+block,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1pdsch__encoder_1_1configuration}{configuration}} \&}]{cfg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Full PDSCH encoding. 

General encoding method that includes the four steps of CRC attachment (see TS38.\+212 Section 7.\+2.\+1), transport block segmentation (see TS38.\+212 Section 7.\+2.\+3), codeblock encoding (see TS38.\+212 Section 7.\+2.\+4) and rate matching (see TS38.\+212 Section 7.\+2.\+5), and codeblock concatenation (see TS38.\+212 Section 7.\+2.\+6) into the PDSCH codeword. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em codeword} & Final PDSCH codeword. \\
\hline
\mbox{\texttt{ in}}  & {\em transport\+\_\+block} & Transport block to be transmitted. \\
\hline
\mbox{\texttt{ in}}  & {\em cfg} & PDSCH configuration parameters. \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classsrsran_1_1pdsch__encoder_a8eb8da18e3dd5568c4db69d2434ce5b1}{srsran\+::pdsch\+\_\+encoder}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00037\ \{}
\DoxyCodeLine{00038\ \ \ \textcolor{comment}{//\ CB\ mode\ will\ be\ forced\ if\ TB\ mode\ is\ requested\ for\ a\ TB\ larger\ than\ the\ maximum\ supported\ size.}}
\DoxyCodeLine{00039\ \ \ \textcolor{keywordflow}{if}\ (!cb\_mode\ \&\&\ transport\_block.\mbox{\hyperlink{classsrsran_1_1span_a251574a211e02a8fea2684eac784fb73}{size\_bytes}}()\ >\ max\_tb\_size)\ \{}
\DoxyCodeLine{00040\ \ \ \ \ cb\_mode\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00041\ \ \ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \textcolor{comment}{//\ Set\ the\ TB\ encoding\ parameters\ (common\ to\ all\ CBs)\ as\ required\ by\ the\ hardware-\/accelerated\ PDSCH\ encoder.}}
\DoxyCodeLine{00044\ \ \ \mbox{\hyperlink{structsrsran_1_1hal_1_1hw__pdsch__encoder__configuration}{hal::hw\_pdsch\_encoder\_configuration}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{hw\_cfg}}\ =\ \{\};}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \textcolor{comment}{//\ Segmentation\ is\ only\ required\ in\ CB\ mode.}}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_ops}}\ =\ 1;}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \mbox{\hyperlink{structsrsran_1_1segmenter__config}{segmenter\_config}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{segmenter\_cfg}};}
\DoxyCodeLine{00050\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{segmenter\_cfg}}.\mbox{\hyperlink{structsrsran_1_1segmenter__config_a07cb0f854c348847ba94e20f2a55063e}{base\_graph}}\ \ \ \ \ =\ config.base\_graph;}
\DoxyCodeLine{00051\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{segmenter\_cfg}}.rv\ \ \ \ \ \ \ \ \ \ \ \ \ =\ config.rv;}
\DoxyCodeLine{00052\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{segmenter\_cfg}}.mod\ \ \ \ \ \ \ \ \ \ \ \ =\ config.mod;}
\DoxyCodeLine{00053\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{segmenter\_cfg}}.Nref\ \ \ \ \ \ \ \ \ \ \ =\ config.Nref;}
\DoxyCodeLine{00054\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{segmenter\_cfg}}.nof\_layers\ \ \ \ \ =\ config.nof\_layers;}
\DoxyCodeLine{00055\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{segmenter\_cfg}}.nof\_ch\_symbols\ =\ config.nof\_ch\_symbols;}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{if}\ (cb\_mode)\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{comment}{//\ Clear\ the\ buffer.}}
\DoxyCodeLine{00059\ \ \ \ \ d\_segments.clear();}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{comment}{//\ Segmentation\ (it\ includes\ CRC\ attachment\ for\ the\ entire\ transport\ block\ and\ each\ individual\ segment).}}
\DoxyCodeLine{00062\ \ \ \ \ segmenter-\/>segment(d\_segments,\ transport\_block,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{segmenter\_cfg}});}
\DoxyCodeLine{00063\ \ \ \}}
\DoxyCodeLine{00064\ \ \ set\_hw\_enc\_tb\_configuration(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{hw\_cfg}},\ transport\_block,\ d\_segments,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{segmenter\_cfg}});}
\DoxyCodeLine{00065\ \ \ \textcolor{keywordflow}{if}\ (cb\_mode)\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_ops}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{hw\_cfg}}.nof\_segments;}
\DoxyCodeLine{00067\ \ \ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \textcolor{comment}{//\ Validate\ that\ all\ CBs\ have\ been\ succesfully\ enqueued\ and\ dequeued.}}
\DoxyCodeLine{00070\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_enqueued\_cb\_id}}\ =\ 0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_dequeued\_cb\_id}}\ =\ 0,\ offset\ =\ 0;}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{all\_enqueued}}\ =\ \textcolor{keyword}{false},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{all\_dequeued}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00072\ \ \ \textcolor{keywordflow}{while}\ (!\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{all\_enqueued}}\ ||\ !\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{all\_dequeued}})\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ Enqueue\ each\ CB\ in\ the\ TB}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enqueued}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_enqueued\_cb\_id}};\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_ops}};\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}})\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ the\ pointer\ to\ the\ CB\ to\ be\ currently\ enqueued.}}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_enqueued\_cb\_id}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}};}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ data\ to\ be\ encoded.}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ uint8\_t>}}\ data;}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cb\_mode)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Retrieve\ the\ CB.}}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1described__segment}{described\_segment}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{descr\_seg}}\ =\ d\_segments[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}}];}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ encoding\ parameters\ of\ the\ CB\ as\ required\ by\ the\ hardware-\/accelerated\ PDSCH\ encoder.}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ set\_hw\_enc\_cb\_configuration(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{hw\_cfg}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{descr\_seg}}.get\_metadata(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}});}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Retrieve\ the\ current\ CB\ to\ be\ encoded.}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ segment\_length\ \ \ \ \ \ \ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{descr\_seg}}.get\_data().size())\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{hw\_cfg}}.nof\_filler\_bits;}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{segment\_length\_bytes}}\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ceil}}(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(segment\_length)\ /\ 8.0));}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ data\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{descr\_seg}}.get\_data().get\_buffer().first(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{segment\_length\_bytes}});}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ encoding\ parameters\ of\ the\ CB\ as\ required\ by\ the\ hardware-\/accelerated\ PDSCH\ encoder.}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ set\_hw\_enc\_cb\_configuration(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{hw\_cfg}},\ \{\},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}});}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Encode\ the\ full\ TB\ at\ once.}}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ data\ =\ transport\_block;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \textcolor{comment}{//\ Enqueue\ the\ hardware-\/accelerated\ PDSCH\ encoding\ operation.}}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enqueued}}\ =\ encoder-\/>enqueue\_operation(data,\ \{\},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}});}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \ \ \textcolor{comment}{//\ Exit\ the\ enqueing\ loop\ in\ case\ the\ operation\ couldn't\ be\ enqueued.}}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enqueued}})\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00106\ \ \ \ \ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{comment}{//\ The\ loop\ is\ exited\ when\ all\ CBs\ in\ the\ TB\ have\ been\ enqueued,\ the\ queue\ is\ full\ or\ because\ enqueuing\ failed\ for\ a}}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{comment}{//\ given\ CB.}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{enqueued}})\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ the\ enqueuing\ point\ to\ ensure\ that\ each\ CB\ is\ only\ enqueued\ once.}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_enqueued\_cb\_id}}\ ==\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_ops}}\ -\/\ 1)\ \{}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_enqueued\_cb\_id}};}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{all\_enqueued}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00116\ \ \ \ \ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ Reset\ the\ dequeuing\ control\ variables.}}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_dequeued}}\ =\ 0;}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dequeued}}\ \ \ \ \ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{comment}{//\ Dequeue\ each\ CB\ in\ the\ TB}}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_dequeued\_cb\_id}};\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_enqueued\_cb\_id}};\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}})\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ the\ pointer\ to\ the\ CB\ to\ be\ currently\ dequeued.}}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_dequeued\_cb\_id}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}};}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \ \ \ \ \textcolor{comment}{//\ In\ CB\ mode,\ select\ the\ correct\ chunk\ of\ the\ output\ codeword.}}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \ \ \ \ \ rm\_length\ =\ 0;}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<uint8\_t>}}\ codeblock;}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cb\_mode)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ rm\_length\ =\ d\_segments[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}}].get\_metadata().cb\_specific.rm\_length;}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ srsran\_assert(offset\ +\ rm\_length\ <=\ codeword.\mbox{\hyperlink{classsrsran_1_1span_ad0e376d95ca916144eac76f27f0654ac}{size}}(),\ \textcolor{stringliteral}{"{}Wrong\ codeword\ length."{}});}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ codeblock\ =\ \mbox{\hyperlink{classsrsran_1_1span}{span<uint8\_t>}}(codeword).\mbox{\hyperlink{classsrsran_1_1span_ac5f02596fcb6e8f430a3e11e47a6d7e8}{subspan}}(offset,\ rm\_length);}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ codeblock\ =\ codeword;}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ at\ least\ one\ operation\ is\ dequeued.}}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dequeued}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dequeued}})\ \{}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Dequeue\ the\ hardware-\/accelerated\ PUSCH\ decoding\ operation\ (updates\ the\ softbuffer\ too).}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dequeued}}\ =\ encoder-\/>dequeue\_operation(codeblock,\ codeblock\_packed,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_id}});}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dequeued}})\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_dequeued}}\ >\ 0)\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{num\_dequeued}};}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \ \ \textcolor{comment}{//\ Exit\ the\ dequeueing\ loop\ in\ case\ no\ more\ operations\ can\ be\ dequeued.}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dequeued}})\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ the\ dequeuing\ offset\ within\ the\ TB.}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ offset\ +=\ rm\_length;}
\DoxyCodeLine{00160\ \ \ \ \ \}}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{comment}{//\ The\ loop\ is\ exited\ when\ all\ enqueued\ CBs\ have\ been\ dequeued\ or\ because\ dequeuing\ failed\ for\ a\ given\ CB.}}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dequeued}})\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \textcolor{comment}{//\ Dequeueing\ of\ a\ given\ CB\ only\ has\ to\ take\ place\ once.}}
\DoxyCodeLine{00164\ \ \ \ \ \ \ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_dequeued\_cb\_id}};}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_dequeued\_cb\_id}}\ ==\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_ops}})\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{all\_dequeued}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00168\ \ \ \ \ \}}
\DoxyCodeLine{00169\ \ \ \}}
\DoxyCodeLine{00170\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/phy/upper/channel\+\_\+processors/\mbox{\hyperlink{pdsch__encoder__hw__impl_8h}{pdsch\+\_\+encoder\+\_\+hw\+\_\+impl.\+h}}\item 
lib/phy/upper/channel\+\_\+processors/pdsch\+\_\+encoder\+\_\+hw\+\_\+impl.\+cpp\end{DoxyCompactItemize}
