\doxysection{srsran\+::dl\+\_\+sch\+\_\+pdu\+\_\+assembler Class Reference}
\hypertarget{classsrsran_1_1dl__sch__pdu__assembler}{}\label{classsrsran_1_1dl__sch__pdu__assembler}\index{srsran::dl\_sch\_pdu\_assembler@{srsran::dl\_sch\_pdu\_assembler}}


Class that manages the encoding of DL-\/\+SCH MAC PDUs that will be stored in Transport Blocks.  




{\ttfamily \#include $<$dl\+\_\+sch\+\_\+pdu\+\_\+assembler.\+h$>$}



Collaboration diagram for srsran\+::dl\+\_\+sch\+\_\+pdu\+\_\+assembler\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=219pt]{d9/d55/classsrsran_1_1dl__sch__pdu__assembler__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1dl__sch__pdu__assembler_ad2f1b7e5f240e8395628f3afd186d6cb}{dl\+\_\+sch\+\_\+pdu\+\_\+assembler}} (\mbox{\hyperlink{classsrsran_1_1mac__dl__ue__manager}{mac\+\_\+dl\+\_\+ue\+\_\+manager}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\+\_\+mng\+\_\+}})
\item 
\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ \mbox{\hyperlink{classsrsran_1_1dl__sch__pdu__assembler_ad18504b2876ec6b2425b53f4e7bbda2f}{assemble\+\_\+newtx\+\_\+pdu}} (\mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}} rnti, \mbox{\hyperlink{namespacesrsran_a5afde872b5d597c47d3674cc7f86b19b}{harq\+\_\+id\+\_\+t}} h\+\_\+id, \mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\+\_\+idx}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1dl__msg__tb__info}{dl\+\_\+msg\+\_\+tb\+\_\+info}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\+\_\+info}}, \mbox{\hyperlink{classunsigned}{unsigned}} tb\+\_\+size\+\_\+bytes)
\begin{DoxyCompactList}\small\item\em Encodes a MAC DL-\/\+SCH PDU with the provided scheduler information. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ \mbox{\hyperlink{classsrsran_1_1dl__sch__pdu__assembler_abdfebb3924fbbe6c99450c18ca697215}{assemble\+\_\+retx\+\_\+pdu}} (\mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}} rnti, \mbox{\hyperlink{namespacesrsran_a5afde872b5d597c47d3674cc7f86b19b}{harq\+\_\+id\+\_\+t}} harq\+\_\+id, \mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\+\_\+idx}}, \mbox{\hyperlink{classunsigned}{unsigned}} tbs\+\_\+bytes)
\begin{DoxyCompactList}\small\item\em Fetches and assembles MAC DL-\/\+SCH PDU that corresponds to a HARQ retransmission. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Class that manages the encoding of DL-\/\+SCH MAC PDUs that will be stored in Transport Blocks. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1dl__sch__pdu__assembler_ad2f1b7e5f240e8395628f3afd186d6cb}\label{classsrsran_1_1dl__sch__pdu__assembler_ad2f1b7e5f240e8395628f3afd186d6cb} 
\index{srsran::dl\_sch\_pdu\_assembler@{srsran::dl\_sch\_pdu\_assembler}!dl\_sch\_pdu\_assembler@{dl\_sch\_pdu\_assembler}}
\index{dl\_sch\_pdu\_assembler@{dl\_sch\_pdu\_assembler}!srsran::dl\_sch\_pdu\_assembler@{srsran::dl\_sch\_pdu\_assembler}}
\doxysubsubsection{\texorpdfstring{dl\_sch\_pdu\_assembler()}{dl\_sch\_pdu\_assembler()}}
{\footnotesize\ttfamily dl\+\_\+sch\+\_\+pdu\+\_\+assembler\+::dl\+\_\+sch\+\_\+pdu\+\_\+assembler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1mac__dl__ue__manager}{mac\+\_\+dl\+\_\+ue\+\_\+manager}} \&}]{ue\+\_\+mng\+\_\+ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00266\ \ \ ue\_mng(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\_mng\_}}),\ logger(srslog::fetch\_basic\_logger(\textcolor{stringliteral}{"{}MAC"{}}))}
\DoxyCodeLine{00267\ \{}
\DoxyCodeLine{00268\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1dl__sch__pdu__assembler_ad18504b2876ec6b2425b53f4e7bbda2f}\label{classsrsran_1_1dl__sch__pdu__assembler_ad18504b2876ec6b2425b53f4e7bbda2f} 
\index{srsran::dl\_sch\_pdu\_assembler@{srsran::dl\_sch\_pdu\_assembler}!assemble\_newtx\_pdu@{assemble\_newtx\_pdu}}
\index{assemble\_newtx\_pdu@{assemble\_newtx\_pdu}!srsran::dl\_sch\_pdu\_assembler@{srsran::dl\_sch\_pdu\_assembler}}
\doxysubsubsection{\texorpdfstring{assemble\_newtx\_pdu()}{assemble\_newtx\_pdu()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ dl\+\_\+sch\+\_\+pdu\+\_\+assembler\+::assemble\+\_\+newtx\+\_\+pdu (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}}}]{rnti,  }\item[{\mbox{\hyperlink{namespacesrsran_a5afde872b5d597c47d3674cc7f86b19b}{harq\+\_\+id\+\_\+t}}}]{h\+\_\+id,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{tb\+\_\+idx,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1dl__msg__tb__info}{dl\+\_\+msg\+\_\+tb\+\_\+info}} \&}]{tb\+\_\+info,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{tb\+\_\+size\+\_\+bytes }\end{DoxyParamCaption})}



Encodes a MAC DL-\/\+SCH PDU with the provided scheduler information. 


\begin{DoxyParams}{Parameters}
{\em rnti} & RNTI for which the MAC PDU was allocated. \\
\hline
{\em h\+\_\+id} & HARQ-\/\+Id of the HARQ process used for this PDU transmission. \\
\hline
{\em tb\+\_\+idx} & Transport block index of the HARQ process used for this PDU transmission. \\
\hline
{\em tb\+\_\+info} & The information relative to the transport block allocated by the scheduler. This class contains a list of LCIDs of the sub\+PDUs to allocated together with how many bytes each sub\+PDU should take. \\
\hline
{\em tb\+\_\+size\+\_\+bytes} & Number of bytes allocated for the Transport Block. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Byte container with assembled PDU. This container length should be lower or equal to {\ttfamily tb\+\_\+size\+\_\+bytes}. 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{00278\ \{}
\DoxyCodeLine{00279\ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<uint8\_t>}}\ buffer\ =\ ue\_mng.get\_dl\_harq\_buffer(rnti,\ h\_id,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_idx}});}
\DoxyCodeLine{00280\ \ \ \textcolor{keywordflow}{if}\ (buffer.\mbox{\hyperlink{classsrsran_1_1span_ad0e376d95ca916144eac76f27f0654ac}{size}}()\ <\ tb\_size\_bytes)\ \{}
\DoxyCodeLine{00281\ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}DL\ ue=\{\}\ rnti=\{\}\ h\_id=\{\}:\ Failed\ to\ assemble\ MAC\ PDU.\ Cause:\ No\ HARQ\ buffers\ available"{}},}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_mng.get\_ue\_index(rnti),}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rnti,}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ h\_id);}
\DoxyCodeLine{00285\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ uint8\_t>}}(zero\_buffer).\mbox{\hyperlink{classsrsran_1_1span_aa4238c2e04ac8c60726db8cc0b687582}{first}}(tb\_size\_bytes);}
\DoxyCodeLine{00286\ \ \ \}}
\DoxyCodeLine{00287\ \ \ \mbox{\hyperlink{classsrsran_1_1dl__sch__pdu}{dl\_sch\_pdu}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\_pdu}}(buffer.\mbox{\hyperlink{classsrsran_1_1span_aa4238c2e04ac8c60726db8cc0b687582}{first}}(tb\_size\_bytes));}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ pdu\_log\_builder\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_logger}}\{ue\_mng.get\_ue\_index(rnti),\ rnti,\ \mbox{\hyperlink{classsrsran_1_1units_1_1bytes}{units::bytes}}\{tb\_size\_bytes\},\ fmtbuf,\ logger\};}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \textcolor{comment}{//\ Encode\ added\ subPDUs.}}
\DoxyCodeLine{00292\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1dl__msg__lc__info}{dl\_msg\_lc\_info}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sched\_lch}}\ :\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_info}}.lc\_chs\_to\_sched)\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sched\_lch}}.lcid.is\_sdu())\ \{}
\DoxyCodeLine{00294\ \ \ \ \ \ \ assemble\_sdus(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\_pdu}},\ rnti,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sched\_lch}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_logger}});}
\DoxyCodeLine{00295\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00296\ \ \ \ \ \ \ assemble\_ce(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\_pdu}},\ rnti,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sched\_lch}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_logger}});}
\DoxyCodeLine{00297\ \ \ \ \ \}}
\DoxyCodeLine{00298\ \ \ \}}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \ \ \textcolor{comment}{//\ Add\ Padding\ if\ required.}}
\DoxyCodeLine{00301\ \ \ \textcolor{keywordtype}{unsigned}\ current\_size\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\_pdu}}.nof\_bytes();}
\DoxyCodeLine{00302\ \ \ \textcolor{keywordflow}{if}\ (current\_size\ <\ tb\_size\_bytes)\ \{}
\DoxyCodeLine{00303\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\_pdu}}.add\_padding(tb\_size\_bytes\ -\/\ current\_size);}
\DoxyCodeLine{00304\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (current\_size\ >\ tb\_size\_bytes)\ \{}
\DoxyCodeLine{00305\ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}ERROR:\ Allocated\ subPDUs\ exceed\ TB\ size\ (\{\}\ >\ \{\})"{}},\ current\_size,\ tb\_size\_bytes);}
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{00307\ \ \ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_logger}}.log();}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\_pdu}}.get();}
\DoxyCodeLine{00312\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1dl__sch__pdu__assembler_abdfebb3924fbbe6c99450c18ca697215}\label{classsrsran_1_1dl__sch__pdu__assembler_abdfebb3924fbbe6c99450c18ca697215} 
\index{srsran::dl\_sch\_pdu\_assembler@{srsran::dl\_sch\_pdu\_assembler}!assemble\_retx\_pdu@{assemble\_retx\_pdu}}
\index{assemble\_retx\_pdu@{assemble\_retx\_pdu}!srsran::dl\_sch\_pdu\_assembler@{srsran::dl\_sch\_pdu\_assembler}}
\doxysubsubsection{\texorpdfstring{assemble\_retx\_pdu()}{assemble\_retx\_pdu()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ dl\+\_\+sch\+\_\+pdu\+\_\+assembler\+::assemble\+\_\+retx\+\_\+pdu (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}}}]{rnti,  }\item[{\mbox{\hyperlink{namespacesrsran_a5afde872b5d597c47d3674cc7f86b19b}{harq\+\_\+id\+\_\+t}}}]{harq\+\_\+id,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{tb\+\_\+idx,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{tbs\+\_\+bytes }\end{DoxyParamCaption})}



Fetches and assembles MAC DL-\/\+SCH PDU that corresponds to a HARQ retransmission. 


\begin{DoxyParams}{Parameters}
{\em rnti} & RNTI for which the MAC PDU was allocated. \\
\hline
{\em h\+\_\+id} & HARQ-\/\+Id of the HARQ process used for this PDU transmission. \\
\hline
{\em tb\+\_\+idx} & Transport block index of the HARQ process used for this PDU transmission. \\
\hline
{\em tb\+\_\+size\+\_\+bytes} & Number of bytes allocated for the Transport Block. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Byte container with assembled PDU. 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{00420\ \{}
\DoxyCodeLine{00421\ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<uint8\_t>}}\ buffer\ =\ ue\_mng.get\_dl\_harq\_buffer(rnti,\ h\_id,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_idx}});}
\DoxyCodeLine{00422\ \ \ \textcolor{keywordflow}{if}\ (buffer.\mbox{\hyperlink{classsrsran_1_1span_ad0e376d95ca916144eac76f27f0654ac}{size}}()\ <\ tbs\_bytes)\ \{}
\DoxyCodeLine{00423\ \ \ \ \ logger.error(\textcolor{stringliteral}{"{}DL\ ue=\{\}\ rnti=\{\}\ h\_id=\{\}:\ Failed\ to\ assemble\ MAC\ PDU.\ Cause:\ No\ HARQ\ buffers\ available"{}},}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ue\_mng.get\_ue\_index(rnti),}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rnti,}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ h\_id);}
\DoxyCodeLine{00427\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ uint8\_t>}}(zero\_buffer).\mbox{\hyperlink{classsrsran_1_1span_aa4238c2e04ac8c60726db8cc0b687582}{first}}(tbs\_bytes);}
\DoxyCodeLine{00428\ \ \ \}}
\DoxyCodeLine{00429\ \ \ \textcolor{keywordflow}{return}\ buffer.\mbox{\hyperlink{classsrsran_1_1span_aa4238c2e04ac8c60726db8cc0b687582}{first}}(tbs\_bytes);}
\DoxyCodeLine{00430\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/mac/mac\+\_\+dl/dl\+\_\+sch\+\_\+pdu\+\_\+assembler.\+h\item 
lib/mac/mac\+\_\+dl/dl\+\_\+sch\+\_\+pdu\+\_\+assembler.\+cpp\end{DoxyCompactItemize}
