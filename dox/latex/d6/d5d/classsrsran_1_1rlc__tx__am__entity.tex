\doxysection{srsran\+::rlc\+\_\+tx\+\_\+am\+\_\+entity Class Reference}
\hypertarget{classsrsran_1_1rlc__tx__am__entity}{}\label{classsrsran_1_1rlc__tx__am__entity}\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}


Inheritance diagram for srsran\+::rlc\+\_\+tx\+\_\+am\+\_\+entity\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d0/d54/classsrsran_1_1rlc__tx__am__entity__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::rlc\+\_\+tx\+\_\+am\+\_\+entity\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d9/db2/classsrsran_1_1rlc__tx__am__entity__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_acd7788c53c21aec4f1349fde033826fa}{rlc\+\_\+tx\+\_\+am\+\_\+entity}} (uint32\+\_\+t du\+\_\+index, \mbox{\hyperlink{namespacesrsran_a511ed22603607d4a784c0f1807648b47}{du\+\_\+ue\+\_\+index\+\_\+t}} ue\+\_\+index, \mbox{\hyperlink{classsrsran_1_1rb__id__t}{rb\+\_\+id\+\_\+t}} rb\+\_\+id, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config}{rlc\+\_\+tx\+\_\+am\+\_\+config}} \&config, \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__notifier}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+notifier}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{upper\+\_\+dn\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__control__notifier}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+control\+\_\+notifier}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{upper\+\_\+cn\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__notifier}{rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+notifier}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{lower\+\_\+dn\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1timer__factory}{timer\+\_\+factory}} timers, \mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pcell\+\_\+executor\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\+\_\+executor\+\_\+}}, \mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{metrics\+\_\+enabled\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1rlc__pcap}{rlc\+\_\+pcap}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pcap\+\_\+}})
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_ab7082c2469c7b6d60621ac0a812c6702}{set\+\_\+status\+\_\+provider}} (\mbox{\hyperlink{classsrsran_1_1rlc__rx__am__status__provider}{rlc\+\_\+rx\+\_\+am\+\_\+status\+\_\+provider}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{status\+\_\+provider\+\_\+}})
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_aefd48f6a90b1f4de6f701feea72d50b9}{handle\+\_\+sdu}} (\mbox{\hyperlink{structsrsran_1_1rlc__sdu}{rlc\+\_\+sdu}} sdu) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Interface for higher layers to pass SDUs into RLC. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a9cfef999318ce4118427cfe154c28e49}{discard\+\_\+sdu}} (uint32\+\_\+t pdcp\+\_\+sn) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Interface for higher layers to discard SDUs from RLC queue. \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_aae545ee2d475205ef89cefae7931cbab}{pull\+\_\+pdu}} (\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rlc\+\_\+pdu\+\_\+buf}}) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Pulls a PDU from the lower end of the RLC TX entity No PDU is written if the size of {\ttfamily rlc\+\_\+pdu\+\_\+buf} is insufficient or the TX buffer is empty. \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_ac610ab8a5e2fd8da6bfcf7e5007988a7}{get\+\_\+buffer\+\_\+state}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Get the buffer status information This function provides the current buffer state of the RLC TX entity. This is the gross total size required to fully flush the TX entity (potentially by multiple calls to pull\+\_\+pdu). \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_ae730ee9d83bf14c7ff3d4e1e377da8df}{on\+\_\+status\+\_\+pdu}} (\mbox{\hyperlink{classsrsran_1_1rlc__am__status__pdu}{rlc\+\_\+am\+\_\+status\+\_\+pdu}} status) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Status PDU handler for TX entity. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a274119bec2d36e23f0f1adfcd65fe8df}{on\+\_\+status\+\_\+report\+\_\+changed}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Informs the TX entity that a status report is triggered or its size has changed, so that the buffer status report needs to be updated. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a2bba6bbf36fd7f28fd9aeb624fa3f085}{get\+\_\+polling\+\_\+bit}} (uint32\+\_\+t sn, \mbox{\hyperlink{classbool}{bool}} is\+\_\+retx, uint32\+\_\+t payload\+\_\+size)
\begin{DoxyCompactList}\small\item\em Determines whether the polling bit in a PDU header has to be set or not Ref\+: TS 38.\+322, Sec. 5.\+3.\+3.\+2. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a398c38e0e19f66404a5627757628615e}{on\+\_\+expired\+\_\+poll\+\_\+retransmit\+\_\+timer}} ()
\begin{DoxyCompactList}\small\item\em on\+\_\+expired\+\_\+poll\+\_\+retransmit\+\_\+timer \doxylink{classHandler}{Handler} for expired poll\+\_\+retransmit\+\_\+timer \end{DoxyCompactList}\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_ad14e9baeb52141c5d802dd39f8b1c0fc}{inside\+\_\+tx\+\_\+window}} (uint32\+\_\+t sn) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\begin{DoxyCompactList}\small\item\em Checks if a sequence number is inside the TX window. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_adc069ac771957d3729e8573efb49cd4c}{is\+\_\+tx\+\_\+window\+\_\+full}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\begin{DoxyCompactList}\small\item\em Checks if the TX window is currently full. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_ac53a40aec1318896858134351fa92342}{valid\+\_\+ack\+\_\+sn}} (uint32\+\_\+t sn) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\begin{DoxyCompactList}\small\item\em This function is used to check if a received status report as a valid ACK\+\_\+\+SN. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a4e69c79d75db0e3b54f569a69a4022f0}{valid\+\_\+nack}} (uint32\+\_\+t ack\+\_\+sn, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1rlc__am__status__nack}{rlc\+\_\+am\+\_\+status\+\_\+nack}} \&nack\+\_\+sn) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\begin{DoxyCompactList}\small\item\em This function is used to check if a received NACK within a status report is valid. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a3d2de9e02babb81d2dc715f8a0e7ea94}{set\+\_\+state}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state}{rlc\+\_\+tx\+\_\+am\+\_\+state}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{st\+\_\+}})
\item 
\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state}{rlc\+\_\+tx\+\_\+am\+\_\+state}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_a0ff975bf2fd8655389c38483c2234fe2}{get\+\_\+state}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1rlc__tx__entity}{srsran\+::rlc\+\_\+tx\+\_\+entity}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{structsrsran_1_1rlc__tx__metrics}{rlc\+\_\+tx\+\_\+metrics}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__entity_ab835005656d9d0dbb67e19d6d49b3577}{get\+\_\+metrics}} ()
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__entity_a6c881c34347d814d0a59be6ed9eca264}{reset\+\_\+metrics}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__interface}{srsran\+::rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+interface}}}
\begin{DoxyCompactItemize}
\item 
{\bfseries rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+interface} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__interface}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+interface}} \&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
\mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__interface}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+interface}} \& {\bfseries operator=} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__interface}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+interface}} \&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
{\bfseries rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+interface} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__interface}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+interface}} \&\&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
\mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__interface}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+interface}} \& {\bfseries operator=} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__interface}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+interface}} \&\&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__interface}{srsran\+::rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+interface}}}
\begin{DoxyCompactItemize}
\item 
{\bfseries rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+interface} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__interface}{rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+interface}} \&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
\mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__interface}{rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+interface}} \& {\bfseries operator=} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__interface}{rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+interface}} \&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
{\bfseries rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+interface} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__interface}{rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+interface}} \&\&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
\mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__interface}{rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+interface}} \& {\bfseries operator=} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__interface}{rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+interface}} \&\&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Additional Inherited Members}
\doxysubsection*{Public Attributes inherited from \mbox{\hyperlink{structsrsran_1_1rlc__tx__metrics}{srsran\+::rlc\+\_\+tx\+\_\+metrics}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classuint32__t}{uint32\+\_\+t}} {\bfseries num\+\_\+sdus}
\begin{DoxyCompactList}\small\item\em Number of SDUs. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classuint32__t}{uint32\+\_\+t}} {\bfseries num\+\_\+of\+\_\+pulled\+\_\+sdus}
\begin{DoxyCompactList}\small\item\em Number of pulled SDUs. \end{DoxyCompactList}\item 
size\+\_\+t {\bfseries num\+\_\+sdu\+\_\+bytes}
\begin{DoxyCompactList}\small\item\em Number of SDU bytes. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classuint32__t}{uint32\+\_\+t}} {\bfseries num\+\_\+dropped\+\_\+sdus}
\begin{DoxyCompactList}\small\item\em Number of dropped SDUs (due to full queue) \end{DoxyCompactList}\item 
\mbox{\hyperlink{classuint32__t}{uint32\+\_\+t}} {\bfseries num\+\_\+discarded\+\_\+sdus}
\begin{DoxyCompactList}\small\item\em Number of discarded SDUs (instructed from higher layer) \end{DoxyCompactList}\item 
\mbox{\hyperlink{classuint32__t}{uint32\+\_\+t}} {\bfseries num\+\_\+discard\+\_\+failures}
\begin{DoxyCompactList}\small\item\em Number of failed SDU discards (instructed from higher layer) \end{DoxyCompactList}\item 
\mbox{\hyperlink{classuint32__t}{uint32\+\_\+t}} {\bfseries sum\+\_\+sdu\+\_\+latency\+\_\+us}
\begin{DoxyCompactList}\small\item\em total SDU latency (in us)\texorpdfstring{$>$}{>} \end{DoxyCompactList}\item 
\mbox{\hyperlink{classuint32__t}{uint32\+\_\+t}} {\bfseries num\+\_\+pdus\+\_\+no\+\_\+segmentation}
\begin{DoxyCompactList}\small\item\em Number of transmitted PDUs without segmentation. \end{DoxyCompactList}\item 
size\+\_\+t {\bfseries num\+\_\+pdu\+\_\+bytes\+\_\+no\+\_\+segmentation}
\begin{DoxyCompactList}\small\item\em Number of transmitted PDU bytes without segmentation. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a1c771f379fa63ba2137654c259563308}{rlc\+\_\+mode}} {\bfseries mode}
\begin{DoxyCompactList}\small\item\em RLC mode of the entity. \end{DoxyCompactList}\item 
\begin{tabbing}
xx\=xx\=xx\=xx\=xx\=xx\=xx\=xx\=xx\=\kill
union \{\\
\>\mbox{\hyperlink{structsrsran_1_1rlc__tm__tx__metrics}{rlc\_tm\_tx\_metrics}} {\bfseries tm}\\
\>\mbox{\hyperlink{structsrsran_1_1rlc__um__tx__metrics}{rlc\_um\_tx\_metrics}} {\bfseries um}\\
\>\mbox{\hyperlink{structsrsran_1_1rlc__am__tx__metrics}{rlc\_am\_tx\_metrics}} {\bfseries am}\\
\} \mbox{\hyperlink{structsrsran_1_1rlc__tx__metrics_a97e10254bd7914a69ee8f0182d5dc2cc}{mode\_specific}}\\

\end{tabbing}\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1rlc__tx__entity}{srsran\+::rlc\+\_\+tx\+\_\+entity}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1rlc__tx__entity_a3d60bcedb1ee117619637568433ca906}{rlc\+\_\+tx\+\_\+entity}} (\mbox{\hyperlink{classuint32__t}{uint32\+\_\+t}} du\+\_\+index, \mbox{\hyperlink{namespacesrsran_a511ed22603607d4a784c0f1807648b47}{du\+\_\+ue\+\_\+index\+\_\+t}} ue\+\_\+index, \mbox{\hyperlink{classsrsran_1_1rb__id__t}{rb\+\_\+id\+\_\+t}} rb\+\_\+id, \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__notifier}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+notifier}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{upper\+\_\+dn\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__control__notifier}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+control\+\_\+notifier}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{upper\+\_\+cn\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__notifier}{rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+notifier}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{lower\+\_\+dn\+\_\+}}, \mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{metrics\+\_\+enabled}}, \mbox{\hyperlink{classsrsran_1_1rlc__pcap}{rlc\+\_\+pcap}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pcap\+\_\+}})
\end{DoxyCompactItemize}
\doxysubsection*{Protected Attributes inherited from \mbox{\hyperlink{classsrsran_1_1rlc__tx__entity}{srsran\+::rlc\+\_\+tx\+\_\+entity}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1prefixed__logger}{rlc\+\_\+bearer\+\_\+logger}} {\bfseries logger}
\item 
\mbox{\hyperlink{classsrsran_1_1rlc__tx__metrics__container}{rlc\+\_\+tx\+\_\+metrics\+\_\+container}} {\bfseries metrics}
\item 
\mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__notifier}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+notifier}} \& {\bfseries upper\+\_\+dn}
\item 
\mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__control__notifier}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+control\+\_\+notifier}} \& {\bfseries upper\+\_\+cn}
\item 
\mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__notifier}{rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+notifier}} \& {\bfseries lower\+\_\+dn}
\item 
\mbox{\hyperlink{classsrsran_1_1rlc__pcap}{rlc\+\_\+pcap}} \& {\bfseries pcap}
\end{DoxyCompactItemize}


\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_acd7788c53c21aec4f1349fde033826fa}\label{classsrsran_1_1rlc__tx__am__entity_acd7788c53c21aec4f1349fde033826fa} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!rlc\_tx\_am\_entity@{rlc\_tx\_am\_entity}}
\index{rlc\_tx\_am\_entity@{rlc\_tx\_am\_entity}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{rlc\_tx\_am\_entity()}{rlc\_tx\_am\_entity()}}
{\footnotesize\ttfamily rlc\+\_\+tx\+\_\+am\+\_\+entity\+::rlc\+\_\+tx\+\_\+am\+\_\+entity (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{du\+\_\+index,  }\item[{\mbox{\hyperlink{namespacesrsran_a511ed22603607d4a784c0f1807648b47}{du\+\_\+ue\+\_\+index\+\_\+t}}}]{ue\+\_\+index,  }\item[{\mbox{\hyperlink{classsrsran_1_1rb__id__t}{rb\+\_\+id\+\_\+t}}}]{rb\+\_\+id,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config}{rlc\+\_\+tx\+\_\+am\+\_\+config}} \&}]{config,  }\item[{\mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__notifier}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+notifier}} \&}]{upper\+\_\+dn\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__control__notifier}{rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+control\+\_\+notifier}} \&}]{upper\+\_\+cn\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__notifier}{rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+notifier}} \&}]{lower\+\_\+dn\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1timer__factory}{timer\+\_\+factory}}}]{timers,  }\item[{\mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&}]{pcell\+\_\+executor\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&}]{ue\+\_\+executor\+\_\+,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{metrics\+\_\+enabled\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1rlc__pcap}{rlc\+\_\+pcap}} \&}]{pcap\+\_\+ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00046\ \ \ \mbox{\hyperlink{classsrsran_1_1rlc__tx__entity}{rlc\_tx\_entity}}(du\_index,\ ue\_index,\ rb\_id,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{upper\_dn\_}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{upper\_cn\_}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{lower\_dn\_}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{metrics\_enabled\_}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pcap\_}}),}
\DoxyCodeLine{00047\ \ \ cfg(config),}
\DoxyCodeLine{00048\ \ \ sdu\_queue(cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_a34f3c5f613e31ff2081af06caaf33b05}{queue\_size}},\ logger),}
\DoxyCodeLine{00049\ \ \ retx\_queue(\mbox{\hyperlink{namespacesrsran_ada4c5e4e89a42d8c43ad7ebab29ef30f}{window\_size}}(to\_number(cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_ac5dcf5ae2ca9ca97a99adc5433698fc2}{sn\_field\_length}}))),}
\DoxyCodeLine{00050\ \ \ mod(\mbox{\hyperlink{namespacesrsran_abcf66419637f2dc1494305c3b8d7aaf5}{cardinality}}(to\_number(cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_ac5dcf5ae2ca9ca97a99adc5433698fc2}{sn\_field\_length}}))),}
\DoxyCodeLine{00051\ \ \ am\_window\_size(\mbox{\hyperlink{namespacesrsran_ada4c5e4e89a42d8c43ad7ebab29ef30f}{window\_size}}(to\_number(cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_ac5dcf5ae2ca9ca97a99adc5433698fc2}{sn\_field\_length}}))),}
\DoxyCodeLine{00052\ \ \ tx\_window(create\_tx\_window(cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_ac5dcf5ae2ca9ca97a99adc5433698fc2}{sn\_field\_length}})),}
\DoxyCodeLine{00053\ \ \ pdu\_recycler(\mbox{\hyperlink{namespacesrsran_ada4c5e4e89a42d8c43ad7ebab29ef30f}{window\_size}}(to\_number(cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_ac5dcf5ae2ca9ca97a99adc5433698fc2}{sn\_field\_length}})),\ logger),}
\DoxyCodeLine{00054\ \ \ head\_min\_size(rlc\_am\_pdu\_header\_min\_size(cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_ac5dcf5ae2ca9ca97a99adc5433698fc2}{sn\_field\_length}})),}
\DoxyCodeLine{00055\ \ \ head\_max\_size(rlc\_am\_pdu\_header\_max\_size(cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_ac5dcf5ae2ca9ca97a99adc5433698fc2}{sn\_field\_length}})),}
\DoxyCodeLine{00056\ \ \ poll\_retransmit\_timer(timers.create\_timer()),}
\DoxyCodeLine{00057\ \ \ is\_poll\_retransmit\_timer\_expired(\textcolor{keyword}{false}),}
\DoxyCodeLine{00058\ \ \ pcell\_executor(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pcell\_executor\_}}),}
\DoxyCodeLine{00059\ \ \ ue\_executor(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\_executor\_}}),}
\DoxyCodeLine{00060\ \ \ pcap\_context(ue\_index,\ rb\_id,\ config)}
\DoxyCodeLine{00061\ \{}
\DoxyCodeLine{00062\ \ \ metrics.metrics\_set\_mode(rlc\_mode::am);}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{//\ check\ timer\ t\_poll\_retransmission\ timer}}
\DoxyCodeLine{00065\ \ \ srsran\_assert(poll\_retransmit\_timer.\mbox{\hyperlink{classsrsran_1_1unique__timer_af009b842ea6d7f5bd5ba2cc87016b8bf}{is\_valid}}(),\ \textcolor{stringliteral}{"{}Cannot\ create\ RLC\ TX\ AM,\ timers\ not\ configured."{}});}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \textcolor{comment}{//\ \ configure\ t\_poll\_retransmission\ timer}}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{if}\ (cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_aee93e67d4d6e5e45dd410fea60928793}{t\_poll\_retx}}\ >\ 0)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ poll\_retransmit\_timer.\mbox{\hyperlink{classsrsran_1_1unique__timer_a79c9d6ec6c5942aa869ea4ba273536c5}{set}}(std::chrono::milliseconds(cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_aee93e67d4d6e5e45dd410fea60928793}{t\_poll\_retx}}),}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this}](\mbox{\hyperlink{namespacesrsran_aa72283f3567ebd1eb77b7dd882d6de33}{timer\_id\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tid}})\ \{\ on\_expired\_poll\_retransmit\_timer();\ \});}
\DoxyCodeLine{00071\ \ \ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ logger.log\_info(\textcolor{stringliteral}{"{}RLC\ AM\ configured.\ \{\}"{}},\ cfg);}
\DoxyCodeLine{00074\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_a9cfef999318ce4118427cfe154c28e49}\label{classsrsran_1_1rlc__tx__am__entity_a9cfef999318ce4118427cfe154c28e49} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!discard\_sdu@{discard\_sdu}}
\index{discard\_sdu@{discard\_sdu}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{discard\_sdu()}{discard\_sdu()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} rlc\+\_\+tx\+\_\+am\+\_\+entity\+::discard\+\_\+sdu (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{pdcp\+\_\+sn }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Interface for higher layers to discard SDUs from RLC queue. 


\begin{DoxyParams}{Parameters}
{\em pdcp\+\_\+sn} & PDCP sequence number (SN) of the SDU that is to be discarded \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__interface_a349619ff887450259fa44a739d2980b6}{srsran\+::rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+interface}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00094\ \{}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{if}\ (sdu\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__sdu__queue__lockfree_a5918fa48177cf34b10fef220c8fc719f}{try\_discard}}(pdcp\_sn))\ \{}
\DoxyCodeLine{00096\ \ \ \ \ logger.log\_info(\textcolor{stringliteral}{"{}Discarded\ SDU.\ pdcp\_sn=\{\}"{}},\ pdcp\_sn);}
\DoxyCodeLine{00097\ \ \ \ \ metrics.metrics\_add\_discard(1);}
\DoxyCodeLine{00098\ \ \ \ \ handle\_changed\_buffer\_state();}
\DoxyCodeLine{00099\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00100\ \ \ \ \ logger.log\_info(\textcolor{stringliteral}{"{}Could\ not\ discard\ SDU.\ pdcp\_sn=\{\}"{}},\ pdcp\_sn);}
\DoxyCodeLine{00101\ \ \ \ \ metrics.metrics\_add\_discard\_failure(1);}
\DoxyCodeLine{00102\ \ \ \}}
\DoxyCodeLine{00103\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_ac610ab8a5e2fd8da6bfcf7e5007988a7}\label{classsrsran_1_1rlc__tx__am__entity_ac610ab8a5e2fd8da6bfcf7e5007988a7} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!get\_buffer\_state@{get\_buffer\_state}}
\index{get\_buffer\_state@{get\_buffer\_state}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{get\_buffer\_state()}{get\_buffer\_state()}}
{\footnotesize\ttfamily uint32\+\_\+t rlc\+\_\+tx\+\_\+am\+\_\+entity\+::get\+\_\+buffer\+\_\+state (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Get the buffer status information This function provides the current buffer state of the RLC TX entity. This is the gross total size required to fully flush the TX entity (potentially by multiple calls to pull\+\_\+pdu). 

\begin{DoxyReturn}{Returns}
Provides the current buffer state 
\end{DoxyReturn}


Implements \mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__interface_a7cbb36d4595cc433e55261341ccc641a}{srsran\+::rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+interface}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00878\ \{}
\DoxyCodeLine{00879\ \ \ std::lock\_guard<std::mutex>\ lock(mutex);}
\DoxyCodeLine{00880\ \ \ \textcolor{keywordflow}{return}\ get\_buffer\_state\_nolock();}
\DoxyCodeLine{00881\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_a2bba6bbf36fd7f28fd9aeb624fa3f085}\label{classsrsran_1_1rlc__tx__am__entity_a2bba6bbf36fd7f28fd9aeb624fa3f085} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!get\_polling\_bit@{get\_polling\_bit}}
\index{get\_polling\_bit@{get\_polling\_bit}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{get\_polling\_bit()}{get\_polling\_bit()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} rlc\+\_\+tx\+\_\+am\+\_\+entity\+::get\+\_\+polling\+\_\+bit (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{sn,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{is\+\_\+retx,  }\item[{uint32\+\_\+t}]{payload\+\_\+size }\end{DoxyParamCaption})}



Determines whether the polling bit in a PDU header has to be set or not Ref\+: TS 38.\+322, Sec. 5.\+3.\+3.\+2. 


\begin{DoxyParams}{Parameters}
{\em sn} & Sequence number of PDU to be transmitted \\
\hline
{\em is\+\_\+retx} & Flags whether this PDU is a retransmission or not \\
\hline
{\em payload\+\_\+size} & Length of the data field mapped to the AMD PDU \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 if the polling bit has to be set, otherwise 0 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{00914\ \{}
\DoxyCodeLine{00915\ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}Checking\ poll\ bit\ requirements\ for\ PDU.\ sn=\{\}\ is\_retx=\{\}\ sdu\_bytes=\{\}\ poll\_sn=\{\}"{}},}
\DoxyCodeLine{00916\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sn,}
\DoxyCodeLine{00917\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_retx\ ?\ \textcolor{stringliteral}{"{}true"{}}\ :\ \textcolor{stringliteral}{"{}false"{}},}
\DoxyCodeLine{00918\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ payload\_size,}
\DoxyCodeLine{00919\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ st.poll\_sn);}
\DoxyCodeLine{00920\ \ \ \textcolor{comment}{/*\ For\ each\ AMD\ PDU\ containing\ a\ SDU\ or\ SDU\ segment\ that\ has\ not\ been\ previoulsy\ tranmitted:}}
\DoxyCodeLine{00921\ \textcolor{comment}{\ \ \ *\ -\/\ increment\ PDU\_WITHOUT\_POLL\ by\ one;}}
\DoxyCodeLine{00922\ \textcolor{comment}{\ \ \ *\ -\/\ increment\ BYTE\_WITHOUT\_POLL\ by\ every\ new\ byte\ of\ Data\ field\ element\ that\ it\ maps\ to\ the\ Data\ field\ of\ the\ AMD}}
\DoxyCodeLine{00923\ \textcolor{comment}{\ \ \ *\ PDU;}}
\DoxyCodeLine{00924\ \textcolor{comment}{\ \ \ *\ \ \ -\/\ if\ PDU\_WITHOUT\_POLL\ >=\ pollPDU;\ or}}
\DoxyCodeLine{00925\ \textcolor{comment}{\ \ \ *\ \ \ -\/\ if\ BYTE\_WITHOUT\_POLL\ >=\ pollByte:}}
\DoxyCodeLine{00926\ \textcolor{comment}{\ \ \ *\ \ \ \ -\/\ include\ a\ poll\ in\ the\ AMD\ PDU\ as\ described\ below.}}
\DoxyCodeLine{00927\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{00928\ \ \ \mbox{\hyperlink{classuint8__t}{uint8\_t}}\ poll\ =\ 0;}
\DoxyCodeLine{00929\ \ \ \textcolor{keywordflow}{if}\ (!is\_retx)\ \{}
\DoxyCodeLine{00930\ \ \ \ \ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a1fe4038eb48d43f3f270c99adc34e062}{pdu\_without\_poll}}++;}
\DoxyCodeLine{00931\ \ \ \ \ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_ad8cf1bf9fa17def7d77ace344cf50b06}{byte\_without\_poll}}\ +=\ payload\_size;}
\DoxyCodeLine{00932\ \ \ \ \ \textcolor{keywordflow}{if}\ (cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_a8e5c46a83f6213512885fee3891e4f52}{poll\_pdu}}\ >\ 0\ \&\&\ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a1fe4038eb48d43f3f270c99adc34e062}{pdu\_without\_poll}}\ >=\ (\mbox{\hyperlink{classuint32__t}{uint32\_t}})cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_a8e5c46a83f6213512885fee3891e4f52}{poll\_pdu}})\ \{}
\DoxyCodeLine{00933\ \ \ \ \ \ \ poll\ =\ 1;}
\DoxyCodeLine{00934\ \ \ \ \ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}Setting\ poll\ bit\ due\ to\ PollPDU.\ sn=\{\}\ poll\_sn=\{\}"{}},\ sn,\ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a92f1c0516ab5a0c69ffb84dac79fb547}{poll\_sn}});}
\DoxyCodeLine{00935\ \ \ \ \ \}}
\DoxyCodeLine{00936\ \ \ \ \ \textcolor{keywordflow}{if}\ (cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_a0c46b4c7f055d06ae60cef184be5d355}{poll\_byte}}\ >\ 0\ \&\&\ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_ad8cf1bf9fa17def7d77ace344cf50b06}{byte\_without\_poll}}\ >=\ (\mbox{\hyperlink{classuint32__t}{uint32\_t}})cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_a0c46b4c7f055d06ae60cef184be5d355}{poll\_byte}})\ \{}
\DoxyCodeLine{00937\ \ \ \ \ \ \ poll\ =\ 1;}
\DoxyCodeLine{00938\ \ \ \ \ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}Setting\ poll\ bit\ due\ to\ PollBYTE.\ sn=\{\}\ poll\_sn=\{\}"{}},\ sn,\ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a92f1c0516ab5a0c69ffb84dac79fb547}{poll\_sn}});}
\DoxyCodeLine{00939\ \ \ \ \ \}}
\DoxyCodeLine{00940\ \ \ \}}
\DoxyCodeLine{00941\ }
\DoxyCodeLine{00942\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00943\ \textcolor{comment}{\ \ \ *\ -\/\ if\ both\ the\ transmission\ buffer\ and\ the\ retransmission\ buffer\ becomes\ empty}}
\DoxyCodeLine{00944\ \textcolor{comment}{\ \ \ *\ \ \ (excluding\ transmitted\ RLC\ SDUs\ or\ RLC\ SDU\ segments\ awaiting\ acknowledgements)}}
\DoxyCodeLine{00945\ \textcolor{comment}{\ \ \ *\ \ \ after\ the\ transmission\ of\ the\ AMD\ PDU;\ or}}
\DoxyCodeLine{00946\ \textcolor{comment}{\ \ \ *\ -\/\ if\ no\ new\ RLC\ SDU\ can\ be\ transmitted\ after\ the\ transmission\ of\ the\ AMD\ PDU\ (e.g.\ due\ to\ window\ stalling);}}
\DoxyCodeLine{00947\ \textcolor{comment}{\ \ \ *\ \ \ -\/\ include\ a\ poll\ in\ the\ AMD\ PDU\ as\ described\ below.}}
\DoxyCodeLine{00948\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{00949\ \ \ \textcolor{keywordflow}{if}\ ((sdu\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__sdu__queue__lockfree_a7ba1e310d8d662703f2922303c627a7a}{is\_empty}}()\ \&\&\ retx\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__retx__queue_a778792b878a76c69aec610429a6f243d}{empty}}()\ \&\&\ sn\_under\_segmentation\ ==\ \mbox{\hyperlink{namespacesrsran_a7330c0b829cb3d3717bb70ab14ec3e3c}{INVALID\_RLC\_SN}})\ ||\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_adc069ac771957d3729e8573efb49cd4c}{is\_tx\_window\_full}}())\ \{}
\DoxyCodeLine{00950\ \ \ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}Setting\ poll\ bit\ due\ to\ empty\ buffers/inablity\ to\ TX.\ sn=\{\}\ poll\_sn=\{\}"{}},\ sn,\ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a92f1c0516ab5a0c69ffb84dac79fb547}{poll\_sn}});}
\DoxyCodeLine{00951\ \ \ \ \ poll\ =\ 1;}
\DoxyCodeLine{00952\ \ \ \}}
\DoxyCodeLine{00953\ }
\DoxyCodeLine{00954\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00955\ \textcolor{comment}{\ \ \ *\ From\ Sec.\ 5.3.3.4\ Expiry\ of\ t-\/PollRetransmit}}
\DoxyCodeLine{00956\ \textcolor{comment}{\ \ \ *\ [...]}}
\DoxyCodeLine{00957\ \textcolor{comment}{\ \ \ *\ -\/\ include\ a\ poll\ in\ an\ AMD\ PDU\ as\ described\ in\ clause\ 5.3.3.2.}}
\DoxyCodeLine{00958\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{00959\ \ \ \textcolor{keywordflow}{if}\ (is\_poll\_retransmit\_timer\_expired.exchange(\textcolor{keyword}{false},\ std::memory\_order\_relaxed))\ \{}
\DoxyCodeLine{00960\ \ \ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}Setting\ poll\ bit\ due\ to\ expired\ poll\ retransmit\ timer.\ sn=\{\}\ poll\_sn=\{\}"{}},\ sn,\ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a92f1c0516ab5a0c69ffb84dac79fb547}{poll\_sn}});}
\DoxyCodeLine{00961\ \ \ \ \ poll\ =\ 1;}
\DoxyCodeLine{00962\ \ \ \}}
\DoxyCodeLine{00963\ }
\DoxyCodeLine{00964\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00965\ \textcolor{comment}{\ \ \ *\ -\/\ If\ poll\ bit\ is\ included:}}
\DoxyCodeLine{00966\ \textcolor{comment}{\ \ \ *\ \ \ \ \ -\/\ set\ PDU\_WITHOUT\_POLL\ to\ 0;}}
\DoxyCodeLine{00967\ \textcolor{comment}{\ \ \ *\ \ \ \ \ -\/\ set\ BYTE\_WITHOUT\_POLL\ to\ 0.}}
\DoxyCodeLine{00968\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{00969\ \ \ \textcolor{keywordflow}{if}\ (poll\ ==\ 1)\ \{}
\DoxyCodeLine{00970\ \ \ \ \ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a1fe4038eb48d43f3f270c99adc34e062}{pdu\_without\_poll}}\ \ =\ 0;}
\DoxyCodeLine{00971\ \ \ \ \ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_ad8cf1bf9fa17def7d77ace344cf50b06}{byte\_without\_poll}}\ =\ 0;}
\DoxyCodeLine{00972\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00973\ \textcolor{comment}{\ \ \ \ \ *\ -\/\ set\ POLL\_SN\ to\ the\ highest\ SN\ of\ the\ AMD\ PDU\ among\ the\ AMD\ PDUs\ submitted\ to\ lower\ layer;}}
\DoxyCodeLine{00974\ \textcolor{comment}{\ \ \ \ \ *\ -\/\ if\ t-\/PollRetransmit\ is\ not\ running:}}
\DoxyCodeLine{00975\ \textcolor{comment}{\ \ \ \ \ *\ \ \ -\/\ start\ t-\/PollRetransmit.}}
\DoxyCodeLine{00976\ \textcolor{comment}{\ \ \ \ \ *\ -\/\ else:}}
\DoxyCodeLine{00977\ \textcolor{comment}{\ \ \ \ \ *\ \ \ -\/\ restart\ t-\/PollRetransmit.}}
\DoxyCodeLine{00978\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00979\ \ \ \ \ \textcolor{keywordflow}{if}\ (!is\_retx)\ \{}
\DoxyCodeLine{00980\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ not\ an\ RETX,\ but\ a\ new\ transmission}}
\DoxyCodeLine{00981\ \ \ \ \ \ \ \textcolor{comment}{//\ As\ such\ it\ should\ be\ the\ highest\ SN\ submitted\ to\ the\ lower\ layers}}
\DoxyCodeLine{00982\ \ \ \ \ \ \ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a92f1c0516ab5a0c69ffb84dac79fb547}{poll\_sn}}\ =\ sn;}
\DoxyCodeLine{00983\ \ \ \ \ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}Updated\ poll\_sn=\{\}."{}},\ sn);}
\DoxyCodeLine{00984\ \ \ \ \ \}}
\DoxyCodeLine{00985\ \ \ \ \ \textcolor{keywordflow}{if}\ (cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_aee93e67d4d6e5e45dd410fea60928793}{t\_poll\_retx}}\ >\ 0)\ \{}
\DoxyCodeLine{00986\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ poll\_retransmit\_timer.\mbox{\hyperlink{classsrsran_1_1unique__timer_a600954b52cb062982a086792c201b9d9}{is\_running}}())\ \{}
\DoxyCodeLine{00987\ \ \ \ \ \ \ \ \ poll\_retransmit\_timer.\mbox{\hyperlink{classsrsran_1_1unique__timer_af3fa2fce72a8058698b971e498e0c262}{run}}();}
\DoxyCodeLine{00988\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00989\ \ \ \ \ \ \ \ \ poll\_retransmit\_timer.\mbox{\hyperlink{classsrsran_1_1unique__timer_a1a4efde28d11d176d481f00ce0274d78}{stop}}();}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \ \ poll\_retransmit\_timer.\mbox{\hyperlink{classsrsran_1_1unique__timer_af3fa2fce72a8058698b971e498e0c262}{run}}();}
\DoxyCodeLine{00991\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00992\ \ \ \ \ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}Started\ poll\ retransmit\ timer.\ poll\_sn=\{\}"{}},\ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a92f1c0516ab5a0c69ffb84dac79fb547}{poll\_sn}});}
\DoxyCodeLine{00993\ \ \ \ \ \}}
\DoxyCodeLine{00994\ \ \ \}}
\DoxyCodeLine{00995\ \ \ \textcolor{keywordflow}{return}\ poll;}
\DoxyCodeLine{00996\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_a0ff975bf2fd8655389c38483c2234fe2}\label{classsrsran_1_1rlc__tx__am__entity_a0ff975bf2fd8655389c38483c2234fe2} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!get\_state@{get\_state}}
\index{get\_state@{get\_state}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{get\_state()}{get\_state()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state}{rlc\+\_\+tx\+\_\+am\+\_\+state}} srsran\+::rlc\+\_\+tx\+\_\+am\+\_\+entity\+::get\+\_\+state (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Get the internal state variables Note\+: This function should only be used for testing

\begin{DoxyReturn}{Returns}
A copy of the internal state variables 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{00231\ \{\ \textcolor{keywordflow}{return}\ st;\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_aefd48f6a90b1f4de6f701feea72d50b9}\label{classsrsran_1_1rlc__tx__am__entity_aefd48f6a90b1f4de6f701feea72d50b9} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!handle\_sdu@{handle\_sdu}}
\index{handle\_sdu@{handle\_sdu}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{handle\_sdu()}{handle\_sdu()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} rlc\+\_\+tx\+\_\+am\+\_\+entity\+::handle\+\_\+sdu (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1rlc__sdu}{rlc\+\_\+sdu}}}]{sdu }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Interface for higher layers to pass SDUs into RLC. 


\begin{DoxyParams}{Parameters}
{\em sdu} & SDU to be handled \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classsrsran_1_1rlc__tx__upper__layer__data__interface_a3672e8658872f39bbcbb61afa9a05235}{srsran\+::rlc\+\_\+tx\+\_\+upper\+\_\+layer\+\_\+data\+\_\+interface}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00078\ \{}
\DoxyCodeLine{00079\ \ \ sdu.time\_of\_arrival\ =\ std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{00080\ \ \ \textcolor{keywordtype}{size\_t}\ sdu\_length\ \ \ =\ sdu.buf.\mbox{\hyperlink{classsrsran_1_1byte__buffer_a7168fb8841a83a60b60a2ae06b59662d}{length}}();}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{if}\ (sdu\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__sdu__queue__lockfree_a1a653b33da96f2caea9471794877464c}{write}}(sdu))\ \{}
\DoxyCodeLine{00082\ \ \ \ \ logger.log\_info(}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ sdu.buf.begin(),\ sdu.buf.end(),\ \textcolor{stringliteral}{"{}TX\ SDU.\ sdu\_len=\{\}\ pdcp\_sn=\{\}\ \{\}"{}},\ sdu.buf.\mbox{\hyperlink{classsrsran_1_1byte__buffer_a7168fb8841a83a60b60a2ae06b59662d}{length}}(),\ sdu.pdcp\_sn,\ sdu\_queue);}
\DoxyCodeLine{00084\ \ \ \ \ metrics.metrics\_add\_sdus(1,\ sdu\_length);}
\DoxyCodeLine{00085\ \ \ \ \ handle\_changed\_buffer\_state();}
\DoxyCodeLine{00086\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00087\ \ \ \ \ logger.log\_warning(\textcolor{stringliteral}{"{}Dropped\ SDU.\ sdu\_len=\{\}\ pdcp\_sn=\{\}\ \{\}"{}},\ sdu\_length,\ sdu.pdcp\_sn,\ sdu\_queue);}
\DoxyCodeLine{00088\ \ \ \ \ metrics.metrics\_add\_lost\_sdus(1);}
\DoxyCodeLine{00089\ \ \ \}}
\DoxyCodeLine{00090\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_ad14e9baeb52141c5d802dd39f8b1c0fc}\label{classsrsran_1_1rlc__tx__am__entity_ad14e9baeb52141c5d802dd39f8b1c0fc} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!inside\_tx\_window@{inside\_tx\_window}}
\index{inside\_tx\_window@{inside\_tx\_window}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{inside\_tx\_window()}{inside\_tx\_window()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classbool}{bool}} rlc\+\_\+tx\+\_\+am\+\_\+entity\+::inside\+\_\+tx\+\_\+window (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{sn }\end{DoxyParamCaption}) const}



Checks if a sequence number is inside the TX window. 


\begin{DoxyParams}{Parameters}
{\em sn} & Sequence Number to check \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if sn is inside the TX window, false otherwise 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{01077\ \{}
\DoxyCodeLine{01078\ \ \ \textcolor{comment}{//\ TX\_Next\_Ack\ <=\ SN\ <\ TX\_Next\_Ack\ +\ AM\_Window\_Size}}
\DoxyCodeLine{01079\ \ \ \textcolor{keywordflow}{return}\ tx\_mod\_base(sn)\ <\ am\_window\_size;}
\DoxyCodeLine{01080\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_adc069ac771957d3729e8573efb49cd4c}\label{classsrsran_1_1rlc__tx__am__entity_adc069ac771957d3729e8573efb49cd4c} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!is\_tx\_window\_full@{is\_tx\_window\_full}}
\index{is\_tx\_window\_full@{is\_tx\_window\_full}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{is\_tx\_window\_full()}{is\_tx\_window\_full()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classbool}{bool}} rlc\+\_\+tx\+\_\+am\+\_\+entity\+::is\+\_\+tx\+\_\+window\+\_\+full (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Checks if the TX window is currently full. 

Note "{}full"{} may be smaller than the full window size to try to limit memory usage. A virtual full window configuration parameter can be used to avoid many UEs with 2\texorpdfstring{$^\wedge$}{\string^}18 windows full of PDUs.

\begin{DoxyReturn}{Returns}
true if the window is full. 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{01083\ \{}
\DoxyCodeLine{01084\ \ \ \textcolor{comment}{//\ TX\ window\ is\ full,\ or\ we\ reached\ our\ virtual\ max\ window\ size}}
\DoxyCodeLine{01085\ \ \ \textcolor{keywordflow}{return}\ tx\_window-\/>full()\ ||\ (cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_abae58d34c6084044ac8f8b057f92bea0}{max\_window}}\ !=\ 0\ \&\&\ tx\_mod\_base(st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a8afd76c4255ae07376ad530e4a0af3fe}{tx\_next}})\ >\ cfg.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__config_abae58d34c6084044ac8f8b057f92bea0}{max\_window}});}
\DoxyCodeLine{01086\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_a398c38e0e19f66404a5627757628615e}\label{classsrsran_1_1rlc__tx__am__entity_a398c38e0e19f66404a5627757628615e} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!on\_expired\_poll\_retransmit\_timer@{on\_expired\_poll\_retransmit\_timer}}
\index{on\_expired\_poll\_retransmit\_timer@{on\_expired\_poll\_retransmit\_timer}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{on\_expired\_poll\_retransmit\_timer()}{on\_expired\_poll\_retransmit\_timer()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} rlc\+\_\+tx\+\_\+am\+\_\+entity\+::on\+\_\+expired\+\_\+poll\+\_\+retransmit\+\_\+timer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



on\+\_\+expired\+\_\+poll\+\_\+retransmit\+\_\+timer \doxylink{classHandler}{Handler} for expired poll\+\_\+retransmit\+\_\+timer 

Note\+: This function shall be executed by the same executor that calls \doxylink{classsrsran_1_1rlc__tx__am__entity_aae545ee2d475205ef89cefae7931cbab}{pull\+\_\+pdu()}, i.\+e. the pcell\+\_\+executor, in order to avoid incidential blocking of those critical paths. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00999\ \{}
\DoxyCodeLine{01000\ \ \ std::unique\_lock<std::mutex>\ lock(mutex);}
\DoxyCodeLine{01001\ }
\DoxyCodeLine{01002\ \ \ \textcolor{comment}{//\ t-\/PollRetransmit}}
\DoxyCodeLine{01003\ \ \ logger.log\_info(\textcolor{stringliteral}{"{}Poll\ retransmit\ timer\ expired\ after\ \{\}ms."{}},\ poll\_retransmit\_timer.\mbox{\hyperlink{classsrsran_1_1unique__timer_a97ad01e4b7d8588d25596489c362b15b}{duration}}().count());}
\DoxyCodeLine{01004\ \ \ log\_state(srslog::basic\_levels::debug);}
\DoxyCodeLine{01005\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01006\ \textcolor{comment}{\ \ \ *\ -\/\ if\ both\ the\ transmission\ buffer\ and\ the\ retransmission\ buffer\ are\ empty}}
\DoxyCodeLine{01007\ \textcolor{comment}{\ \ \ *\ \ \ (excluding\ transmitted\ RLC\ SDU\ or\ RLC\ SDU\ segment\ awaiting\ acknowledgements);\ or}}
\DoxyCodeLine{01008\ \textcolor{comment}{\ \ \ *\ -\/\ if\ no\ new\ RLC\ SDU\ or\ RLC\ SDU\ segment\ can\ be\ transmitted\ (e.g.\ due\ to\ window\ stalling):}}
\DoxyCodeLine{01009\ \textcolor{comment}{\ \ \ *\ \ \ -\/\ consider\ the\ RLC\ SDU\ with\ the\ highest\ SN\ among\ the\ RLC\ SDUs\ submitted\ to\ lower\ layer\ for}}
\DoxyCodeLine{01010\ \textcolor{comment}{\ \ \ *\ \ \ retransmission;\ or}}
\DoxyCodeLine{01011\ \textcolor{comment}{\ \ \ *\ \ \ -\/\ consider\ any\ RLC\ SDU\ which\ has\ not\ been\ positively\ acknowledged\ for\ retransmission.}}
\DoxyCodeLine{01012\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{01013\ \ \ \textcolor{keywordflow}{if}\ ((sdu\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__sdu__queue__lockfree_a7ba1e310d8d662703f2922303c627a7a}{is\_empty}}()\ \&\&\ retx\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__retx__queue_a778792b878a76c69aec610429a6f243d}{empty}}()\ \&\&\ sn\_under\_segmentation\ ==\ \mbox{\hyperlink{namespacesrsran_a7330c0b829cb3d3717bb70ab14ec3e3c}{INVALID\_RLC\_SN}})\ ||\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_adc069ac771957d3729e8573efb49cd4c}{is\_tx\_window\_full}}())\ \{}
\DoxyCodeLine{01014\ \ \ \ \ \textcolor{keywordflow}{if}\ (tx\_window-\/>empty())\ \{}
\DoxyCodeLine{01015\ \ \ \ \ \ \ logger.log\_info(}
\DoxyCodeLine{01016\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Poll\ retransmit\ timer\ expired,\ but\ the\ TX\ window\ is\ empty.\ \{\}\ tx\_window\_size=\{\}"{}},\ st,\ tx\_window-\/>size());}
\DoxyCodeLine{01017\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01018\ \ \ \ \ \}}
\DoxyCodeLine{01019\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ tx\_window-\/>has\_sn(st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a6c1488e36449c9f9ac0c8dd369768a56}{tx\_next\_ack}}))\ \{}
\DoxyCodeLine{01020\ \ \ \ \ \ \ logger.log\_info(\textcolor{stringliteral}{"{}Poll\ retransmit\ timer\ expired,\ but\ tx\_next\_ack\ is\ not\ in\ the\ TX\ window.\ \{\}\ tx\_window\_size=\{\}"{}},}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ st,}
\DoxyCodeLine{01022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tx\_window-\/>size());}
\DoxyCodeLine{01023\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01024\ \ \ \ \ \}}
\DoxyCodeLine{01025\ \ \ \ \ \textcolor{comment}{//\ RETX\ first\ RLC\ SDU\ that\ has\ not\ been\ ACKed}}
\DoxyCodeLine{01026\ \ \ \ \ \textcolor{comment}{//\ or\ first\ SDU\ segment\ of\ the\ first\ RLC\ SDU}}
\DoxyCodeLine{01027\ \ \ \ \ \textcolor{comment}{//\ that\ has\ not\ been\ acked}}
\DoxyCodeLine{01028\ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1rlc__tx__amd__retx}{rlc\_tx\_amd\_retx}}\ retx\ =\ \{\};}
\DoxyCodeLine{01029\ \ \ \ \ retx.\mbox{\hyperlink{structsrsran_1_1rlc__tx__amd__retx_a80ab73a1ffc00ff6c965b75673542d08}{so}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ 0;}
\DoxyCodeLine{01030\ \ \ \ \ retx.\mbox{\hyperlink{structsrsran_1_1rlc__tx__amd__retx_ab235f9dedd9f926b587605b1835076f5}{sn}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a6c1488e36449c9f9ac0c8dd369768a56}{tx\_next\_ack}};}
\DoxyCodeLine{01031\ \ \ \ \ retx.\mbox{\hyperlink{structsrsran_1_1rlc__tx__amd__retx_a5f3e3c8f518d0850fa1fb632c04562fb}{length}}\ \ \ \ \ \ \ \ \ \ =\ (*tx\_window)[st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a6c1488e36449c9f9ac0c8dd369768a56}{tx\_next\_ack}}].sdu.length();}
\DoxyCodeLine{01032\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{retx\_enqueued}}\ \ \ =\ retx\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__retx__queue_a7741fbc6f94d04570bb6e1f5c2bfd736}{try\_push}}(retx);}
\DoxyCodeLine{01033\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01034\ \ \ \ \ \textcolor{comment}{//\ TODO:\ Revise\ this:\ shall\ we\ send\ a\ minimum-\/sized\ segment\ instead?}}
\DoxyCodeLine{01035\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01036\ }
\DoxyCodeLine{01037\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{retx\_enqueued}})\ \{}
\DoxyCodeLine{01038\ \ \ \ \ \ \ logger.log\_debug(}
\DoxyCodeLine{01039\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Scheduled\ RETX\ due\ to\ expired\ poll\ retransmit\ timer.\ \{\}\ retx\_queue\_len=\{\}"{}},\ retx,\ retx\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__retx__queue_a484070008d093c081e44bd88a41c3acd}{size}}());}
\DoxyCodeLine{01040\ \ \ \ \ \ \ increment\_retx\_count(st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a6c1488e36449c9f9ac0c8dd369768a56}{tx\_next\_ack}});}
\DoxyCodeLine{01041\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01042\ \ \ \ \ \ \ logger.log\_warning(}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Failed\ to\ schedule\ RETX\ at\ expired\ poll\ retransmit\ timer.\ Queue\ is\ full.\ \{\}\ retx\_queue\_len=\{\}"{}},}
\DoxyCodeLine{01044\ \ \ \ \ \ \ \ \ \ \ retx,}
\DoxyCodeLine{01045\ \ \ \ \ \ \ \ \ \ \ retx\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__retx__queue_a484070008d093c081e44bd88a41c3acd}{size}}());}
\DoxyCodeLine{01046\ \ \ \ \ \}}
\DoxyCodeLine{01047\ }
\DoxyCodeLine{01048\ \ \ \ \ update\_mac\_buffer\_state(\textcolor{comment}{/*\ is\_locked\ =\ */}\ \textcolor{keyword}{true});}
\DoxyCodeLine{01049\ \ \ \}}
\DoxyCodeLine{01050\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01051\ \textcolor{comment}{\ \ \ *\ -\/\ include\ a\ poll\ in\ an\ AMD\ PDU\ as\ described\ in\ clause\ 5.3.3.2.}}
\DoxyCodeLine{01052\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{01053\ \ \ is\_poll\_retransmit\_timer\_expired.store(\textcolor{keyword}{true},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{01054\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_ae730ee9d83bf14c7ff3d4e1e377da8df}\label{classsrsran_1_1rlc__tx__am__entity_ae730ee9d83bf14c7ff3d4e1e377da8df} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!on\_status\_pdu@{on\_status\_pdu}}
\index{on\_status\_pdu@{on\_status\_pdu}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{on\_status\_pdu()}{on\_status\_pdu()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} rlc\+\_\+tx\+\_\+am\+\_\+entity\+::on\+\_\+status\+\_\+pdu (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1rlc__am__status__pdu}{rlc\+\_\+am\+\_\+status\+\_\+pdu}}}]{status }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Status PDU handler for TX entity. 


\begin{DoxyParams}{Parameters}
{\em status} & The status PDU to be processed by the RLC TX AM entity \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__status__handler_ad4150788a00a9e2416ba01954c0010cb}{srsran\+::rlc\+\_\+tx\+\_\+am\+\_\+status\+\_\+handler}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00562\ \{}
\DoxyCodeLine{00563\ \ \ \textcolor{comment}{//\ Redirect\ handling\ of\ status\ to\ pcell\_executor}}
\DoxyCodeLine{00564\ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{handle\_func}}\ =\ [\textcolor{keyword}{this},\ status\ =\ std::move(status)]()\ \textcolor{keyword}{mutable}\ \{\ handle\_status\_pdu(std::move(status));\ \};}
\DoxyCodeLine{00565\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ pcell\_executor.\mbox{\hyperlink{classsrsran_1_1task__executor_a7ce182401ef2d2b419bfbed5b5e488f7}{execute}}(std::move(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{handle\_func}})))\ \{}
\DoxyCodeLine{00566\ \ \ \ \ logger.log\_error(\textcolor{stringliteral}{"{}Unable\ to\ handle\ status\ report"{}});}
\DoxyCodeLine{00567\ \ \ \}}
\DoxyCodeLine{00568\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_a274119bec2d36e23f0f1adfcd65fe8df}\label{classsrsran_1_1rlc__tx__am__entity_a274119bec2d36e23f0f1adfcd65fe8df} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!on\_status\_report\_changed@{on\_status\_report\_changed}}
\index{on\_status\_report\_changed@{on\_status\_report\_changed}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{on\_status\_report\_changed()}{on\_status\_report\_changed()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} rlc\+\_\+tx\+\_\+am\+\_\+entity\+::on\+\_\+status\+\_\+report\+\_\+changed (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Informs the TX entity that a status report is triggered or its size has changed, so that the buffer status report needs to be updated. 



Implements \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__status__notifier_a5e3aa08205076627fb9258aeb951827b}{srsran\+::rlc\+\_\+tx\+\_\+am\+\_\+status\+\_\+notifier}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00740\ \{}
\DoxyCodeLine{00741\ \ \ handle\_changed\_buffer\_state();}
\DoxyCodeLine{00742\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_aae545ee2d475205ef89cefae7931cbab}\label{classsrsran_1_1rlc__tx__am__entity_aae545ee2d475205ef89cefae7931cbab} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!pull\_pdu@{pull\_pdu}}
\index{pull\_pdu@{pull\_pdu}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{pull\_pdu()}{pull\_pdu()}}
{\footnotesize\ttfamily size\+\_\+t rlc\+\_\+tx\+\_\+am\+\_\+entity\+::pull\+\_\+pdu (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$}]{rlc\+\_\+pdu\+\_\+buf }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Pulls a PDU from the lower end of the RLC TX entity No PDU is written if the size of {\ttfamily rlc\+\_\+pdu\+\_\+buf} is insufficient or the TX buffer is empty. 


\begin{DoxyParams}{Parameters}
{\em rlc\+\_\+pdu\+\_\+buf} & TX buffer where to encode an RLC Tx PDU. The encoded PDU size cannot exceed the size of the buffer. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Number of bytes taken by the written RLC PDU. 
\end{DoxyReturn}


Implements \mbox{\hyperlink{classsrsran_1_1rlc__tx__lower__layer__interface_acdd2d3757d55392f35627a2a05e1fbcf}{srsran\+::rlc\+\_\+tx\+\_\+lower\+\_\+layer\+\_\+interface}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00107\ \{}
\DoxyCodeLine{00108\ \ \ std::lock\_guard<std::mutex>\ lock(mutex);}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant\_len}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rlc\_pdu\_buf}}.size();}
\DoxyCodeLine{00111\ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}MAC\ opportunity.\ grant\_len=\{\}\ tx\_window\_size=\{\}"{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant\_len}},\ tx\_window-\/>size());}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \textcolor{comment}{//\ TX\ STATUS\ if\ requested}}
\DoxyCodeLine{00114\ \ \ \textcolor{keywordflow}{if}\ (status\_provider-\/>status\_report\_required())\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant\_len}}\ <\ \mbox{\hyperlink{namespacesrsran_a60ec2718dd93ef76fd902eb9199dd841}{rlc\_am\_nr\_status\_pdu\_sizeof\_header\_ack\_sn}})\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}Cannot\ fit\ status\ PDU\ into\ small\ grant\_len=\{\}."{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant\_len}});}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00118\ \ \ \ \ \}}
\DoxyCodeLine{00119\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1rlc__am__status__pdu}{rlc\_am\_status\_pdu}}\&\ status\_pdu\ =\ status\_provider-\/>\mbox{\hyperlink{classsrsran_1_1rlc__rx__am__status__provider_a032530956cbc71aa46b635070184d94c}{get\_status\_pdu}}();\ \textcolor{comment}{//\ this\ also\ resets\ status\_report\_required}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keywordflow}{if}\ (status\_pdu.get\_packed\_size()\ >\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant\_len}})\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ status\_pdu.trim(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant\_len}}))\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ logger.log\_warning(\textcolor{stringliteral}{"{}Could\ not\ trim\ status\ PDU\ down\ to\ grant\_len=\{\}."{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant\_len}});}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ logger.log\_info(\textcolor{stringliteral}{"{}Trimmed\ status\ PDU\ to\ fit\ into\ grant\_len=\{\}."{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant\_len}});}
\DoxyCodeLine{00127\ \ \ \ \ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}Trimmed\ status\ PDU.\ \{\}"{}},\ status\_pdu);}
\DoxyCodeLine{00128\ \ \ \ \ \}}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}}\ =\ status\_pdu.pack(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rlc\_pdu\_buf}});}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}}\ ==\ 0)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ logger.log\_error(\textcolor{stringliteral}{"{}Could\ not\ pack\ status\ pdu.\ \{\}"{}},\ status\_pdu);}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00133\ \ \ \ \ \}}
\DoxyCodeLine{00134\ \ \ \ \ logger.log\_info(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rlc\_pdu\_buf}}.data(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}},\ \textcolor{stringliteral}{"{}TX\ status\ PDU.\ pdu\_len=\{\}\ grant\_len=\{\}"{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant\_len}});}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{comment}{//\ Update\ metrics}}
\DoxyCodeLine{00137\ \ \ \ \ metrics.metrics\_add\_ctrl\_pdus(1,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}});}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{comment}{//\ Log\ state}}
\DoxyCodeLine{00140\ \ \ \ \ log\_state(srslog::basic\_levels::debug);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ pcap.push\_pdu(pcap\_context,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rlc\_pdu\_buf}}.subspan(0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}}));}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}};}
\DoxyCodeLine{00144\ \ \ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \textcolor{comment}{//\ Retransmit\ if\ required}}
\DoxyCodeLine{00147\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ retx\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__retx__queue_a778792b878a76c69aec610429a6f243d}{empty}}())\ \{}
\DoxyCodeLine{00148\ \ \ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}Re-\/transmission\ required.\ retx\_queue\_size=\{\}"{}},\ retx\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__retx__queue_a484070008d093c081e44bd88a41c3acd}{size}}());}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}}\ =\ build\_retx\_pdu(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rlc\_pdu\_buf}});}
\DoxyCodeLine{00151\ \ \ \ \ pcap.push\_pdu(pcap\_context,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rlc\_pdu\_buf}}.subspan(0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}}));}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}};}
\DoxyCodeLine{00153\ \ \ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \textcolor{comment}{//\ Send\ remaining\ segment,\ if\ it\ exists}}
\DoxyCodeLine{00156\ \ \ \textcolor{keywordflow}{if}\ (sn\_under\_segmentation\ !=\ \mbox{\hyperlink{namespacesrsran_a7330c0b829cb3d3717bb70ab14ec3e3c}{INVALID\_RLC\_SN}})\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordflow}{if}\ (tx\_window-\/>has\_sn(sn\_under\_segmentation))\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}}\ =\ build\_continued\_sdu\_segment(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rlc\_pdu\_buf}},\ (*tx\_window)[sn\_under\_segmentation]);}
\DoxyCodeLine{00159\ \ \ \ \ \ \ pcap.push\_pdu(pcap\_context,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rlc\_pdu\_buf}}.subspan(0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}}));}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}};}
\DoxyCodeLine{00161\ \ \ \ \ \}}
\DoxyCodeLine{00162\ \ \ \ \ logger.log\_error(\textcolor{stringliteral}{"{}SDU\ under\ segmentation\ does\ not\ exist\ in\ tx\_window.\ sn=\{\}"{}},\ sn\_under\_segmentation);}
\DoxyCodeLine{00163\ \ \ \ \ sn\_under\_segmentation\ =\ \mbox{\hyperlink{namespacesrsran_a7330c0b829cb3d3717bb70ab14ec3e3c}{INVALID\_RLC\_SN}};}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{//\ attempt\ to\ send\ next\ SDU}}
\DoxyCodeLine{00165\ \ \ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \textcolor{comment}{//\ Check\ whether\ there\ is\ something\ to\ TX}}
\DoxyCodeLine{00168\ \ \ \textcolor{keywordflow}{if}\ (sdu\_queue.\mbox{\hyperlink{classsrsran_1_1rlc__sdu__queue__lockfree_a7ba1e310d8d662703f2922303c627a7a}{is\_empty}}())\ \{}
\DoxyCodeLine{00169\ \ \ \ \ logger.log\_debug(\textcolor{stringliteral}{"{}SDU\ queue\ empty.\ grant\_len=\{\}"{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grant\_len}});}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00171\ \ \ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}}\ =\ build\_new\_pdu(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rlc\_pdu\_buf}});}
\DoxyCodeLine{00174\ \ \ pcap.push\_pdu(pcap\_context,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{rlc\_pdu\_buf}}.subspan(0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}}));}
\DoxyCodeLine{00175\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_len}};}
\DoxyCodeLine{00176\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_a3d2de9e02babb81d2dc715f8a0e7ea94}\label{classsrsran_1_1rlc__tx__am__entity_a3d2de9e02babb81d2dc715f8a0e7ea94} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!set\_state@{set\_state}}
\index{set\_state@{set\_state}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{set\_state()}{set\_state()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} srsran\+::rlc\+\_\+tx\+\_\+am\+\_\+entity\+::set\+\_\+state (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state}{rlc\+\_\+tx\+\_\+am\+\_\+state}} \&}]{st\+\_\+ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Set the internal state variables Note\+: This function should only be used for testing


\begin{DoxyParams}{Parameters}
{\em st\+\_\+} & The state variables to be set \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00225\ \{\ this-\/>st\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{st\_}};\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_ab7082c2469c7b6d60621ac0a812c6702}\label{classsrsran_1_1rlc__tx__am__entity_ab7082c2469c7b6d60621ac0a812c6702} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!set\_status\_provider@{set\_status\_provider}}
\index{set\_status\_provider@{set\_status\_provider}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{set\_status\_provider()}{set\_status\_provider()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} srsran\+::rlc\+\_\+tx\+\_\+am\+\_\+entity\+::set\+\_\+status\+\_\+provider (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1rlc__rx__am__status__provider}{rlc\+\_\+rx\+\_\+am\+\_\+status\+\_\+provider}} \texorpdfstring{$\ast$}{*}}]{status\+\_\+provider\+\_\+ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00154\ \{\ status\_provider\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{status\_provider\_}};\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_ac53a40aec1318896858134351fa92342}\label{classsrsran_1_1rlc__tx__am__entity_ac53a40aec1318896858134351fa92342} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!valid\_ack\_sn@{valid\_ack\_sn}}
\index{valid\_ack\_sn@{valid\_ack\_sn}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{valid\_ack\_sn()}{valid\_ack\_sn()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classbool}{bool}} rlc\+\_\+tx\+\_\+am\+\_\+entity\+::valid\+\_\+ack\+\_\+sn (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{sn }\end{DoxyParamCaption}) const}



This function is used to check if a received status report as a valid ACK\+\_\+\+SN. 

ACK\+\_\+\+SN may be equal to TX\+\_\+\+NEXT + AM\+\_\+\+Window\+\_\+\+Size if the PDU with SN=TX\+\_\+\+NEXT+\+AM\+\_\+\+Window\+\_\+\+Size has been received by the RX An ACK\+\_\+\+SN == Tx\+\_\+\+Next\+\_\+\+Ack doesn\textquotesingle{}t ACK or NACKs any PDUs, as such, such a status report can be discarded.


\begin{DoxyParams}{Parameters}
{\em sn} & Sequence Number to check \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if sn is valid, false otherwise 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{01089\ \{}
\DoxyCodeLine{01090\ \ \ \textcolor{comment}{//\ Tx\_Next\_Ack\ <\ SN\ <=\ TX\_Next\ +\ AM\_Window\_Size}}
\DoxyCodeLine{01091\ \ \ \textcolor{keywordflow}{return}\ (0\ <\ tx\_mod\_base(sn))\ \&\&\ (tx\_mod\_base(sn)\ <=\ am\_window\_size);}
\DoxyCodeLine{01092\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1rlc__tx__am__entity_a4e69c79d75db0e3b54f569a69a4022f0}\label{classsrsran_1_1rlc__tx__am__entity_a4e69c79d75db0e3b54f569a69a4022f0} 
\index{srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}!valid\_nack@{valid\_nack}}
\index{valid\_nack@{valid\_nack}!srsran::rlc\_tx\_am\_entity@{srsran::rlc\_tx\_am\_entity}}
\doxysubsubsection{\texorpdfstring{valid\_nack()}{valid\_nack()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classbool}{bool}} rlc\+\_\+tx\+\_\+am\+\_\+entity\+::valid\+\_\+nack (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{ack\+\_\+sn,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1rlc__am__status__nack}{rlc\+\_\+am\+\_\+status\+\_\+nack}} \&}]{nack\+\_\+sn }\end{DoxyParamCaption}) const}



This function is used to check if a received NACK within a status report is valid. 


\begin{DoxyParams}{Parameters}
{\em ack\+\_\+sn} & ACK\+\_\+\+SN of status report \\
\hline
{\em nack} & NACK to check validity of \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if NACK is valid, false otherwise 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{01095\ \{}
\DoxyCodeLine{01096\ \ \ \textcolor{comment}{//\ NACK\_SN\ >=\ ACK\_SN}}
\DoxyCodeLine{01097\ \ \ \textcolor{keywordflow}{if}\ (tx\_mod\_base(nack.nack\_sn)\ >=\ tx\_mod\_base(ack\_sn))\ \{}
\DoxyCodeLine{01098\ \ \ \ \ logger.log\_info(\textcolor{stringliteral}{"{}Ignoring\ status\ report\ with\ nack\_sn=\{\}\ >=\ ack\_sn=\{\}.\ \{\}"{}},\ nack.nack\_sn,\ ack\_sn,\ st);}
\DoxyCodeLine{01099\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01100\ \ \ \}}
\DoxyCodeLine{01101\ \ \ \textcolor{comment}{//\ NACK\_SN\ +\ range\ >=\ ACK\_SN}}
\DoxyCodeLine{01102\ \ \ \textcolor{keywordflow}{if}\ (nack.has\_nack\_range)\ \{}
\DoxyCodeLine{01103\ \ \ \ \ \textcolor{keywordflow}{if}\ (tx\_mod\_base(nack.nack\_sn\ +\ nack.nack\_range\ -\/\ 1)\ >=\ tx\_mod\_base(ack\_sn))\ \{}
\DoxyCodeLine{01104\ \ \ \ \ \ \ logger.log\_info(\textcolor{stringliteral}{"{}Ignoring\ status\ report\ with\ nack\_sn=\{\}\ +\ nack\_range=\{\}\ -\/\ 1\ >=\ ack\_sn=\{\}.\ \{\}"{}},}
\DoxyCodeLine{01105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nack.nack\_sn,}
\DoxyCodeLine{01106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nack.nack\_range,}
\DoxyCodeLine{01107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ack\_sn,}
\DoxyCodeLine{01108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ st);}
\DoxyCodeLine{01109\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01110\ \ \ \ \ \}}
\DoxyCodeLine{01111\ \ \ \}}
\DoxyCodeLine{01112\ \ \ \textcolor{comment}{//\ NACK\_SN\ within\ TX\ Window}}
\DoxyCodeLine{01113\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_ad14e9baeb52141c5d802dd39f8b1c0fc}{inside\_tx\_window}}(nack.nack\_sn))\ \{}
\DoxyCodeLine{01114\ \ \ \ \ logger.log\_info(\textcolor{stringliteral}{"{}Ignoring\ status\ report\ with\ nack\_sn=\{\}\ outside\ TX\ window.\ \{\}"{}},\ nack.nack\_sn,\ st);}
\DoxyCodeLine{01115\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01116\ \ \ \}}
\DoxyCodeLine{01117\ \ \ \textcolor{comment}{//\ NACK\_SN\ +\ range\ within\ TX\ Window}}
\DoxyCodeLine{01118\ \ \ \textcolor{keywordflow}{if}\ (nack.has\_nack\_range)\ \{}
\DoxyCodeLine{01119\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{classsrsran_1_1rlc__tx__am__entity_ad14e9baeb52141c5d802dd39f8b1c0fc}{inside\_tx\_window}}(nack.nack\_sn\ +\ nack.nack\_range\ -\/\ 1))\ \{}
\DoxyCodeLine{01120\ \ \ \ \ \ \ logger.log\_info(\textcolor{stringliteral}{"{}Ignoring\ status\ report\ with\ nack\_sn=\{\}\ +\ nack\_range=\{\}\ -\/\ 1\ outside\ TX\ window.\ \{\}"{}},}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nack.nack\_sn,}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nack.nack\_range,}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ st);}
\DoxyCodeLine{01124\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01125\ \ \ \ \ \}}
\DoxyCodeLine{01126\ \ \ \}}
\DoxyCodeLine{01127\ }
\DoxyCodeLine{01128\ \ \ \textcolor{comment}{//\ It\ should\ not\ be\ possible\ for\ NACK\_SN\ to\ be\ larger\ than\ TX\_NEXT,}}
\DoxyCodeLine{01129\ \ \ \textcolor{comment}{//\ since\ we\ check\ earlier\ if\ ACK\_SN\ >\ tx\_next\ +1}}
\DoxyCodeLine{01130\ \ \ \textcolor{comment}{//\ *\ ACK\_SN\ >\ TX\_NEXT\ +\ 1\ =>\ drop}}
\DoxyCodeLine{01131\ \ \ \textcolor{comment}{//\ \ \ \ \ *\ implies\ ACK\_SN\ <=\ TX\_NEXT}}
\DoxyCodeLine{01132\ \ \ \textcolor{comment}{//\ *\ NACK\_SN\ >=\ ACK\_SN\ =>\ drop}}
\DoxyCodeLine{01133\ \ \ \textcolor{comment}{//\ \ \ \ \ *\ implies\ NACK\_SN\ <\ ACK\_SN}}
\DoxyCodeLine{01134\ \ \ \textcolor{comment}{//\ *\ Therefore:}}
\DoxyCodeLine{01135\ \ \ \textcolor{comment}{//\ \ \ \ \ *\ NACK\_SN\ <\ ACK\_SN\ <=\ TX\_NEXT}}
\DoxyCodeLine{01136\ }
\DoxyCodeLine{01137\ \ \ \textcolor{comment}{//\ NACK\_SN\ >=\ tx\_next}}
\DoxyCodeLine{01138\ \ \ \textcolor{keywordflow}{if}\ (tx\_mod\_base(nack.nack\_sn)\ >\ tx\_mod\_base(st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a8afd76c4255ae07376ad530e4a0af3fe}{tx\_next}}))\ \{}
\DoxyCodeLine{01139\ \ \ \ \ logger.log\_error(\textcolor{stringliteral}{"{}Ignoring\ status\ report\ with\ nack\_sn=\{\}\ >=\ tx\_next.\ \{\}"{}},\ nack.nack\_sn,\ st);}
\DoxyCodeLine{01140\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01141\ \ \ \}}
\DoxyCodeLine{01142\ \ \ \textcolor{comment}{//\ NACK\_SN\ +\ range\ >=\ tx\_next}}
\DoxyCodeLine{01143\ \ \ \textcolor{keywordflow}{if}\ (nack.has\_nack\_range)\ \{}
\DoxyCodeLine{01144\ \ \ \ \ \textcolor{keywordflow}{if}\ (tx\_mod\_base(nack.nack\_sn\ +\ nack.nack\_range\ -\/\ 1)\ >\ tx\_mod\_base(st.\mbox{\hyperlink{structsrsran_1_1rlc__tx__am__state_a8afd76c4255ae07376ad530e4a0af3fe}{tx\_next}}))\ \{}
\DoxyCodeLine{01145\ \ \ \ \ \ \ logger.log\_error(\textcolor{stringliteral}{"{}Ignoring\ status\ report\ with\ nack\_sn=\{\}\ +\ nack\_range=\{\}\ -\/\ 1\ >=\ tx\_next.\ \{\}"{}},}
\DoxyCodeLine{01146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nack.nack\_sn,}
\DoxyCodeLine{01147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nack.nack\_range,}
\DoxyCodeLine{01148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ st);}
\DoxyCodeLine{01149\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01150\ \ \ \ \ \}}
\DoxyCodeLine{01151\ \ \ \}}
\DoxyCodeLine{01152\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01153\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/rlc/rlc\+\_\+tx\+\_\+am\+\_\+entity.\+h\item 
lib/rlc/rlc\+\_\+tx\+\_\+am\+\_\+entity.\+cpp\end{DoxyCompactItemize}
