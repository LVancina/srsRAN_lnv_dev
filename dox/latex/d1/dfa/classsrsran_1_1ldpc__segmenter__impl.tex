\doxysection{srsran\+::ldpc\+\_\+segmenter\+\_\+impl Class Reference}
\hypertarget{classsrsran_1_1ldpc__segmenter__impl}{}\label{classsrsran_1_1ldpc__segmenter__impl}\index{srsran::ldpc\_segmenter\_impl@{srsran::ldpc\_segmenter\_impl}}


Generic implementation of LDPC segmentation.  




{\ttfamily \#include $<$ldpc\+\_\+segmenter\+\_\+impl.\+h$>$}



Inheritance diagram for srsran\+::ldpc\+\_\+segmenter\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dd/de7/classsrsran_1_1ldpc__segmenter__impl__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::ldpc\+\_\+segmenter\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/dcd/classsrsran_1_1ldpc__segmenter__impl__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structsrsran_1_1ldpc__segmenter__impl_1_1sch__crc}{sch\+\_\+crc}}
\begin{DoxyCompactList}\small\item\em CRC calculators used in shared channels. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__impl_ac42240fce4bb7e502661967508115d76}{segment}} (\mbox{\hyperlink{classsrsran_1_1static__vector}{static\+\_\+vector}}$<$ \mbox{\hyperlink{classsrsran_1_1described__segment}{described\+\_\+segment}}, MAX\+\_\+\+NOF\+\_\+\+SEGMENTS $>$ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{described\+\_\+segments}}, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$ transport\+\_\+block, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1segmenter__config}{segmenter\+\_\+config}} \&cfg) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Adds the CRC to the a transport block, carries out segmentation and computes all codeblock metadata for later use (encoder and rate matching). \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__impl_a75d65c4074bcbe5c3931bfa3544154a9}{segment}} (\mbox{\hyperlink{classsrsran_1_1static__vector}{static\+\_\+vector}}$<$ \mbox{\hyperlink{namespacesrsran_a98c687a6314223a04e1b4d3a54b1035b}{described\+\_\+rx\+\_\+codeblock}}, MAX\+\_\+\+NOF\+\_\+\+SEGMENTS $>$ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{described\+\_\+codeblocks}}, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1log__likelihood__ratio}{log\+\_\+likelihood\+\_\+ratio}} $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{codeword\+\_\+llrs}}, \mbox{\hyperlink{classunsigned}{unsigned}} tbs, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1segmenter__config}{segmenter\+\_\+config}} \&cfg) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Splits a codeword into codeblocks and computes the metadata of all codeblocks. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__tx}{srsran\+::ldpc\+\_\+segmenter\+\_\+tx}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{virtual}} {\bfseries \texorpdfstring{$\sim$}{\string~}ldpc\+\_\+segmenter\+\_\+tx} ()=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{default}}
\begin{DoxyCompactList}\small\item\em Default destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__rx}{srsran\+::ldpc\+\_\+segmenter\+\_\+rx}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{virtual}} {\bfseries \texorpdfstring{$\sim$}{\string~}ldpc\+\_\+segmenter\+\_\+rx} ()=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{default}}
\begin{DoxyCompactList}\small\item\em Default destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{static}} std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__tx}{ldpc\+\_\+segmenter\+\_\+tx}} $>$ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__impl_ac9b94cc668575c6fb122b3d8d7b5a0ca}{create\+\_\+ldpc\+\_\+segmenter\+\_\+impl\+\_\+tx}} (\mbox{\hyperlink{structsrsran_1_1ldpc__segmenter__impl_1_1sch__crc}{sch\+\_\+crc}} \&)
\begin{DoxyCompactList}\small\item\em Wraps the constructor of the Tx version of the LDPC segmenter. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{static}} std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__rx}{ldpc\+\_\+segmenter\+\_\+rx}} $>$ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__impl_ab902ba9d2a109cc9d7b56476e4363f8a}{create\+\_\+ldpc\+\_\+segmenter\+\_\+impl\+\_\+rx}} ()
\begin{DoxyCompactList}\small\item\em Wraps the constructor of the Rx version of the LDPC segmenter. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Generic implementation of LDPC segmentation. 

Implements both \doxylink{classsrsran_1_1ldpc__segmenter__tx}{ldpc\+\_\+segmenter\+\_\+tx} and \doxylink{classsrsran_1_1ldpc__segmenter__rx}{ldpc\+\_\+segmenter\+\_\+rx}. For this reason, the constructor has been hidden behind the static wrapper methods \doxylink{classsrsran_1_1ldpc__segmenter__impl_ac9b94cc668575c6fb122b3d8d7b5a0ca}{create\+\_\+ldpc\+\_\+segmenter\+\_\+impl\+\_\+tx()} and \doxylink{classsrsran_1_1ldpc__segmenter__impl_ab902ba9d2a109cc9d7b56476e4363f8a}{create\+\_\+ldpc\+\_\+segmenter\+\_\+impl\+\_\+rx()}. 

\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1ldpc__segmenter__impl_ab902ba9d2a109cc9d7b56476e4363f8a}\label{classsrsran_1_1ldpc__segmenter__impl_ab902ba9d2a109cc9d7b56476e4363f8a} 
\index{srsran::ldpc\_segmenter\_impl@{srsran::ldpc\_segmenter\_impl}!create\_ldpc\_segmenter\_impl\_rx@{create\_ldpc\_segmenter\_impl\_rx}}
\index{create\_ldpc\_segmenter\_impl\_rx@{create\_ldpc\_segmenter\_impl\_rx}!srsran::ldpc\_segmenter\_impl@{srsran::ldpc\_segmenter\_impl}}
\doxysubsubsection{\texorpdfstring{create\_ldpc\_segmenter\_impl\_rx()}{create\_ldpc\_segmenter\_impl\_rx()}}
{\footnotesize\ttfamily std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__rx}{ldpc\+\_\+segmenter\+\_\+rx}} $>$ ldpc\+\_\+segmenter\+\_\+impl\+::create\+\_\+ldpc\+\_\+segmenter\+\_\+impl\+\_\+rx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Wraps the constructor of the Rx version of the LDPC segmenter. 

\begin{DoxyRemark}{Remarks}
The receive-\/chain version of the segmenter does not need CRC calculators. 
\end{DoxyRemark}

\begin{DoxyCode}{0}
\DoxyCodeLine{00054\ \{}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordflow}{return}\ std::unique\_ptr<ldpc\_segmenter\_impl>(\textcolor{keyword}{new}\ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__impl}{ldpc\_segmenter\_impl}}());}
\DoxyCodeLine{00056\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ldpc__segmenter__impl_ac9b94cc668575c6fb122b3d8d7b5a0ca}\label{classsrsran_1_1ldpc__segmenter__impl_ac9b94cc668575c6fb122b3d8d7b5a0ca} 
\index{srsran::ldpc\_segmenter\_impl@{srsran::ldpc\_segmenter\_impl}!create\_ldpc\_segmenter\_impl\_tx@{create\_ldpc\_segmenter\_impl\_tx}}
\index{create\_ldpc\_segmenter\_impl\_tx@{create\_ldpc\_segmenter\_impl\_tx}!srsran::ldpc\_segmenter\_impl@{srsran::ldpc\_segmenter\_impl}}
\doxysubsubsection{\texorpdfstring{create\_ldpc\_segmenter\_impl\_tx()}{create\_ldpc\_segmenter\_impl\_tx()}}
{\footnotesize\ttfamily std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__tx}{ldpc\+\_\+segmenter\+\_\+tx}} $>$ ldpc\+\_\+segmenter\+\_\+impl\+::create\+\_\+ldpc\+\_\+segmenter\+\_\+impl\+\_\+tx (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1ldpc__segmenter__impl_1_1sch__crc}{ldpc\+\_\+segmenter\+\_\+impl\+::sch\+\_\+crc}} \&}]{c }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Wraps the constructor of the Tx version of the LDPC segmenter. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00042\ \{}
\DoxyCodeLine{00043\ \ \ srsran\_assert(c.\mbox{\hyperlink{structsrsran_1_1ldpc__segmenter__impl_1_1sch__crc_a7a15c157c9a71ec8008fcf3b3e431963}{crc16}},\ \textcolor{stringliteral}{"{}Invalid\ CRC16\ calculator."{}});}
\DoxyCodeLine{00044\ \ \ srsran\_assert(c.\mbox{\hyperlink{structsrsran_1_1ldpc__segmenter__impl_1_1sch__crc_a1632766771b79d0742849b0ad070e099}{crc24A}},\ \textcolor{stringliteral}{"{}Invalid\ CRC24A\ calculator."{}});}
\DoxyCodeLine{00045\ \ \ srsran\_assert(c.\mbox{\hyperlink{structsrsran_1_1ldpc__segmenter__impl_1_1sch__crc_ade7d09be37cbbb89b97c3e9039795233}{crc24B}},\ \textcolor{stringliteral}{"{}Invalid\ CRC24B\ calculator."{}});}
\DoxyCodeLine{00046\ \ \ srsran\_assert(c.\mbox{\hyperlink{structsrsran_1_1ldpc__segmenter__impl_1_1sch__crc_a7a15c157c9a71ec8008fcf3b3e431963}{crc16}}-\/>get\_generator\_poly()\ ==\ crc\_generator\_poly::CRC16,\ \textcolor{stringliteral}{"{}Not\ a\ CRC\ generator\ of\ type\ CRC16."{}});}
\DoxyCodeLine{00047\ \ \ srsran\_assert(c.\mbox{\hyperlink{structsrsran_1_1ldpc__segmenter__impl_1_1sch__crc_a1632766771b79d0742849b0ad070e099}{crc24A}}-\/>get\_generator\_poly()\ ==\ crc\_generator\_poly::CRC24A,\ \textcolor{stringliteral}{"{}Not\ a\ CRC\ generator\ of\ type\ CRC24A."{}});}
\DoxyCodeLine{00048\ \ \ srsran\_assert(c.\mbox{\hyperlink{structsrsran_1_1ldpc__segmenter__impl_1_1sch__crc_ade7d09be37cbbb89b97c3e9039795233}{crc24B}}-\/>get\_generator\_poly()\ ==\ crc\_generator\_poly::CRC24B,\ \textcolor{stringliteral}{"{}Not\ a\ CRC\ generator\ of\ type\ CRC24B."{}});}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{return}\ std::unique\_ptr<ldpc\_segmenter\_impl>(\textcolor{keyword}{new}\ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__impl}{ldpc\_segmenter\_impl}}(std::move(c)));}
\DoxyCodeLine{00051\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ldpc__segmenter__impl_a75d65c4074bcbe5c3931bfa3544154a9}\label{classsrsran_1_1ldpc__segmenter__impl_a75d65c4074bcbe5c3931bfa3544154a9} 
\index{srsran::ldpc\_segmenter\_impl@{srsran::ldpc\_segmenter\_impl}!segment@{segment}}
\index{segment@{segment}!srsran::ldpc\_segmenter\_impl@{srsran::ldpc\_segmenter\_impl}}
\doxysubsubsection{\texorpdfstring{segment()}{segment()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} ldpc\+\_\+segmenter\+\_\+impl\+::segment (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1static__vector}{static\+\_\+vector}}$<$ \mbox{\hyperlink{namespacesrsran_a98c687a6314223a04e1b4d3a54b1035b}{described\+\_\+rx\+\_\+codeblock}}, MAX\+\_\+\+NOF\+\_\+\+SEGMENTS $>$ \&}]{described\+\_\+codeblocks,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1log__likelihood__ratio}{log\+\_\+likelihood\+\_\+ratio}} $>$}]{codeword\+\_\+llrs,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{tbs,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1segmenter__config}{segmenter\+\_\+config}} \&}]{cfg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Splits a codeword into codeblocks and computes the metadata of all codeblocks. 

The LLRs corresponding to the received codeword are split into codeblocks to feed the decoder. Each codeblock is described by all the metadata needed for rate-\/dematching and decoding, as per TS38.\+212 Section 5.\+4.\+2.\+1. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em described\+\_\+codeblocks} & Codeblock LLRs and corresponding metadata. \\
\hline
\mbox{\texttt{ in}}  & {\em codeword\+\_\+llrs} & Log-\/likelihood ratios of the received codeword. \\
\hline
\mbox{\texttt{ in}}  & {\em tbs} & Transport block size (not including CRC), as a number of bits. \\
\hline
\mbox{\texttt{ in}}  & {\em cfg} & Parameters affecting splitting and codeblock metadata. \\
\hline
\end{DoxyParams}
\begin{DoxyRemark}{Remarks}
The output codeblocks are just views (not copies) of the proper block of codeword log-\/likelihood ratios in {\ttfamily codeword\+\_\+llrs}. 
\end{DoxyRemark}


Implements \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__rx_afc2e88efb648316e4a90d3b019d5cf26}{srsran\+::ldpc\+\_\+segmenter\+\_\+rx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00258\ \{}
\DoxyCodeLine{00259\ \ \ check\_inputs\_rx(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{codeword\_llrs}},\ cfg);}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \textcolor{keyword}{using\ namespace\ }units::literals;}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ base\_graph\ =\ cfg.\mbox{\hyperlink{structsrsran_1_1segmenter__config_a07cb0f854c348847ba94e20f2a55063e}{base\_graph}};}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tbs\_bits}}(tbs);}
\DoxyCodeLine{00266\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ nof\_tb\_crc\_bits\ =\ \mbox{\hyperlink{namespacesrsran_1_1ldpc_a7260856d9ec4648dad107763036ef906}{compute\_tb\_crc\_size}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tbs\_bits}});}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ nof\_tb\_bits\_in\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tbs\_bits}}\ +\ nof\_tb\_crc\_bits;}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ nof\_segments\ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_1_1ldpc_a23acad74746ca49586fe02e3033bd392}{ldpc::compute\_nof\_codeblocks}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tbs\_bits}},\ base\_graph);}
\DoxyCodeLine{00271\ \ \ nof\_tb\_bits\_out\ =\ nof\_tb\_bits\_in;}
\DoxyCodeLine{00272\ \ \ \textcolor{keywordflow}{if}\ (nof\_segments\ >\ 1)\ \{}
\DoxyCodeLine{00273\ \ \ \ \ nof\_tb\_bits\_out\ +=\ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}(nof\_segments\ *\ SEG\_CRC\_LENGTH.\mbox{\hyperlink{classsrsran_1_1strong__type_a1a71ac48ba41b4a070b32e296c177db0}{value}}());}
\DoxyCodeLine{00274\ \ \ \}}
\DoxyCodeLine{00275\ \ \ lifting\_size\ \ \ =\ \mbox{\hyperlink{namespacesrsran_1_1ldpc_a65389d5aa819559b5c2cac18d5ec37ae}{compute\_lifting\_size}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tbs\_bits}},\ base\_graph,\ nof\_segments);}
\DoxyCodeLine{00276\ \ \ segment\_length\ =\ \mbox{\hyperlink{namespacesrsran_1_1ldpc_aeffeb135707ed719a149777da808b611}{compute\_codeblock\_size}}(base\_graph,\ lifting\_size);}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ nof\_crc\_bits\ =\ (nof\_segments\ >\ 1)\ ?\ SEG\_CRC\_LENGTH\ :\ 0\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\_bits}};}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ \textcolor{comment}{//\ Compute\ the\ maximum\ number\ of\ information\ bits\ that\ can\ be\ assigned\ to\ a\ segment.}}
\DoxyCodeLine{00281\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_info\_bits}}\ =\ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}(\mbox{\hyperlink{namespacesrsran_a6e5aee1d553dc6e825017842e4059adb}{divide\_ceil}}(nof\_tb\_bits\_out.\mbox{\hyperlink{classsrsran_1_1strong__type_a1a71ac48ba41b4a070b32e296c177db0}{value}}(),\ nof\_segments))\ -\/\ nof\_crc\_bits;}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \textcolor{comment}{//\ Number\ of\ channel\ symbols\ assigned\ to\ a\ transmission\ layer.}}
\DoxyCodeLine{00284\ \ \ nof\_symbols\_per\_layer\ =\ cfg.\mbox{\hyperlink{structsrsran_1_1segmenter__config_a8c5b77d22a4b2d17e2977ffad868b20b}{nof\_ch\_symbols}}\ /\ cfg.\mbox{\hyperlink{structsrsran_1_1segmenter__config_abee99babfc1bda958ddfd12ae646cb03}{nof\_layers}};}
\DoxyCodeLine{00285\ \ \ \textcolor{comment}{//\ Number\ of\ segments\ that\ will\ have\ a\ short\ rate-\/matched\ length.\ In\ TS38.212\ Section\ 5.4.2.1,\ these\ correspond\ to}}
\DoxyCodeLine{00286\ \ \ \textcolor{comment}{//\ codeblocks\ whose\ length\ E\_r\ is\ computed\ by\ rounding\ down\ -\/\ floor.\ For\ the\ remaining\ codewords,\ the\ length\ is}}
\DoxyCodeLine{00287\ \ \ \textcolor{comment}{//\ rounded\ up.}}
\DoxyCodeLine{00288\ \ \ nof\_short\_segments\ =\ nof\_segments\ -\/\ (nof\_symbols\_per\_layer\ \%\ nof\_segments);}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ \textcolor{comment}{//\ Codeword\ length\ (after\ concatenation\ of\ codeblocks).}}
\DoxyCodeLine{00291\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ cw\_length(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{codeword\_llrs}}.size());}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \textcolor{keywordtype}{unsigned}\ cw\_offset\ =\ 0;}
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ i\_segment\ =\ 0;\ i\_segment\ !=\ nof\_segments;\ ++i\_segment)\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ nof\_filler\_bits\ =\ segment\_length\ -\/\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_info\_bits}}\ +\ nof\_crc\_bits);}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1codeblock__metadata}{codeblock\_metadata}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tmp\_description}}\ =}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ generate\_cb\_metadata(\{i\_segment,\ cw\_length,\ cw\_offset,\ nof\_filler\_bits,\ nof\_crc\_bits,\ nof\_tb\_crc\_bits\},\ cfg);}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ rm\_length\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tmp\_description}}.\mbox{\hyperlink{structsrsran_1_1codeblock__metadata_a84f64cf3931e9df25ed5b6c5a9782a08}{cb\_specific}}.\mbox{\hyperlink{structsrsran_1_1codeblock__metadata_1_1cb__specific__metadata_a3e24779ac4f4ca25afe2ad635c115308}{rm\_length}};}
\DoxyCodeLine{00301\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{described\_codeblocks}}.push\_back(\{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{codeword\_llrs}}.subspan(cw\_offset,\ rm\_length),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tmp\_description}}\});}
\DoxyCodeLine{00302\ \ \ \ \ cw\_offset\ +=\ rm\_length;}
\DoxyCodeLine{00303\ \ \ \}}
\DoxyCodeLine{00304\ \ \ \textcolor{comment}{//\ After\ accumulating\ all\ codeblock\ rate-\/matched\ lengths,\ cw\_offset\ should\ be\ the\ same\ as\ cw\_length.}}
\DoxyCodeLine{00305\ \ \ srsran\_assert(cw\_length.value()\ ==\ cw\_offset,\ \textcolor{stringliteral}{"{}Cw\ offset\ must\ be\ equal\ to\ the\ cw\ length"{}});}
\DoxyCodeLine{00306\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ldpc__segmenter__impl_ac42240fce4bb7e502661967508115d76}\label{classsrsran_1_1ldpc__segmenter__impl_ac42240fce4bb7e502661967508115d76} 
\index{srsran::ldpc\_segmenter\_impl@{srsran::ldpc\_segmenter\_impl}!segment@{segment}}
\index{segment@{segment}!srsran::ldpc\_segmenter\_impl@{srsran::ldpc\_segmenter\_impl}}
\doxysubsubsection{\texorpdfstring{segment()}{segment()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} ldpc\+\_\+segmenter\+\_\+impl\+::segment (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1static__vector}{static\+\_\+vector}}$<$ \mbox{\hyperlink{classsrsran_1_1described__segment}{described\+\_\+segment}}, MAX\+\_\+\+NOF\+\_\+\+SEGMENTS $>$ \&}]{described\+\_\+segments,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classuint8__t}{uint8\+\_\+t}} $>$}]{transport\+\_\+block,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1segmenter__config}{segmenter\+\_\+config}} \&}]{cfg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Adds the CRC to the a transport block, carries out segmentation and computes all codeblock metadata for later use (encoder and rate matching). 

First, the transport block CRC is attached, as per TS38.\+212 Section 7.\+2.\+1. Then, the transport block is split into a number of segments and, if needed, a CRC is attached to each segment\+\_\+tx. This is done according to TS38.\+212 Section 5.\+2.\+2. The function also computes other segment\+\_\+tx metadata (e.\+g., coded and rate-\/matched length) according to TS38.\+212 Section 5.\+4.\+2.\+1.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em described\+\_\+segments} & Segments (unpacked, one bit per entry) and corresponding metadata. \\
\hline
\mbox{\texttt{ in}}  & {\em transport\+\_\+block} & The transport block to segment\+\_\+tx (packed, one byte per entry). \\
\hline
\mbox{\texttt{ in}}  & {\em cfg} & Parameters affecting splitting and codeblock metadata. \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__tx_a4862995fa5565996de5c9b4c6e6ef946}{srsran\+::ldpc\+\_\+segmenter\+\_\+tx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00093\ \{}
\DoxyCodeLine{00094\ \ \ check\_inputs\_tx(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{described\_segments}},\ transport\_block,\ cfg);}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \textcolor{keyword}{using\ namespace\ }units::literals;}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ base\_graph\ =\ cfg.\mbox{\hyperlink{structsrsran_1_1segmenter__config_a07cb0f854c348847ba94e20f2a55063e}{base\_graph}};}
\DoxyCodeLine{00099\ \ \ \textcolor{comment}{//\ Each\ transport\_block\ entry\ is\ a\ byte,\ and\ TBS\ can\ always\ be\ expressed\ as\ an\ integer\ number\ of\ bytes\ (see,\ e.g.,}}
\DoxyCodeLine{00100\ \ \ \textcolor{comment}{//\ TS38.214\ Section\ 5.1.3.2).}}
\DoxyCodeLine{00101\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_tb\_bits\_tmp}}\ =\ \mbox{\hyperlink{classsrsran_1_1units_1_1bytes}{units::bytes}}(transport\_block.\mbox{\hyperlink{classsrsran_1_1span_ad0e376d95ca916144eac76f27f0654ac}{size}}()).\mbox{\hyperlink{classsrsran_1_1units_1_1bytes_a3633d6a80fc41a40f08be27a32e04acf}{to\_bits}}();}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ MAX\_BITS\_CRC16\{3824\};}
\DoxyCodeLine{00104\ \ \ \mbox{\hyperlink{classsrsran_1_1crc__calculator}{crc\_calculator}}\&\ \ \ \ \ \ \ tb\_crc\ \ \ \ \ \ \ \ \ \ =\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_tb\_bits\_tmp}}\ <=\ MAX\_BITS\_CRC16)\ ?\ *crc\_set.\mbox{\hyperlink{structsrsran_1_1ldpc__segmenter__impl_1_1sch__crc_a7a15c157c9a71ec8008fcf3b3e431963}{crc16}}\ :\ *crc\_set.crc24A;}
\DoxyCodeLine{00105\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ \ \ \ \ \ \ \ \ \ \ nof\_tb\_crc\_bits\ =\ \mbox{\hyperlink{namespacesrsran_1_1ldpc_a7260856d9ec4648dad107763036ef906}{compute\_tb\_crc\_size}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_tb\_bits\_tmp}});}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ nof\_tb\_bits\_in\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_tb\_bits\_tmp}}\ +\ nof\_tb\_crc\_bits;}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ nof\_segments\ \ \ \ =\ \mbox{\hyperlink{namespacesrsran_1_1ldpc_a23acad74746ca49586fe02e3033bd392}{ldpc::compute\_nof\_codeblocks}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_tb\_bits\_tmp}},\ base\_graph);}
\DoxyCodeLine{00110\ \ \ nof\_tb\_bits\_out\ =\ nof\_tb\_bits\_in;}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{if}\ (nof\_segments\ >\ 1)\ \{}
\DoxyCodeLine{00112\ \ \ \ \ nof\_tb\_bits\_out\ +=\ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}(nof\_segments\ *\ SEG\_CRC\_LENGTH.\mbox{\hyperlink{classsrsran_1_1strong__type_a1a71ac48ba41b4a070b32e296c177db0}{value}}());}
\DoxyCodeLine{00113\ \ \ \}}
\DoxyCodeLine{00114\ \ \ lifting\_size\ \ \ =\ \mbox{\hyperlink{namespacesrsran_1_1ldpc_a65389d5aa819559b5c2cac18d5ec37ae}{compute\_lifting\_size}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_tb\_bits\_tmp}},\ base\_graph,\ nof\_segments);}
\DoxyCodeLine{00115\ \ \ segment\_length\ =\ \mbox{\hyperlink{namespacesrsran_1_1ldpc_aeffeb135707ed719a149777da808b611}{compute\_codeblock\_size}}(base\_graph,\ lifting\_size);}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ nof\_crc\_bits\ =\ (nof\_segments\ >\ 1)\ ?\ SEG\_CRC\_LENGTH\ :\ 0\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\_bits}};}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \textcolor{comment}{//\ Compute\ the\ number\ of\ information\ bits\ that\ is\ assigned\ to\ a\ segment.}}
\DoxyCodeLine{00120\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ cb\_info\_bits\ =\ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}(\mbox{\hyperlink{namespacesrsran_a6e5aee1d553dc6e825017842e4059adb}{divide\_ceil}}(nof\_tb\_bits\_out.\mbox{\hyperlink{classsrsran_1_1strong__type_a1a71ac48ba41b4a070b32e296c177db0}{value}}(),\ nof\_segments))\ -\/\ nof\_crc\_bits;}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{comment}{//\ Zero-\/padding\ if\ necessary.}}
\DoxyCodeLine{00123\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ zero\_pad\ =\ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}((cb\_info\_bits\ +\ nof\_crc\_bits).value()\ *\ nof\_segments)\ -\/\ nof\_tb\_bits\_out;}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \textcolor{comment}{//\ Append\ TB\ CRC.}}
\DoxyCodeLine{00126\ \ \ \mbox{\hyperlink{classunsigned}{crc\_calculator\_checksum\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_checksum}}\ =\ tb\_crc.\mbox{\hyperlink{classsrsran_1_1crc__calculator_a527fe01b97675f1709ea4995b7a8f936}{calculate\_byte}}(transport\_block);}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \textcolor{comment}{//\ Number\ of\ channel\ symbols\ assigned\ to\ a\ transmission\ layer.}}
\DoxyCodeLine{00129\ \ \ nof\_symbols\_per\_layer\ =\ cfg.\mbox{\hyperlink{structsrsran_1_1segmenter__config_a8c5b77d22a4b2d17e2977ffad868b20b}{nof\_ch\_symbols}}\ /\ cfg.\mbox{\hyperlink{structsrsran_1_1segmenter__config_abee99babfc1bda958ddfd12ae646cb03}{nof\_layers}};}
\DoxyCodeLine{00130\ \ \ \textcolor{comment}{//\ Number\ of\ segments\ that\ will\ have\ a\ short\ rate-\/matched\ length.\ In\ TS38.212\ Section\ 5.4.2.1,\ these\ correspond\ to}}
\DoxyCodeLine{00131\ \ \ \textcolor{comment}{//\ codeblocks\ whose\ length\ E\_r\ is\ computed\ by\ rounding\ down\ -\/\ floor.\ For\ the\ remaining\ codewords,\ the\ length\ is}}
\DoxyCodeLine{00132\ \ \ \textcolor{comment}{//\ rounded\ up.}}
\DoxyCodeLine{00133\ \ \ nof\_short\_segments\ =\ nof\_segments\ -\/\ (nof\_symbols\_per\_layer\ \%\ nof\_segments);}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \textcolor{comment}{//\ Codeword\ length\ (after\ concatenation\ of\ codeblocks).}}
\DoxyCodeLine{00136\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ cw\_length(cfg.\mbox{\hyperlink{structsrsran_1_1segmenter__config_a8c5b77d22a4b2d17e2977ffad868b20b}{nof\_ch\_symbols}}\ *\ \mbox{\hyperlink{namespacesrsran_af78ee928d6d8a3d8ff6bbc753f50c44e}{get\_bits\_per\_symbol}}(cfg.\mbox{\hyperlink{structsrsran_1_1segmenter__config_a368bfda32bf9a15edfbfb1445c13bcdf}{mod}}));}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \textcolor{comment}{//\ Number\ of\ filler\ bits\ in\ this\ segment.}}
\DoxyCodeLine{00139\ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ nof\_filler\_bits\ =\ segment\_length\ -\/\ cb\_info\_bits\ -\/\ nof\_crc\_bits;}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \textcolor{keywordtype}{unsigned}\ cw\_offset\ =\ 0;}
\DoxyCodeLine{00142\ \ \ \textcolor{keywordtype}{unsigned}\ tb\_offset\ =\ 0;}
\DoxyCodeLine{00143\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ i\_segment\ =\ 0;\ i\_segment\ !=\ nof\_segments;\ ++i\_segment)\ \{}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_cb}}\ =\ (i\_segment\ ==\ nof\_segments\ -\/\ 1);}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{comment}{//\ Generate\ metadata\ for\ this\ segment.}}
\DoxyCodeLine{00147\ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1codeblock__metadata}{codeblock\_metadata}}\ cb\_metadata\ =}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ generate\_cb\_metadata(\{i\_segment,\ cw\_length,\ cw\_offset,\ nof\_filler\_bits,\ nof\_crc\_bits,\ nof\_tb\_crc\_bits\},\ cfg);}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{//\ Prepare\ segment\ data.}}
\DoxyCodeLine{00151\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{described\_segments}}.emplace\_back(cb\_metadata,\ segment\_length);}
\DoxyCodeLine{00152\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1described__segment}{described\_segment}}\&\ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__impl_ac42240fce4bb7e502661967508115d76}{segment}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{described\_segments}}.back();}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{comment}{//\ Segment\ bit\ buffer.}}
\DoxyCodeLine{00155\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1bit__buffer}{bit\_buffer}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_bit\_buffer}}\ =\ \mbox{\hyperlink{classsrsran_1_1ldpc__segmenter__impl_ac42240fce4bb7e502661967508115d76}{segment}}.get\_data();}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{comment}{//\ Number\ of\ information\ bits\ to\ get\ from\ the\ transport\ block.\ Remove\ transport\ block\ CRC\ bits\ if\ it\ is\ the\ last\ CB.}}
\DoxyCodeLine{00158\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}\ =\ cb\_info\_bits;}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_cb}})\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}\ -\/=\ nof\_tb\_crc\_bits\ +\ zero\_pad;}
\DoxyCodeLine{00161\ \ \ \ \ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{comment}{//\ Copy\ information\ bits\ from\ the\ transport\ block.}}
\DoxyCodeLine{00164\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1bit__buffer}{bit\_buffer}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_info\_bit\_buffer}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_bit\_buffer}}.\mbox{\hyperlink{classsrsran_1_1bit__buffer_abba52fc044021e0e4492726fc8a4dc24}{first}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}.value());}
\DoxyCodeLine{00165\ \ \ \ \ srsvec::copy\_offset(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_info\_bit\_buffer}},\ transport\_block,\ tb\_offset);}
\DoxyCodeLine{00166\ \ \ \ \ tb\_offset\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}.value();}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{comment}{//\ If\ it\ is\ the\ last\ CB,\ append\ the\ transport\ block\ CRC\ and\ padding\ bits.}}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{last\_cb}})\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \textcolor{comment}{//\ For\ each\ byte\ of\ the\ transport\ block\ CRC...}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte}}\ =\ 0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte\_end}}\ =\ nof\_tb\_crc\_bits.\mbox{\hyperlink{classsrsran_1_1units_1_1bits_a240778dc7ade6085090b094fafd45aa5}{truncate\_to\_bytes}}().\mbox{\hyperlink{classsrsran_1_1strong__type_a1a71ac48ba41b4a070b32e296c177db0}{value}}();}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte\_end}};}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte}})\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Extract\ byte\ from\ the\ CRC.}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_crc\_byte}}\ =\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_checksum}}\ >>\ (nof\_tb\_crc\_bits.\mbox{\hyperlink{classsrsran_1_1strong__type_a1a71ac48ba41b4a070b32e296c177db0}{value}}()\ -\/\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte}}\ +\ 1)\ *\ 8))\ \&\ 0xffUL;}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Insert\ the\ byte\ at\ the\ end\ of\ the\ bit\ buffer.}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_bit\_buffer}}.insert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tb\_crc\_byte}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}.value(),\ 8);}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Increment\ the\ number\ of\ bits.}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}\ +=\ 8\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\_bits}};}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00181\ \ \ \ \ \ \ tb\_offset\ +=\ nof\_tb\_crc\_bits.\mbox{\hyperlink{classsrsran_1_1strong__type_a1a71ac48ba41b4a070b32e296c177db0}{value}}();}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \ \ \textcolor{comment}{//\ Insert\ zero\ padding\ bits.}}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits\_end}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}\ +\ zero\_pad;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits\_end}};)\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ number\ of\ zeros\ to\ pad,\ no\ more\ than\ a\ byte\ at\ a\ time.}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_zeros}}\ =\ std::min<units::bits>(8\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\_bits}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits\_end}}\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}});}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Insert\ the\ zeros\ at\ the\ end\ of\ the\ bit\ buffer.}}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_bit\_buffer}}.insert(0\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{UL}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}.value(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_zeros}}.value());}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Increment\ the\ number\ of\ bits.}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_zeros}};}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00192\ \ \ \ \ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{comment}{//\ Append\ codeblock\ CRC\ if\ required.}}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordflow}{if}\ (nof\_crc\_bits\ !=\ 0\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\_bits}})\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \mbox{\hyperlink{classunsigned}{crc\_calculator\_checksum\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_checksum}}\ =\ crc\_set.\mbox{\hyperlink{structsrsran_1_1ldpc__segmenter__impl_1_1sch__crc_ade7d09be37cbbb89b97c3e9039795233}{crc24B}}-\/>calculate(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_bit\_buffer}}.first(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}.value()));}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \ \ \textcolor{comment}{//\ For\ each\ byte\ of\ the\ transport\ block\ CRC...}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte}}\ =\ 0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte\_end}}\ =\ nof\_crc\_bits.truncate\_to\_bytes().value();}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte\_end}};}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte}})\ \{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Extract\ byte\ from\ the\ CRC.}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_crc\_byte}}\ =\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_checksum}}\ >>\ (nof\_crc\_bits.value()\ -\/\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_checksum\_byte}}\ +\ 1)\ *\ 8))\ \&\ 0xffUL;}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Insert\ the\ byte\ at\ the\ end\ of\ the\ bit\ buffer.}}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_bit\_buffer}}.insert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_crc\_byte}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}.value(),\ 8);}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Increment\ the\ number\ of\ bits.}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}\ +=\ 8\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\_bits}};}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00209\ \ \ \ \ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{comment}{//\ Append\ filler\ bits\ as\ zeros.}}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}\ !=\ segment\_length)\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ number\ of\ zeros\ to\ pad,\ no\ more\ than\ a\ byte\ at\ a\ time.}}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1units_1_1bits}{units::bits}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_zeros}}\ =\ std::min<units::bits>(8\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{\_bits}},\ segment\_length\ -\/\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}});}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \textcolor{comment}{//\ Insert\ the\ zeros\ at\ the\ end\ of\ the\ bit\ buffer.}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cb\_bit\_buffer}}.insert(0\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{UL}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}.value(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_zeros}}.value());}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \textcolor{comment}{//\ Increment\ the\ number\ of\ bits.}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_used\_bits}}\ +=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nof\_zeros}};}
\DoxyCodeLine{00219\ \ \ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{comment}{//\ Advance\ offsets.}}
\DoxyCodeLine{00222\ \ \ \ \ cw\_offset\ +=\ cb\_metadata.\mbox{\hyperlink{structsrsran_1_1codeblock__metadata_a84f64cf3931e9df25ed5b6c5a9782a08}{cb\_specific}}.\mbox{\hyperlink{structsrsran_1_1codeblock__metadata_1_1cb__specific__metadata_a3e24779ac4f4ca25afe2ad635c115308}{rm\_length}};}
\DoxyCodeLine{00223\ \ \ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \textcolor{comment}{//\ After\ segmenting\ no\ bits\ should\ be\ left\ in\ the\ buffer.}}
\DoxyCodeLine{00226\ \ \ srsran\_assert(nof\_tb\_bits\_in.\mbox{\hyperlink{classsrsran_1_1strong__type_a1a71ac48ba41b4a070b32e296c177db0}{value}}()\ ==\ tb\_offset,}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Transport\ block\ offset\ (\{\})\ must\ be\ equal\ to\ the\ transport\ block\ size\ including\ CRC\ (\{\})."{}},}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tb\_offset,}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nof\_tb\_bits\_in);}
\DoxyCodeLine{00230\ \ \ \textcolor{comment}{//\ After\ accumulating\ all\ codeblock\ rate-\/matched\ lengths,\ cw\_offset\ should\ be\ the\ same\ as\ cw\_length.}}
\DoxyCodeLine{00231\ \ \ srsran\_assert(cw\_length.value()\ ==\ cw\_offset,}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Codeblock\ offset\ (\{\})\ must\ be\ equal\ to\ the\ codeword\ size\ (\{\})."{}},}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cw\_offset,}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cw\_length.value());}
\DoxyCodeLine{00235\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/phy/upper/channel\+\_\+coding/ldpc/\mbox{\hyperlink{ldpc__segmenter__impl_8h}{ldpc\+\_\+segmenter\+\_\+impl.\+h}}\item 
lib/phy/upper/channel\+\_\+coding/ldpc/ldpc\+\_\+segmenter\+\_\+impl.\+cpp\end{DoxyCompactItemize}
