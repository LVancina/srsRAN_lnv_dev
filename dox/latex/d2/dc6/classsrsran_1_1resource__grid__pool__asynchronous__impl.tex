\doxysection{srsran\+::resource\+\_\+grid\+\_\+pool\+\_\+asynchronous\+\_\+impl Class Reference}
\hypertarget{classsrsran_1_1resource__grid__pool__asynchronous__impl}{}\label{classsrsran_1_1resource__grid__pool__asynchronous__impl}\index{srsran::resource\_grid\_pool\_asynchronous\_impl@{srsran::resource\_grid\_pool\_asynchronous\_impl}}


Implements a generic resource grid pool that zeroes the resource grids after a number of slots.  




{\ttfamily \#include $<$resource\+\_\+grid\+\_\+pool\+\_\+asynchronous\+\_\+impl.\+h$>$}



Inheritance diagram for srsran\+::resource\+\_\+grid\+\_\+pool\+\_\+asynchronous\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=219pt]{dd/da8/classsrsran_1_1resource__grid__pool__asynchronous__impl__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::resource\+\_\+grid\+\_\+pool\+\_\+asynchronous\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=219pt]{d1/d66/classsrsran_1_1resource__grid__pool__asynchronous__impl__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{classsrsran_1_1resource__grid__pool__asynchronous__impl_a3068cdbd032b198d752d91f597507773}\label{classsrsran_1_1resource__grid__pool__asynchronous__impl_a3068cdbd032b198d752d91f597507773} 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{using}} {\bfseries resource\+\_\+grid\+\_\+ptr} = std\+::unique\+\_\+ptr$<$\mbox{\hyperlink{classsrsran_1_1resource__grid}{resource\+\_\+grid}}$>$
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1resource__grid__pool__asynchronous__impl_ad6a1de3338844db1b7641869b46d61d8}{resource\+\_\+grid\+\_\+pool\+\_\+asynchronous\+\_\+impl}} (\mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{expire\+\_\+timeout\+\_\+slots\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{async\+\_\+executor\+\_\+}}, std\+::vector$<$ std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1resource__grid}{resource\+\_\+grid}} $>$ $>$ grids)
\begin{DoxyCompactList}\small\item\em Constructs a resource grid pool. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classsrsran_1_1resource__grid}{resource\+\_\+grid}} \& \mbox{\hyperlink{classsrsran_1_1resource__grid__pool__asynchronous__impl_ae2dea9cc6458aa8e22be622ffe3454ef}{get\+\_\+resource\+\_\+grid}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1resource__grid__context}{resource\+\_\+grid\+\_\+context}} \&context) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1resource__grid__pool}{srsran\+::resource\+\_\+grid\+\_\+pool}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{virtual}} {\bfseries \texorpdfstring{$\sim$}{\string~}resource\+\_\+grid\+\_\+pool} ()=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{default}}
\begin{DoxyCompactList}\small\item\em Default destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implements a generic resource grid pool that zeroes the resource grids after a number of slots. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1resource__grid__pool__asynchronous__impl_ad6a1de3338844db1b7641869b46d61d8}\label{classsrsran_1_1resource__grid__pool__asynchronous__impl_ad6a1de3338844db1b7641869b46d61d8} 
\index{srsran::resource\_grid\_pool\_asynchronous\_impl@{srsran::resource\_grid\_pool\_asynchronous\_impl}!resource\_grid\_pool\_asynchronous\_impl@{resource\_grid\_pool\_asynchronous\_impl}}
\index{resource\_grid\_pool\_asynchronous\_impl@{resource\_grid\_pool\_asynchronous\_impl}!srsran::resource\_grid\_pool\_asynchronous\_impl@{srsran::resource\_grid\_pool\_asynchronous\_impl}}
\doxysubsubsection{\texorpdfstring{resource\_grid\_pool\_asynchronous\_impl()}{resource\_grid\_pool\_asynchronous\_impl()}}
{\footnotesize\ttfamily resource\+\_\+grid\+\_\+pool\+\_\+asynchronous\+\_\+impl\+::resource\+\_\+grid\+\_\+pool\+\_\+asynchronous\+\_\+impl (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{expire\+\_\+timeout\+\_\+slots\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&}]{async\+\_\+executor\+\_\+,  }\item[{std\+::vector$<$ std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{classsrsran_1_1resource__grid}{resource\+\_\+grid}} $>$ $>$}]{grids }\end{DoxyParamCaption})}



Constructs a resource grid pool. 


\begin{DoxyParams}{Parameters}
{\em expire\+\_\+timeout\+\_\+slots\+\_\+} & Resource grid timeout expiration in slots. \\
\hline
{\em async\+\_\+executor\+\_\+} & Asynchronous housekeeping executor. \\
\hline
{\em grids\+\_\+} & Resource grids. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00037\ \ \ logger(srslog::fetch\_basic\_logger(\textcolor{stringliteral}{"{}PHY"{}},\ \textcolor{keyword}{true})),}
\DoxyCodeLine{00038\ \ \ expire\_timeout\_slots(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{expire\_timeout\_slots\_}}),}
\DoxyCodeLine{00039\ \ \ grids(std::move(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{grids\_}})),}
\DoxyCodeLine{00040\ \ \ grids\_str\_zero(grids.size()),}
\DoxyCodeLine{00041\ \ \ grids\_str\_reserved(grids.size()),}
\DoxyCodeLine{00042\ \ \ reserved(grids.size()),}
\DoxyCodeLine{00043\ \ \ available(grids.size()),}
\DoxyCodeLine{00044\ \ \ async\_executor(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{async\_executor\_}})}
\DoxyCodeLine{00045\ \{}
\DoxyCodeLine{00046\ \ \ \textcolor{comment}{//\ Make\ sure\ the\ expiration\ timeout\ is\ consistent\ with\ the\ number\ of\ grids.\ If\ the\ expiration\ time\ is\ greater\ than}}
\DoxyCodeLine{00047\ \ \ \textcolor{comment}{//\ or\ equal\ to\ the\ number\ of\ grids,\ the\ pool\ blocks.}}
\DoxyCodeLine{00048\ \ \ srsran\_assert(expire\_timeout\_slots\ <\ grids.size(),}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ grid\ expiration\ time\ (i.e.,\ \{\})\ must\ be\ lesser\ than\ the\ number\ of\ grids\ (i.e.,\ \{\})."{}},}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ expire\_timeout\_slots,}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ grids.size());}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{//\ Move\ grids\ to\ available\ list.}}
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_grid}}\ =\ 0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_grid\_end}}\ =\ grids.size();\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_grid}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_grid\_end}};\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_grid}})\ \{}
\DoxyCodeLine{00055\ \ \ \ \ grids\_str\_zero[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_grid}}]\ \ \ \ \ =\ \textcolor{stringliteral}{"{}set\_all\_zero\#"{}}\ +\ std::to\_string(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_grid}});}
\DoxyCodeLine{00056\ \ \ \ \ grids\_str\_reserved[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_grid}}]\ =\ \textcolor{stringliteral}{"{}rg\_reserved\#"{}}\ +\ std::to\_string(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_grid}});}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{bool}\ success\ =\ available.\mbox{\hyperlink{classsrsran_1_1concurrent__queue_acc0043f182b8d55c7cd432047fe15179}{push\_blocking}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{i\_grid}});}
\DoxyCodeLine{00059\ \ \ \ \ srsran\_assert(success,\ \textcolor{stringliteral}{"{}Failed\ to\ push\ grid."{}});}
\DoxyCodeLine{00060\ \ \ \}}
\DoxyCodeLine{00061\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1resource__grid__pool__asynchronous__impl_ae2dea9cc6458aa8e22be622ffe3454ef}\label{classsrsran_1_1resource__grid__pool__asynchronous__impl_ae2dea9cc6458aa8e22be622ffe3454ef} 
\index{srsran::resource\_grid\_pool\_asynchronous\_impl@{srsran::resource\_grid\_pool\_asynchronous\_impl}!get\_resource\_grid@{get\_resource\_grid}}
\index{get\_resource\_grid@{get\_resource\_grid}!srsran::resource\_grid\_pool\_asynchronous\_impl@{srsran::resource\_grid\_pool\_asynchronous\_impl}}
\doxysubsubsection{\texorpdfstring{get\_resource\_grid()}{get\_resource\_grid()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classsrsran_1_1resource__grid}{resource\+\_\+grid}} \& resource\+\_\+grid\+\_\+pool\+\_\+asynchronous\+\_\+impl\+::get\+\_\+resource\+\_\+grid (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1resource__grid__context}{resource\+\_\+grid\+\_\+context}} \&}]{context }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Get a resource grid for the given context 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em context} & Provides the given context \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{classsrsran_1_1resource__grid__pool_a1e6bb07037155aa557847f14da25605d}{srsran\+::resource\+\_\+grid\+\_\+pool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00064\ \{}
\DoxyCodeLine{00065\ \ \ \textcolor{comment}{//\ While\ the\ reserved\ buffer\ is\ not\ empty\ and\ the\ first\ element\ is\ expired.}}
\DoxyCodeLine{00066\ \ \ \textcolor{keywordflow}{while}\ (!reserved.empty()\ \&\&\ (reserved.top().expiration\ <=\ context.\mbox{\hyperlink{structsrsran_1_1resource__grid__context_a520e03a16004ae2879ddb2f934c6b7d8}{slot}}))\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{comment}{//\ Read\ first\ element.}}
\DoxyCodeLine{00068\ \ \ \ \ reserved\_resource\_grid\ grid\ =\ reserved.top();}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{comment}{//\ Extract\ grid\ identifier.}}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ grid\_id\ =\ grid.grid\_id;}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ Skip\ setting\ to\ zero\ if\ the\ grid\ is\ empty.}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{if}\ (grids[grid\_id]-\/>get\_reader().is\_empty())\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ reserved.pop();}
\DoxyCodeLine{00076\ \ \ \ \ \ \ available.\mbox{\hyperlink{classsrsran_1_1concurrent__queue_acc0043f182b8d55c7cd432047fe15179}{push\_blocking}}(grid\_id);}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00078\ \ \ \ \ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ Create\ lambda\ function\ for\ setting\ the\ grid\ to\ zero.}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{set\_all\_zero\_func}}\ =\ [\textcolor{keyword}{this},\ grid\_id]()\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ trace\_point\ tp\ =\ \mbox{\hyperlink{namespacesrsran_a84c18973244331fd6a0b0e1e553e54a1}{l1\_tracer}}.now();}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ grid\ to\ zero.}}
\DoxyCodeLine{00085\ \ \ \ \ \ \ grids[grid\_id]-\/>set\_all\_zero();}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \ \ \textcolor{comment}{//\ Queue\ available\ grid.}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ success\ =\ available.\mbox{\hyperlink{classsrsran_1_1concurrent__queue_acc0043f182b8d55c7cd432047fe15179}{push\_blocking}}(grid\_id);}
\DoxyCodeLine{00089\ \ \ \ \ \ \ srsran\_assert(success,\ \textcolor{stringliteral}{"{}Failed\ to\ push\ grid."{}});}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a84c18973244331fd6a0b0e1e553e54a1}{l1\_tracer}}\ <<\ \mbox{\hyperlink{structsrsran_1_1trace__event}{trace\_event}}(grids\_str\_zero[grid\_id].c\_str(),\ tp);}
\DoxyCodeLine{00092\ \ \ \ \ \};}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{comment}{//\ Try\ to\ execute\ the\ asynchronous\ housekeeping\ task.}}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordtype}{bool}\ success\ =\ async\_executor.\mbox{\hyperlink{classsrsran_1_1task__executor_a7ce182401ef2d2b419bfbed5b5e488f7}{execute}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{set\_all\_zero\_func}});}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{comment}{//\ Pop\ the\ resource\ grid\ identifier\ if\ it\ was\ successfully\ executed.\ Otherwise,\ it\ skips\ zeroing.}}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{if}\ (success)\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \ \ reserved.pop();}
\DoxyCodeLine{00100\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ logger.warning(context.\mbox{\hyperlink{structsrsran_1_1resource__grid__context_a520e03a16004ae2879ddb2f934c6b7d8}{slot}}.\mbox{\hyperlink{classsrsran_1_1slot__point_a19d7b2faaa1fcc74f3d01560339f7602}{sfn}}(),\ context.\mbox{\hyperlink{structsrsran_1_1resource__grid__context_a520e03a16004ae2879ddb2f934c6b7d8}{slot}}.\mbox{\hyperlink{classsrsran_1_1slot__point_a1808c0aeecc25d6382e49511028c010e}{slot\_index}}(),\ \textcolor{stringliteral}{"{}Failed\ to\ enqueue\ grid\ zeroing\ task."{}});}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00103\ \ \ \ \ \}}
\DoxyCodeLine{00104\ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \textcolor{comment}{//\ Trace\ point\ for\ grid\ reservation.}}
\DoxyCodeLine{00107\ \ \ trace\_point\ tp\ =\ \mbox{\hyperlink{namespacesrsran_a84c18973244331fd6a0b0e1e553e54a1}{l1\_tracer}}.now();}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \textcolor{comment}{//\ Pop\ first\ available\ grid.}}
\DoxyCodeLine{00110\ \ \ \mbox{\hyperlink{classsrsran_1_1optional}{optional<unsigned>}}\ grid\ =\ available.\mbox{\hyperlink{classsrsran_1_1concurrent__queue_a9fc2964f0e85797249b5531434c70935}{pop\_blocking}}();}
\DoxyCodeLine{00111\ \ \ srsran\_assert(grid.\mbox{\hyperlink{classsrsran_1_1optional_a2f160539a76c3f4dd0b50b339b81202e}{has\_value}}(),\ \textcolor{stringliteral}{"{}Failed\ to\ pop\ grid."{}});}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \textcolor{comment}{//\ Prepare\ reserved\ grid\ and\ enqueue.}}
\DoxyCodeLine{00114\ \ \ reserved\_resource\_grid\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{reserved\_grid}};}
\DoxyCodeLine{00115\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{reserved\_grid}}.expiration\ =\ context.\mbox{\hyperlink{structsrsran_1_1resource__grid__context_a520e03a16004ae2879ddb2f934c6b7d8}{slot}}\ +\ expire\_timeout\_slots;}
\DoxyCodeLine{00116\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{reserved\_grid}}.grid\_id\ \ \ \ =\ grid.value();}
\DoxyCodeLine{00117\ \ \ reserved.push(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{reserved\_grid}});}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \textcolor{comment}{//\ Trace\ the\ resource\ grid\ reservation.}}
\DoxyCodeLine{00120\ \ \ \mbox{\hyperlink{namespacesrsran_a84c18973244331fd6a0b0e1e553e54a1}{l1\_tracer}}\ <<\ \mbox{\hyperlink{structsrsran_1_1trace__event}{trace\_event}}(grids\_str\_reserved[grid.value()].c\_str(),\ tp);}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{return}\ *grids[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{reserved\_grid}}.grid\_id];}
\DoxyCodeLine{00123\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/phy/support/resource\+\_\+grid\+\_\+pool\+\_\+asynchronous\+\_\+impl.\+h\item 
lib/phy/support/resource\+\_\+grid\+\_\+pool\+\_\+asynchronous\+\_\+impl.\+cpp\end{DoxyCompactItemize}
