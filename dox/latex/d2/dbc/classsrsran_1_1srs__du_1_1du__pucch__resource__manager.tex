\doxysection{srsran\+::srs\+\_\+du\+::du\+\_\+pucch\+\_\+resource\+\_\+manager Class Reference}
\hypertarget{classsrsran_1_1srs__du_1_1du__pucch__resource__manager}{}\label{classsrsran_1_1srs__du_1_1du__pucch__resource__manager}\index{srsran::srs\_du::du\_pucch\_resource\_manager@{srsran::srs\_du::du\_pucch\_resource\_manager}}


This class manages the allocation of RAN PUCCH Resources to DU UEs. For instance, this class ensures that UEs do not collide in the usage of the PUCCH for SRs and CSI. For HARQ-\/\+ACKs, we rely on the MAC scheduler to ensure no collisions take place in the PUCCH.  




{\ttfamily \#include $<$du\+\_\+pucch\+\_\+resource\+\_\+manager.\+h$>$}



Collaboration diagram for srsran\+::srs\+\_\+du\+::du\+\_\+pucch\+\_\+resource\+\_\+manager\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=251pt]{d0/d8b/classsrsran_1_1srs__du_1_1du__pucch__resource__manager__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a333f7fe234936b54a11682c3900118a4}{du\+\_\+pucch\+\_\+resource\+\_\+manager}} (\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1du__cell__config}{du\+\_\+cell\+\_\+config}} $>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\+\_\+cfg\+\_\+list\+\_\+}}, \mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\+\_\+pucch\+\_\+grants\+\_\+per\+\_\+slot\+\_\+}})
\item 
\Hypertarget{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a18f8518e6bcae092bdb5334e0beea853}\label{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a18f8518e6bcae092bdb5334e0beea853} 
{\bfseries du\+\_\+pucch\+\_\+resource\+\_\+manager} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1srs__du_1_1du__pucch__resource__manager}{du\+\_\+pucch\+\_\+resource\+\_\+manager}} \&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
\Hypertarget{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a7d7b7e25ba691bb56d2903f827157b69}\label{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a7d7b7e25ba691bb56d2903f827157b69} 
{\bfseries du\+\_\+pucch\+\_\+resource\+\_\+manager} (\mbox{\hyperlink{classsrsran_1_1srs__du_1_1du__pucch__resource__manager}{du\+\_\+pucch\+\_\+resource\+\_\+manager}} \&\&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
\Hypertarget{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a99e8fbd21114494430ba9c60f52343dc}\label{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a99e8fbd21114494430ba9c60f52343dc} 
\mbox{\hyperlink{classsrsran_1_1srs__du_1_1du__pucch__resource__manager}{du\+\_\+pucch\+\_\+resource\+\_\+manager}} \& {\bfseries operator=} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{classsrsran_1_1srs__du_1_1du__pucch__resource__manager}{du\+\_\+pucch\+\_\+resource\+\_\+manager}} \&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
\Hypertarget{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_af473b968a7a6bee2b557598f3fe30d36}\label{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_af473b968a7a6bee2b557598f3fe30d36} 
\mbox{\hyperlink{classsrsran_1_1srs__du_1_1du__pucch__resource__manager}{du\+\_\+pucch\+\_\+resource\+\_\+manager}} \& {\bfseries operator=} (\mbox{\hyperlink{classsrsran_1_1srs__du_1_1du__pucch__resource__manager}{du\+\_\+pucch\+\_\+resource\+\_\+manager}} \&\&)=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{delete}}
\item 
\mbox{\hyperlink{classbool}{bool}} \mbox{\hyperlink{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a2fdd5b5a574bb52e9cc1e6fec03900bb}{alloc\+\_\+resources}} (\mbox{\hyperlink{structsrsran_1_1srs__du_1_1cell__group__config}{cell\+\_\+group\+\_\+config}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\+\_\+grp\+\_\+cfg}})
\begin{DoxyCompactList}\small\item\em Allocate PUCCH resources for a given UE. The resources are stored in the UE\textquotesingle{}s cell group config. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a3eac0634989efb5854976b9218d6daea}{dealloc\+\_\+resources}} (\mbox{\hyperlink{structsrsran_1_1srs__du_1_1cell__group__config}{cell\+\_\+group\+\_\+config}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\+\_\+grp\+\_\+cfg}})
\begin{DoxyCompactList}\small\item\em Deallocate PUCCH resources previously given to a UE. The resources are returned back to a pool. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
This class manages the allocation of RAN PUCCH Resources to DU UEs. For instance, this class ensures that UEs do not collide in the usage of the PUCCH for SRs and CSI. For HARQ-\/\+ACKs, we rely on the MAC scheduler to ensure no collisions take place in the PUCCH. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a333f7fe234936b54a11682c3900118a4}\label{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a333f7fe234936b54a11682c3900118a4} 
\index{srsran::srs\_du::du\_pucch\_resource\_manager@{srsran::srs\_du::du\_pucch\_resource\_manager}!du\_pucch\_resource\_manager@{du\_pucch\_resource\_manager}}
\index{du\_pucch\_resource\_manager@{du\_pucch\_resource\_manager}!srsran::srs\_du::du\_pucch\_resource\_manager@{srsran::srs\_du::du\_pucch\_resource\_manager}}
\doxysubsubsection{\texorpdfstring{du\_pucch\_resource\_manager()}{du\_pucch\_resource\_manager()}}
{\footnotesize\ttfamily du\+\_\+pucch\+\_\+resource\+\_\+manager\+::du\+\_\+pucch\+\_\+resource\+\_\+manager (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1du__cell__config}{du\+\_\+cell\+\_\+config}} $>$}]{cell\+\_\+cfg\+\_\+list\+\_\+,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{max\+\_\+pucch\+\_\+grants\+\_\+per\+\_\+slot\+\_\+ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00059\ \ \ user\_defined\_pucch\_cfg(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].pucch\_cfg),}
\DoxyCodeLine{00060\ \ \ default\_pucch\_res\_list(}
\DoxyCodeLine{00061\ \ \ \ \ \ \ srs\_du::generate\_cell\_pucch\_res\_list(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].pucch\_cfg.nof\_ue\_pucch\_f1\_res\_harq.to\_uint()\ *}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].pucch\_cfg.nof\_cell\_harq\_pucch\_res\_sets\ +}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].pucch\_cfg.nof\_sr\_resources,}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].pucch\_cfg.nof\_ue\_pucch\_f2\_res\_harq.to\_uint()\ *}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].pucch\_cfg.nof\_cell\_harq\_pucch\_res\_sets\ +}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].pucch\_cfg.nof\_csi\_resources,}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].pucch\_cfg.f1\_params,}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].pucch\_cfg.f2\_params,}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].ul\_cfg\_common.init\_ul\_bwp.generic\_params.crbs.length())),}
\DoxyCodeLine{00070\ \ \ default\_pucch\_cfg(}
\DoxyCodeLine{00071\ \ \ \ \ \ \ build\_default\_pucch\_cfg(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].ue\_ded\_serv\_cell\_cfg.ul\_config-\/>init\_ul\_bwp.pucch\_cfg.value(),}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ user\_defined\_pucch\_cfg)),}
\DoxyCodeLine{00073\ \ \ default\_csi\_report\_cfg([\&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}]()\ -\/>\ \mbox{\hyperlink{classsrsran_1_1optional}{optional<csi\_report\_config>}}\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_meas}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].ue\_ded\_serv\_cell\_cfg.csi\_meas\_cfg;}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_meas}}.has\_value()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_meas}}-\/>csi\_report\_cfg\_list.empty())\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ return\ csi\_meas-\/>csi\_report\_cfg\_list[0];}
\DoxyCodeLine{00077\ \ \ \ \ \}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a2e817fa4d4a8084eb1746ee8d1440679}{nullopt}};}
\DoxyCodeLine{00079\ \ \ \}()),}
\DoxyCodeLine{00080\ \ \ \textcolor{comment}{//\ Leave\ 1\ PUCCH\ grants\ for\ HARQ\ ACKs.}}
\DoxyCodeLine{00081\ \ \ max\_pucch\_grants\_per\_slot(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{max\_pucch\_grants\_per\_slot\_}}\ -\/\ 1U),}
\DoxyCodeLine{00082\ \ \ cells(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}.size())}
\DoxyCodeLine{00083\ \{}
\DoxyCodeLine{00084\ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ default\_pucch\_cfg.\mbox{\hyperlink{structsrsran_1_1pucch__config_a9cd322ac5ec3ab428121e1a82f81d0cf}{sr\_res\_list}}.empty(),\ \textcolor{stringliteral}{"{}There\ must\ be\ at\ least\ one\ SR\ Resource"{}});}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \textcolor{comment}{//\ Compute\ fundamental\ SR\ period.}}
\DoxyCodeLine{00087\ \ \ \textcolor{comment}{//\ TODO:\ Handle\ more\ than\ one\ SR\ period.}}
\DoxyCodeLine{00088\ \ \ sr\_period\_slots\ =\ \mbox{\hyperlink{namespacesrsran_a359275bb921a72119f37ed0df37ae091}{sr\_periodicity\_to\_slot}}(default\_pucch\_cfg.\mbox{\hyperlink{structsrsran_1_1pucch__config_a9cd322ac5ec3ab428121e1a82f81d0cf}{sr\_res\_list}}[0].period);}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \textcolor{comment}{//\ Compute\ fundamental\ CSI\ report\ period.}}
\DoxyCodeLine{00091\ \ \ \textcolor{comment}{//\ TODO:\ Handle\ more\ than\ one\ CSI\ report\ period.}}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ (default\_csi\_report\_cfg.has\_value())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ rep\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{srsran::variant\_get<csi\_report\_config::periodic\_or\_semi\_persistent\_report\_on\_pucch>}}(}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ default\_csi\_report\_cfg-\/>report\_cfg\_type);}
\DoxyCodeLine{00095\ \ \ \ \ csi\_period\_slots\ =\ csi\_report\_periodicity\_to\_uint(rep.report\_slot\_period);}
\DoxyCodeLine{00096\ \ \ \}}
\DoxyCodeLine{00097\ \ \ \textcolor{comment}{//\ As\ the\ SR\ and\ CSI\ period\ might\ not\ be\ one\ a\ multiple\ of\ each\ other,\ we\ compute\ the\ Least\ Common\ Multiple\ (LCM)\ of}}
\DoxyCodeLine{00098\ \ \ \textcolor{comment}{//\ the\ two\ periods.}}
\DoxyCodeLine{00099\ \ \ lcm\_csi\_sr\_period\ =\ \mbox{\hyperlink{namespacesrsran_a6b6b94c2d0fec617b6da702c6478140b}{lcm}}(sr\_period\_slots,\ csi\_period\_slots);}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \textcolor{comment}{//\ Setup\ RAN\ resources\ per\ cell.}}
\DoxyCodeLine{00102\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ cell\ :\ cells)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//\ Initialize\ the\ PUCCH\ grants-\/per-\/slot\ counter.}}
\DoxyCodeLine{00104\ \ \ \ \ cell.pucch\_grants\_per\_slot\_cnt.resize(lcm\_csi\_sr\_period,\ 0);}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{comment}{//\ Set\ up\ the\ pucch\_res\_id\ for\ the\ resource\ used\ for\ SR.}}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_idx}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_idx}}\ <\ user\_defined\_pucch\_cfg.\mbox{\hyperlink{structsrsran_1_1pucch__builder__params_a7c6e654d337586250eb8544ee3fad6fd}{nof\_sr\_resources}};\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_idx}})\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ offset\ =\ 0;\ offset\ !=\ sr\_period\_slots;\ ++offset)\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].tdd\_ul\_dl\_cfg\_common.has\_value())\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1tdd__ul__dl__config__common}{tdd\_ul\_dl\_config\_common}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tdd\_cfg}}\ =\ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].tdd\_ul\_dl\_cfg\_common;}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ slot\_index\ =\ offset\ \%\ (\mbox{\hyperlink{namespacesrsran_afe120c5fa59fc13e75fa47b6161f3ad3}{NOF\_SUBFRAMES\_PER\_FRAME}}\ *\ \mbox{\hyperlink{namespacesrsran_a45b408115d2fba72e768ef375c59da19}{get\_nof\_slots\_per\_subframe}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tdd\_cfg}}.ref\_scs));}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_aa7df181c0c8aa3e214580bccdd5d2cdc}{srsran::get\_active\_tdd\_ul\_symbols}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tdd\_cfg}},\ slot\_index,\ \mbox{\hyperlink{classsrsran_1_1cyclic__prefix_adb112068f1eb62e47a74b63b90d92b65a464683a58c4e07f845370a0eb40a0b67}{cyclic\_prefix::NORMAL}}).\mbox{\hyperlink{classsrsran_1_1interval_ac47a815285449ead553a43a0b5f85f63}{length}}()\ !=}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a2ec632168c0292dc5fd78c9bd35f159b}{NOF\_OFDM\_SYM\_PER\_SLOT\_NORMAL\_CP}})\ \{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ UL\ disabled\ for\ this\ slot.}}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ cell.sr\_res\_offset\_free\_list.emplace\_back(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_idx}},\ offset);}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00120\ \ \ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_res\_idx}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_res\_idx}}\ <\ user\_defined\_pucch\_cfg.\mbox{\hyperlink{structsrsran_1_1pucch__builder__params_a1d4f9b7c4f163907599867ae40c9210b}{nof\_csi\_resources}};\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_res\_idx}})\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ offset\ =\ 0;\ offset\ !=\ csi\_period\_slots;\ ++offset)\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].tdd\_ul\_dl\_cfg\_common.has\_value())\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1tdd__ul__dl__config__common}{tdd\_ul\_dl\_config\_common}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tdd\_cfg}}\ =\ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_cfg\_list\_}}[0].tdd\_ul\_dl\_cfg\_common;}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ slot\_index\ =\ offset\ \%\ (\mbox{\hyperlink{namespacesrsran_afe120c5fa59fc13e75fa47b6161f3ad3}{NOF\_SUBFRAMES\_PER\_FRAME}}\ *\ \mbox{\hyperlink{namespacesrsran_a45b408115d2fba72e768ef375c59da19}{get\_nof\_slots\_per\_subframe}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tdd\_cfg}}.ref\_scs));}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_aa7df181c0c8aa3e214580bccdd5d2cdc}{srsran::get\_active\_tdd\_ul\_symbols}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{tdd\_cfg}},\ slot\_index,\ \mbox{\hyperlink{classsrsran_1_1cyclic__prefix_adb112068f1eb62e47a74b63b90d92b65a464683a58c4e07f845370a0eb40a0b67}{cyclic\_prefix::NORMAL}}).\mbox{\hyperlink{classsrsran_1_1interval_ac47a815285449ead553a43a0b5f85f63}{length}}()\ !=}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a2ec632168c0292dc5fd78c9bd35f159b}{NOF\_OFDM\_SYM\_PER\_SLOT\_NORMAL\_CP}})\ \{}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ UL\ disabled\ for\ this\ slot.}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ cell.csi\_res\_offset\_free\_list.emplace\_back(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_res\_idx}},\ offset);}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00135\ \ \ \ \ \}}
\DoxyCodeLine{00136\ \ \ \}}
\DoxyCodeLine{00137\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a2fdd5b5a574bb52e9cc1e6fec03900bb}\label{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a2fdd5b5a574bb52e9cc1e6fec03900bb} 
\index{srsran::srs\_du::du\_pucch\_resource\_manager@{srsran::srs\_du::du\_pucch\_resource\_manager}!alloc\_resources@{alloc\_resources}}
\index{alloc\_resources@{alloc\_resources}!srsran::srs\_du::du\_pucch\_resource\_manager@{srsran::srs\_du::du\_pucch\_resource\_manager}}
\doxysubsubsection{\texorpdfstring{alloc\_resources()}{alloc\_resources()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classbool}{bool}} du\+\_\+pucch\+\_\+resource\+\_\+manager\+::alloc\+\_\+resources (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1srs__du_1_1cell__group__config}{cell\+\_\+group\+\_\+config}} \&}]{cell\+\_\+grp\+\_\+cfg }\end{DoxyParamCaption})}



Allocate PUCCH resources for a given UE. The resources are stored in the UE\textquotesingle{}s cell group config. 

\begin{DoxyReturn}{Returns}
true if allocation was successful. 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{00217\ \{}
\DoxyCodeLine{00218\ \ \ \textcolor{comment}{//\ Allocation\ of\ SR\ PUCCH\ offset.}}
\DoxyCodeLine{00219\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.ul\_config-\/>init\_ul\_bwp.pucch\_cfg\ =\ default\_pucch\_cfg;}
\DoxyCodeLine{00220\ \ \ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{free\_sr\_list}}\ \ =\ cells[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.cell\_index].sr\_res\_offset\_free\_list;}
\DoxyCodeLine{00221\ \ \ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{free\_csi\_list}}\ =\ cells[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.cell\_index].csi\_res\_offset\_free\_list;}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \textcolor{comment}{//\ Verify\ where\ there\ are\ SR\ and\ CSI\ resources\ to\ allocate\ a\ new\ UE.}}
\DoxyCodeLine{00224\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{free\_sr\_list}}.empty()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{or}}\ (default\_csi\_report\_cfg.has\_value()\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{free\_csi\_list}}.empty()))\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00226\ \ \ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \mbox{\hyperlink{classsrsran_1_1optional}{optional<std::pair<unsigned,\ unsigned>}}>\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset}};}
\DoxyCodeLine{00229\ \ \ \mbox{\hyperlink{classsrsran_1_1optional}{optional<std::pair<unsigned,\ unsigned>}}>\ csi\_res\_offset;}
\DoxyCodeLine{00230\ \ \ \textcolor{keyword}{auto}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset\_it}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{free\_sr\_list}}.begin();}
\DoxyCodeLine{00231\ \ \ \textcolor{comment}{//\ Iterate\ over\ the\ list\ of\ SR\ resource/offsets\ and\ find\ the\ first\ one\ that\ doesn't\ exceed\ the\ maximum\ number\ of\ PUCCH}}
\DoxyCodeLine{00232\ \ \ \textcolor{comment}{//\ grants.}}
\DoxyCodeLine{00233\ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset\_it}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{free\_sr\_list}}.end())\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_cnt\_exceeded}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_off}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset\_it}}-\/>second;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_off}}\ <\ lcm\_csi\_sr\_period;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_off}}\ +=\ sr\_period\_slots)\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_off}}\ <\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(cells[0].pucch\_grants\_per\_slot\_cnt.size()),}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Index\ exceeds\ the\ size\ of\ the\ PUCCH\ grants\ vector"{}});}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_cnt\_exceeded}}\ =\ cells[0].pucch\_grants\_per\_slot\_cnt[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_off}}]\ >=\ max\_pucch\_grants\_per\_slot;}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_cnt\_exceeded}})\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00242\ \ \ \ \ \}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{comment}{//\ If\ the\ PUCCH\ is\ exceeded,\ proceed\ with\ the\ next\ SR\ resource/offset\ pair.}}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pucch\_cnt\_exceeded}})\ \{}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ default\_csi\_report\_cfg.has\_value())\ \{}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset}}\ =\ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset\_it}};}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{free\_sr\_list}}.erase(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset\_it}});}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.csi\_meas\_cfg-\/>csi\_report\_cfg\_list\ =\ \{*default\_csi\_report\_cfg\};}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{optimal\_res\_it}}\ =\ get\_csi\_resource\_offset(}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.csi\_meas\_cfg.value(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset\_it}}-\/>second,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{free\_csi\_list}});}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{optimal\_res\_it}}\ !=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{free\_csi\_list}}.end())\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ the\ allocation\ has\ been\ successful.\ Remove\ SR\ and\ CSI\ resources\ assigned\ to\ this\ UE\ from\ the}}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ lists\ of\ free\ resources.}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ csi\_res\_offset\ =\ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{optimal\_res\_it}};}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{free\_csi\_list}}.erase(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{optimal\_res\_it}});}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset}}\ =\ *\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset\_it}};}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{free\_sr\_list}}.erase(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset\_it}});}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00266\ \ \ \ \ \}}
\DoxyCodeLine{00267\ \ \ \ \ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset\_it}};}
\DoxyCodeLine{00268\ \ \ \}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset}}.has\_value())\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00272\ \ \ \}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \textcolor{comment}{//\ Update\ the\ PUCCH\ grants-\/per-\/slot\ counter.}}
\DoxyCodeLine{00275\ \ \ std::set<unsigned>\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_sr\_offset\_for\_pucch\_cnt}}\ =\ compute\_sr\_csi\_pucch\_offsets(}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset}}.value().second,\ default\_csi\_report\_cfg.has\_value()\ ?\ csi\_res\_offset.value().second\ :\ 0);}
\DoxyCodeLine{00277\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ offset\ :\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_sr\_offset\_for\_pucch\_cnt}})\ \{}
\DoxyCodeLine{00278\ \ \ \ \ srsran\_assert(offset\ <\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(cells[0].pucch\_grants\_per\_slot\_cnt.size()),}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Index\ exceeds\ the\ size\ of\ the\ PUCCH\ grants\ vector"{}});}
\DoxyCodeLine{00280\ \ \ \ \ ++cells[0].pucch\_grants\_per\_slot\_cnt[offset];}
\DoxyCodeLine{00281\ \ \ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \textcolor{comment}{//\ Generate\ PUCCH\ resource\ list\ for\ the\ UE.}}
\DoxyCodeLine{00284\ \ \ srs\_du::ue\_pucch\_config\_builder(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg,}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ default\_pucch\_res\_list,}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cells[0].ue\_idx,}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset}}.value().first,}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ csi\_res\_offset.\mbox{\hyperlink{classsrsran_1_1optional_a2f160539a76c3f4dd0b50b339b81202e}{has\_value}}()\ ?\ csi\_res\_offset.value().first\ :\ 0,}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ user\_defined\_pucch\_cfg.nof\_ue\_pucch\_f1\_res\_harq,}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ user\_defined\_pucch\_cfg.nof\_ue\_pucch\_f2\_res\_harq,}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ user\_defined\_pucch\_cfg.nof\_cell\_harq\_pucch\_res\_sets,}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ user\_defined\_pucch\_cfg.nof\_sr\_resources,}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ user\_defined\_pucch\_cfg.nof\_csi\_resources);}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \textcolor{comment}{//\ Set\ the\ offsets\ for\ SR\ and\ CSI.}}
\DoxyCodeLine{00296\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.ul\_config-\/>init\_ul\_bwp.pucch\_cfg-\/>sr\_res\_list.front().offset\ =}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_res\_offset}}.value().second;}
\DoxyCodeLine{00298\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.csi\_meas\_cfg.has\_value())\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{srsran::variant\_get<csi\_report\_config::periodic\_or\_semi\_persistent\_report\_on\_pucch>}}(}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.csi\_meas\_cfg-\/>csi\_report\_cfg\_list[0].report\_cfg\_type)}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ .report\_slot\_offset\ =\ csi\_res\_offset.value().second;}
\DoxyCodeLine{00302\ \ \ \}}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ ++cells[0].ue\_idx;}
\DoxyCodeLine{00305\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00306\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a3eac0634989efb5854976b9218d6daea}\label{classsrsran_1_1srs__du_1_1du__pucch__resource__manager_a3eac0634989efb5854976b9218d6daea} 
\index{srsran::srs\_du::du\_pucch\_resource\_manager@{srsran::srs\_du::du\_pucch\_resource\_manager}!dealloc\_resources@{dealloc\_resources}}
\index{dealloc\_resources@{dealloc\_resources}!srsran::srs\_du::du\_pucch\_resource\_manager@{srsran::srs\_du::du\_pucch\_resource\_manager}}
\doxysubsubsection{\texorpdfstring{dealloc\_resources()}{dealloc\_resources()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} du\+\_\+pucch\+\_\+resource\+\_\+manager\+::dealloc\+\_\+resources (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1srs__du_1_1cell__group__config}{cell\+\_\+group\+\_\+config}} \&}]{cell\+\_\+grp\+\_\+cfg }\end{DoxyParamCaption})}



Deallocate PUCCH resources previously given to a UE. The resources are returned back to a pool. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00309\ \{}
\DoxyCodeLine{00310\ \ \ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_to\_deallocate}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.ul\_config-\/>init\_ul\_bwp.pucch\_cfg-\/>sr\_res\_list.front();}
\DoxyCodeLine{00311\ \ \ cells[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.cell\_index].sr\_res\_offset\_free\_list.emplace\_back(}
\DoxyCodeLine{00312\ \ \ \ \ \ \ pucch\_res\_idx\_to\_sr\_du\_res\_idx(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_to\_deallocate}}.pucch\_res\_id.cell\_res\_id),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_to\_deallocate}}.offset);}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_offset}}\ =\ 0;}
\DoxyCodeLine{00315\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.csi\_meas\_cfg.has\_value())\ \{}
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{target\_csi\_cfg}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{srsran::variant\_get<csi\_report\_config::periodic\_or\_semi\_persistent\_report\_on\_pucch>}}(}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.csi\_meas\_cfg-\/>csi\_report\_cfg\_list[0].report\_cfg\_type);}
\DoxyCodeLine{00318\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_offset}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{target\_csi\_cfg}}.report\_slot\_offset;}
\DoxyCodeLine{00319\ \ \ \ \ cells[\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cell\_grp\_cfg}}.cells[0].serv\_cell\_cfg.cell\_index].csi\_res\_offset\_free\_list.emplace\_back(}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ pucch\_res\_idx\_to\_csi\_du\_res\_idx(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{target\_csi\_cfg}}.pucch\_csi\_res\_list.front().pucch\_res\_id.cell\_res\_id),}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_offset}});}
\DoxyCodeLine{00322\ \ \ \}}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \textcolor{comment}{//\ Remove\ the\ SR\ and\ CSI\ offsets\ from\ the\ PUCCH\ grants-\/per-\/slot\ counter.}}
\DoxyCodeLine{00325\ \ \ std::set<unsigned>\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_sr\_offset\_for\_pucch\_cnt}}\ =\ compute\_sr\_csi\_pucch\_offsets(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{sr\_to\_deallocate}}.offset,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_offset}});}
\DoxyCodeLine{00326\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ offset\ :\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{csi\_sr\_offset\_for\_pucch\_cnt}})\ \{}
\DoxyCodeLine{00327\ \ \ \ \ srsran\_assert(offset\ <\ cells[0].pucch\_grants\_per\_slot\_cnt.size(),}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Index\ exceeds\ the\ size\ of\ the\ PUCCH\ grants\ vector"{}});}
\DoxyCodeLine{00329\ \ \ \ \ srsran\_assert(cells[0].pucch\_grants\_per\_slot\_cnt[offset]\ !=\ 0,\ \textcolor{stringliteral}{"{}Index\ exceeds\ the\ size\ of\ the\ PUCCH\ grants\ vector"{}});}
\DoxyCodeLine{00330\ \ \ \ \ -\/-\/cells[0].pucch\_grants\_per\_slot\_cnt[offset];}
\DoxyCodeLine{00331\ \ \ \}}
\DoxyCodeLine{00332\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/du\+\_\+manager/ran\+\_\+resource\+\_\+management/du\+\_\+pucch\+\_\+resource\+\_\+manager.\+h\item 
lib/du\+\_\+manager/ran\+\_\+resource\+\_\+management/du\+\_\+pucch\+\_\+resource\+\_\+manager.\+cpp\end{DoxyCompactItemize}
