\doxysection{srsran\+::ether\+::receiver\+\_\+impl Class Reference}
\hypertarget{classsrsran_1_1ether_1_1receiver__impl}{}\label{classsrsran_1_1ether_1_1receiver__impl}\index{srsran::ether::receiver\_impl@{srsran::ether::receiver\_impl}}


Implementation for the Ethernet receiver.  




{\ttfamily \#include $<$ethernet\+\_\+receiver\+\_\+impl.\+h$>$}



Inheritance diagram for srsran\+::ether\+::receiver\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=225pt]{d6/d9f/classsrsran_1_1ether_1_1receiver__impl__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::ether\+::receiver\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=225pt]{d4/d44/classsrsran_1_1ether_1_1receiver__impl__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1ether_1_1receiver__impl_a80d0fc084dd7bd0fb1f49d4994fadcba}{receiver\+\_\+impl}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} std\+::string \&interface, \mbox{\hyperlink{classbool}{bool}} is\+\_\+promiscuous\+\_\+mode\+\_\+enabled, \mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{executor\+\_\+}}, \mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{logger\+\_\+}})
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ether_1_1receiver__impl_abbd3639a5bfc84b8ca5b0582deafb0a3}{start}} (\mbox{\hyperlink{classsrsran_1_1ether_1_1frame__notifier}{frame\+\_\+notifier}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{notifier\+\_\+}}) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Starts the Ethernet receiver operation. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ether_1_1receiver__impl_acd657e499501c4d0870361d0c7eb599a}{stop}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Stops the Ethernet receiver operation. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1ether_1_1receiver}{srsran\+::ether\+::receiver}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{virtual}} {\bfseries \texorpdfstring{$\sim$}{\string~}receiver} ()=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{default}}
\begin{DoxyCompactList}\small\item\em Default destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implementation for the Ethernet receiver. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1ether_1_1receiver__impl_a80d0fc084dd7bd0fb1f49d4994fadcba}\label{classsrsran_1_1ether_1_1receiver__impl_a80d0fc084dd7bd0fb1f49d4994fadcba} 
\index{srsran::ether::receiver\_impl@{srsran::ether::receiver\_impl}!receiver\_impl@{receiver\_impl}}
\index{receiver\_impl@{receiver\_impl}!srsran::ether::receiver\_impl@{srsran::ether::receiver\_impl}}
\doxysubsubsection{\texorpdfstring{receiver\_impl()}{receiver\_impl()}}
{\footnotesize\ttfamily receiver\+\_\+impl\+::receiver\+\_\+impl (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} std\+::string \&}]{interface,  }\item[{\mbox{\hyperlink{classbool}{bool}}}]{is\+\_\+promiscuous\+\_\+mode\+\_\+enabled,  }\item[{\mbox{\hyperlink{classsrsran_1_1task__executor}{task\+\_\+executor}} \&}]{executor\+\_\+,  }\item[{\mbox{\hyperlink{classsrslog_1_1detail_1_1logger__impl}{srslog\+::basic\+\_\+logger}} \&}]{logger\+\_\+ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00057\ \ \ logger(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{logger\_}}),\ executor(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{executor\_}}),\ notifier(dummy\_notifier)}
\DoxyCodeLine{00058\ \{}
\DoxyCodeLine{00059\ \ \ socket\_fd\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::socket}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{AF\_PACKET}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{SOCK\_RAW}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{htons}}(ECPRI\_ETH\_TYPE));}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordflow}{if}\ (socket\_fd\ <\ 0)\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a355eafe8d872b8f555172fa7bcd1482f}{report\_error}}(\textcolor{stringliteral}{"{}Unable\ to\ open\ raw\ socket\ for\ Ethernet\ receiver:\ \{\}"{}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{strerror}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{errno}}));}
\DoxyCodeLine{00062\ \ \ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \textcolor{keywordflow}{if}\ (interface.size()\ >\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{IFNAMSIZ}}\ -\/\ 1))\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a355eafe8d872b8f555172fa7bcd1482f}{report\_error}}(\textcolor{stringliteral}{"{}The\ Ethernet\ receiver\ interface\ name\ '\{\}'\ exceeds\ the\ maximum\ allowed\ length"{}});}
\DoxyCodeLine{00066\ \ \ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{if}\ (is\_promiscuous\_mode\_enabled)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{//\ Set\ interface\ to\ promiscuous\ mode.}}
\DoxyCodeLine{00070\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::ifreq}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{if\_opts}};}
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::strncpy}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{if\_opts}}.ifr\_name,\ interface.c\_str(),\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{IFNAMSIZ}}\ -\/\ 1);}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::ioctl}}(socket\_fd,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{SIOCGIFFLAGS}},\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{if\_opts}})\ <\ 0)\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a355eafe8d872b8f555172fa7bcd1482f}{report\_error}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ flags\ for\ NIC\ interface\ in\ the\ Ethernet\ receiver"{}});}
\DoxyCodeLine{00074\ \ \ \ \ \}}
\DoxyCodeLine{00075\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{if\_opts}}.ifr\_flags\ |=\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{IFF\_PROMISC}};}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::ioctl}}(socket\_fd,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{SIOCSIFFLAGS}},\ \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{if\_opts}})\ <\ 0)\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a355eafe8d872b8f555172fa7bcd1482f}{report\_error}}(\textcolor{stringliteral}{"{}Unable\ to\ set\ flags\ for\ NIC\ interface\ in\ the\ Ethernet\ receiver"{}});}
\DoxyCodeLine{00078\ \ \ \ \ \}}
\DoxyCodeLine{00079\ \ \ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \textcolor{comment}{//\ Bind\ to\ device.}}
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{::setsockopt}}(socket\_fd,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{SOL\_SOCKET}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{SO\_BINDTODEVICE}},\ interface.c\_str(),\ interface.size())\ ==\ -\/1)\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a355eafe8d872b8f555172fa7bcd1482f}{report\_error}}(\textcolor{stringliteral}{"{}Unable\ to\ bind\ socket\ in\ Ethernet\ receiver"{}});}
\DoxyCodeLine{00084\ \ \ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ logger.info(\textcolor{stringliteral}{"{}Opened\ successfully\ the\ NIC\ interface\ '\{\}'\ used\ by\ the\ Ethernet\ receiver"{}},\ interface);}
\DoxyCodeLine{00087\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ether_1_1receiver__impl_a93c58d8a0f096c050df07051e5201f6e}\label{classsrsran_1_1ether_1_1receiver__impl_a93c58d8a0f096c050df07051e5201f6e} 
\index{srsran::ether::receiver\_impl@{srsran::ether::receiver\_impl}!````~receiver\_impl@{\texorpdfstring{$\sim$}{\string~}receiver\_impl}}
\index{````~receiver\_impl@{\texorpdfstring{$\sim$}{\string~}receiver\_impl}!srsran::ether::receiver\_impl@{srsran::ether::receiver\_impl}}
\doxysubsubsection{\texorpdfstring{\texorpdfstring{$\sim$}{\string~}receiver\_impl()}{\string~receiver\_impl()}}
{\footnotesize\ttfamily receiver\+\_\+impl\+::\texorpdfstring{$\sim$}{\string~}receiver\+\_\+impl (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00090\ \{}
\DoxyCodeLine{00091\ \ \ ::close(socket\_fd);}
\DoxyCodeLine{00092\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1ether_1_1receiver__impl_abbd3639a5bfc84b8ca5b0582deafb0a3}\label{classsrsran_1_1ether_1_1receiver__impl_abbd3639a5bfc84b8ca5b0582deafb0a3} 
\index{srsran::ether::receiver\_impl@{srsran::ether::receiver\_impl}!start@{start}}
\index{start@{start}!srsran::ether::receiver\_impl@{srsran::ether::receiver\_impl}}
\doxysubsubsection{\texorpdfstring{start()}{start()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} receiver\+\_\+impl\+::start (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1ether_1_1frame__notifier}{frame\+\_\+notifier}} \&}]{notifier }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Starts the Ethernet receiver operation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em notifier} & Ethernet frames reception notifier. \\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
Caller will be blocked until the receiver is fully started. 
\end{DoxyNote}


Implements \mbox{\hyperlink{classsrsran_1_1ether_1_1receiver_a63a9cd717d0862a26e1daf12efcc5984}{srsran\+::ether\+::receiver}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00095\ \{}
\DoxyCodeLine{00096\ \ \ logger.info(\textcolor{stringliteral}{"{}Starting\ the\ ethernet\ frame\ receiver"{}});}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ notifier\ =\ std::ref(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{notifier\_}});}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ std::promise<void>\ p;}
\DoxyCodeLine{00101\ \ \ std::future<void>\ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{fut}}\ =\ p.get\_future();}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{if}\ (!executor.\mbox{\hyperlink{classsrsran_1_1task__executor_a296e1c4285dafdbfcbc912c3006690a4}{defer}}([\textcolor{keyword}{this},\ \&p]()\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ rx\_status.store(receiver\_status::running,\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Signal\ start()\ caller\ thread\ that\ the\ operation\ is\ complete.}}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ p.set\_value();}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ receive\_loop();}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \}))\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a355eafe8d872b8f555172fa7bcd1482f}{report\_error}}(\textcolor{stringliteral}{"{}Unable\ to\ start\ the\ ethernet\ frame\ receiver"{}});}
\DoxyCodeLine{00110\ \ \ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \textcolor{comment}{//\ Block\ waiting\ for\ timing\ executor\ to\ start.}}
\DoxyCodeLine{00113\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{fut}}.wait();}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ logger.info(\textcolor{stringliteral}{"{}Started\ the\ ethernet\ frame\ receiver"{}});}
\DoxyCodeLine{00116\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ether_1_1receiver__impl_acd657e499501c4d0870361d0c7eb599a}\label{classsrsran_1_1ether_1_1receiver__impl_acd657e499501c4d0870361d0c7eb599a} 
\index{srsran::ether::receiver\_impl@{srsran::ether::receiver\_impl}!stop@{stop}}
\index{stop@{stop}!srsran::ether::receiver\_impl@{srsran::ether::receiver\_impl}}
\doxysubsubsection{\texorpdfstring{stop()}{stop()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} receiver\+\_\+impl\+::stop (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Stops the Ethernet receiver operation. 

\begin{DoxyNote}{Note}
Caller will be blocked until the receiver is fully stopped. 
\end{DoxyNote}


Implements \mbox{\hyperlink{classsrsran_1_1ether_1_1receiver_a2a2a1c749e76f397c7926a5cc0b38cec}{srsran\+::ether\+::receiver}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00119\ \{}
\DoxyCodeLine{00120\ \ \ logger.info(\textcolor{stringliteral}{"{}Requesting\ stop\ of\ the\ ethernet\ frame\ receiver"{}});}
\DoxyCodeLine{00121\ \ \ rx\_status.store(receiver\_status::stop\_requested,\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \textcolor{comment}{//\ Wait\ for\ the\ receiver\ thread\ to\ stop.}}
\DoxyCodeLine{00124\ \ \ \textcolor{keywordflow}{while}\ (rx\_status.load(std::memory\_order\_acquire)\ !=\ receiver\_status::stopped)\ \{}
\DoxyCodeLine{00125\ \ \ \ \ std::this\_thread::sleep\_for(std::chrono::milliseconds(100));}
\DoxyCodeLine{00126\ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ logger.info(\textcolor{stringliteral}{"{}Stopped\ the\ ethernet\ frame\ receiver"{}});}
\DoxyCodeLine{00129\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/ofh/ethernet/ethernet\+\_\+receiver\+\_\+impl.\+h\item 
lib/ofh/ethernet/ethernet\+\_\+receiver\+\_\+impl.\+cpp\end{DoxyCompactItemize}
