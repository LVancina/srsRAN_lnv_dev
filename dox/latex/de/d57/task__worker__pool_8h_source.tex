\doxysection{task\+\_\+worker\+\_\+pool.\+h}
\hypertarget{task__worker__pool_8h_source}{}\label{task__worker__pool_8h_source}\index{include/srsran/support/executors/task\_worker\_pool.h@{include/srsran/support/executors/task\_worker\_pool.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Copyright\ 2021-\/2024\ Software\ Radio\ Systems\ Limited}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ This\ file\ is\ part\ of\ srsRAN.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ srsRAN\ is\ free\ software:\ you\ can\ redistribute\ it\ and/or\ modify}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ it\ under\ the\ terms\ of\ the\ GNU\ Affero\ General\ Public\ License\ as}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *\ published\ by\ the\ Free\ Software\ Foundation,\ either\ version\ 3\ of}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *\ the\ License,\ or\ (at\ your\ option)\ any\ later\ version.}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *\ srsRAN\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ but\ WITHOUT\ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ MERCHANTABILITY\ or\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ GNU\ Affero\ General\ Public\ License\ for\ more\ details.}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ A\ copy\ of\ the\ GNU\ Affero\ General\ Public\ License\ can\ be\ found\ in}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ the\ LICENSE\ file\ in\ the\ top-\/level\ directory\ of\ this\ distribution}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ and\ at\ http://www.gnu.org/licenses/.}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{pragma}\ \textcolor{preprocessor}{once}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/adt/concurrent\_queue.h"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/support/executors/task\_executor.h"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/support/unique\_thread.h"{}}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{namespace}\ \mbox{\hyperlink{namespacesrsran}{srsran}}\ \{}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{namespace}\ detail\ \{}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{comment}{//\ Pool\ of\ workers\ with\ no\ associated\ task\ enqueueing\ policy.}}
\DoxyCodeLine{00034\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool}{base\_worker\_pool}}}
\DoxyCodeLine{00035\ \{}
\DoxyCodeLine{00036\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00037\ \ \ base\_worker\_pool(\textcolor{keywordtype}{unsigned}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nof\_workers\_,}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ worker\_pool\_name,}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::function<\textcolor{keywordtype}{void}()>\&\ \ \ \ \ \ \ \ \ \ run\_tasks\_job,}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority}{os\_thread\_realtime\_priority}}\ \ \ \ \ \ \ \ \ \ \ prio\ \ \ \ \ \ =\ \mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority}{os\_thread\_realtime\_priority}}\mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority_af2cf72da038c74badffd988ce6a08e46}{::}}\mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority_af2cf72da038c74badffd988ce6a08e46}{no\_realtime}}\mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority_af2cf72da038c74badffd988ce6a08e46}{(}}\mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority_af2cf72da038c74badffd988ce6a08e46}{)}},}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ span<\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1os__sched__affinity__bitmask}{os\_sched\_affinity\_bitmask}}>\ cpu\_masks\ =\ \{\});}
\DoxyCodeLine{00042\ \ \ base\_worker\_pool(\textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool}{base\_worker\_pool}}\&)\ \ \ \ \ \ \ \ \ \ \ \ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00043\ \ \ base\_worker\_pool(\mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool}{base\_worker\_pool}}\&\&)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00044\ \ \ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool}{base\_worker\_pool}}\&\ operator=(\textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool}{base\_worker\_pool}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00045\ \ \ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool}{base\_worker\_pool}}\&\ operator=(\mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool}{base\_worker\_pool}}\&\&)\ \ \ \ \ \ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \textcolor{comment}{///\ Name\ given\ to\ the\ pool.}}
\DoxyCodeLine{00048\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool_af1b4a19374e74617208c321dfd5d45e9}{name}}()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{this}-\/>pool\_name.c\_str();\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Number\ of\ workers\ that\ compose\ the\ worker\ pool.}}
\DoxyCodeLine{00051\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool_acfd715e518133fdeca2bb40c9ae6b129}{nof\_workers}}()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ worker\_threads.size();\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{///\ Determines\ whether\ the\ caller\ is\ inside\ the\ pool.}}
\DoxyCodeLine{00054\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool_a5cf84d9fa36017e95693400624138414}{is\_in\_thread\_pool}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ std::string\ pool\_name;}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \textcolor{comment}{//\ List\ of\ workers\ belonging\ to\ the\ worker\ pool.}}
\DoxyCodeLine{00059\ \ \ std::vector<unique\_thread>\ worker\_threads;}
\DoxyCodeLine{00060\ \};}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \textcolor{comment}{//\ Worker\ pool\ functionality\ that\ varies\ with\ the\ task\ enqueueing\ policies\ used.}}
\DoxyCodeLine{00063\ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}...\ QueuePolicies>}
\DoxyCodeLine{00064\ \textcolor{keyword}{class}\ base\_worker\_pool\_with\_policy;}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{comment}{//\ Specialization\ for\ single\ queue.}}
\DoxyCodeLine{00067\ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}\ QueuePolicy>}
\DoxyCodeLine{00068\ \textcolor{keyword}{class}\ base\_worker\_pool\_with\_policy<QueuePolicy>}
\DoxyCodeLine{00069\ \{}
\DoxyCodeLine{00070\ \ \ \textcolor{keyword}{using}\ queue\_type\ =\ concurrent\_queue<unique\_task,}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ QueuePolicy,}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ QueuePolicy\ !=\ concurrent\_queue\_policy::locking\_mpmc}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ concurrent\_queue\_wait\_policy::sleep}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ concurrent\_queue\_wait\_policy::condition\_variable>;}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00077\ \ \ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}\ P\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ QueuePolicy,}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ std::enable\_if\_t<P\ ==\ concurrent\_queue\_policy::lockfree\_mpmc,\ \textcolor{keywordtype}{int}>\ =\ 0>}
\DoxyCodeLine{00079\ \ \ base\_worker\_pool\_with\_policy(\textcolor{keywordtype}{unsigned}\ queue\_size,\ std::chrono::microseconds\ wait\_sleep\_time)\ :}
\DoxyCodeLine{00080\ \ \ \ \ pending\_tasks(queue\_size,\ wait\_sleep\_time)}
\DoxyCodeLine{00081\ \ \ \{}
\DoxyCodeLine{00082\ \ \ \}}
\DoxyCodeLine{00083\ \ \ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}\ P\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ QueuePolicy,}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ std::enable\_if\_t<P\ !=\ concurrent\_queue\_policy::lockfree\_mpmc,\ \textcolor{keywordtype}{int}>\ =\ 0>}
\DoxyCodeLine{00085\ \ \ base\_worker\_pool\_with\_policy(\textcolor{keywordtype}{unsigned}\ queue\_size,\ std::chrono::microseconds\ \textcolor{comment}{/**/})\ :\ pending\_tasks(queue\_size)}
\DoxyCodeLine{00086\ \ \ \{}
\DoxyCodeLine{00087\ \ \ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Push\ a\ new\ task\ to\ be\ processed\ by\ the\ worker\ pool.\ If\ the\ task\ queue\ is\ full,\ it\ skips\ the\ task\ and}}
\DoxyCodeLine{00090\ \ \ \textcolor{comment}{///\ return\ false.}}
\DoxyCodeLine{00091\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ task\ Task\ to\ be\ run\ in\ the\ thread\ pool.}}
\DoxyCodeLine{00092\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ True\ if\ task\ was\ successfully\ enqueued\ to\ be\ processed.\ False,\ if\ task\ queue\ is\ full.}}
\DoxyCodeLine{00093\ \ \ \mbox{\hyperlink{compiler_8h_a84270d7b45f0280051bd27685657e03e}{SRSRAN\_NODISCARD}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool__with__policy_3_01QueuePolicy_01_4_a236a38aca6a209f96842f1783893c70f}{push\_task}}(unique\_task\ task)\ \{\ \textcolor{keywordflow}{return}\ pending\_tasks.try\_push(std::move(task));\ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Push\ a\ new\ task\ to\ be\ processed\ by\ the\ worker\ pool.\ If\ the\ task\ queue\ is\ full,\ blocks.}}
\DoxyCodeLine{00096\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ task\ Task\ to\ be\ run\ in\ the\ thread\ pool.}}
\DoxyCodeLine{00097\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool__with__policy_3_01QueuePolicy_01_4_ab79062685582a964fddc42739a643666}{push\_task\_blocking}}(unique\_task\ task)\ \{\ \textcolor{keywordflow}{return}\ pending\_tasks.push\_blocking(std::move(task));\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ size\_t\ capacity()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ pending\_tasks.capacity();\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00102\ \ \ queue\_type\ pending\_tasks;}
\DoxyCodeLine{00103\ \};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}\ QueuePolicy,\ \mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}...\ QueuePolicies>}
\DoxyCodeLine{00106\ \textcolor{keyword}{class}\ base\_worker\_pool\_with\_policy<QueuePolicy,\ QueuePolicies...>}
\DoxyCodeLine{00107\ \{}
\DoxyCodeLine{00108\ \ \ \textcolor{keyword}{using}\ queue\_type\ =\ concurrent\_priority\_queue<unique\_task,\ QueuePolicy,\ QueuePolicies...>;}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00111\ \ \ base\_worker\_pool\_with\_policy(\textcolor{keyword}{const}\ std::array<\textcolor{keywordtype}{unsigned},\ \textcolor{keyword}{sizeof}...(QueuePolicies)\ +\ 1>\&\ task\_queue\_sizes,}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::chrono::microseconds\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ wait\_sleep\_time)\ :}
\DoxyCodeLine{00113\ \ \ \ \ pending\_tasks(task\_queue\_sizes,\ wait\_sleep\_time)}
\DoxyCodeLine{00114\ \ \ \{}
\DoxyCodeLine{00115\ \ \ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Push\ a\ new\ task\ to\ be\ processed\ by\ the\ worker\ pool.\ If\ the\ task\ queue\ is\ full,\ it\ skips\ the\ task\ and}}
\DoxyCodeLine{00118\ \ \ \textcolor{comment}{///\ return\ false.}}
\DoxyCodeLine{00119\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ task\ Task\ to\ be\ run\ in\ the\ thread\ pool.}}
\DoxyCodeLine{00120\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ True\ if\ task\ was\ successfully\ enqueued\ to\ be\ processed.\ False,\ if\ task\ queue\ is\ full.}}
\DoxyCodeLine{00121\ \ \ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a8773a5775c48bb0867347e2791c954d5}{enqueue\_priority}}\ Priority>}
\DoxyCodeLine{00122\ \ \ \mbox{\hyperlink{compiler_8h_a84270d7b45f0280051bd27685657e03e}{SRSRAN\_NODISCARD}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool__with__policy_3_01QueuePolicy_00_01QueuePolicies_8_8_8_01_4_ab44fe8a9989bccbdd19ee67645902370}{push\_task}}(unique\_task\ task)}
\DoxyCodeLine{00123\ \ \ \{}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordflow}{return}\ pending\_tasks.\textcolor{keyword}{template}\ try\_push<Priority>(std::move(task));}
\DoxyCodeLine{00125\ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Push\ a\ new\ task\ to\ be\ processed\ by\ the\ worker\ pool.\ If\ the\ task\ queue\ is\ full,\ blocks.}}
\DoxyCodeLine{00128\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ task\ Task\ to\ be\ run\ in\ the\ thread\ pool.}}
\DoxyCodeLine{00129\ \ \ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a8773a5775c48bb0867347e2791c954d5}{enqueue\_priority}}\ Priority>}
\DoxyCodeLine{00130\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool__with__policy_3_01QueuePolicy_00_01QueuePolicies_8_8_8_01_4_a6998a6b1361499314b60fd67e4b4e3d0}{push\_task\_blocking}}(unique\_task\ task)}
\DoxyCodeLine{00131\ \ \ \{}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordflow}{return}\ pending\_tasks.\textcolor{keyword}{template}\ push\_blocking<Priority>(std::move(task));}
\DoxyCodeLine{00133\ \ \ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a8773a5775c48bb0867347e2791c954d5}{enqueue\_priority}}\ Priority>}
\DoxyCodeLine{00136\ \ \ size\_t\ capacity()\ \textcolor{keyword}{const}}
\DoxyCodeLine{00137\ \ \ \{}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{return}\ pending\_tasks.\textcolor{keyword}{template}\ capacity<Priority>();}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Get\ enqueuer\ object\ for\ a\ given\ Priority.}}
\DoxyCodeLine{00142\ \ \ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a8773a5775c48bb0867347e2791c954d5}{enqueue\_priority}}\ Priority>}
\DoxyCodeLine{00143\ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool__with__policy_3_01QueuePolicy_00_01QueuePolicies_8_8_8_01_4_abdc169b03b6adee41dfe3a90205a92e2}{get\_enqueuer}}()}
\DoxyCodeLine{00144\ \ \ \{}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{return}\ pending\_tasks.\textcolor{keyword}{template}\ get\_enqueuer<Priority>();}
\DoxyCodeLine{00146\ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00149\ \ \ queue\_type\ pending\_tasks;}
\DoxyCodeLine{00150\ \};}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \}\ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \textcolor{comment}{///\ \(\backslash\)brief\ Simple\ pool\ of\ task\ workers/threads.\ The\ workers\ share\ the\ same\ queue\ of\ task\ and\ do\ not\ perform}}
\DoxyCodeLine{00155\ \textcolor{comment}{///\ work-\/stealing.}}
\DoxyCodeLine{00156\ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}...\ QueuePolicies>}
\DoxyCodeLine{00157\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}\ :\ \textcolor{keyword}{public}\ detail::base\_worker\_pool\_with\_policy<QueuePolicies...>,\ \textcolor{keyword}{public}\ detail::\mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool}{base\_worker\_pool}}}
\DoxyCodeLine{00158\ \{}
\DoxyCodeLine{00159\ \ \ \textcolor{keyword}{static\_assert}(\textcolor{keyword}{sizeof}...(QueuePolicies)\ >=\ 1,\ \textcolor{stringliteral}{"{}Invalid\ number\ of\ queues"{}});}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \textcolor{keyword}{using}\ pool\_type\ \ =\ detail::\mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool}{base\_worker\_pool}};}
\DoxyCodeLine{00162\ \ \ \textcolor{keyword}{using}\ queue\_type\ =\ detail::base\_worker\_pool\_with\_policy<QueuePolicies...>;}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00165\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Creates\ a\ task\ worker\ pool.}}
\DoxyCodeLine{00166\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ nof\_workers\ Number\ of\ workers\ of\ the\ worker\ pool.}}
\DoxyCodeLine{00167\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ queue\_size\ Size\ of\ the\ task\ queue.}}
\DoxyCodeLine{00168\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ pool\_name\ String\ with\ the\ name\ for\ the\ worker\ pool.\ Individual\ workers\ of\ the\ pool\ will\ be\ assigned\ the}}
\DoxyCodeLine{00169\ \ \ \textcolor{comment}{///\ name\ "{}<pool\_name>\#<worker\ index>"{}.\ E.g.\ for\ pool\_name="{}Pool"{},\ the\ second\ worker\ will\ be\ called\ "{}Pool\#1"{}.}}
\DoxyCodeLine{00170\ \ \ \textcolor{comment}{///\ \(\backslash\)param\ prio\ Workers\ realtime\ thread\ priority.}}
\DoxyCodeLine{00171\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ QueueSizes>}
\DoxyCodeLine{00172\ \ \ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{task\_worker\_pool}}(\textcolor{keywordtype}{unsigned}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nof\_workers\_,}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QueueSizes\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ queue\_sizes,}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ worker\_pool\_name,}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::chrono::microseconds\ \ \ \ \ \ \ \ \ \ \ \ \ wait\_sleep\_time\ =\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{std}}::\mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{chrono}}::\mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{microseconds}}\{100\},}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority}{os\_thread\_realtime\_priority}}\ \ \ \ \ \ \ \ \ \ \ prio\ \ \ \ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority}{os\_thread\_realtime\_priority}}\mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority_af2cf72da038c74badffd988ce6a08e46}{::}}\mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority_af2cf72da038c74badffd988ce6a08e46}{no\_realtime}}\mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority_af2cf72da038c74badffd988ce6a08e46}{(}}\mbox{\hyperlink{classsrsran_1_1os__thread__realtime__priority_af2cf72da038c74badffd988ce6a08e46}{)}},}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ span<\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1os__sched__affinity__bitmask}{os\_sched\_affinity\_bitmask}}>\ cpu\_masks\ \ \ \ \ \ \ =\ \{\})\ :}
\DoxyCodeLine{00178\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{queue\_type}}(\mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{queue\_sizes}},\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{wait\_sleep\_time}}),}
\DoxyCodeLine{00179\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{pool\_type}}(\mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{nof\_workers\_}},\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{std}}::\mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{move}}(\mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{worker\_pool\_name}}),\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{create\_pop\_loop\_task}}(),\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{prio}},\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_a4d1345a9af95daddd569120f29726e40}{cpu\_masks}})}
\DoxyCodeLine{00180\ \ \ \{}
\DoxyCodeLine{00181\ \ \ \}}
\DoxyCodeLine{00182\ \ \ \string~task\_worker\_pool();}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \textcolor{comment}{///\ Stop\ task\ worker\ pool,\ if\ running.}}
\DoxyCodeLine{00185\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_aef62e53b76bc00b46167a620be3e98fe}{stop}}();}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Number\ of\ tasks\ currently\ enqueued.}}
\DoxyCodeLine{00188\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_a26935bb457ac2f54966f2797b49d9542}{nof\_pending\_tasks}}()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{this}-\/>pending\_tasks.size();\ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Wait\ for\ all\ the\ currently\ enqueued\ tasks\ to\ complete.\ If\ more\ tasks\ get\ enqueued\ after\ this\ function\ call}}
\DoxyCodeLine{00191\ \ \ \textcolor{comment}{///\ those\ tasks\ are\ not\ accounted\ for\ in\ the\ waiting.}}
\DoxyCodeLine{00192\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool_a40264d4e39b9df2d1fd8cd55fb72fc1c}{wait\_pending\_tasks}}();}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00195\ \ \ std::function<\textcolor{keywordtype}{void}()>\ create\_pop\_loop\_task();}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ srslog::basic\_logger\&\ logger\ =\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool}{srslog}}::\mbox{\hyperlink{classsrsran_1_1task__worker__pool}{fetch\_basic\_logger}}(\textcolor{stringliteral}{"{}ALL"{}});}
\DoxyCodeLine{00198\ \};}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \textcolor{keyword}{extern}\ \textcolor{keyword}{template}\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}<\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}::lockfree\_mpmc>;}
\DoxyCodeLine{00201\ \textcolor{keyword}{extern}\ \textcolor{keyword}{template}\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}<\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}::locking\_mpmc>;}
\DoxyCodeLine{00202\ \textcolor{keyword}{extern}\ \textcolor{keyword}{template}\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}<\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}::lockfree\_mpmc,\ \mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}::lockfree\_mpmc>;}
\DoxyCodeLine{00203\ \textcolor{keyword}{extern}\ \textcolor{keyword}{template}\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}<\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}::locking\_mpmc,\ \mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}::lockfree\_mpmc>;}
\DoxyCodeLine{00204\ \textcolor{keyword}{extern}\ \textcolor{keyword}{template}\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}<\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}::lockfree\_mpmc,\ \mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}::locking\_mpmc>;}
\DoxyCodeLine{00205\ \textcolor{keyword}{extern}\ \textcolor{keyword}{template}\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}<\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}::locking\_mpmc,\ \mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}::locking\_mpmc>;}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}\ QueuePolicy>}
\DoxyCodeLine{00208\ \textcolor{keyword}{class}\ task\_worker\_pool\_executor\ \textcolor{keyword}{final}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classsrsran_1_1task__executor}{task\_executor}}}
\DoxyCodeLine{00209\ \{}
\DoxyCodeLine{00210\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00211\ \ \ task\_worker\_pool\_executor()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00212\ \ \ task\_worker\_pool\_executor(\mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}<QueuePolicy>\&\ worker\_pool\_)\ :\ worker\_pool(\&worker\_pool\_)\ \{\}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \mbox{\hyperlink{compiler_8h_a84270d7b45f0280051bd27685657e03e}{SRSRAN\_NODISCARD}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool__executor_a88769a0f6028746a13edb35c8a1ca3e0}{execute}}(unique\_task\ task)\ \textcolor{keyword}{override}}
\DoxyCodeLine{00215\ \ \ \{}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{comment}{//\ TODO:\ Shortpath\ if\ can\_run\_task\_inline()\ returns\ true.\ This\ feature\ has\ been\ disabled\ while\ we\ don't\ correct\ the}}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{comment}{//\ \ use\ of\ .execute\ in\ some\ places.}}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordflow}{return}\ worker\_pool-\/>push\_task(std::move(task));}
\DoxyCodeLine{00219\ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \mbox{\hyperlink{compiler_8h_a84270d7b45f0280051bd27685657e03e}{SRSRAN\_NODISCARD}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool__executor_abc66689dabd413ec0f9a79b3335f07f0}{defer}}(unique\_task\ task)\ \textcolor{keyword}{override}\ \{\ \textcolor{keywordflow}{return}\ worker\_pool-\/>push\_task(std::move(task));\ \}}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \textcolor{comment}{///\ Determine\ whether\ the\ caller\ is\ in\ one\ of\ the\ threads\ of\ the\ worker\ pool.}}
\DoxyCodeLine{00224\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1task__worker__pool__executor_a2829c32dce431c3ab50485c27b6828cf}{can\_run\_task\_inline}}()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ worker\_pool-\/>is\_in\_thread\_pool();\ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00227\ \ \ \mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}<QueuePolicy>*\ worker\_pool\ =\ \textcolor{keywordtype}{nullptr};}
\DoxyCodeLine{00228\ \};}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \textcolor{comment}{///\ \(\backslash\)brief\ Task\ executor\ that\ pushes\ tasks\ to\ worker\ pool\ with\ a\ given\ priority.}}
\DoxyCodeLine{00231\ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}\ QueuePolicy>}
\DoxyCodeLine{00232\ \textcolor{keyword}{class}\ priority\_task\_worker\_pool\_executor\ \textcolor{keyword}{final}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classsrsran_1_1task__executor}{task\_executor}}}
\DoxyCodeLine{00233\ \{}
\DoxyCodeLine{00234\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00235\ \ \ priority\_task\_worker\_pool\_executor()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00236\ \ \ priority\_task\_worker\_pool\_executor(priority\_enqueuer<unique\_task,\ QueuePolicy>\ enqueuer\_,}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a8773a5775c48bb0867347e2791c954d5}{enqueue\_priority}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ prio\_,}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ detail::\mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool}{base\_worker\_pool}}\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ workers\_)\ :}
\DoxyCodeLine{00239\ \ \ \ \ enqueuer(std::move(enqueuer\_)),\ prio(prio\_),\ workers(workers\_)}
\DoxyCodeLine{00240\ \ \ \{}
\DoxyCodeLine{00241\ \ \ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \mbox{\hyperlink{compiler_8h_a84270d7b45f0280051bd27685657e03e}{SRSRAN\_NODISCARD}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1priority__task__worker__pool__executor_ab0d787dd15d474ac2f24b1ec46ca3417}{execute}}(unique\_task\ task)\ \textcolor{keyword}{override}}
\DoxyCodeLine{00244\ \ \ \{}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classsrsran_1_1priority__task__worker__pool__executor_aa1aa2eb3586e81a1f06b8fede6c0bdcd}{can\_run\_task\_inline}}\mbox{\hyperlink{classsrsran_1_1priority__task__worker__pool__executor_aa1aa2eb3586e81a1f06b8fede6c0bdcd}{(}}\mbox{\hyperlink{classsrsran_1_1priority__task__worker__pool__executor_aa1aa2eb3586e81a1f06b8fede6c0bdcd}{)}})\ \{}
\DoxyCodeLine{00246\ \ \ \ \ \ \ task();}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00248\ \ \ \ \ \}}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordflow}{return}\ enqueuer.try\_push(std::move(task));}
\DoxyCodeLine{00250\ \ \ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \mbox{\hyperlink{compiler_8h_a84270d7b45f0280051bd27685657e03e}{SRSRAN\_NODISCARD}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1priority__task__worker__pool__executor_a7992d248ca70a1f1115a0cb02551b7f4}{defer}}(unique\_task\ task)\ \textcolor{keyword}{override}\ \{\ \textcolor{keywordflow}{return}\ enqueuer.try\_push(std::move(task));\ \}}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \textcolor{comment}{///\ Determine\ whether\ the\ caller\ is\ in\ one\ of\ the\ threads\ of\ the\ worker\ pool\ and\ the\ the\ task\ can\ run\ without}}
\DoxyCodeLine{00255\ \ \ \textcolor{comment}{///\ being\ dispatched.}}
\DoxyCodeLine{00256\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsrsran_1_1priority__task__worker__pool__executor_aa1aa2eb3586e81a1f06b8fede6c0bdcd}{can\_run\_task\_inline}}()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ prio\ ==\ \mbox{\hyperlink{namespacesrsran_a8773a5775c48bb0867347e2791c954d5}{enqueue\_priority}}::max\ \textcolor{keyword}{and}\ workers\mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool_a5cf84d9fa36017e95693400624138414}{.}}\mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool_a5cf84d9fa36017e95693400624138414}{is\_in\_thread\_pool}}\mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool_a5cf84d9fa36017e95693400624138414}{(}}\mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool_a5cf84d9fa36017e95693400624138414}{)}};\ \}}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00259\ \ \ priority\_enqueuer<unique\_task,\ QueuePolicy>\ enqueuer;}
\DoxyCodeLine{00260\ \ \ \mbox{\hyperlink{namespacesrsran_a8773a5775c48bb0867347e2791c954d5}{enqueue\_priority}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ prio;}
\DoxyCodeLine{00261\ \ \ detail::\mbox{\hyperlink{classsrsran_1_1detail_1_1base__worker__pool}{base\_worker\_pool}}\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ workers;}
\DoxyCodeLine{00262\ \};}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \textcolor{comment}{///\ \(\backslash\)brief\ Create\ task\ executor\ with\ \(\backslash\)c\ Priority\ for\ \(\backslash\)c\ task\_worker\_pool\ that\ supports\ multiple\ priorities.}}
\DoxyCodeLine{00265\ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a8773a5775c48bb0867347e2791c954d5}{enqueue\_priority}}\ Priority,\ \mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}...\ QueuePolicies>}
\DoxyCodeLine{00266\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespacesrsran_adeefef2a70c1ed18da1cf22753bb91eb}{make\_priority\_task\_worker\_pool\_executor}}(\mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}<QueuePolicies...>\&\ worker)}
\DoxyCodeLine{00267\ \{}
\DoxyCodeLine{00268\ \ \ \textcolor{keywordflow}{return}\ priority\_task\_worker\_pool\_executor<get\_priority\_queue\_policy<QueuePolicies...>(Priority)>(}
\DoxyCodeLine{00269\ \ \ \ \ \ \ worker.\textcolor{keyword}{template}\ get\_enqueuer<Priority>(),\ Priority,\ worker);}
\DoxyCodeLine{00270\ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \textcolor{comment}{///\ \(\backslash\)brief\ Create\ general\ task\ executor\ pointer\ with\ \(\backslash\)c\ Priority\ for\ \(\backslash\)c\ task\_worker\_pool\ that\ supports\ multiple}}
\DoxyCodeLine{00273\ \textcolor{comment}{///\ priorities.}}
\DoxyCodeLine{00274\ \textcolor{keyword}{template}\ <\mbox{\hyperlink{namespacesrsran_a8773a5775c48bb0867347e2791c954d5}{enqueue\_priority}}\ Priority,\ \mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}...\ QueuePolicies>}
\DoxyCodeLine{00275\ \mbox{\hyperlink{namespacesrsran_ad067bbc26a9fe1d59dfbb185d972ebee}{std}}::\mbox{\hyperlink{namespacesrsran_ad067bbc26a9fe1d59dfbb185d972ebee}{unique\_ptr}}<\mbox{\hyperlink{namespacesrsran_ad067bbc26a9fe1d59dfbb185d972ebee}{task\_executor}}>\ \mbox{\hyperlink{namespacesrsran_ad067bbc26a9fe1d59dfbb185d972ebee}{make\_priority\_task\_worker\_pool\_executor\_ptr}}(\mbox{\hyperlink{namespacesrsran_ad067bbc26a9fe1d59dfbb185d972ebee}{task\_worker\_pool}}<\mbox{\hyperlink{namespacesrsran_ad067bbc26a9fe1d59dfbb185d972ebee}{QueuePolicies}}...>\&\ \mbox{\hyperlink{namespacesrsran_ad067bbc26a9fe1d59dfbb185d972ebee}{worker}})}
\DoxyCodeLine{00276\ \{}
\DoxyCodeLine{00277\ \ \ \textcolor{keywordflow}{return}\ std::make\_unique<priority\_task\_worker\_pool\_executor<get\_priority\_queue\_policy<QueuePolicies...>(Priority)>>(}
\DoxyCodeLine{00278\ \ \ \ \ \ \ worker.\textcolor{keyword}{template}\ get\_enqueuer<Priority>(),\ Priority,\ worker.name());}
\DoxyCodeLine{00279\ \}}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \textcolor{keyword}{namespace}\ detail\ \{}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Func,\ \mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}...\ QueuePolicies,\ size\_t...\ Is>}
\DoxyCodeLine{00284\ \textcolor{keywordtype}{void}\ visit\_executor(\mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}<QueuePolicies...>\&\ w,}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a8773a5775c48bb0867347e2791c954d5}{enqueue\_priority}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ priority,}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Func\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ func,}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::index\_sequence<Is...>\ \textcolor{comment}{/*unused*/})}
\DoxyCodeLine{00288\ \{}
\DoxyCodeLine{00289\ \ \ \textcolor{keyword}{const}\ size\_t\ idx\ =\ detail::enqueue\_priority\_to\_queue\_index(priority,\ \textcolor{keyword}{sizeof}...(QueuePolicies));}
\DoxyCodeLine{00290\ \ \ (\textcolor{keywordtype}{void})std::initializer\_list<\textcolor{keywordtype}{int}>\{[idx,\ \&w,\ \&func]()\ \{}
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keywordflow}{if}\ (idx\ ==\ Is)\ \{}
\DoxyCodeLine{00292\ \ \ \ \ \ \ func(}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ make\_priority\_task\_worker\_pool\_executor<detail::queue\_index\_to\_enqueue\_priority(Is,\ \textcolor{keyword}{sizeof}...(QueuePolicies)),}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ QueuePolicies...>(w));}
\DoxyCodeLine{00295\ \ \ \ \ \}}
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00297\ \ \ \}()...\};}
\DoxyCodeLine{00298\ \}}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \}\ \textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \textcolor{comment}{///\ \(\backslash\)brief\ Create\ general\ task\ executor\ pointer\ with\ \(\backslash\)c\ Priority\ for\ \(\backslash\)c\ priority\_task\_worker\_pool.}}
\DoxyCodeLine{00303\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Func,\ \mbox{\hyperlink{namespacesrsran_a08f31ae01c088c535705650443feec0c}{concurrent\_queue\_policy}}...\ QueuePolicies>}
\DoxyCodeLine{00304\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacesrsran_a81e67691da725d68ab8de5af92892166}{visit\_executor}}(\mbox{\hyperlink{classsrsran_1_1task__worker__pool}{task\_worker\_pool}}<QueuePolicies...>\&\ worker,\ \mbox{\hyperlink{namespacesrsran_a8773a5775c48bb0867347e2791c954d5}{enqueue\_priority}}\ priority,\ \textcolor{keyword}{const}\ Func\&\ func)}
\DoxyCodeLine{00305\ \{}
\DoxyCodeLine{00306\ \ \ detail::visit\_executor(worker,\ priority,\ func,\ std::make\_index\_sequence<\textcolor{keyword}{sizeof}...(QueuePolicies)>\{\});}
\DoxyCodeLine{00307\ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \}\ \textcolor{comment}{//\ namespace\ srsran}}

\end{DoxyCode}
