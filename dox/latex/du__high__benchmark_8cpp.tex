\doxysection{tests/benchmarks/du\+\_\+high/du\+\_\+high\+\_\+benchmark.cpp File Reference}
\hypertarget{du__high__benchmark_8cpp}{}\label{du__high__benchmark_8cpp}\index{tests/benchmarks/du\_high/du\_high\_benchmark.cpp@{tests/benchmarks/du\_high/du\_high\_benchmark.cpp}}


Benchmarks for the DU-\/high latency.  


{\ttfamily \#include "{}lib/du\+\_\+high/du\+\_\+high\+\_\+executor\+\_\+strategies.\+h"{}}\newline
{\ttfamily \#include "{}lib/du\+\_\+high/du\+\_\+high\+\_\+impl.\+h"{}}\newline
{\ttfamily \#include "{}tests/unittests/f1ap/du/f1ap\+\_\+du\+\_\+test\+\_\+helpers.\+h"{}}\newline
{\ttfamily \#include "{}tests/unittests/mac/mac\+\_\+test\+\_\+helpers.\+h"{}}\newline
{\ttfamily \#include "{}srsran/asn1/f1ap/common.\+h"{}}\newline
{\ttfamily \#include "{}srsran/du/du\+\_\+cell\+\_\+config\+\_\+helpers.\+h"{}}\newline
{\ttfamily \#include "{}srsran/du\+\_\+high/du\+\_\+high\+\_\+configuration.\+h"{}}\newline
{\ttfamily \#include "{}srsran/f1u/du/f1u\+\_\+gateway.\+h"{}}\newline
{\ttfamily \#include "{}srsran/support/benchmark\+\_\+utils.\+h"{}}\newline
{\ttfamily \#include "{}srsran/support/event\+\_\+tracing.\+h"{}}\newline
{\ttfamily \#include "{}srsran/support/executors/priority\+\_\+task\+\_\+worker.\+h"{}}\newline
{\ttfamily \#include "{}srsran/support/executors/task\+\_\+worker.\+h"{}}\newline
{\ttfamily \#include "{}srsran/support/test\+\_\+utils.\+h"{}}\newline
{\ttfamily \#include $<$pthread.\+h$>$}\newline
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structbench__params}{bench\+\_\+params}}
\begin{DoxyCompactList}\small\item\em Parameters of the benchmark. \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classdummy__metrics__handler}{dummy\+\_\+metrics\+\_\+handler}}
\item 
class \mbox{\hyperlink{classcu__cp__simulator}{cu\+\_\+cp\+\_\+simulator}}
\begin{DoxyCompactList}\small\item\em Simulator of the CU-\/\+CP from the perspective of the DU. This class should reply to the F1\+AP messages that the DU sends in order for the DU normal operation to proceed. \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classf1u__dummy__bearer}{f1u\+\_\+dummy\+\_\+bearer}}
\begin{DoxyCompactList}\small\item\em Dummy F1-\/U bearer for the purpose of benchmark. \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcu__up__simulator}{cu\+\_\+up\+\_\+simulator}}
\begin{DoxyCompactList}\small\item\em Simulator of the CU-\/\+UP from the perspective of the DU. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structdu__high__single__cell__worker__manager}{du\+\_\+high\+\_\+single\+\_\+cell\+\_\+worker\+\_\+manager}}
\begin{DoxyCompactList}\small\item\em Instantiation of the DU-\/high workers and executors for the benchmark. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structphy__metrics}{phy\+\_\+metrics}}
\begin{DoxyCompactList}\small\item\em Metrics collected from the results passed by the MAC to the lower layers. \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classphy__simulator}{phy\+\_\+simulator}}
\begin{DoxyCompactList}\small\item\em Emulator of the PHY, FAPI and UE from the perspective of the DU-\/high. This class should be able to provide the required UE signalling (e.\+g. HARQ ACKs) for the DU-\/high normal operation. \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classdu__high__bench}{du\+\_\+high\+\_\+bench}}
\begin{DoxyCompactList}\small\item\em Test\+Bench for the DU-\/high. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{du__high__benchmark_8cpp_a6675febfac81170d9943c7e217242bd8}\label{du__high__benchmark_8cpp_a6675febfac81170d9943c7e217242bd8} 
void {\bfseries benchmark\+\_\+dl\+\_\+ul\+\_\+only\+\_\+rlc\+\_\+um} (\mbox{\hyperlink{classsrsran_1_1benchmarker}{benchmarker}} \&bm, unsigned nof\+\_\+ues, \mbox{\hyperlink{namespacesrsran_a7c254965b53e3067931191bc7eda18ac}{duplex\+\_\+mode}} dplx\+\_\+mode, unsigned dl\+\_\+buffer\+\_\+state\+\_\+bytes, unsigned ul\+\_\+bsr\+\_\+bytes, unsigned max\+\_\+nof\+\_\+rbs\+\_\+per\+\_\+dl\+\_\+grant, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ unsigned $>$ du\+\_\+cell\+\_\+cores)
\begin{DoxyCompactList}\small\item\em Benchmark DU-\/high with DL and/or UL only traffic using an RLC UM bearer. \end{DoxyCompactList}\item 
\Hypertarget{du__high__benchmark_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}\label{du__high__benchmark_8cpp_a3c04138a5bfe5d72780bb7e82a18e627} 
int {\bfseries main} (int argc, char \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}argv)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Benchmarks for the DU-\/high latency. 

In this benchmark, we emulate the behaviors of the CU-\/\+CP, CU-\/\+UP and PHY in order to simulate a realistic deployment of the instantiated DU-\/high class. However, there are some simplifications\+:
\begin{DoxyItemize}
\item the PHY is emulated by a single thread, rather than by separate threads for DL PHY, UL PHY, and slot indications. In practice, this may lead to less contention faced by the notifications of the PHY that reach the MAC.
\item metrics handlers and E2 agents are instantiated separately from the DU-\/high class. If these entities have blocking calls, such as mutexes, they may introduce additional latency.
\item Complicated CU-\/\+CP procedures (e.\+g. reconfig) and their impact on the MAC latency are left out of this benchmark.
\item The UP traffic is continuous rather than bursty.
\item The activity of higher priority threads, namely DL PHY and RU threads are not emulated. This will mean that the DU-\/high threads will be preempted less often than in a real deployment. To circumvent it, we can run a parallel stress job in the same machine. For instance, to run stressors that solely interfere with the gnb\+\_\+ue and gnb\+\_\+ctrl threads (and not with the du\+\_\+cell thread), one can run\+: \begin{quote}
sudo stress-\/ng --cpu 6 --taskset 2-\/7 --sched fifo --sched-\/prio 97 -\/l 90 \end{quote}
which will instantiate 6 threads running in cores 2-\/7 (assuming du\+\_\+cell is pinned to 0-\/1), with high priority and a CPU load of 90\%. 
\end{DoxyItemize}