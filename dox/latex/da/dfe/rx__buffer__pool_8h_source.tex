\doxysection{rx\+\_\+buffer\+\_\+pool.\+h}
\hypertarget{rx__buffer__pool_8h_source}{}\label{rx__buffer__pool_8h_source}\index{include/srsran/phy/upper/rx\_buffer\_pool.h@{include/srsran/phy/upper/rx\_buffer\_pool.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Copyright\ 2021-\/2024\ Software\ Radio\ Systems\ Limited}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ This\ file\ is\ part\ of\ srsRAN.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ srsRAN\ is\ free\ software:\ you\ can\ redistribute\ it\ and/or\ modify}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ it\ under\ the\ terms\ of\ the\ GNU\ Affero\ General\ Public\ License\ as}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *\ published\ by\ the\ Free\ Software\ Foundation,\ either\ version\ 3\ of}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *\ the\ License,\ or\ (at\ your\ option)\ any\ later\ version.}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *\ srsRAN\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ but\ WITHOUT\ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ MERCHANTABILITY\ or\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ GNU\ Affero\ General\ Public\ License\ for\ more\ details.}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ A\ copy\ of\ the\ GNU\ Affero\ General\ Public\ License\ can\ be\ found\ in}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ the\ LICENSE\ file\ in\ the\ top-\/level\ directory\ of\ this\ distribution}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ and\ at\ http://www.gnu.org/licenses/.}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{pragma}\ \textcolor{preprocessor}{once}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/phy/upper/trx\_buffer\_identifier.h"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/ran/rnti.h"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{"{}srsran/ran/slot\_point.h"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{<}\textcolor{preprocessor}{cstdint}\textcolor{preprocessor}{>}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#}\textcolor{preprocessor}{include}\ \textcolor{preprocessor}{<}\textcolor{preprocessor}{limits}\textcolor{preprocessor}{>}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{namespace}\ \mbox{\hyperlink{namespacesrsran}{srsran}}\ \{}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1unique__rx__buffer}{unique\_rx\_buffer}};}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{comment}{///\ \(\backslash\)brief\ Describes\ a\ receive\ buffer\ pool.}}
\DoxyCodeLine{00036\ \textcolor{comment}{///}}
\DoxyCodeLine{00037\ \textcolor{comment}{///\ The\ aim\ of\ this\ interface\ is\ to\ provide\ the\ physical\ layer\ shared\ channel\ decoder\ with\ receiver\ buffers.}}
\DoxyCodeLine{00038\ \textcolor{comment}{///}}
\DoxyCodeLine{00039\ \textcolor{comment}{///\ The\ receiver\ buffers\ are\ selected\ from\ a\ pool\ of\ resources\ for\ a\ given\ trx\_buffer\_identifier\ and\ kept\ persistent}}
\DoxyCodeLine{00040\ \textcolor{comment}{///\ until\ the\ buffer\ is\ released\ or\ expires.}}
\DoxyCodeLine{00041\ \textcolor{comment}{///}}
\DoxyCodeLine{00042\ \textcolor{comment}{///\ The\ pool\ is\ designed\ for\ being\ unique\ in\ a\ sector.\ In\ other\ words,\ every\ sector\ must\ create\ its\ own\ pool.}}
\DoxyCodeLine{00043\ \textcolor{comment}{///}}
\DoxyCodeLine{00044\ \textcolor{comment}{///\ The\ implementation\ might\ not\ be\ thread\ safe:\ reserve(),\ and\ run\_slot()\ can\ not\ be\ called\ simultaneously.}}
\DoxyCodeLine{00045\ \textcolor{comment}{///}}
\DoxyCodeLine{00046\ \textcolor{comment}{///\ \(\backslash\)remark\ An\ assertion\ is\ triggered\ if\ the\ slot\ numerology\ used\ for\ reserve()\ and\ run\_slot()\ are\ different.}}
\DoxyCodeLine{00047\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1rx__buffer__pool}{rx\_buffer\_pool}}}
\DoxyCodeLine{00048\ \{}
\DoxyCodeLine{00049\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{///\ Default\ destructor.}}
\DoxyCodeLine{00051\ \ \ \textcolor{keyword}{virtual}\ \string~\mbox{\hyperlink{classsrsran_1_1rx__buffer__pool_a564a44ffbf72b9324a9237538e1722b6}{rx\_buffer\_pool}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Reserves\ and\ gets\ a\ buffer\ for\ a\ given\ identifier\ and\ number\ of\ codeblocks.}}
\DoxyCodeLine{00054\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00055\ \ \ \textcolor{comment}{///\ It\ reserves\ a\ buffer\ for\ the\ given\ identifier.\ It\ guarantees\ that\ reserved\ buffers\ keep\ the\ CRC\ and\ data\ values.}}
\DoxyCodeLine{00056\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00057\ \ \ \textcolor{comment}{///\ The\ buffers\ are\ reserved\ until:}}
\DoxyCodeLine{00058\ \ \ \textcolor{comment}{///\ -\/\ the\ buffer\ is\ freed\ using\ unique\_rx\_buffer::release(),}}
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{///\ -\/\ a\ buffer\ reservation\ is\ performed\ with\ the\ same\ identifier\ but\ different\ number\ of\ codeblocks,\ or}}
\DoxyCodeLine{00060\ \ \ \textcolor{comment}{///\ -\/\ buffer\ reservation\ expires\ (by\ means\ run\_slot()).}}
\DoxyCodeLine{00061\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00062\ \ \ \textcolor{comment}{///\ The\ pool\ does\ not\ initialize\ or\ modify\ the\ codeblock\ contents\ of\ the\ buffers.\ The\ modules\ that\ use\ the\ buffers\ are}}
\DoxyCodeLine{00063\ \ \ \textcolor{comment}{///\ responsible\ for\ initializing\ and\ modifying\ their\ contents\ upon\ new\ transmissions.}}
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00065\ \ \ \textcolor{comment}{///\ It\ is\ expected\ that\ the\ pool\ logs\ in\ \(\backslash\)c\ PHY\ channel\ the\ context\ and\ the\ reason\ of\ a\ failed\ reservation.\ Possible}}
\DoxyCodeLine{00066\ \ \ \textcolor{comment}{///\ reservation\ failures\ are:}}
\DoxyCodeLine{00067\ \ \ \textcolor{comment}{///\ -\/\ Insufficient\ number\ of\ buffers,\ \(\backslash\)ref\ rx\_buffer\_pool\_config::nof\_buffers\ buffers\ are\ reserved\ with\ different}}
\DoxyCodeLine{00068\ \ \ \textcolor{comment}{///\ \ \ identifiers;}}
\DoxyCodeLine{00069\ \ \ \textcolor{comment}{///\ -\/\ Insufficient\ number\ of\ codeblocks,\ \(\backslash\)ref\ rx\_buffer\_pool\_config::max\_nof\_codeblocks\ codeblocks\ are\ currently}}
\DoxyCodeLine{00070\ \ \ \textcolor{comment}{///\ \ \ assigned\ to\ buffers;}}
\DoxyCodeLine{00071\ \ \ \textcolor{comment}{///\ -\/\ A\ buffer\ with\ the\ same\ identifier\ is\ locked;}}
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{///\ -\/\ No\ buffer\ is\ found\ with\ the\ same\ identifier\ while\ the\ reservation\ is\ not\ marked\ as\ new\ data;}}
\DoxyCodeLine{00073\ \ \ \textcolor{comment}{///\ -\/\ The\ number\ of\ codeblocks\ for\ a\ retransmission\ is\ different\ than\ the\ previous\ reservation;\ or}}
\DoxyCodeLine{00074\ \ \ \textcolor{comment}{///\ -\/\ The\ pool\ operation\ has\ stopped.}}
\DoxyCodeLine{00075\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00076\ \ \ \textcolor{comment}{///\ \(\backslash\)param[in]\ slot\ \ \ \ \ \ \ \ \ \ \ Slot\ context\ in\ which\ the\ reservation\ occurs.}}
\DoxyCodeLine{00077\ \ \ \textcolor{comment}{///\ \(\backslash\)param[in]\ id\ \ \ \ \ \ \ \ \ \ \ \ \ Buffer\ identifier.}}
\DoxyCodeLine{00078\ \ \ \textcolor{comment}{///\ \(\backslash\)param[in]\ nof\_codeblocks\ Indicates\ the\ number\ of\ codeblocks\ to\ reserve.}}
\DoxyCodeLine{00079\ \ \ \textcolor{comment}{///\ \(\backslash\)param[in]\ new\_data\ \ \ \ \ \ \ Set\ to\ true\ if\ the\ transmission\ is\ for\ new\ data.}}
\DoxyCodeLine{00080\ \ \ \textcolor{comment}{///\ \(\backslash\)return\ A\ valid\ unique\ buffer\ if\ the\ reservation\ was\ successful.\ Otherwise,\ an\ invalid\ unique\ buffer.}}
\DoxyCodeLine{00081\ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classsrsran_1_1unique__rx__buffer}{unique\_rx\_buffer}}}
\DoxyCodeLine{00082\ \ \ \mbox{\hyperlink{classsrsran_1_1rx__buffer__pool_a7b084964b445dbb89fdc96458bb4d9cc}{reserve}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1slot__point}{slot\_point}}\&\ slot,\ \mbox{\hyperlink{classsrsran_1_1trx__buffer__identifier}{trx\_buffer\_identifier}}\ id,\ \textcolor{keywordtype}{unsigned}\ nof\_codeblocks,\ \textcolor{keywordtype}{bool}\ new\_data)\ =\ 0;}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Runs\ pool\ housekeeping\ tasks.}}
\DoxyCodeLine{00085\ \ \ \textcolor{comment}{///\ \(\backslash\)param[in]\ slot\ Indicates\ the\ current\ slot.}}
\DoxyCodeLine{00086\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrsran_1_1rx__buffer__pool_a64f95bbb458bf577d1d98ce847199262}{run\_slot}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classsrsran_1_1slot__point}{slot\_point}}\&\ slot)\ =\ 0;}
\DoxyCodeLine{00087\ \};}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \textcolor{comment}{///\ buffer\ pool\ configuration.}}
\DoxyCodeLine{00090\ \textcolor{keyword}{struct}\ \mbox{\hyperlink{structsrsran_1_1rx__buffer__pool__config}{rx\_buffer\_pool\_config}}\ \{}
\DoxyCodeLine{00091\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Maximum\ codeblock\ size.}}
\DoxyCodeLine{00092\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00093\ \ \ \textcolor{comment}{///\ Set\ to\ \(\backslash\)c\ ldpc::MAX\_CODEBLOCK\_SIZE\ by\ default.}}
\DoxyCodeLine{00094\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{structsrsran_1_1rx__buffer__pool__config_a2f31c12b6638828cd9f6329af6f9e63a}{max\_codeblock\_size}};}
\DoxyCodeLine{00095\ \ \ \textcolor{comment}{///\ Number\ of\ buffers\ available\ in\ the\ pool.}}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{structsrsran_1_1rx__buffer__pool__config_ab3b65ab37eb08e0048e80d8411b28185}{nof\_buffers}};}
\DoxyCodeLine{00097\ \ \ \textcolor{comment}{///\ Number\ of\ codeblocks\ available\ in\ the\ pool\ for\ all\ the\ buffers.}}
\DoxyCodeLine{00098\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{structsrsran_1_1rx__buffer__pool__config_a037bdf3e72e8a2fcdfaf42492bfc245c}{nof\_codeblocks}};}
\DoxyCodeLine{00099\ \ \ \textcolor{comment}{///\ buffer\ lifetime\ as\ a\ number\ of\ slots.}}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{structsrsran_1_1rx__buffer__pool__config_a9b345234f1341198f7dd7fd26a9cc1f9}{expire\_timeout\_slots}};}
\DoxyCodeLine{00101\ \ \ \textcolor{comment}{///\ Set\ to\ true\ to\ indicate\ that\ soft\ bits\ are\ not\ stored\ in\ the\ buffer.}}
\DoxyCodeLine{00102\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structsrsran_1_1rx__buffer__pool__config_af66112976db56f59bd3cbaa32e97a79c}{external\_soft\_bits}};}
\DoxyCodeLine{00103\ \};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \textcolor{comment}{///\ Receive\ buffer\ pool\ controller\ interface.}}
\DoxyCodeLine{00106\ \textcolor{keyword}{class}\ \mbox{\hyperlink{classsrsran_1_1rx__buffer__pool__controller}{rx\_buffer\_pool\_controller}}}
\DoxyCodeLine{00107\ \{}
\DoxyCodeLine{00108\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00109\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Default\ destructor.}}
\DoxyCodeLine{00110\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00111\ \ \ \textcolor{comment}{///\ An\ assertion\ is\ triggered\ if\ any\ buffer\ is\ still\ locked.\ This\ prevents\ that\ unique\ buffers\ lose\ the\ reference\ to}}
\DoxyCodeLine{00112\ \ \ \textcolor{comment}{///\ the\ actual\ buffers.}}
\DoxyCodeLine{00113\ \ \ \textcolor{keyword}{virtual}\ \string~\mbox{\hyperlink{classsrsran_1_1rx__buffer__pool__controller_a1a66ef37e5e31bcfa50234688804cf15}{rx\_buffer\_pool\_controller}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \textcolor{comment}{///\ Gets\ the\ actual\ buffer\ pool.}}
\DoxyCodeLine{00116\ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classsrsran_1_1rx__buffer__pool}{rx\_buffer\_pool}}\&\ \mbox{\hyperlink{classsrsran_1_1rx__buffer__pool__controller_aa88833f0915d05dc714a4ea7e46947a3}{get\_pool}}()\ =\ 0;}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \textcolor{comment}{///\ \(\backslash\)brief\ Stops\ the\ buffer\ pool.}}
\DoxyCodeLine{00119\ \ \ \textcolor{comment}{///}}
\DoxyCodeLine{00120\ \ \ \textcolor{comment}{///\ It\ waits\ for\ all\ buffers\ to\ be\ unlocked.}}
\DoxyCodeLine{00121\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsrsran_1_1rx__buffer__pool__controller_a17c629cca32b3cc687f2ea802434b78b}{stop}}()\ =\ 0;}
\DoxyCodeLine{00122\ \};}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \textcolor{comment}{///\ Creates\ a\ receive\ buffer\ pool.}}
\DoxyCodeLine{00125\ \mbox{\hyperlink{namespacesrsran_a8473d2c4daa50d58a911c48c8fafa265}{std}}::\mbox{\hyperlink{namespacesrsran_a8473d2c4daa50d58a911c48c8fafa265}{unique\_ptr}}<\mbox{\hyperlink{namespacesrsran_a8473d2c4daa50d58a911c48c8fafa265}{rx\_buffer\_pool\_controller}}>\ \mbox{\hyperlink{namespacesrsran_a8473d2c4daa50d58a911c48c8fafa265}{create\_rx\_buffer\_pool}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesrsran_a8473d2c4daa50d58a911c48c8fafa265}{rx\_buffer\_pool\_config}}\&\ \mbox{\hyperlink{namespacesrsran_a8473d2c4daa50d58a911c48c8fafa265}{config}});}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \}\ \textcolor{comment}{//\ namespace\ srsran}}

\end{DoxyCode}
