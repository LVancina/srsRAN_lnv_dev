\doxysection{srsran\+::mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter Class Reference}
\hypertarget{classsrsran_1_1mac__test__mode__cell__adapter}{}\label{classsrsran_1_1mac__test__mode__cell__adapter}\index{srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}}


Adapter of MAC cell for testing purposes. It automatically forces ACK/\+CRC=OK for the test UE.  




{\ttfamily \#include $<$mac\+\_\+test\+\_\+mode\+\_\+adapter.\+h$>$}



Inheritance diagram for srsran\+::mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/d4c/classsrsran_1_1mac__test__mode__cell__adapter__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d0/d50/classsrsran_1_1mac__test__mode__cell__adapter__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1mac__test__mode__cell__adapter_ad0f8e9df4a0fa9c2ff1561148c2326ed}{mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1srs__du_1_1du__test__config_1_1test__ue__config}{srs\+\_\+du\+::du\+\_\+test\+\_\+config\+::test\+\_\+ue\+\_\+config}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\+\_\+ue\+\_\+cfg\+\_\+}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__cell__creation__request}{mac\+\_\+cell\+\_\+creation\+\_\+request}} \&cell\+\_\+cfg, \mbox{\hyperlink{classsrsran_1_1mac__cell__control__information__handler}{mac\+\_\+cell\+\_\+control\+\_\+information\+\_\+handler}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{adapted\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1mac__pdu__handler}{mac\+\_\+pdu\+\_\+handler}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\+\_\+handler\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1mac__cell__slot__handler}{mac\+\_\+cell\+\_\+slot\+\_\+handler}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\+\_\+handler\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1mac__cell__result__notifier}{mac\+\_\+cell\+\_\+result\+\_\+notifier}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{result\+\_\+notifier\+\_\+}}, std\+::function$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}}(\mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}})$>$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dl\+\_\+bs\+\_\+notifier\+\_\+}}, \mbox{\hyperlink{classsrsran_1_1test__ue__info__manager}{test\+\_\+ue\+\_\+info\+\_\+manager}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\+\_\+info\+\_\+mgr\+\_\+}})
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1mac__test__mode__cell__adapter_aa1c58fbf1c517349e00ecd6fb8825e5b}{on\+\_\+new\+\_\+downlink\+\_\+scheduler\+\_\+results}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__dl__sched__result}{mac\+\_\+dl\+\_\+sched\+\_\+result}} \&dl\+\_\+res) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Notifies scheduled SSB/\+PDCCH/\+PDSCH grants. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1mac__test__mode__cell__adapter_a0a01aedc921bc7a68f5beefcc5e76f29}{on\+\_\+new\+\_\+downlink\+\_\+data}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__dl__data__result}{mac\+\_\+dl\+\_\+data\+\_\+result}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dl\+\_\+data}}) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Notifies scheduled PDSCH PDUs. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1mac__test__mode__cell__adapter_a9594cedc871ddddf8e96d47093c13d56}{on\+\_\+new\+\_\+uplink\+\_\+scheduler\+\_\+results}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__ul__sched__result}{mac\+\_\+ul\+\_\+sched\+\_\+result}} \&ul\+\_\+res) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Notifies slot scheduled PUCCH/\+PUSCH grants. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1mac__test__mode__cell__adapter_afbc088f2868aff0f69d4f2ddd75353b2}{on\+\_\+cell\+\_\+results\+\_\+completion}} (\mbox{\hyperlink{classsrsran_1_1slot__point}{slot\+\_\+point}} \mbox{\hyperlink{namespacesrsran_a457973e91fb03d0c262578c3bdf460f0a5e97994ed38a2b2f984f3b2b75012bf8}{slot}}) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Notifies the completion of all cell results for the given slot. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1mac__test__mode__cell__adapter_a7ffada545fb6fe7078f42fadd6e3f7a6}{handle\+\_\+slot\+\_\+indication}} (\mbox{\hyperlink{classsrsran_1_1slot__point}{slot\+\_\+point}} sl\+\_\+tx) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Processing of a new Slot Indication. This operation involves the following sub-\/tasks\+: \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1mac__test__mode__cell__adapter_aba8599bce233a71aa757fd1890e14e42}{handle\+\_\+error\+\_\+indication}} (\mbox{\hyperlink{classsrsran_1_1slot__point}{slot\+\_\+point}} sl\+\_\+tx, \mbox{\hyperlink{structsrsran_1_1mac__cell__slot__handler_1_1error__event}{error\+\_\+event}} event) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Handles an error indication sent by the lower layers for a given slot. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1mac__test__mode__cell__adapter_a41ca3a5c149b3235a84da283aa4a02c0}{handle\+\_\+crc}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__crc__indication__message}{mac\+\_\+crc\+\_\+indication\+\_\+message}} \&msg) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Handles a CRC indication. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1mac__test__mode__cell__adapter_a6364a2abaaa12aad993569ecf8f53086}{handle\+\_\+uci}} (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__uci__indication__message}{mac\+\_\+uci\+\_\+indication\+\_\+message}} \&msg) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Handles an UCI indication. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Adapter of MAC cell for testing purposes. It automatically forces ACK/\+CRC=OK for the test UE. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1mac__test__mode__cell__adapter_ad0f8e9df4a0fa9c2ff1561148c2326ed}\label{classsrsran_1_1mac__test__mode__cell__adapter_ad0f8e9df4a0fa9c2ff1561148c2326ed} 
\index{srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}!mac\_test\_mode\_cell\_adapter@{mac\_test\_mode\_cell\_adapter}}
\index{mac\_test\_mode\_cell\_adapter@{mac\_test\_mode\_cell\_adapter}!srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}}
\doxysubsubsection{\texorpdfstring{mac\_test\_mode\_cell\_adapter()}{mac\_test\_mode\_cell\_adapter()}}
{\footnotesize\ttfamily mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter\+::mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1srs__du_1_1du__test__config_1_1test__ue__config}{srs\+\_\+du\+::du\+\_\+test\+\_\+config\+::test\+\_\+ue\+\_\+config}} \&}]{test\+\_\+ue\+\_\+cfg\+\_\+,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__cell__creation__request}{mac\+\_\+cell\+\_\+creation\+\_\+request}} \&}]{cell\+\_\+cfg,  }\item[{\mbox{\hyperlink{classsrsran_1_1mac__cell__control__information__handler}{mac\+\_\+cell\+\_\+control\+\_\+information\+\_\+handler}} \&}]{adapted\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1mac__pdu__handler}{mac\+\_\+pdu\+\_\+handler}} \&}]{pdu\+\_\+handler\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1mac__cell__slot__handler}{mac\+\_\+cell\+\_\+slot\+\_\+handler}} \&}]{slot\+\_\+handler\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1mac__cell__result__notifier}{mac\+\_\+cell\+\_\+result\+\_\+notifier}} \&}]{result\+\_\+notifier\+\_\+,  }\item[{std\+::function$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}}(\mbox{\hyperlink{namespacesrsran_a1d83bcd76f2b7c6251855be8472a46f5}{rnti\+\_\+t}})$>$}]{dl\+\_\+bs\+\_\+notifier\+\_\+,  }\item[{\mbox{\hyperlink{classsrsran_1_1test__ue__info__manager}{test\+\_\+ue\+\_\+info\+\_\+manager}} \&}]{ue\+\_\+info\+\_\+mgr\+\_\+ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00086\ \ \ test\_ue\_cfg(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\_ue\_cfg\_}}),}
\DoxyCodeLine{00087\ \ \ adapted(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{adapted\_}}),}
\DoxyCodeLine{00088\ \ \ pdu\_handler(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{pdu\_handler\_}}),}
\DoxyCodeLine{00089\ \ \ slot\_handler(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{slot\_handler\_}}),}
\DoxyCodeLine{00090\ \ \ result\_notifier(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{result\_notifier\_}}),}
\DoxyCodeLine{00091\ \ \ dl\_bs\_notifier(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dl\_bs\_notifier\_}}),}
\DoxyCodeLine{00092\ \ \ logger(srslog::fetch\_basic\_logger(\textcolor{stringliteral}{"{}MAC"{}})),}
\DoxyCodeLine{00093\ \ \ ue\_info\_mgr(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ue\_info\_mgr\_}})}
\DoxyCodeLine{00094\ \{}
\DoxyCodeLine{00095\ \ \ \textcolor{comment}{//\ Note:\ The\ history\ ring\ size\ has\ to\ be\ a\ multiple\ of\ the\ TDD\ frame\ size\ in\ slots.}}
\DoxyCodeLine{00096\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{HISTORY\_RING\_SIZE}}\ =}
\DoxyCodeLine{00097\ \ \ \ \ \ \ 100\ *\ (cell\_cfg.\mbox{\hyperlink{structsrsran_1_1mac__cell__creation__request_aae80e2ecf723414db6d854012d058e71}{sched\_req}}.\mbox{\hyperlink{structsrsran_1_1sched__cell__configuration__request__message_ace5d3c64354606de1b7d32c342745afe}{tdd\_ul\_dl\_cfg\_common}}.has\_value()}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{namespacesrsran_a90cd61385e029e37194774233634a16c}{nof\_slots\_per\_tdd\_period}}(cell\_cfg.\mbox{\hyperlink{structsrsran_1_1mac__cell__creation__request_aae80e2ecf723414db6d854012d058e71}{sched\_req}}.\mbox{\hyperlink{structsrsran_1_1sched__cell__configuration__request__message_ace5d3c64354606de1b7d32c342745afe}{tdd\_ul\_dl\_cfg\_common}}.value())}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ 10U);}
\DoxyCodeLine{00100\ \ \ sched\_decision\_history.resize(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{HISTORY\_RING\_SIZE}});}
\DoxyCodeLine{00101\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1mac__test__mode__cell__adapter_a41ca3a5c149b3235a84da283aa4a02c0}\label{classsrsran_1_1mac__test__mode__cell__adapter_a41ca3a5c149b3235a84da283aa4a02c0} 
\index{srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}!handle\_crc@{handle\_crc}}
\index{handle\_crc@{handle\_crc}!srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}}
\doxysubsubsection{\texorpdfstring{handle\_crc()}{handle\_crc()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter\+::handle\+\_\+crc (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__crc__indication__message}{mac\+\_\+crc\+\_\+indication\+\_\+message}} \&}]{msg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Handles a CRC indication. 

There can be more than one CRC indication per slot. 

Implements \mbox{\hyperlink{classsrsran_1_1mac__cell__control__information__handler_a5029f169388d177227936d42af1c78dd}{srsran\+::mac\+\_\+cell\+\_\+control\+\_\+information\+\_\+handler}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00179\ \{}
\DoxyCodeLine{00180\ \ \ \textcolor{comment}{//\ Forward\ CRC\ to\ MAC,\ but\ remove\ the\ UCI\ for\ the\ test\ mode\ UE.}}
\DoxyCodeLine{00181\ \ \ \mbox{\hyperlink{structsrsran_1_1mac__crc__indication__message}{mac\_crc\_indication\_message}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}};}
\DoxyCodeLine{00182\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}}.sl\_rx\ =\ msg.sl\_rx;}
\DoxyCodeLine{00183\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1mac__crc__pdu}{mac\_crc\_pdu}}\&\ crc\ :\ msg.crcs)\ \{}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordflow}{if}\ (ue\_info\_mgr.is\_test\_ue(crc.rnti))\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \textcolor{comment}{//\ test\ mode\ UE\ case.}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ respective\ PUSCH\ PDU\ that\ was\ previously\ scheduled.}}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \textcolor{keyword}{const}\ slot\_descision\_history\&\ entry\ =\ sched\_decision\_history[msg.sl\_rx.to\_uint()\ \%\ sched\_decision\_history.size()];}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{found}}\ =\ std::any\_of(entry.puschs.begin(),\ entry.puschs.end(),\ [\&](\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1ul__sched__info}{ul\_sched\_info}}\&\ pusch)\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ return\ pusch.pusch\_cfg.rnti\ ==\ crc.rnti\ and\ pusch.pusch\_cfg.harq\_id\ ==\ crc.harq\_id;}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{found}})\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ logger.warning(}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}c-\/rnti=\{\}:\ Mismatch\ between\ provided\ CRC\ and\ expected\ PUSCH\ for\ slot\_rx=\{\}"{}},\ crc.rnti,\ msg.sl\_rx);}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \ \ \textcolor{comment}{//\ Intercept\ the\ CRC\ indication\ and\ force\ crc=OK\ and\ UL\ SNR.}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1mac__crc__pdu}{mac\_crc\_pdu}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\_crc}}\ \ \ \ =\ crc;}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\_crc}}.\mbox{\hyperlink{structsrsran_1_1mac__crc__pdu_a89a040f328679b9dca085ecd053e8d74}{tb\_crc\_success}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\_crc}}.ul\_sinr\_metric\ =\ 100;}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}}.crcs.push\_back(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\_crc}});}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \textcolor{comment}{//\ non-\/test\ mode\ UE.\ Forward\ the\ original\ CRC\ PDU.}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}}.crcs.push\_back(crc);}
\DoxyCodeLine{00207\ \ \ \ \ \}}
\DoxyCodeLine{00208\ \ \ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \textcolor{comment}{//\ Forward\ resulting\ CRC\ indication\ to\ real\ MAC.}}
\DoxyCodeLine{00211\ \ \ forward\_crc\_ind\_to\_mac(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}});}
\DoxyCodeLine{00212\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1mac__test__mode__cell__adapter_aba8599bce233a71aa757fd1890e14e42}\label{classsrsran_1_1mac__test__mode__cell__adapter_aba8599bce233a71aa757fd1890e14e42} 
\index{srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}!handle\_error\_indication@{handle\_error\_indication}}
\index{handle\_error\_indication@{handle\_error\_indication}!srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}}
\doxysubsubsection{\texorpdfstring{handle\_error\_indication()}{handle\_error\_indication()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter\+::handle\+\_\+error\+\_\+indication (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1slot__point}{slot\+\_\+point}}}]{sl\+\_\+tx,  }\item[{\mbox{\hyperlink{structsrsran_1_1mac__cell__slot__handler_1_1error__event}{error\+\_\+event}}}]{event }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Handles an error indication sent by the lower layers for a given slot. 

This indication may occur when the MAC took too long to send its slot result to the lower layers or when the lower layers were not able to process that slot result. 

Implements \mbox{\hyperlink{classsrsran_1_1mac__cell__slot__handler_a81bc4df807a2ffdb8fd3de5d521b74f7}{srsran\+::mac\+\_\+cell\+\_\+slot\+\_\+handler}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00166\ \{}
\DoxyCodeLine{00167\ \ \ slot\_descision\_history\&\ entry\ =\ sched\_decision\_history[sl\_tx.to\_uint()\ \%\ sched\_decision\_history.size()];}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{if}\ (event.pusch\_and\_pucch\_discarded)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{comment}{//\ Delete\ expected\ UCI\ and\ CRC\ indications\ that\ resulted\ from\ the\ scheduler\ decisions\ for\ this\ slot.}}
\DoxyCodeLine{00171\ \ \ \ \ entry.puschs.clear();}
\DoxyCodeLine{00172\ \ \ \ \ entry.pucchs.clear();}
\DoxyCodeLine{00173\ \ \ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ slot\_handler.\mbox{\hyperlink{classsrsran_1_1mac__cell__slot__handler_a81bc4df807a2ffdb8fd3de5d521b74f7}{handle\_error\_indication}}(sl\_tx,\ event);}
\DoxyCodeLine{00176\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1mac__test__mode__cell__adapter_a7ffada545fb6fe7078f42fadd6e3f7a6}\label{classsrsran_1_1mac__test__mode__cell__adapter_a7ffada545fb6fe7078f42fadd6e3f7a6} 
\index{srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}!handle\_slot\_indication@{handle\_slot\_indication}}
\index{handle\_slot\_indication@{handle\_slot\_indication}!srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}}
\doxysubsubsection{\texorpdfstring{handle\_slot\_indication()}{handle\_slot\_indication()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter\+::handle\+\_\+slot\+\_\+indication (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1slot__point}{slot\+\_\+point}}}]{sl\+\_\+tx }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Processing of a new Slot Indication. This operation involves the following sub-\/tasks\+: 


\begin{DoxyItemize}
\item The scheduler generates the scheduling grants for the provided slot and cell.
\item The scheduling grants are passed to the PHY.
\item The MAC DL PDUs are generated and passed to the PHY as well. 
\end{DoxyItemize}

Implements \mbox{\hyperlink{classsrsran_1_1mac__cell__slot__handler_ad1341fb0a9c70072b3ccda82148534da}{srsran\+::mac\+\_\+cell\+\_\+slot\+\_\+handler}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00104\ \{}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{if}\ (test\_ue\_cfg.auto\_ack\_indication\_delay.\mbox{\hyperlink{classsrsran_1_1optional_a2f160539a76c3f4dd0b50b339b81202e}{has\_value}}())\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{comment}{//\ auto-\/generation\ of\ CRC/UCI\ indication\ is\ enabled.}}
\DoxyCodeLine{00107\ \ \ \ \ \mbox{\hyperlink{classsrsran_1_1slot__point}{slot\_point}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sl\_rx\ =\ sl\_tx\ -\/\ test\_ue\_cfg.auto\_ack\_indication\_delay.value();}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keyword}{const}\ slot\_descision\_history\&\ entry\ =\ sched\_decision\_history[sl\_rx.to\_uint()\ \%\ sched\_decision\_history.size()];}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ Handle\ auto-\/generation\ of\ pending\ CRC\ indications.}}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ entry.puschs.empty())\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1mac__crc__indication__message}{mac\_crc\_indication\_message}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{crc\_ind}}\{\};}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{crc\_ind}}.sl\_rx\ =\ sl\_rx;}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1ul__sched__info}{ul\_sched\_info}}\&\ pusch\ :\ entry.puschs)\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{crc\_pdu}}\ \ \ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{crc\_ind}}.crcs.emplace\_back();}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{crc\_pdu}}.rnti\ \ \ \ =\ pusch.pusch\_cfg.rnti;}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{crc\_pdu}}.harq\_id\ =\ pusch.pusch\_cfg.harq\_id;}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Force\ CRC=OK\ for\ test\ UE.}}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{crc\_pdu}}.tb\_crc\_success\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Force\ UL\ SINR.}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{crc\_pdu}}.ul\_sinr\_metric\ =\ 100;}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \ \ \textcolor{comment}{//\ Forward\ CRC\ to\ the\ real\ MAC.}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ forward\_crc\_ind\_to\_mac(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{crc\_ind}});}
\DoxyCodeLine{00127\ \ \ \ \ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{comment}{//\ Handle\ auto-\/generation\ of\ pending\ UCI\ indications.}}
\DoxyCodeLine{00130\ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1mac__uci__indication__message}{mac\_uci\_indication\_message}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uci\_ind}};}
\DoxyCodeLine{00131\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uci\_ind}}.sl\_rx\ =\ sl\_rx;}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{comment}{//\ >\ Handle\ pending\ PUCCHs.}}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1pucch__info}{pucch\_info}}\&\ pucch\ :\ entry.pucchs)\ \{}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1mac__uci__pdu}{mac\_uci\_pdu}}\&\ pdu\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uci\_ind}}.ucis.emplace\_back();}
\DoxyCodeLine{00136\ \ \ \ \ \ \ pdu.\mbox{\hyperlink{structsrsran_1_1mac__uci__pdu_a4055fdfe05d214540ceeca5d3673f8f2}{rnti}}\ \ \ \ \ \ \ \ \ =\ pucch.crnti;}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (pucch.format)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ pucch\_format::FORMAT\_1:\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ fill\_uci\_pdu(pdu.\mbox{\hyperlink{structsrsran_1_1mac__uci__pdu_afa92105c4d6198c9b558d913ccf5d8e5}{pdu}}.emplace<\mbox{\hyperlink{structsrsran_1_1mac__uci__pdu_1_1pucch__f0__or__f1__type}{mac\_uci\_pdu::pucch\_f0\_or\_f1\_type}}>(),\ pucch);}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ pucch\_format::FORMAT\_2:\ \{}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ fill\_uci\_pdu(pdu.\mbox{\hyperlink{structsrsran_1_1mac__uci__pdu_afa92105c4d6198c9b558d913ccf5d8e5}{pdu}}.emplace<\mbox{\hyperlink{structsrsran_1_1mac__uci__pdu_1_1pucch__f2__or__f3__or__f4__type}{mac\_uci\_pdu::pucch\_f2\_or\_f3\_or\_f4\_type}}>(),\ pucch);}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00147\ \ \ \ \ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{comment}{//\ >\ Handle\ pending\ PUSCHs.}}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1ul__sched__info}{ul\_sched\_info}}\&\ pusch\ :\ entry.puschs)\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pusch.uci.has\_value())\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1mac__uci__pdu}{mac\_uci\_pdu}}\&\ pdu\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uci\_ind}}.ucis.emplace\_back();}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ pdu.\mbox{\hyperlink{structsrsran_1_1mac__uci__pdu_a4055fdfe05d214540ceeca5d3673f8f2}{rnti}}\ \ \ \ \ \ \ \ \ =\ pusch.pusch\_cfg.rnti;}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ fill\_uci\_pdu(pdu.\mbox{\hyperlink{structsrsran_1_1mac__uci__pdu_afa92105c4d6198c9b558d913ccf5d8e5}{pdu}}.emplace<\mbox{\hyperlink{structsrsran_1_1mac__uci__pdu_1_1pusch__type}{mac\_uci\_pdu::pusch\_type}}>(),\ pusch);}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00156\ \ \ \ \ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{comment}{//\ Forward\ UCI\ indication\ to\ real\ MAC.}}
\DoxyCodeLine{00159\ \ \ \ \ forward\_uci\_ind\_to\_mac(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{uci\_ind}});}
\DoxyCodeLine{00160\ \ \ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ slot\_handler.\mbox{\hyperlink{classsrsran_1_1mac__cell__slot__handler_ad1341fb0a9c70072b3ccda82148534da}{handle\_slot\_indication}}(sl\_tx);}
\DoxyCodeLine{00163\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1mac__test__mode__cell__adapter_a6364a2abaaa12aad993569ecf8f53086}\label{classsrsran_1_1mac__test__mode__cell__adapter_a6364a2abaaa12aad993569ecf8f53086} 
\index{srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}!handle\_uci@{handle\_uci}}
\index{handle\_uci@{handle\_uci}!srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}}
\doxysubsubsection{\texorpdfstring{handle\_uci()}{handle\_uci()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter\+::handle\+\_\+uci (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__uci__indication__message}{mac\+\_\+uci\+\_\+indication\+\_\+message}} \&}]{msg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Handles an UCI indication. 

The UCI indication can be received on both PUSCH and PUCCH. There can be more than one UCI indication per slot. 

Implements \mbox{\hyperlink{classsrsran_1_1mac__cell__control__information__handler_aedab97d56fb9c4a42a4bd6ef14c92848}{srsran\+::mac\+\_\+cell\+\_\+control\+\_\+information\+\_\+handler}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00364\ \{}
\DoxyCodeLine{00365\ \ \ \textcolor{keyword}{const}\ slot\_descision\_history\&\ entry\ =\ sched\_decision\_history[msg.sl\_rx.to\_uint()\ \%\ sched\_decision\_history.size()];}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \textcolor{comment}{//\ Forward\ UCI\ to\ MAC,\ but\ alter\ the\ UCI\ for\ the\ test\ mode\ UE.}}
\DoxyCodeLine{00368\ \ \ \mbox{\hyperlink{structsrsran_1_1mac__uci__indication__message}{mac\_uci\_indication\_message}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}};}
\DoxyCodeLine{00369\ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}}.sl\_rx\ =\ msg.sl\_rx;}
\DoxyCodeLine{00370\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1mac__uci__pdu}{mac\_uci\_pdu}}\&\ pdu\ :\ msg.ucis)\ \{}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ ue\_info\_mgr.is\_test\_ue(pdu.rnti))\ \{}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \textcolor{comment}{//\ non-\/test\ mode\ UE.\ Forward\ the\ original\ UCI\ indication\ PDU.}}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}}.ucis.push\_back(pdu);}
\DoxyCodeLine{00374\ \ \ \ \ \}}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \ \ \textcolor{comment}{//\ test\ mode\ UE.}}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{comment}{//\ Intercept\ the\ UCI\ indication\ and\ force\ HARQ-\/ACK=ACK\ and\ CSI.}}
\DoxyCodeLine{00378\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}}.ucis.push\_back(pdu);}
\DoxyCodeLine{00379\ \ \ \ \ \mbox{\hyperlink{structsrsran_1_1mac__uci__pdu}{mac\_uci\_pdu}}\&\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\_uci}}\ =\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}}.ucis.back();}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{entry\_found}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00382\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{variant\_holds\_alternative<mac\_uci\_pdu::pusch\_type>}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\_uci}}.pdu))\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1ul__sched__info}{ul\_sched\_info}}\&\ pusch\ :\ entry.puschs)\ \{}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pusch.pusch\_cfg.rnti\ ==\ pdu.rnti\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{and}}\ pusch.uci.has\_value())\ \{}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ fill\_uci\_pdu(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{variant\_get<mac\_uci\_pdu::pusch\_type>}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\_uci}}.pdu),\ pusch);}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{entry\_found}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00389\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \textcolor{comment}{//\ PUCCH\ case.}}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1pucch__info}{pucch\_info}}\&\ pucch\ :\ entry.pucchs)\ \{}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pucch\_info\_and\_uci\_ind\_match(pucch,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\_uci}}))\ \{}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Intercept\ the\ UCI\ indication\ and\ force\ HARQ-\/ACK=ACK\ and\ UCI.}}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pucch.format\ ==\ pucch\_format::FORMAT\_1)\ \{}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ fill\_uci\_pdu(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{variant\_get<mac\_uci\_pdu::pucch\_f0\_or\_f1\_type>}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\_uci}}.pdu),\ pucch);}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ \ \ fill\_uci\_pdu(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{variant\_get<mac\_uci\_pdu::pucch\_f2\_or\_f3\_or\_f4\_type>}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{test\_uci}}.pdu),\ pucch);}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{entry\_found}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00402\ \ \ \ \ \}}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{not}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{entry\_found}})\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}}.ucis.pop\_back();}
\DoxyCodeLine{00406\ \ \ \ \ \ \ logger.warning(\textcolor{stringliteral}{"{}c-\/rnti=\{\}:\ Mismatch\ between\ provided\ UCI\ and\ expected\ UCI\ for\ slot\_rx=\{\}"{}},\ pdu.rnti,\ msg.sl\_rx);}
\DoxyCodeLine{00407\ \ \ \ \ \}}
\DoxyCodeLine{00408\ \ \ \}}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \ \ \textcolor{comment}{//\ Forward\ UCI\ indication\ to\ real\ MAC.}}
\DoxyCodeLine{00411\ \ \ forward\_uci\_ind\_to\_mac(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{msg\_copy}});}
\DoxyCodeLine{00412\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1mac__test__mode__cell__adapter_afbc088f2868aff0f69d4f2ddd75353b2}\label{classsrsran_1_1mac__test__mode__cell__adapter_afbc088f2868aff0f69d4f2ddd75353b2} 
\index{srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}!on\_cell\_results\_completion@{on\_cell\_results\_completion}}
\index{on\_cell\_results\_completion@{on\_cell\_results\_completion}!srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}}
\doxysubsubsection{\texorpdfstring{on\_cell\_results\_completion()}{on\_cell\_results\_completion()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} srsran\+::mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter\+::on\+\_\+cell\+\_\+results\+\_\+completion (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1slot__point}{slot\+\_\+point}}}]{slot }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Notifies the completion of all cell results for the given slot. 



Implements \mbox{\hyperlink{classsrsran_1_1mac__cell__result__notifier_aa2aafc4fdfc432b920631112a36e25b7}{srsran\+::mac\+\_\+cell\+\_\+result\+\_\+notifier}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00157\ \{\ result\_notifier.\mbox{\hyperlink{classsrsran_1_1mac__cell__result__notifier_aa2aafc4fdfc432b920631112a36e25b7}{on\_cell\_results\_completion}}(\mbox{\hyperlink{namespacesrsran_a457973e91fb03d0c262578c3bdf460f0a5e97994ed38a2b2f984f3b2b75012bf8}{slot}});\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1mac__test__mode__cell__adapter_a0a01aedc921bc7a68f5beefcc5e76f29}\label{classsrsran_1_1mac__test__mode__cell__adapter_a0a01aedc921bc7a68f5beefcc5e76f29} 
\index{srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}!on\_new\_downlink\_data@{on\_new\_downlink\_data}}
\index{on\_new\_downlink\_data@{on\_new\_downlink\_data}!srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}}
\doxysubsubsection{\texorpdfstring{on\_new\_downlink\_data()}{on\_new\_downlink\_data()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} srsran\+::mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter\+::on\+\_\+new\+\_\+downlink\+\_\+data (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__dl__data__result}{mac\+\_\+dl\+\_\+data\+\_\+result}} \&}]{dl\+\_\+data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Notifies scheduled PDSCH PDUs. 



Implements \mbox{\hyperlink{classsrsran_1_1mac__cell__result__notifier_a7529a2aecae2b5d5fe40fcc0a085692a}{srsran\+::mac\+\_\+cell\+\_\+result\+\_\+notifier}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00150\ \ \ \{}
\DoxyCodeLine{00151\ \ \ \ \ result\_notifier.\mbox{\hyperlink{classsrsran_1_1mac__cell__result__notifier_a7529a2aecae2b5d5fe40fcc0a085692a}{on\_new\_downlink\_data}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dl\_data}});}
\DoxyCodeLine{00152\ \ \ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1mac__test__mode__cell__adapter_aa1c58fbf1c517349e00ecd6fb8825e5b}\label{classsrsran_1_1mac__test__mode__cell__adapter_aa1c58fbf1c517349e00ecd6fb8825e5b} 
\index{srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}!on\_new\_downlink\_scheduler\_results@{on\_new\_downlink\_scheduler\_results}}
\index{on\_new\_downlink\_scheduler\_results@{on\_new\_downlink\_scheduler\_results}!srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}}
\doxysubsubsection{\texorpdfstring{on\_new\_downlink\_scheduler\_results()}{on\_new\_downlink\_scheduler\_results()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} srsran\+::mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter\+::on\+\_\+new\+\_\+downlink\+\_\+scheduler\+\_\+results (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__dl__sched__result}{mac\+\_\+dl\+\_\+sched\+\_\+result}} \&}]{dl\+\_\+res }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Notifies scheduled SSB/\+PDCCH/\+PDSCH grants. 



Implements \mbox{\hyperlink{classsrsran_1_1mac__cell__result__notifier_a455b4a208bbff1b8d0d49c13743b4155}{srsran\+::mac\+\_\+cell\+\_\+result\+\_\+notifier}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00145\ \ \ \{}
\DoxyCodeLine{00146\ \ \ \ \ result\_notifier.\mbox{\hyperlink{classsrsran_1_1mac__cell__result__notifier_a455b4a208bbff1b8d0d49c13743b4155}{on\_new\_downlink\_scheduler\_results}}(dl\_res);}
\DoxyCodeLine{00147\ \ \ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1mac__test__mode__cell__adapter_a9594cedc871ddddf8e96d47093c13d56}\label{classsrsran_1_1mac__test__mode__cell__adapter_a9594cedc871ddddf8e96d47093c13d56} 
\index{srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}!on\_new\_uplink\_scheduler\_results@{on\_new\_uplink\_scheduler\_results}}
\index{on\_new\_uplink\_scheduler\_results@{on\_new\_uplink\_scheduler\_results}!srsran::mac\_test\_mode\_cell\_adapter@{srsran::mac\_test\_mode\_cell\_adapter}}
\doxysubsubsection{\texorpdfstring{on\_new\_uplink\_scheduler\_results()}{on\_new\_uplink\_scheduler\_results()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} mac\+\_\+test\+\_\+mode\+\_\+cell\+\_\+adapter\+::on\+\_\+new\+\_\+uplink\+\_\+scheduler\+\_\+results (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1mac__ul__sched__result}{mac\+\_\+ul\+\_\+sched\+\_\+result}} \&}]{ul\+\_\+res }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Notifies slot scheduled PUCCH/\+PUSCH grants. 



Implements \mbox{\hyperlink{classsrsran_1_1mac__cell__result__notifier_a48f4b5a78472f0df38653cab7300ec3f}{srsran\+::mac\+\_\+cell\+\_\+result\+\_\+notifier}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00416\ \{}
\DoxyCodeLine{00417\ \ \ slot\_descision\_history\&\ entry\ =\ sched\_decision\_history[ul\_res.slot.to\_uint()\ \%\ sched\_decision\_history.size()];}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \textcolor{comment}{//\ Resets\ the\ history\ for\ this\ ring\ element.}}
\DoxyCodeLine{00420\ \ \ entry.pucchs.clear();}
\DoxyCodeLine{00421\ \ \ entry.puschs.clear();}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \ \ \textcolor{comment}{//\ Fill\ the\ ring\ element\ with\ the\ scheduler\ decisions.}}
\DoxyCodeLine{00424\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1pucch__info}{pucch\_info}}\&\ pucch\ :\ ul\_res.ul\_res-\/>pucchs)\ \{}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{keywordflow}{if}\ (ue\_info\_mgr.is\_test\_ue(pucch.crnti))\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ entry.pucchs.push\_back(pucch);}
\DoxyCodeLine{00427\ \ \ \ \ \}}
\DoxyCodeLine{00428\ \ \ \}}
\DoxyCodeLine{00429\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structsrsran_1_1ul__sched__info}{ul\_sched\_info}}\&\ pusch\ :\ ul\_res.ul\_res-\/>puschs)\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \textcolor{keywordflow}{if}\ (ue\_info\_mgr.is\_test\_ue(pusch.pusch\_cfg.rnti))\ \{}
\DoxyCodeLine{00431\ \ \ \ \ \ \ entry.puschs.push\_back(pusch);}
\DoxyCodeLine{00432\ \ \ \ \ \}}
\DoxyCodeLine{00433\ \ \ \}}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00435\ \ \ result\_notifier.\mbox{\hyperlink{classsrsran_1_1mac__cell__result__notifier_a48f4b5a78472f0df38653cab7300ec3f}{on\_new\_uplink\_scheduler\_results}}(ul\_res);}
\DoxyCodeLine{00436\ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/du\+\_\+high/adapters/mac\+\_\+test\+\_\+mode\+\_\+adapter.\+h\item 
lib/du\+\_\+high/adapters/mac\+\_\+test\+\_\+mode\+\_\+adapter.\+cpp\end{DoxyCompactItemize}
