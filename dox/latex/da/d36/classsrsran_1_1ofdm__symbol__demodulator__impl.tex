\doxysection{srsran\+::ofdm\+\_\+symbol\+\_\+demodulator\+\_\+impl Class Reference}
\hypertarget{classsrsran_1_1ofdm__symbol__demodulator__impl}{}\label{classsrsran_1_1ofdm__symbol__demodulator__impl}\index{srsran::ofdm\_symbol\_demodulator\_impl@{srsran::ofdm\_symbol\_demodulator\_impl}}


Describes a generic OFDM symbol demodulator.  




{\ttfamily \#include $<$ofdm\+\_\+demodulator\+\_\+impl.\+h$>$}



Inheritance diagram for srsran\+::ofdm\+\_\+symbol\+\_\+demodulator\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=252pt]{d0/dc8/classsrsran_1_1ofdm__symbol__demodulator__impl__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for srsran\+::ofdm\+\_\+symbol\+\_\+demodulator\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=252pt]{d0/d98/classsrsran_1_1ofdm__symbol__demodulator__impl__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classsrsran_1_1ofdm__symbol__demodulator__impl_a3620ce9f8c0ad94a74c891a2e1e7db1c}{ofdm\+\_\+symbol\+\_\+demodulator\+\_\+impl}} (\mbox{\hyperlink{structsrsran_1_1ofdm__demodulator__common__configuration}{ofdm\+\_\+demodulator\+\_\+common\+\_\+configuration}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{common\+\_\+config}}, \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1ofdm__demodulator__configuration}{ofdm\+\_\+demodulator\+\_\+configuration}} \&\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\+\_\+config}})
\begin{DoxyCompactList}\small\item\em Constructs an OFDM symbol demodulator. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{classsrsran_1_1ofdm__symbol__demodulator__impl_ad6959b0794e48ffca9679b0cccde25f4}{get\+\_\+rg\+\_\+size}} () \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\begin{DoxyCompactList}\small\item\em Gets the resource grid bandwidth in resource elements. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{classsrsran_1_1ofdm__symbol__demodulator__impl_a568ae22931f2fc32f8262ff9c4158f58}{get\+\_\+cp\+\_\+offset}} (\mbox{\hyperlink{classunsigned}{unsigned}} symbol\+\_\+index, \mbox{\hyperlink{classunsigned}{unsigned}} slot\+\_\+index) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}}
\begin{DoxyCompactList}\small\item\em Gets the offset in samples to the start of (the cyclic prefix of) a given symbol. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{classsrsran_1_1ofdm__symbol__demodulator__impl_a9e96f5604d26a5d83d3c219b34304a2a}{get\+\_\+symbol\+\_\+size}} (\mbox{\hyperlink{classunsigned}{unsigned}} symbol\+\_\+index) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Gets a symbol size including cyclic prefix. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} \mbox{\hyperlink{classsrsran_1_1ofdm__symbol__demodulator__impl_acfc1edc79e5e564998fec17482f4aa46}{demodulate}} (\mbox{\hyperlink{classsrsran_1_1resource__grid__writer}{resource\+\_\+grid\+\_\+writer}} \&grid, \mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{namespacesrsran_adb0c7723c7e69c78add18ca453dd1dbc}{cf\+\_\+t}} $>$ input, \mbox{\hyperlink{classunsigned}{unsigned}} \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{port\+\_\+index}}, \mbox{\hyperlink{classunsigned}{unsigned}} symbol\+\_\+index) \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{override}}
\begin{DoxyCompactList}\small\item\em Demodulates an OFDM signal with symbol granularity. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classsrsran_1_1ofdm__symbol__demodulator}{srsran\+::ofdm\+\_\+symbol\+\_\+demodulator}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{virtual}} {\bfseries \texorpdfstring{$\sim$}{\string~}ofdm\+\_\+symbol\+\_\+demodulator} ()=\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{default}}
\begin{DoxyCompactList}\small\item\em Default destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Describes a generic OFDM symbol demodulator. 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classsrsran_1_1ofdm__symbol__demodulator__impl_a3620ce9f8c0ad94a74c891a2e1e7db1c}\label{classsrsran_1_1ofdm__symbol__demodulator__impl_a3620ce9f8c0ad94a74c891a2e1e7db1c} 
\index{srsran::ofdm\_symbol\_demodulator\_impl@{srsran::ofdm\_symbol\_demodulator\_impl}!ofdm\_symbol\_demodulator\_impl@{ofdm\_symbol\_demodulator\_impl}}
\index{ofdm\_symbol\_demodulator\_impl@{ofdm\_symbol\_demodulator\_impl}!srsran::ofdm\_symbol\_demodulator\_impl@{srsran::ofdm\_symbol\_demodulator\_impl}}
\doxysubsubsection{\texorpdfstring{ofdm\_symbol\_demodulator\_impl()}{ofdm\_symbol\_demodulator\_impl()}}
{\footnotesize\ttfamily ofdm\+\_\+symbol\+\_\+demodulator\+\_\+impl\+::ofdm\+\_\+symbol\+\_\+demodulator\+\_\+impl (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsrsran_1_1ofdm__demodulator__common__configuration}{ofdm\+\_\+demodulator\+\_\+common\+\_\+configuration}} \&}]{common\+\_\+config,  }\item[{\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{structsrsran_1_1ofdm__demodulator__configuration}{ofdm\+\_\+demodulator\+\_\+configuration}} \&}]{ofdm\+\_\+config }\end{DoxyParamCaption})}



Constructs an OFDM symbol demodulator. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em common\+\_\+config} & Provides specific configuration parameters from the factory. \\
\hline
\mbox{\texttt{ in}}  & {\em ofdm\+\_\+config} & Provides generic OFDM configuration parameters. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :}
\DoxyCodeLine{00037\ \ \ dft\_size(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.dft\_size),}
\DoxyCodeLine{00038\ \ \ rg\_size(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.bw\_rb\ *\ NRE),}
\DoxyCodeLine{00039\ \ \ cp(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.cp),}
\DoxyCodeLine{00040\ \ \ nof\_samples\_window\_offset(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.nof\_samples\_window\_offset),}
\DoxyCodeLine{00041\ \ \ scs(\mbox{\hyperlink{namespacesrsran_a2e4c9b3ea403617006756dfa03632b0f}{to\_subcarrier\_spacing}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.numerology)),}
\DoxyCodeLine{00042\ \ \ sampling\_rate\_Hz(\mbox{\hyperlink{namespacesrsran_af7e1cfa828177b067334574244a06c8f}{to\_sampling\_rate\_Hz}}(scs,\ dft\_size)),}
\DoxyCodeLine{00043\ \ \ scale(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.scale),}
\DoxyCodeLine{00044\ \ \ dft(std::move(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{common\_config}}.dft)),}
\DoxyCodeLine{00045\ \ \ phase\_compensation\_table(\mbox{\hyperlink{namespacesrsran_a2e4c9b3ea403617006756dfa03632b0f}{to\_subcarrier\_spacing}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.numerology),}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.cp,}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.dft\_size,}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.center\_freq\_hz,}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false})}
\DoxyCodeLine{00050\ \{}
\DoxyCodeLine{00051\ \ \ report\_fatal\_error\_if\_not(std::isnormal(scale),\ \textcolor{stringliteral}{"{}Invalid\ scaling\ factor\ \{\}."{}},\ scale);}
\DoxyCodeLine{00052\ \ \ report\_fatal\_error\_if\_not(}
\DoxyCodeLine{00053\ \ \ \ \ \ \ dft\_size\ >\ rg\_size,\ \textcolor{stringliteral}{"{}The\ DFT\ size\ (\{\})\ must\ be\ greater\ than\ the\ resource\ grid\ size\ (\{\})."{}},\ dft\_size,\ rg\_size);}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \textcolor{comment}{//\ Fill\ DFT\ input\ with\ zeros.}}
\DoxyCodeLine{00056\ \ \ srsvec::zero(dft-\/>get\_input());}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \textcolor{comment}{//\ Set\ the\ right\ size\ to\ the\ internal\ phase\ compensation\ buffer.}}
\DoxyCodeLine{00059\ \ \ compensated\_output.resize(dft\_size);}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.nof\_samples\_window\_offset\ !=\ 0)\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ Verify\ the\ window\ is\ valid.}}
\DoxyCodeLine{00063\ \ \ \ \ srsran\_assert(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.nof\_samples\_window\_offset\ <\ (144\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.dft\_size)\ /\ 2048,}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ DFT\ window\ offset\ (i.e.,\ \{\})\ must\ be\ lower\ than\ \{\}."{}},}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.nof\_samples\_window\_offset,}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (144\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.dft\_size)\ /\ 2048);}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//\ Prepare\ phase\ compensation\ vector.}}
\DoxyCodeLine{00069\ \ \ \ \ window\_phase\_compensation.resize(dft\_size);}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{comment}{//\ Discrete\ frequency\ of\ the\ complex\ exponential.}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{omega}}\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{ofdm\_config}}.nof\_samples\_window\_offset)\ *\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(2.0\ *\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{M\_PI}})\ /}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(dft\_size);}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ i\ =\ 0;\ i\ !=\ dft\_size;\ ++i)\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ window\_phase\_compensation[i]\ =\ std::polar(1.0F,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{omega}}\ *\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(i));}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \}}
\DoxyCodeLine{00078\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classsrsran_1_1ofdm__symbol__demodulator__impl_acfc1edc79e5e564998fec17482f4aa46}\label{classsrsran_1_1ofdm__symbol__demodulator__impl_acfc1edc79e5e564998fec17482f4aa46} 
\index{srsran::ofdm\_symbol\_demodulator\_impl@{srsran::ofdm\_symbol\_demodulator\_impl}!demodulate@{demodulate}}
\index{demodulate@{demodulate}!srsran::ofdm\_symbol\_demodulator\_impl@{srsran::ofdm\_symbol\_demodulator\_impl}}
\doxysubsubsection{\texorpdfstring{demodulate()}{demodulate()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{void}} ofdm\+\_\+symbol\+\_\+demodulator\+\_\+impl\+::demodulate (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsrsran_1_1resource__grid__writer}{resource\+\_\+grid\+\_\+writer}} \&}]{grid,  }\item[{\mbox{\hyperlink{classsrsran_1_1span}{span}}$<$ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{const}} \mbox{\hyperlink{namespacesrsran_adb0c7723c7e69c78add18ca453dd1dbc}{cf\+\_\+t}} $>$}]{input,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{port\+\_\+index,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{symbol\+\_\+index }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Demodulates an OFDM signal with symbol granularity. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em grid} & Provides the output as frequency-\/domain signal corresponding to one slot. \\
\hline
\mbox{\texttt{ in}}  & {\em input} & Provides the time domain modulated signal. \\
\hline
\mbox{\texttt{ in}}  & {\em port\+\_\+index} & Indicates the port index to demodulate. \\
\hline
\mbox{\texttt{ in}}  & {\em symbol\+\_\+index} & Symbol index within the subframe to demodulate. \\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
The input size must be equal to the the symbol size including the cyclic prefix. 

The output size must be consistent with the configured bandwidth. 
\end{DoxyNote}


Implements \mbox{\hyperlink{classsrsran_1_1ofdm__symbol__demodulator_a6e7abeacdb4ace7af9057fa7d42e1b90}{srsran\+::ofdm\+\_\+symbol\+\_\+demodulator}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00098\ \{}
\DoxyCodeLine{00099\ \ \ \textcolor{comment}{//\ Calculate\ number\ of\ symbols\ per\ slot.}}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nsymb}}\ =\ \mbox{\hyperlink{namespacesrsran_aa1d2bd5d3008afda19c0949d241a73f7}{get\_nsymb\_per\_slot}}(cp);}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \textcolor{comment}{//\ Calculate\ cyclic\ prefix\ length.}}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordtype}{unsigned}\ cp\_len\ =\ cp.\mbox{\hyperlink{classsrsran_1_1cyclic__prefix_ac71cef705198bb0f9b4a83f5ee3f158b}{get\_length}}(symbol\_index,\ scs).\mbox{\hyperlink{classsrsran_1_1phy__time__unit_a942e82e30afbcebbc43f1943738f9d19}{to\_samples}}(sampling\_rate\_Hz);}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{//\ Make\ sure\ output\ buffer\ matches\ the\ symbol\ size.}}
\DoxyCodeLine{00106\ \ \ srsran\_assert(input.\mbox{\hyperlink{classsrsran_1_1span_ad0e376d95ca916144eac76f27f0654ac}{size}}()\ ==\ (cp\_len\ +\ dft\_size),}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ input\ buffer\ size\ (\{\})\ does\ not\ match\ the\ symbol\ index\ \{\}\ size\ (\{\}+\{\}=\{\}).\ SCS=\{\}kHz."{}},}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input.\mbox{\hyperlink{classsrsran_1_1span_ad0e376d95ca916144eac76f27f0654ac}{size}}(),}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ symbol\_index,}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cp\_len,}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dft\_size,}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cp\_len\ +\ dft\_size,}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a8c3848f1144990e3777cdc7e1ab27cf7}{scs\_to\_khz}}(scs));}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \textcolor{comment}{//\ Prepare\ the\ DFT\ inputs,\ while\ skipping\ the\ cyclic\ prefix.}}
\DoxyCodeLine{00116\ \ \ srsvec::copy(dft-\/>get\_input().first(dft\_size),\ input.\mbox{\hyperlink{classsrsran_1_1span_ac5f02596fcb6e8f430a3e11e47a6d7e8}{subspan}}(cp\_len\ -\/\ nof\_samples\_window\_offset,\ dft\_size));}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \textcolor{comment}{//\ Execute\ DFT.}}
\DoxyCodeLine{00119\ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<const\ cf\_t>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dft\_output}}\ =\ dft-\/>run();}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \textcolor{comment}{//\ Get\ phase\ correction\ (TS\ 138.211,\ Section\ 5.4)}}
\DoxyCodeLine{00122\ \ \ \mbox{\hyperlink{namespacesrsran_adb0c7723c7e69c78add18ca453dd1dbc}{cf\_t}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{phase\_compensation}}\ =\ phase\_compensation\_table.\mbox{\hyperlink{classsrsran_1_1phase__compensation__lut_a767c0755e3324729c5737b9c38112efc}{get\_coefficient}}(symbol\_index);}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \textcolor{comment}{//\ Apply\ scaling\ and\ phase\ compensation.}}
\DoxyCodeLine{00125\ \ \ srsvec::sc\_prod(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{dft\_output}},\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{phase\_compensation}}\ *\ scale,\ compensated\_output);}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{//\ Compensate\ DFT\ window\ offset\ phase\ shift.}}
\DoxyCodeLine{00128\ \ \ \textcolor{keywordflow}{if}\ (!window\_phase\_compensation.\mbox{\hyperlink{classsrsran_1_1span_a06f3393981b96d556095d9023b894a8f}{empty}}())\ \{}
\DoxyCodeLine{00129\ \ \ \ \ srsvec::prod(compensated\_output,\ window\_phase\_compensation,\ compensated\_output);}
\DoxyCodeLine{00130\ \ \ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \textcolor{comment}{//\ Map\ the\ upper\ bound\ frequency\ domain\ data.}}
\DoxyCodeLine{00133\ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<cf\_t>}}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{upper\_bound}}(\&compensated\_output[dft\_size\ -\/\ rg\_size\ /\ 2],\ rg\_size\ /\ 2);}
\DoxyCodeLine{00134\ \ \ grid.\mbox{\hyperlink{classsrsran_1_1resource__grid__writer_aaad19c2090c3824f52092dfcf251710c}{put}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{port\_index}},\ symbol\_index\ \%\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nsymb}},\ 0,\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{upper\_bound}});}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \textcolor{comment}{//\ Map\ the\ lower\ bound\ frequency\ domain\ data.}}
\DoxyCodeLine{00137\ \ \ \mbox{\hyperlink{classsrsran_1_1span}{span<cf\_t>}}\ lower\_bound(\&compensated\_output[0],\ rg\_size\ /\ 2);}
\DoxyCodeLine{00138\ \ \ grid.\mbox{\hyperlink{classsrsran_1_1resource__grid__writer_aaad19c2090c3824f52092dfcf251710c}{put}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{port\_index}},\ symbol\_index\ \%\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nsymb}},\ rg\_size\ /\ 2,\ lower\_bound);}
\DoxyCodeLine{00139\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ofdm__symbol__demodulator__impl_a568ae22931f2fc32f8262ff9c4158f58}\label{classsrsran_1_1ofdm__symbol__demodulator__impl_a568ae22931f2fc32f8262ff9c4158f58} 
\index{srsran::ofdm\_symbol\_demodulator\_impl@{srsran::ofdm\_symbol\_demodulator\_impl}!get\_cp\_offset@{get\_cp\_offset}}
\index{get\_cp\_offset@{get\_cp\_offset}!srsran::ofdm\_symbol\_demodulator\_impl@{srsran::ofdm\_symbol\_demodulator\_impl}}
\doxysubsubsection{\texorpdfstring{get\_cp\_offset()}{get\_cp\_offset()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classunsigned}{unsigned}} ofdm\+\_\+symbol\+\_\+demodulator\+\_\+impl\+::get\+\_\+cp\+\_\+offset (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{symbol\+\_\+index,  }\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{slot\+\_\+index }\end{DoxyParamCaption}) const}



Gets the offset in samples to the start of (the cyclic prefix of) a given symbol. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em symbol\+\_\+index} & Indicates the symbol index within the subframe. \\
\hline
\mbox{\texttt{ in}}  & {\em slot\+\_\+index} & Slot index within the subframe containing the symbol to demodulate. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of samples preceding the given symbol. 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{00081\ \{}
\DoxyCodeLine{00082\ \ \ \textcolor{comment}{//\ Calculate\ number\ of\ symbols\ per\ slot.}}
\DoxyCodeLine{00083\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nsymb}}\ =\ \mbox{\hyperlink{namespacesrsran_aa1d2bd5d3008afda19c0949d241a73f7}{get\_nsymb\_per\_slot}}(cp);}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \textcolor{comment}{//\ Calculate\ the\ offset\ in\ samples\ to\ the\ start\ of\ the\ symbol\ CP\ within\ the\ current\ slot}}
\DoxyCodeLine{00086\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cp\_offset}}\ =\ 0;}
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symb\_idx}}\ =\ 0;\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symb\_idx}}\ !=\ symbol\_index;\ ++\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symb\_idx}})\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cp\_offset}}\ +=\ cp.\mbox{\hyperlink{classsrsran_1_1cyclic__prefix_ac71cef705198bb0f9b4a83f5ee3f158b}{get\_length}}(\mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{nsymb}}\ *\ slot\_index\ +\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{symb\_idx}},\ scs).\mbox{\hyperlink{classsrsran_1_1phy__time__unit_a942e82e30afbcebbc43f1943738f9d19}{to\_samples}}(sampling\_rate\_Hz)\ +\ dft\_size;}
\DoxyCodeLine{00089\ \ \ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesrsran_a58e7c9f2c51a9ad6a0899b46d5315723}{cp\_offset}};}
\DoxyCodeLine{00092\ \}}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ofdm__symbol__demodulator__impl_ad6959b0794e48ffca9679b0cccde25f4}\label{classsrsran_1_1ofdm__symbol__demodulator__impl_ad6959b0794e48ffca9679b0cccde25f4} 
\index{srsran::ofdm\_symbol\_demodulator\_impl@{srsran::ofdm\_symbol\_demodulator\_impl}!get\_rg\_size@{get\_rg\_size}}
\index{get\_rg\_size@{get\_rg\_size}!srsran::ofdm\_symbol\_demodulator\_impl@{srsran::ofdm\_symbol\_demodulator\_impl}}
\doxysubsubsection{\texorpdfstring{get\_rg\_size()}{get\_rg\_size()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classunsigned}{unsigned}} srsran\+::ofdm\+\_\+symbol\+\_\+demodulator\+\_\+impl\+::get\+\_\+rg\+\_\+size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Gets the resource grid bandwidth in resource elements. 

\begin{DoxyReturn}{Returns}
The number of resource elements in the grid. 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{00075\ \{\ \textcolor{keywordflow}{return}\ rg\_size;\ \};}

\end{DoxyCode}
\Hypertarget{classsrsran_1_1ofdm__symbol__demodulator__impl_a9e96f5604d26a5d83d3c219b34304a2a}\label{classsrsran_1_1ofdm__symbol__demodulator__impl_a9e96f5604d26a5d83d3c219b34304a2a} 
\index{srsran::ofdm\_symbol\_demodulator\_impl@{srsran::ofdm\_symbol\_demodulator\_impl}!get\_symbol\_size@{get\_symbol\_size}}
\index{get\_symbol\_size@{get\_symbol\_size}!srsran::ofdm\_symbol\_demodulator\_impl@{srsran::ofdm\_symbol\_demodulator\_impl}}
\doxysubsubsection{\texorpdfstring{get\_symbol\_size()}{get\_symbol\_size()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classunsigned}{unsigned}} srsran\+::ofdm\+\_\+symbol\+\_\+demodulator\+\_\+impl\+::get\+\_\+symbol\+\_\+size (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classunsigned}{unsigned}}}]{symbol\+\_\+index }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Gets a symbol size including cyclic prefix. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em symbol\+\_\+index} & Indicates the symbol index within the subframe. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of samples for the given symbol index. 
\end{DoxyReturn}


Implements \mbox{\hyperlink{classsrsran_1_1ofdm__symbol__demodulator_a98fb688c6b9acc311a67318538ac64e9}{srsran\+::ofdm\+\_\+symbol\+\_\+demodulator}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00085\ \ \ \{}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordflow}{return}\ cp.\mbox{\hyperlink{classsrsran_1_1cyclic__prefix_ac71cef705198bb0f9b4a83f5ee3f158b}{get\_length}}(symbol\_index,\ scs).\mbox{\hyperlink{classsrsran_1_1phy__time__unit_a942e82e30afbcebbc43f1943738f9d19}{to\_samples}}(sampling\_rate\_Hz)\ +\ dft\_size;}
\DoxyCodeLine{00087\ \ \ \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/phy/lower/modulation/ofdm\+\_\+demodulator\+\_\+impl.\+h\item 
lib/phy/lower/modulation/ofdm\+\_\+demodulator\+\_\+impl.\+cpp\end{DoxyCompactItemize}
