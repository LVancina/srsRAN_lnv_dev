<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>srsRAN Docs: srsran::srs_du::du_pucch_resource_manager Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">srsRAN Docs
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/def/namespacesrsran.html">srsran</a></li><li class="navelem"><b>srs_du</b></li><li class="navelem"><a class="el" href="../../d2/dbc/classsrsran_1_1srs__du_1_1du__pucch__resource__manager.html">du_pucch_resource_manager</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="../../d0/d6c/classsrsran_1_1srs__du_1_1du__pucch__resource__manager-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">srsran::srs_du::du_pucch_resource_manager Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This class manages the allocation of RAN PUCCH Resources to DU UEs. For instance, this class ensures that UEs do not collide in the usage of the PUCCH for SRs and CSI. For HARQ-ACKs, we rely on the MAC scheduler to ensure no collisions take place in the PUCCH.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="../../d0/d02/du__pucch__resource__manager_8h_source.html">du_pucch_resource_manager.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for srsran::srs_du::du_pucch_resource_manager:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/d8b/classsrsran_1_1srs__du_1_1du__pucch__resource__manager__coll__graph.png" border="0" usemap="#asrsran_1_1srs__du_1_1du__pucch__resource__manager_coll__map" alt="Collaboration graph"/></div>
<map name="asrsran_1_1srs__du_1_1du__pucch__resource__manager_coll__map" id="asrsran_1_1srs__du_1_1du__pucch__resource__manager_coll__map">
<area shape="rect" title="This class manages the allocation of RAN PUCCH Resources to DU UEs. For instance, this class ensures ..." alt="" coords="5,5,233,205"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a333f7fe234936b54a11682c3900118a4" id="r_a333f7fe234936b54a11682c3900118a4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a333f7fe234936b54a11682c3900118a4">du_pucch_resource_manager</a> (<a class="el" href="../../de/d4c/classsrsran_1_1span.html">span</a>&lt; <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../de/dad/structsrsran_1_1du__cell__config.html">du_cell_config</a> &gt; <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>, <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_pucch_grants_per_slot_</a>)</td></tr>
<tr class="separator:a333f7fe234936b54a11682c3900118a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18f8518e6bcae092bdb5334e0beea853" id="r_a18f8518e6bcae092bdb5334e0beea853"><td class="memItemLeft" align="right" valign="top"><a id="a18f8518e6bcae092bdb5334e0beea853" name="a18f8518e6bcae092bdb5334e0beea853"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>du_pucch_resource_manager</b> (<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d2/dbc/classsrsran_1_1srs__du_1_1du__pucch__resource__manager.html">du_pucch_resource_manager</a> &amp;)=<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">delete</a></td></tr>
<tr class="separator:a18f8518e6bcae092bdb5334e0beea853"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d7b7e25ba691bb56d2903f827157b69" id="r_a7d7b7e25ba691bb56d2903f827157b69"><td class="memItemLeft" align="right" valign="top"><a id="a7d7b7e25ba691bb56d2903f827157b69" name="a7d7b7e25ba691bb56d2903f827157b69"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>du_pucch_resource_manager</b> (<a class="el" href="../../d2/dbc/classsrsran_1_1srs__du_1_1du__pucch__resource__manager.html">du_pucch_resource_manager</a> &amp;&amp;)=<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">delete</a></td></tr>
<tr class="separator:a7d7b7e25ba691bb56d2903f827157b69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99e8fbd21114494430ba9c60f52343dc" id="r_a99e8fbd21114494430ba9c60f52343dc"><td class="memItemLeft" align="right" valign="top"><a id="a99e8fbd21114494430ba9c60f52343dc" name="a99e8fbd21114494430ba9c60f52343dc"></a>
<a class="el" href="../../d2/dbc/classsrsran_1_1srs__du_1_1du__pucch__resource__manager.html">du_pucch_resource_manager</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d2/dbc/classsrsran_1_1srs__du_1_1du__pucch__resource__manager.html">du_pucch_resource_manager</a> &amp;)=<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">delete</a></td></tr>
<tr class="separator:a99e8fbd21114494430ba9c60f52343dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af473b968a7a6bee2b557598f3fe30d36" id="r_af473b968a7a6bee2b557598f3fe30d36"><td class="memItemLeft" align="right" valign="top"><a id="af473b968a7a6bee2b557598f3fe30d36" name="af473b968a7a6bee2b557598f3fe30d36"></a>
<a class="el" href="../../d2/dbc/classsrsran_1_1srs__du_1_1du__pucch__resource__manager.html">du_pucch_resource_manager</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (<a class="el" href="../../d2/dbc/classsrsran_1_1srs__du_1_1du__pucch__resource__manager.html">du_pucch_resource_manager</a> &amp;&amp;)=<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">delete</a></td></tr>
<tr class="separator:af473b968a7a6bee2b557598f3fe30d36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fdd5b5a574bb52e9cc1e6fec03900bb" id="r_a2fdd5b5a574bb52e9cc1e6fec03900bb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/db9/classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2fdd5b5a574bb52e9cc1e6fec03900bb">alloc_resources</a> (<a class="el" href="../../d5/d0e/structsrsran_1_1srs__du_1_1cell__group__config.html">cell_group_config</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>)</td></tr>
<tr class="memdesc:a2fdd5b5a574bb52e9cc1e6fec03900bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate PUCCH resources for a given UE. The resources are stored in the UE's cell group config.  <br /></td></tr>
<tr class="separator:a2fdd5b5a574bb52e9cc1e6fec03900bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3eac0634989efb5854976b9218d6daea" id="r_a3eac0634989efb5854976b9218d6daea"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3eac0634989efb5854976b9218d6daea">dealloc_resources</a> (<a class="el" href="../../d5/d0e/structsrsran_1_1srs__du_1_1cell__group__config.html">cell_group_config</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>)</td></tr>
<tr class="memdesc:a3eac0634989efb5854976b9218d6daea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deallocate PUCCH resources previously given to a UE. The resources are returned back to a pool.  <br /></td></tr>
<tr class="separator:a3eac0634989efb5854976b9218d6daea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class manages the allocation of RAN PUCCH Resources to DU UEs. For instance, this class ensures that UEs do not collide in the usage of the PUCCH for SRs and CSI. For HARQ-ACKs, we rely on the MAC scheduler to ensure no collisions take place in the PUCCH. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a333f7fe234936b54a11682c3900118a4" name="a333f7fe234936b54a11682c3900118a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a333f7fe234936b54a11682c3900118a4">&#9670;&#160;</a></span>du_pucch_resource_manager()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">du_pucch_resource_manager::du_pucch_resource_manager </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d4c/classsrsran_1_1span.html">span</a>&lt; <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../de/dad/structsrsran_1_1du__cell__config.html">du_cell_config</a> &gt;</td>          <td class="paramname"><span class="paramname"><em>cell_cfg_list_</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a></td>          <td class="paramname"><span class="paramname"><em>max_pucch_grants_per_slot_</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   58</span>                                                                                                            :</div>
<div class="line"><span class="lineno">   59</span>  user_defined_pucch_cfg(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].pucch_cfg),</div>
<div class="line"><span class="lineno">   60</span>  default_pucch_res_list(</div>
<div class="line"><span class="lineno">   61</span>      srs_du::generate_cell_pucch_res_list(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].pucch_cfg.nof_ue_pucch_f1_res_harq.to_uint() *</div>
<div class="line"><span class="lineno">   62</span>                                                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].pucch_cfg.nof_cell_harq_pucch_res_sets +</div>
<div class="line"><span class="lineno">   63</span>                                               <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].pucch_cfg.nof_sr_resources,</div>
<div class="line"><span class="lineno">   64</span>                                           <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].pucch_cfg.nof_ue_pucch_f2_res_harq.to_uint() *</div>
<div class="line"><span class="lineno">   65</span>                                                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].pucch_cfg.nof_cell_harq_pucch_res_sets +</div>
<div class="line"><span class="lineno">   66</span>                                               <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].pucch_cfg.nof_csi_resources,</div>
<div class="line"><span class="lineno">   67</span>                                           <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].pucch_cfg.f1_params,</div>
<div class="line"><span class="lineno">   68</span>                                           <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].pucch_cfg.f2_params,</div>
<div class="line"><span class="lineno">   69</span>                                           <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].ul_cfg_common.init_ul_bwp.generic_params.crbs.length())),</div>
<div class="line"><span class="lineno">   70</span>  default_pucch_cfg(</div>
<div class="line"><span class="lineno">   71</span>      build_default_pucch_cfg(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].ue_ded_serv_cell_cfg.ul_config-&gt;init_ul_bwp.pucch_cfg.value(),</div>
<div class="line"><span class="lineno">   72</span>                              user_defined_pucch_cfg)),</div>
<div class="line"><span class="lineno">   73</span>  default_csi_report_cfg([&amp;<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>]() -&gt; <a class="code hl_class" href="../../d1/d57/classsrsran_1_1optional.html">optional&lt;csi_report_config&gt;</a> {</div>
<div class="line"><span class="lineno">   74</span>    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_meas</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].ue_ded_serv_cell_cfg.csi_meas_cfg;</div>
<div class="line"><span class="lineno">   75</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_meas</a>.has_value() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_meas</a>-&gt;csi_report_cfg_list.empty()) {</div>
<div class="line"><span class="lineno">   76</span>      return csi_meas-&gt;csi_report_cfg_list[0];</div>
<div class="line"><span class="lineno">   77</span>    }</div>
<div class="line"><span class="lineno">   78</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d9/def/namespacesrsran.html#a2e817fa4d4a8084eb1746ee8d1440679">nullopt</a>;</div>
<div class="line"><span class="lineno">   79</span>  }()),</div>
<div class="line"><span class="lineno">   80</span>  <span class="comment">// Leave 1 PUCCH grants for HARQ ACKs.</span></div>
<div class="line"><span class="lineno">   81</span>  max_pucch_grants_per_slot(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_pucch_grants_per_slot_</a> - 1U),</div>
<div class="line"><span class="lineno">   82</span>  cells(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>.size())</div>
<div class="line"><span class="lineno">   83</span>{</div>
<div class="line"><span class="lineno">   84</span>  srsran_assert(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> default_pucch_cfg.<a class="code hl_variable" href="../../d6/d83/structsrsran_1_1pucch__config.html#a9cd322ac5ec3ab428121e1a82f81d0cf">sr_res_list</a>.empty(), <span class="stringliteral">&quot;There must be at least one SR Resource&quot;</span>);</div>
<div class="line"><span class="lineno">   85</span> </div>
<div class="line"><span class="lineno">   86</span>  <span class="comment">// Compute fundamental SR period.</span></div>
<div class="line"><span class="lineno">   87</span>  <span class="comment">// TODO: Handle more than one SR period.</span></div>
<div class="line"><span class="lineno">   88</span>  sr_period_slots = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a359275bb921a72119f37ed0df37ae091">sr_periodicity_to_slot</a>(default_pucch_cfg.<a class="code hl_variable" href="../../d6/d83/structsrsran_1_1pucch__config.html#a9cd322ac5ec3ab428121e1a82f81d0cf">sr_res_list</a>[0].period);</div>
<div class="line"><span class="lineno">   89</span> </div>
<div class="line"><span class="lineno">   90</span>  <span class="comment">// Compute fundamental CSI report period.</span></div>
<div class="line"><span class="lineno">   91</span>  <span class="comment">// TODO: Handle more than one CSI report period.</span></div>
<div class="line"><span class="lineno">   92</span>  <span class="keywordflow">if</span> (default_csi_report_cfg.has_value()) {</div>
<div class="line"><span class="lineno">   93</span>    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; rep = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">srsran::variant_get&lt;csi_report_config::periodic_or_semi_persistent_report_on_pucch&gt;</a>(</div>
<div class="line"><span class="lineno">   94</span>        default_csi_report_cfg-&gt;report_cfg_type);</div>
<div class="line"><span class="lineno">   95</span>    csi_period_slots = csi_report_periodicity_to_uint(rep.report_slot_period);</div>
<div class="line"><span class="lineno">   96</span>  }</div>
<div class="line"><span class="lineno">   97</span>  <span class="comment">// As the SR and CSI period might not be one a multiple of each other, we compute the Least Common Multiple (LCM) of</span></div>
<div class="line"><span class="lineno">   98</span>  <span class="comment">// the two periods.</span></div>
<div class="line"><span class="lineno">   99</span>  lcm_csi_sr_period = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a6b6b94c2d0fec617b6da702c6478140b">lcm</a>(sr_period_slots, csi_period_slots);</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>  <span class="comment">// Setup RAN resources per cell.</span></div>
<div class="line"><span class="lineno">  102</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; cell : cells) {</div>
<div class="line"><span class="lineno">  103</span>    <span class="comment">// Initialize the PUCCH grants-per-slot counter.</span></div>
<div class="line"><span class="lineno">  104</span>    cell.pucch_grants_per_slot_cnt.resize(lcm_csi_sr_period, 0);</div>
<div class="line"><span class="lineno">  105</span> </div>
<div class="line"><span class="lineno">  106</span>    <span class="comment">// Set up the pucch_res_id for the resource used for SR.</span></div>
<div class="line"><span class="lineno">  107</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_idx</a> = 0; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_idx</a> &lt; user_defined_pucch_cfg.<a class="code hl_variable" href="../../d3/dc2/structsrsran_1_1pucch__builder__params.html#a7c6e654d337586250eb8544ee3fad6fd">nof_sr_resources</a>; ++<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_idx</a>) {</div>
<div class="line"><span class="lineno">  108</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> offset = 0; offset != sr_period_slots; ++offset) {</div>
<div class="line"><span class="lineno">  109</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].tdd_ul_dl_cfg_common.has_value()) {</div>
<div class="line"><span class="lineno">  110</span>          <span class="keyword">const</span> <a class="code hl_struct" href="../../d9/df8/structsrsran_1_1tdd__ul__dl__config__common.html">tdd_ul_dl_config_common</a>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">tdd_cfg</a> = *<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].tdd_ul_dl_cfg_common;</div>
<div class="line"><span class="lineno">  111</span>          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> slot_index = offset % (<a class="code hl_variable" href="../../d9/def/namespacesrsran.html#afe120c5fa59fc13e75fa47b6161f3ad3">NOF_SUBFRAMES_PER_FRAME</a> * <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a45b408115d2fba72e768ef375c59da19">get_nof_slots_per_subframe</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">tdd_cfg</a>.ref_scs));</div>
<div class="line"><span class="lineno">  112</span>          <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#aa7df181c0c8aa3e214580bccdd5d2cdc">srsran::get_active_tdd_ul_symbols</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">tdd_cfg</a>, slot_index, <a class="code hl_enumvalue" href="../../d4/d8b/classsrsran_1_1cyclic__prefix.html#adb112068f1eb62e47a74b63b90d92b65a464683a58c4e07f845370a0eb40a0b67">cyclic_prefix::NORMAL</a>).<a class="code hl_function" href="../../d4/d3c/classsrsran_1_1interval.html#ac47a815285449ead553a43a0b5f85f63">length</a>() !=</div>
<div class="line"><span class="lineno">  113</span>              <a class="code hl_variable" href="../../d9/def/namespacesrsran.html#a2ec632168c0292dc5fd78c9bd35f159b">NOF_OFDM_SYM_PER_SLOT_NORMAL_CP</a>) {</div>
<div class="line"><span class="lineno">  114</span>            <span class="comment">// UL disabled for this slot.</span></div>
<div class="line"><span class="lineno">  115</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  116</span>          }</div>
<div class="line"><span class="lineno">  117</span>        }</div>
<div class="line"><span class="lineno">  118</span>        cell.sr_res_offset_free_list.emplace_back(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_idx</a>, offset);</div>
<div class="line"><span class="lineno">  119</span>      }</div>
<div class="line"><span class="lineno">  120</span>    }</div>
<div class="line"><span class="lineno">  121</span> </div>
<div class="line"><span class="lineno">  122</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_res_idx</a> = 0; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_res_idx</a> &lt; user_defined_pucch_cfg.<a class="code hl_variable" href="../../d3/dc2/structsrsran_1_1pucch__builder__params.html#a1d4f9b7c4f163907599867ae40c9210b">nof_csi_resources</a>; ++<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_res_idx</a>) {</div>
<div class="line"><span class="lineno">  123</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> offset = 0; offset != csi_period_slots; ++offset) {</div>
<div class="line"><span class="lineno">  124</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].tdd_ul_dl_cfg_common.has_value()) {</div>
<div class="line"><span class="lineno">  125</span>          <span class="keyword">const</span> <a class="code hl_struct" href="../../d9/df8/structsrsran_1_1tdd__ul__dl__config__common.html">tdd_ul_dl_config_common</a>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">tdd_cfg</a> = *<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_cfg_list_</a>[0].tdd_ul_dl_cfg_common;</div>
<div class="line"><span class="lineno">  126</span>          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> slot_index = offset % (<a class="code hl_variable" href="../../d9/def/namespacesrsran.html#afe120c5fa59fc13e75fa47b6161f3ad3">NOF_SUBFRAMES_PER_FRAME</a> * <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a45b408115d2fba72e768ef375c59da19">get_nof_slots_per_subframe</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">tdd_cfg</a>.ref_scs));</div>
<div class="line"><span class="lineno">  127</span>          <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#aa7df181c0c8aa3e214580bccdd5d2cdc">srsran::get_active_tdd_ul_symbols</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">tdd_cfg</a>, slot_index, <a class="code hl_enumvalue" href="../../d4/d8b/classsrsran_1_1cyclic__prefix.html#adb112068f1eb62e47a74b63b90d92b65a464683a58c4e07f845370a0eb40a0b67">cyclic_prefix::NORMAL</a>).<a class="code hl_function" href="../../d4/d3c/classsrsran_1_1interval.html#ac47a815285449ead553a43a0b5f85f63">length</a>() !=</div>
<div class="line"><span class="lineno">  128</span>              <a class="code hl_variable" href="../../d9/def/namespacesrsran.html#a2ec632168c0292dc5fd78c9bd35f159b">NOF_OFDM_SYM_PER_SLOT_NORMAL_CP</a>) {</div>
<div class="line"><span class="lineno">  129</span>            <span class="comment">// UL disabled for this slot.</span></div>
<div class="line"><span class="lineno">  130</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  131</span>          }</div>
<div class="line"><span class="lineno">  132</span>        }</div>
<div class="line"><span class="lineno">  133</span>        cell.csi_res_offset_free_list.emplace_back(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_res_idx</a>, offset);</div>
<div class="line"><span class="lineno">  134</span>      }</div>
<div class="line"><span class="lineno">  135</span>    }</div>
<div class="line"><span class="lineno">  136</span>  }</div>
<div class="line"><span class="lineno">  137</span>}</div>
<div class="ttc" id="aclasssrsran_1_1cyclic__prefix_html_adb112068f1eb62e47a74b63b90d92b65a464683a58c4e07f845370a0eb40a0b67"><div class="ttname"><a href="../../d4/d8b/classsrsran_1_1cyclic__prefix.html#adb112068f1eb62e47a74b63b90d92b65a464683a58c4e07f845370a0eb40a0b67">srsran::cyclic_prefix::NORMAL</a></div><div class="ttdeci">@ NORMAL</div><div class="ttdoc">Indicates normal cyclic prefix length.</div><div class="ttdef"><b>Definition</b> cyclic_prefix.h:41</div></div>
<div class="ttc" id="aclasssrsran_1_1interval_html_ac47a815285449ead553a43a0b5f85f63"><div class="ttname"><a href="../../d4/d3c/classsrsran_1_1interval.html#ac47a815285449ead553a43a0b5f85f63">srsran::interval::length</a></div><div class="ttdeci">length_type length() const</div><div class="ttdoc">Interval length. e.g. [0, 1), [0, 1], [0 .. 1) have length 1. [0 .. 1] has length 2.</div><div class="ttdef"><b>Definition</b> interval.h:63</div></div>
<div class="ttc" id="aclasssrsran_1_1optional_html"><div class="ttname"><a href="../../d1/d57/classsrsran_1_1optional.html">srsran::optional</a></div><div class="ttdoc">Optional objects.</div><div class="ttdef"><b>Definition</b> optional.h:281</div></div>
<div class="ttc" id="anamespacesrsran_html_a2e817fa4d4a8084eb1746ee8d1440679"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a2e817fa4d4a8084eb1746ee8d1440679">srsran::nullopt</a></div><div class="ttdeci">constexpr nullopt_t nullopt</div><div class="ttdoc">Initializer for empty optional objects.</div><div class="ttdef"><b>Definition</b> optional.h:39</div></div>
<div class="ttc" id="anamespacesrsran_html_a2ec632168c0292dc5fd78c9bd35f159b"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a2ec632168c0292dc5fd78c9bd35f159b">srsran::NOF_OFDM_SYM_PER_SLOT_NORMAL_CP</a></div><div class="ttdeci">const unsigned NOF_OFDM_SYM_PER_SLOT_NORMAL_CP</div><div class="ttdoc">The number of OFDM symbols per slot is constant for all numerologies.</div><div class="ttdef"><b>Definition</b> frame_types.h:30</div></div>
<div class="ttc" id="anamespacesrsran_html_a359275bb921a72119f37ed0df37ae091"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a359275bb921a72119f37ed0df37ae091">srsran::sr_periodicity_to_slot</a></div><div class="ttdeci">unsigned sr_periodicity_to_slot(sr_periodicity period)</div><div class="ttdoc">Convert unsigned to scheduling_request_id.</div><div class="ttdef"><b>Definition</b> sr_configuration.h:65</div></div>
<div class="ttc" id="anamespacesrsran_html_a45b408115d2fba72e768ef375c59da19"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a45b408115d2fba72e768ef375c59da19">srsran::get_nof_slots_per_subframe</a></div><div class="ttdeci">constexpr unsigned get_nof_slots_per_subframe(subcarrier_spacing scs)</div><div class="ttdoc">Calculates number of slots per subframe.</div><div class="ttdef"><b>Definition</b> subcarrier_spacing.h:106</div></div>
<div class="ttc" id="anamespacesrsran_html_a58e7c9f2c51a9ad6a0899b46d5315723"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">srsran::mask_msb_ones</a></div><div class="ttdeci">constexpr Integer mask_msb_ones(size_t N)</div><div class="ttdoc">Returns an unsigned integer with the N most significant bits (MSB) set to one, and the remaining bits...</div><div class="ttdef"><b>Definition</b> bounded_bitset.h:65</div></div>
<div class="ttc" id="anamespacesrsran_html_a6b6b94c2d0fec617b6da702c6478140b"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a6b6b94c2d0fec617b6da702c6478140b">srsran::lcm</a></div><div class="ttdeci">Integer lcm(Integer a, Integer b)</div><div class="ttdoc">Calculates the least common multiplier (LCM) of two integers.</div><div class="ttdef"><b>Definition</b> gcd.h:48</div></div>
<div class="ttc" id="anamespacesrsran_html_aa7df181c0c8aa3e214580bccdd5d2cdc"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#aa7df181c0c8aa3e214580bccdd5d2cdc">srsran::get_active_tdd_ul_symbols</a></div><div class="ttdeci">ofdm_symbol_range get_active_tdd_ul_symbols(const tdd_ul_dl_config_common &amp;cfg, unsigned slot_index, cyclic_prefix cp)</div><div class="ttdoc">Calculates the number of active UL symbols in the current slot_index.</div><div class="ttdef"><b>Definition</b> tdd_ul_dl_config.cpp:91</div></div>
<div class="ttc" id="anamespacesrsran_html_afe120c5fa59fc13e75fa47b6161f3ad3"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#afe120c5fa59fc13e75fa47b6161f3ad3">srsran::NOF_SUBFRAMES_PER_FRAME</a></div><div class="ttdeci">constexpr uint32_t NOF_SUBFRAMES_PER_FRAME</div><div class="ttdoc">Number of subframers per frame. This constant doesn't depend on the numerology used.</div><div class="ttdef"><b>Definition</b> slot_point.h:32</div></div>
<div class="ttc" id="astructsrsran_1_1pucch__builder__params_html_a1d4f9b7c4f163907599867ae40c9210b"><div class="ttname"><a href="../../d3/dc2/structsrsran_1_1pucch__builder__params.html#a1d4f9b7c4f163907599867ae40c9210b">srsran::pucch_builder_params::nof_csi_resources</a></div><div class="ttdeci">unsigned nof_csi_resources</div><div class="ttdef"><b>Definition</b> du_cell_config.h:91</div></div>
<div class="ttc" id="astructsrsran_1_1pucch__builder__params_html_a7c6e654d337586250eb8544ee3fad6fd"><div class="ttname"><a href="../../d3/dc2/structsrsran_1_1pucch__builder__params.html#a7c6e654d337586250eb8544ee3fad6fd">srsran::pucch_builder_params::nof_sr_resources</a></div><div class="ttdeci">unsigned nof_sr_resources</div><div class="ttdef"><b>Definition</b> du_cell_config.h:88</div></div>
<div class="ttc" id="astructsrsran_1_1pucch__config_html_a9cd322ac5ec3ab428121e1a82f81d0cf"><div class="ttname"><a href="../../d6/d83/structsrsran_1_1pucch__config.html#a9cd322ac5ec3ab428121e1a82f81d0cf">srsran::pucch_config::sr_res_list</a></div><div class="ttdeci">static_vector&lt; scheduling_request_resource_config, MAX_NOF_SR_RESOURCES &gt; sr_res_list</div><div class="ttdoc">List of SchedulingRequestResourceConfig.</div><div class="ttdef"><b>Definition</b> pucch_configuration.h:211</div></div>
<div class="ttc" id="astructsrsran_1_1tdd__ul__dl__config__common_html"><div class="ttname"><a href="../../d9/df8/structsrsran_1_1tdd__ul__dl__config__common.html">srsran::tdd_ul_dl_config_common</a></div><div class="ttdef"><b>Definition</b> tdd_ul_dl_config.h:47</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a2fdd5b5a574bb52e9cc1e6fec03900bb" name="a2fdd5b5a574bb52e9cc1e6fec03900bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fdd5b5a574bb52e9cc1e6fec03900bb">&#9670;&#160;</a></span>alloc_resources()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/db9/classbool.html">bool</a> du_pucch_resource_manager::alloc_resources </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d5/d0e/structsrsran_1_1srs__du_1_1cell__group__config.html">cell_group_config</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>cell_grp_cfg</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate PUCCH resources for a given UE. The resources are stored in the UE's cell group config. </p>
<dl class="section return"><dt>Returns</dt><dd>true if allocation was successful. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  217</span>{</div>
<div class="line"><span class="lineno">  218</span>  <span class="comment">// Allocation of SR PUCCH offset.</span></div>
<div class="line"><span class="lineno">  219</span>  <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.ul_config-&gt;init_ul_bwp.pucch_cfg = default_pucch_cfg;</div>
<div class="line"><span class="lineno">  220</span>  <span class="keyword">auto</span>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">free_sr_list</a>  = cells[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.cell_index].sr_res_offset_free_list;</div>
<div class="line"><span class="lineno">  221</span>  <span class="keyword">auto</span>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">free_csi_list</a> = cells[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.cell_index].csi_res_offset_free_list;</div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>  <span class="comment">// Verify where there are SR and CSI resources to allocate a new UE.</span></div>
<div class="line"><span class="lineno">  224</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">free_sr_list</a>.empty() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">or</a> (default_csi_report_cfg.has_value() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">free_csi_list</a>.empty())) {</div>
<div class="line"><span class="lineno">  225</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  226</span>  }</div>
<div class="line"><span class="lineno">  227</span> </div>
<div class="line"><span class="lineno">  228</span>  <a class="code hl_class" href="../../d1/d57/classsrsran_1_1optional.html">optional&lt;std::pair&lt;unsigned, unsigned&gt;</a>&gt; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset</a>;</div>
<div class="line"><span class="lineno">  229</span>  <a class="code hl_class" href="../../d1/d57/classsrsran_1_1optional.html">optional&lt;std::pair&lt;unsigned, unsigned&gt;</a>&gt; csi_res_offset;</div>
<div class="line"><span class="lineno">  230</span>  <span class="keyword">auto</span>                                    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset_it</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">free_sr_list</a>.begin();</div>
<div class="line"><span class="lineno">  231</span>  <span class="comment">// Iterate over the list of SR resource/offsets and find the first one that doesn&#39;t exceed the maximum number of PUCCH</span></div>
<div class="line"><span class="lineno">  232</span>  <span class="comment">// grants.</span></div>
<div class="line"><span class="lineno">  233</span>  <span class="keywordflow">while</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset_it</a> != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">free_sr_list</a>.end()) {</div>
<div class="line"><span class="lineno">  234</span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_cnt_exceeded</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_off</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset_it</a>-&gt;second; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_off</a> &lt; lcm_csi_sr_period; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_off</a> += sr_period_slots) {</div>
<div class="line"><span class="lineno">  236</span>      srsran_assert(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_off</a> &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(cells[0].pucch_grants_per_slot_cnt.size()),</div>
<div class="line"><span class="lineno">  237</span>                    <span class="stringliteral">&quot;Index exceeds the size of the PUCCH grants vector&quot;</span>);</div>
<div class="line"><span class="lineno">  238</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_cnt_exceeded</a> = cells[0].pucch_grants_per_slot_cnt[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_off</a>] &gt;= max_pucch_grants_per_slot;</div>
<div class="line"><span class="lineno">  239</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_cnt_exceeded</a>) {</div>
<div class="line"><span class="lineno">  240</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  241</span>      }</div>
<div class="line"><span class="lineno">  242</span>    }</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>    <span class="comment">// If the PUCCH is exceeded, proceed with the next SR resource/offset pair.</span></div>
<div class="line"><span class="lineno">  245</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_cnt_exceeded</a>) {</div>
<div class="line"><span class="lineno">  246</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> default_csi_report_cfg.has_value()) {</div>
<div class="line"><span class="lineno">  247</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset</a> = *<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset_it</a>;</div>
<div class="line"><span class="lineno">  248</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">free_sr_list</a>.erase(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset_it</a>);</div>
<div class="line"><span class="lineno">  249</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  250</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  251</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.csi_meas_cfg-&gt;csi_report_cfg_list = {*default_csi_report_cfg};</div>
<div class="line"><span class="lineno">  252</span> </div>
<div class="line"><span class="lineno">  253</span>        <span class="keyword">auto</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">optimal_res_it</a> = get_csi_resource_offset(</div>
<div class="line"><span class="lineno">  254</span>            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.csi_meas_cfg.value(), <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset_it</a>-&gt;second, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">free_csi_list</a>);</div>
<div class="line"><span class="lineno">  255</span> </div>
<div class="line"><span class="lineno">  256</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">optimal_res_it</a> != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">free_csi_list</a>.end()) {</div>
<div class="line"><span class="lineno">  257</span>          <span class="comment">// At this point the allocation has been successful. Remove SR and CSI resources assigned to this UE from the</span></div>
<div class="line"><span class="lineno">  258</span>          <span class="comment">// lists of free resources.</span></div>
<div class="line"><span class="lineno">  259</span>          csi_res_offset = *<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">optimal_res_it</a>;</div>
<div class="line"><span class="lineno">  260</span>          <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">free_csi_list</a>.erase(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">optimal_res_it</a>);</div>
<div class="line"><span class="lineno">  261</span>          <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset</a> = *<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset_it</a>;</div>
<div class="line"><span class="lineno">  262</span>          <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">free_sr_list</a>.erase(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset_it</a>);</div>
<div class="line"><span class="lineno">  263</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  264</span>        }</div>
<div class="line"><span class="lineno">  265</span>      }</div>
<div class="line"><span class="lineno">  266</span>    }</div>
<div class="line"><span class="lineno">  267</span>    ++<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset_it</a>;</div>
<div class="line"><span class="lineno">  268</span>  }</div>
<div class="line"><span class="lineno">  269</span> </div>
<div class="line"><span class="lineno">  270</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset</a>.has_value()) {</div>
<div class="line"><span class="lineno">  271</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  272</span>  }</div>
<div class="line"><span class="lineno">  273</span> </div>
<div class="line"><span class="lineno">  274</span>  <span class="comment">// Update the PUCCH grants-per-slot counter.</span></div>
<div class="line"><span class="lineno">  275</span>  std::set&lt;unsigned&gt; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_sr_offset_for_pucch_cnt</a> = compute_sr_csi_pucch_offsets(</div>
<div class="line"><span class="lineno">  276</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset</a>.value().second, default_csi_report_cfg.has_value() ? csi_res_offset.value().second : 0);</div>
<div class="line"><span class="lineno">  277</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> offset : <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_sr_offset_for_pucch_cnt</a>) {</div>
<div class="line"><span class="lineno">  278</span>    srsran_assert(offset &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(cells[0].pucch_grants_per_slot_cnt.size()),</div>
<div class="line"><span class="lineno">  279</span>                  <span class="stringliteral">&quot;Index exceeds the size of the PUCCH grants vector&quot;</span>);</div>
<div class="line"><span class="lineno">  280</span>    ++cells[0].pucch_grants_per_slot_cnt[offset];</div>
<div class="line"><span class="lineno">  281</span>  }</div>
<div class="line"><span class="lineno">  282</span> </div>
<div class="line"><span class="lineno">  283</span>  <span class="comment">// Generate PUCCH resource list for the UE.</span></div>
<div class="line"><span class="lineno">  284</span>  srs_du::ue_pucch_config_builder(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg,</div>
<div class="line"><span class="lineno">  285</span>                                  default_pucch_res_list,</div>
<div class="line"><span class="lineno">  286</span>                                  cells[0].ue_idx,</div>
<div class="line"><span class="lineno">  287</span>                                  <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset</a>.value().first,</div>
<div class="line"><span class="lineno">  288</span>                                  csi_res_offset.<a class="code hl_function" href="../../d1/d57/classsrsran_1_1optional.html#a2f160539a76c3f4dd0b50b339b81202e">has_value</a>() ? csi_res_offset.value().first : 0,</div>
<div class="line"><span class="lineno">  289</span>                                  user_defined_pucch_cfg.nof_ue_pucch_f1_res_harq,</div>
<div class="line"><span class="lineno">  290</span>                                  user_defined_pucch_cfg.nof_ue_pucch_f2_res_harq,</div>
<div class="line"><span class="lineno">  291</span>                                  user_defined_pucch_cfg.nof_cell_harq_pucch_res_sets,</div>
<div class="line"><span class="lineno">  292</span>                                  user_defined_pucch_cfg.nof_sr_resources,</div>
<div class="line"><span class="lineno">  293</span>                                  user_defined_pucch_cfg.nof_csi_resources);</div>
<div class="line"><span class="lineno">  294</span> </div>
<div class="line"><span class="lineno">  295</span>  <span class="comment">// Set the offsets for SR and CSI.</span></div>
<div class="line"><span class="lineno">  296</span>  <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.ul_config-&gt;init_ul_bwp.pucch_cfg-&gt;sr_res_list.front().offset =</div>
<div class="line"><span class="lineno">  297</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_res_offset</a>.value().second;</div>
<div class="line"><span class="lineno">  298</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.csi_meas_cfg.has_value()) {</div>
<div class="line"><span class="lineno">  299</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">srsran::variant_get&lt;csi_report_config::periodic_or_semi_persistent_report_on_pucch&gt;</a>(</div>
<div class="line"><span class="lineno">  300</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.csi_meas_cfg-&gt;csi_report_cfg_list[0].report_cfg_type)</div>
<div class="line"><span class="lineno">  301</span>        .report_slot_offset = csi_res_offset.value().second;</div>
<div class="line"><span class="lineno">  302</span>  }</div>
<div class="line"><span class="lineno">  303</span> </div>
<div class="line"><span class="lineno">  304</span>  ++cells[0].ue_idx;</div>
<div class="line"><span class="lineno">  305</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  306</span>}</div>
<div class="ttc" id="aclasssrsran_1_1optional_html_a2f160539a76c3f4dd0b50b339b81202e"><div class="ttname"><a href="../../d1/d57/classsrsran_1_1optional.html#a2f160539a76c3f4dd0b50b339b81202e">srsran::optional::has_value</a></div><div class="ttdeci">constexpr bool has_value() const noexcept</div><div class="ttdef"><b>Definition</b> optional.h:298</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3eac0634989efb5854976b9218d6daea" name="a3eac0634989efb5854976b9218d6daea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3eac0634989efb5854976b9218d6daea">&#9670;&#160;</a></span>dealloc_resources()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a> du_pucch_resource_manager::dealloc_resources </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d5/d0e/structsrsran_1_1srs__du_1_1cell__group__config.html">cell_group_config</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>cell_grp_cfg</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deallocate PUCCH resources previously given to a UE. The resources are returned back to a pool. </p>
<div class="fragment"><div class="line"><span class="lineno">  309</span>{</div>
<div class="line"><span class="lineno">  310</span>  <span class="keyword">auto</span>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_to_deallocate</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.ul_config-&gt;init_ul_bwp.pucch_cfg-&gt;sr_res_list.front();</div>
<div class="line"><span class="lineno">  311</span>  cells[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.cell_index].sr_res_offset_free_list.emplace_back(</div>
<div class="line"><span class="lineno">  312</span>      pucch_res_idx_to_sr_du_res_idx(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_to_deallocate</a>.pucch_res_id.cell_res_id), <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_to_deallocate</a>.offset);</div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>  <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_offset</a> = 0;</div>
<div class="line"><span class="lineno">  315</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.csi_meas_cfg.has_value()) {</div>
<div class="line"><span class="lineno">  316</span>    <span class="keyword">auto</span>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">target_csi_cfg</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">srsran::variant_get&lt;csi_report_config::periodic_or_semi_persistent_report_on_pucch&gt;</a>(</div>
<div class="line"><span class="lineno">  317</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.csi_meas_cfg-&gt;csi_report_cfg_list[0].report_cfg_type);</div>
<div class="line"><span class="lineno">  318</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_offset</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">target_csi_cfg</a>.report_slot_offset;</div>
<div class="line"><span class="lineno">  319</span>    cells[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">cell_grp_cfg</a>.cells[0].serv_cell_cfg.cell_index].csi_res_offset_free_list.emplace_back(</div>
<div class="line"><span class="lineno">  320</span>        pucch_res_idx_to_csi_du_res_idx(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">target_csi_cfg</a>.pucch_csi_res_list.front().pucch_res_id.cell_res_id),</div>
<div class="line"><span class="lineno">  321</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_offset</a>);</div>
<div class="line"><span class="lineno">  322</span>  }</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>  <span class="comment">// Remove the SR and CSI offsets from the PUCCH grants-per-slot counter.</span></div>
<div class="line"><span class="lineno">  325</span>  std::set&lt;unsigned&gt; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_sr_offset_for_pucch_cnt</a> = compute_sr_csi_pucch_offsets(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">sr_to_deallocate</a>.offset, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_offset</a>);</div>
<div class="line"><span class="lineno">  326</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> offset : <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_sr_offset_for_pucch_cnt</a>) {</div>
<div class="line"><span class="lineno">  327</span>    srsran_assert(offset &lt; cells[0].pucch_grants_per_slot_cnt.size(),</div>
<div class="line"><span class="lineno">  328</span>                  <span class="stringliteral">&quot;Index exceeds the size of the PUCCH grants vector&quot;</span>);</div>
<div class="line"><span class="lineno">  329</span>    srsran_assert(cells[0].pucch_grants_per_slot_cnt[offset] != 0, <span class="stringliteral">&quot;Index exceeds the size of the PUCCH grants vector&quot;</span>);</div>
<div class="line"><span class="lineno">  330</span>    --cells[0].pucch_grants_per_slot_cnt[offset];</div>
<div class="line"><span class="lineno">  331</span>  }</div>
<div class="line"><span class="lineno">  332</span>}</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>lib/du_manager/ran_resource_management/<a class="el" href="../../d0/d02/du__pucch__resource__manager_8h_source.html">du_pucch_resource_manager.h</a></li>
<li>lib/du_manager/ran_resource_management/<b>du_pucch_resource_manager.cpp</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
