<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>srsRAN Docs: srsran::ue_cell_grid_allocator Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">srsRAN Docs
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/def/namespacesrsran.html">srsran</a></li><li class="navelem"><a class="el" href="../../db/d73/classsrsran_1_1ue__cell__grid__allocator.html">ue_cell_grid_allocator</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="../../d0/d48/classsrsran_1_1ue__cell__grid__allocator-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">srsran::ue_cell_grid_allocator Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../dd/dfe/ue__cell__grid__allocator_8h_source.html">ue_cell_grid_allocator.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for srsran::ue_cell_grid_allocator:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d7e/classsrsran_1_1ue__cell__grid__allocator__inherit__graph.png" border="0" usemap="#asrsran_1_1ue__cell__grid__allocator_inherit__map" alt="Inheritance graph"/></div>
<map name="asrsran_1_1ue__cell__grid__allocator_inherit__map" id="asrsran_1_1ue__cell__grid__allocator_inherit__map">
<area shape="rect" title=" " alt="" coords="113,139,295,319"/>
<area shape="rect" href="../../d7/d64/classsrsran_1_1ue__pdsch__allocator.html" title="Allocator of PDSCH grants for UEs." alt="" coords="5,5,192,91"/>
<area shape="poly" title=" " alt="" coords="133,102,154,137,149,140,128,104"/>
<area shape="rect" href="../../d4/d82/classsrsran_1_1ue__pusch__allocator.html" title="Allocator of PUSCH grants for UEs." alt="" coords="216,5,403,91"/>
<area shape="poly" title=" " alt="" coords="280,104,259,140,254,137,275,102"/>
</map>
</div>
<div class="dynheader">
Collaboration diagram for srsran::ue_cell_grid_allocator:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/dc8/classsrsran_1_1ue__cell__grid__allocator__coll__graph.png" border="0" usemap="#asrsran_1_1ue__cell__grid__allocator_coll__map" alt="Collaboration graph"/></div>
<map name="asrsran_1_1ue__cell__grid__allocator_coll__map" id="asrsran_1_1ue__cell__grid__allocator_coll__map">
<area shape="rect" title=" " alt="" coords="113,139,295,319"/>
<area shape="rect" href="../../d7/d64/classsrsran_1_1ue__pdsch__allocator.html" title="Allocator of PDSCH grants for UEs." alt="" coords="5,5,192,91"/>
<area shape="poly" title=" " alt="" coords="133,102,154,137,149,140,128,104"/>
<area shape="rect" href="../../d4/d82/classsrsran_1_1ue__pusch__allocator.html" title="Allocator of PUSCH grants for UEs." alt="" coords="216,5,403,91"/>
<area shape="poly" title=" " alt="" coords="280,104,259,140,254,137,275,102"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:adb8863d8d70d9180925e31e2643675de" id="r_adb8863d8d70d9180925e31e2643675de"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adb8863d8d70d9180925e31e2643675de">ue_cell_grid_allocator</a> (<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html">scheduler_ue_expert_config</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">expert_cfg_</a>, <a class="el" href="../../dc/df2/classsrsran_1_1ue__repository.html">ue_repository</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ues_</a>, <a class="el" href="../../db/d1e/classsrslog_1_1detail_1_1logger__impl.html">srslog::basic_logger</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">logger_</a>)</td></tr>
<tr class="separator:adb8863d8d70d9180925e31e2643675de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afca9a3b4314e663168a9b4067be1040e" id="r_afca9a3b4314e663168a9b4067be1040e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afca9a3b4314e663168a9b4067be1040e">add_cell</a> (<a class="el" href="../../d9/def/namespacesrsran.html#a5b995a7b11715f3042e18281c21991ff">du_cell_index_t</a> cell_index, <a class="el" href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html">pdcch_resource_allocator</a> &amp;pdcch_sched, <a class="el" href="../../da/d26/classsrsran_1_1uci__allocator.html">uci_allocator</a> &amp;uci_alloc, <a class="el" href="../../df/d56/structsrsran_1_1cell__resource__allocator.html">cell_resource_allocator</a> &amp;cell_alloc)</td></tr>
<tr class="memdesc:afca9a3b4314e663168a9b4067be1040e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a new cell to the UE allocator.  <br /></td></tr>
<tr class="separator:afca9a3b4314e663168a9b4067be1040e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe20d3757ae24b91489c800a86acf968" id="r_abe20d3757ae24b91489c800a86acf968"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abe20d3757ae24b91489c800a86acf968">nof_cells</a> () <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a></td></tr>
<tr class="separator:abe20d3757ae24b91489c800a86acf968"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab623952886cb3dd29d7c84a487c3ad01" id="r_ab623952886cb3dd29d7c84a487c3ad01"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab623952886cb3dd29d7c84a487c3ad01">slot_indication</a> ()</td></tr>
<tr class="separator:ab623952886cb3dd29d7c84a487c3ad01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a783c6fceaac6d90861eeead5b94f4e4f" id="r_a783c6fceaac6d90861eeead5b94f4e4f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#adad52e6cbb57b4801efa5bf5b1c11b14">alloc_outcome</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a783c6fceaac6d90861eeead5b94f4e4f">allocate_dl_grant</a> (<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d2/d71/structsrsran_1_1ue__pdsch__grant.html">ue_pdsch_grant</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>) <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">override</a></td></tr>
<tr class="separator:a783c6fceaac6d90861eeead5b94f4e4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc2a16bc1d10fb89a00d487e6d95b805" id="r_acc2a16bc1d10fb89a00d487e6d95b805"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#adad52e6cbb57b4801efa5bf5b1c11b14">alloc_outcome</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acc2a16bc1d10fb89a00d487e6d95b805">allocate_ul_grant</a> (<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d6/dbc/structsrsran_1_1ue__pusch__grant.html">ue_pusch_grant</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>) <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">override</a></td></tr>
<tr class="separator:acc2a16bc1d10fb89a00d487e6d95b805"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class implements the <a class="el" href="../../d7/d64/classsrsran_1_1ue__pdsch__allocator.html" title="Allocator of PDSCH grants for UEs.">ue_pdsch_allocator</a> and <a class="el" href="../../d4/d82/classsrsran_1_1ue__pusch__allocator.html" title="Allocator of PUSCH grants for UEs.">ue_pusch_allocator</a> interfaces, namely the methods to allocate PDSCH and PUSCH grants in different cells, and the methods to fetch the current gNB resource grid DL and UL states. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="adb8863d8d70d9180925e31e2643675de" name="adb8863d8d70d9180925e31e2643675de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb8863d8d70d9180925e31e2643675de">&#9670;&#160;</a></span>ue_cell_grid_allocator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ue_cell_grid_allocator::ue_cell_grid_allocator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html">scheduler_ue_expert_config</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>expert_cfg_</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/df2/classsrsran_1_1ue__repository.html">ue_repository</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>ues_</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d1e/classsrslog_1_1detail_1_1logger__impl.html">srslog::basic_logger</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>logger_</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   37</span>                                                                                        :</div>
<div class="line"><span class="lineno">   38</span>  expert_cfg(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">expert_cfg_</a>), ues(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ues_</a>), logger(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">logger_</a>)</div>
<div class="line"><span class="lineno">   39</span>{</div>
<div class="line"><span class="lineno">   40</span>}</div>
<div class="ttc" id="anamespacesrsran_html_a58e7c9f2c51a9ad6a0899b46d5315723"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">srsran::mask_msb_ones</a></div><div class="ttdeci">constexpr Integer mask_msb_ones(size_t N)</div><div class="ttdoc">Returns an unsigned integer with the N most significant bits (MSB) set to one, and the remaining bits...</div><div class="ttdef"><b>Definition</b> bounded_bitset.h:65</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="afca9a3b4314e663168a9b4067be1040e" name="afca9a3b4314e663168a9b4067be1040e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afca9a3b4314e663168a9b4067be1040e">&#9670;&#160;</a></span>add_cell()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a> ue_cell_grid_allocator::add_cell </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a5b995a7b11715f3042e18281c21991ff">du_cell_index_t</a></td>          <td class="paramname"><span class="paramname"><em>cell_index</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html">pdcch_resource_allocator</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pdcch_sched</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../da/d26/classsrsran_1_1uci__allocator.html">uci_allocator</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>uci_alloc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d56/structsrsran_1_1cell__resource__allocator.html">cell_resource_allocator</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>cell_alloc</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a new cell to the UE allocator. </p>
<div class="fragment"><div class="line"><span class="lineno">   46</span>{</div>
<div class="line"><span class="lineno">   47</span>  cells.<a class="code hl_function" href="../../d7/da5/classsrsran_1_1slotted__array.html#acda4b221c7a9c1007a22571e63bc011f">emplace</a>(cell_index, cell_t{cell_index, &amp;pdcch_sched, &amp;uci_alloc, &amp;cell_alloc});</div>
<div class="line"><span class="lineno">   48</span>}</div>
<div class="ttc" id="aclasssrsran_1_1slotted__array_html_acda4b221c7a9c1007a22571e63bc011f"><div class="ttname"><a href="../../d7/da5/classsrsran_1_1slotted__array.html#acda4b221c7a9c1007a22571e63bc011f">srsran::slotted_array::emplace</a></div><div class="ttdeci">void emplace(size_t idx, Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition</b> slotted_array.h:286</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a783c6fceaac6d90861eeead5b94f4e4f" name="a783c6fceaac6d90861eeead5b94f4e4f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a783c6fceaac6d90861eeead5b94f4e4f">&#9670;&#160;</a></span>allocate_dl_grant()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/def/namespacesrsran.html#adad52e6cbb57b4801efa5bf5b1c11b14">alloc_outcome</a> ue_cell_grid_allocator::allocate_dl_grant </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d2/d71/structsrsran_1_1ue__pdsch__grant.html">ue_pdsch_grant</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>grant</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d7/d64/classsrsran_1_1ue__pdsch__allocator.html">srsran::ue_pdsch_allocator</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   57</span>{</div>
<div class="line"><span class="lineno">   58</span>  srsran_assert(ues.<a class="code hl_function" href="../../dc/df2/classsrsran_1_1ue__repository.html#a8d4b4805828ab1b0375fa323b73c3d6c">contains</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.user-&gt;ue_index), <span class="stringliteral">&quot;Invalid UE candidate index={}&quot;</span>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.user-&gt;ue_index);</div>
<div class="line"><span class="lineno">   59</span>  srsran_assert(has_cell(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index), <span class="stringliteral">&quot;Invalid UE candidate cell_index={}&quot;</span>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index);</div>
<div class="line"><span class="lineno">   60</span> </div>
<div class="line"><span class="lineno">   61</span>  <span class="keywordflow">if</span> (dl_attempts_count++ &gt;= expert_cfg.<a class="code hl_variable" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#a5c3949d57f4a7de1391f092b4288c352">max_pdcch_alloc_attempts_per_slot</a>) {</div>
<div class="line"><span class="lineno">   62</span>    logger.debug(<span class="stringliteral">&quot;Stopping DL allocations. Cause: Max number of DL PDCCH allocation attempts {} reached.&quot;</span>,</div>
<div class="line"><span class="lineno">   63</span>                 expert_cfg.<a class="code hl_variable" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#a5c3949d57f4a7de1391f092b4288c352">max_pdcch_alloc_attempts_per_slot</a>);</div>
<div class="line"><span class="lineno">   64</span>    <span class="keywordflow">return</span> alloc_outcome::skip_slot;</div>
<div class="line"><span class="lineno">   65</span>  }</div>
<div class="line"><span class="lineno">   66</span> </div>
<div class="line"><span class="lineno">   67</span>  <a class="code hl_class" href="../../de/d8c/classsrsran_1_1ue.html">ue</a>&amp; u = ues[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.user-&gt;ue_index];</div>
<div class="line"><span class="lineno">   68</span> </div>
<div class="line"><span class="lineno">   69</span>  <span class="comment">// Verify UE carrier is active.</span></div>
<div class="line"><span class="lineno">   70</span>  <a class="code hl_class" href="../../d9/d2d/classsrsran_1_1ue__cell.html">ue_cell</a>* ue_cc = u.find_cell(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index);</div>
<div class="line"><span class="lineno">   71</span>  <span class="keywordflow">if</span> (ue_cc == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">   72</span>    logger.warning(<span class="stringliteral">&quot;PDSCH allocation failed. Cause: The ue={} carrier with cell_index={} is inactive&quot;</span>,</div>
<div class="line"><span class="lineno">   73</span>                   u.ue_index,</div>
<div class="line"><span class="lineno">   74</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index);</div>
<div class="line"><span class="lineno">   75</span>    <span class="keywordflow">return</span> alloc_outcome::skip_ue;</div>
<div class="line"><span class="lineno">   76</span>  }</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html">ue_cell_configuration</a>&amp; ue_cell_cfg = ue_cc-&gt;cfg();</div>
<div class="line"><span class="lineno">   79</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../d2/d2d/classsrsran_1_1cell__configuration.html">cell_configuration</a>&amp;    cell_cfg    = ue_cell_cfg.cell_cfg_common;</div>
<div class="line"><span class="lineno">   80</span>  <span class="keyword">const</span> <a class="code hl_struct" href="../../d8/df2/structsrsran_1_1bwp__downlink__common.html">bwp_downlink_common</a>&amp;   init_dl_bwp = *ue_cell_cfg.bwp(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a41c7236508881761bbd602d002833e8e">to_bwp_id</a>(0)).dl_common;</div>
<div class="line"><span class="lineno">   81</span>  <span class="keyword">const</span> <a class="code hl_struct" href="../../d8/df2/structsrsran_1_1bwp__downlink__common.html">bwp_downlink_common</a>&amp;   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">bwp_dl_cmn</a>  = *ue_cell_cfg.bwp(ue_cc-&gt;active_bwp_id()).dl_common;</div>
<div class="line"><span class="lineno">   82</span>  <a class="code hl_class" href="../../d3/d90/classsrsran_1_1dl__harq__process.html">dl_harq_process</a>&amp;             <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>        = ue_cc-&gt;harqs.dl_harq(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.h_id);</div>
<div class="line"><span class="lineno">   83</span> </div>
<div class="line"><span class="lineno">   84</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> ue_cc-&gt;<a class="code hl_function" href="../../d9/d2d/classsrsran_1_1ue__cell.html#a5547f22a9e862e932a494f187f17b61a">is_active</a>() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.empty()) {</div>
<div class="line"><span class="lineno">   85</span>    <span class="comment">// newTxs are not allowed for inactive UEs.</span></div>
<div class="line"><span class="lineno">   86</span>    logger.warning(<span class="stringliteral">&quot;PDSCH allocation failed. Cause: The ue={} carrier with cell_index={} is inactive. New DL Tx &quot;</span></div>
<div class="line"><span class="lineno">   87</span>                   <span class="stringliteral">&quot;transmissions are not allowed.&quot;</span>,</div>
<div class="line"><span class="lineno">   88</span>                   u.ue_index,</div>
<div class="line"><span class="lineno">   89</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index);</div>
<div class="line"><span class="lineno">   90</span>    <span class="keywordflow">return</span> alloc_outcome::skip_ue;</div>
<div class="line"><span class="lineno">   91</span>  }</div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span>  <span class="comment">// Find a SearchSpace candidate.</span></div>
<div class="line"><span class="lineno">   94</span>  <span class="keyword">const</span> <a class="code hl_struct" href="../../de/d65/structsrsran_1_1search__space__info.html">search_space_info</a>* <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a> = ue_cell_cfg.<a class="code hl_function" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html#ac98203b0c951eb022845bd8b85bb6613">find_search_space</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id);</div>
<div class="line"><span class="lineno">   95</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a> == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">   96</span>    logger.warning(<span class="stringliteral">&quot;Failed to allocate PDSCH. Cause: No valid SearchSpace found.&quot;</span>);</div>
<div class="line"><span class="lineno">   97</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">   98</span>  }</div>
<div class="line"><span class="lineno">   99</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;bwp-&gt;bwp_id != ue_cc-&gt;active_bwp_id()) {</div>
<div class="line"><span class="lineno">  100</span>    logger.warning(<span class="stringliteral">&quot;Failed to allocate PDSCH. Cause: SearchSpace not valid for active BWP.&quot;</span>);</div>
<div class="line"><span class="lineno">  101</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  102</span>  }</div>
<div class="line"><span class="lineno">  103</span>  <span class="keyword">const</span> <a class="code hl_struct" href="../../dd/df5/structsrsran_1_1search__space__configuration.html">search_space_configuration</a>&amp; ss_cfg = *<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;cfg;</div>
<div class="line"><span class="lineno">  104</span>  <span class="keyword">const</span> <a class="code hl_struct" href="../../de/dcf/structsrsran_1_1coreset__configuration.html">coreset_configuration</a>&amp;      cs_cfg = *<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;coreset;</div>
<div class="line"><span class="lineno">  105</span> </div>
<div class="line"><span class="lineno">  106</span>  <a class="code hl_enumeration" href="../../d9/def/namespacesrsran.html#ac0a93d3e0aa8452e32308d5038bcad49">dci_dl_rnti_config_type</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a>;</div>
<div class="line"><span class="lineno">  107</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.empty()) {</div>
<div class="line"><span class="lineno">  108</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.last_alloc_params().dci_cfg_type;</div>
<div class="line"><span class="lineno">  109</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (u.<a class="code hl_function" href="../../de/d8c/classsrsran_1_1ue.html#a009850d92300e2137c65a21030ec7c1c">is_conres_ce_pending</a>()) {</div>
<div class="line"><span class="lineno">  110</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a> = dci_dl_rnti_config_type::tc_rnti_f1_0;</div>
<div class="line"><span class="lineno">  111</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  112</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;get_dl_dci_format() == dci_dl_format::f1_0 ? dci_dl_rnti_config_type::c_rnti_f1_0</div>
<div class="line"><span class="lineno">  113</span>                                                                   : dci_dl_rnti_config_type::c_rnti_f1_1;</div>
<div class="line"><span class="lineno">  114</span>  }</div>
<div class="line"><span class="lineno">  115</span> </div>
<div class="line"><span class="lineno">  116</span>  <span class="comment">// See 3GPP TS 38.213, clause 10.1,</span></div>
<div class="line"><span class="lineno">  117</span>  <span class="comment">// A UE monitors PDCCH candidates in one or more of the following search spaces sets</span></div>
<div class="line"><span class="lineno">  118</span>  <span class="comment">//  - a Type1-PDCCH CSS set configured by ra-SearchSpace in PDCCH-ConfigCommon for a DCI format with</span></div>
<div class="line"><span class="lineno">  119</span>  <span class="comment">//    CRC scrambled by a RA-RNTI, a MsgB-RNTI, or a TC-RNTI on the primary cell.</span></div>
<div class="line"><span class="lineno">  120</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a> == dci_dl_rnti_config_type::tc_rnti_f1_0 <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a></div>
<div class="line"><span class="lineno">  121</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id != cell_cfg.dl_cfg_common.init_dl_bwp.pdcch_common.<a class="code hl_variable" href="../../d1/d67/structsrsran_1_1pdcch__config__common.html#abb3e2d05a704bec469946b206ad200f7">ra_search_space_id</a>) {</div>
<div class="line"><span class="lineno">  122</span>    logger.info(<span class="stringliteral">&quot;Failed to allocate PDSCH. Cause: SearchSpace not valid for re-transmission of Msg4.&quot;</span>);</div>
<div class="line"><span class="lineno">  123</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  124</span>  }</div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span>  <span class="comment">// Note: Unable to multiplex CSI and SRB0 retransmission.</span></div>
<div class="line"><span class="lineno">  127</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a> == dci_dl_rnti_config_type::tc_rnti_f1_0 <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a></div>
<div class="line"><span class="lineno">  128</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> get_res_alloc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index)[0].result.dl.csi_rs.empty()) {</div>
<div class="line"><span class="lineno">  129</span>    logger.info(<span class="stringliteral">&quot;Failed to allocate PDSCH. Cause: Multiplexing of CSI-RS and TC-RNTI retransmission is not allowed.&quot;</span>);</div>
<div class="line"><span class="lineno">  130</span>    <span class="keywordflow">return</span> alloc_outcome::skip_ue;</div>
<div class="line"><span class="lineno">  131</span>  }</div>
<div class="line"><span class="lineno">  132</span> </div>
<div class="line"><span class="lineno">  133</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../de/d4c/classsrsran_1_1span.html">span&lt;const pdsch_time_domain_resource_allocation&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_list</a>   = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;pdsch_time_domain_list;</div>
<div class="line"><span class="lineno">  134</span>  <span class="keyword">const</span> <a class="code hl_struct" href="../../d3/d05/structsrsran_1_1pdsch__time__domain__resource__allocation.html">pdsch_time_domain_resource_allocation</a>&amp;            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_td_cfg</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_list</a>[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index];</div>
<div class="line"><span class="lineno">  135</span> </div>
<div class="line"><span class="lineno">  136</span>  <span class="comment">// Fetch PDCCH and PDSCH resource grid allocators.</span></div>
<div class="line"><span class="lineno">  137</span>  <a class="code hl_struct" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a> = get_res_alloc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index)[0];</div>
<div class="line"><span class="lineno">  138</span>  <a class="code hl_struct" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a> = get_res_alloc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index)[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_td_cfg</a>.k0];</div>
<div class="line"><span class="lineno">  139</span> </div>
<div class="line"><span class="lineno">  140</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.result.dl.bc.sibs.size() + <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.result.dl.paging_grants.size() +</div>
<div class="line"><span class="lineno">  141</span>          <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.result.dl.rar_grants.size() + <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.result.dl.ue_grants.size() &gt;=</div>
<div class="line"><span class="lineno">  142</span>      expert_cfg.<a class="code hl_variable" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#a489ee2f731f31aa0d2f710253bd62541">max_pdschs_per_slot</a>) {</div>
<div class="line"><span class="lineno">  143</span>    logger.info(<span class="stringliteral">&quot;Failed to allocate PDSCH. Cause: Max number of PDSCHs per slot {} was reached.&quot;</span>,</div>
<div class="line"><span class="lineno">  144</span>                expert_cfg.<a class="code hl_variable" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#a489ee2f731f31aa0d2f710253bd62541">max_pdschs_per_slot</a>);</div>
<div class="line"><span class="lineno">  145</span>    <span class="keywordflow">return</span> alloc_outcome::skip_slot;</div>
<div class="line"><span class="lineno">  146</span>  }</div>
<div class="line"><span class="lineno">  147</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> cell_cfg.is_dl_enabled(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a>.slot)) {</div>
<div class="line"><span class="lineno">  148</span>    logger.warning(<span class="stringliteral">&quot;Failed to allocate PDSCH in slot={}. Cause: DL is not active in the PDCCH slot&quot;</span>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.slot);</div>
<div class="line"><span class="lineno">  149</span>    <span class="keywordflow">return</span> alloc_outcome::skip_slot;</div>
<div class="line"><span class="lineno">  150</span>  }</div>
<div class="line"><span class="lineno">  151</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> cell_cfg.is_dl_enabled(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.slot)) {</div>
<div class="line"><span class="lineno">  152</span>    logger.warning(<span class="stringliteral">&quot;Failed to allocate PDSCH in slot={}. Cause: DL is not active in the PDSCH slot&quot;</span>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.slot);</div>
<div class="line"><span class="lineno">  153</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  154</span>  }</div>
<div class="line"><span class="lineno">  155</span>  <span class="comment">// Check whether PDSCH time domain resource does not overlap with CORESET.</span></div>
<div class="line"><span class="lineno">  156</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_td_cfg</a>.symbols.start() &lt; ss_cfg.<a class="code hl_function" href="../../dd/df5/structsrsran_1_1search__space__configuration.html#ab5df7a88e860e0181fb1c5bd24dd0831">get_first_symbol_index</a>() + cs_cfg.<a class="code hl_variable" href="../../de/dcf/structsrsran_1_1coreset__configuration.html#ac70faa1088f184a624da17749bc1c863">duration</a>) {</div>
<div class="line"><span class="lineno">  157</span>    logger.warning(<span class="stringliteral">&quot;Failed to allocate PDSCH in slot={}. Cause: PDSCH time domain resource ={} is starting before the &quot;</span></div>
<div class="line"><span class="lineno">  158</span>                   <span class="stringliteral">&quot;CORESET symbols&quot;</span>,</div>
<div class="line"><span class="lineno">  159</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.slot,</div>
<div class="line"><span class="lineno">  160</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index);</div>
<div class="line"><span class="lineno">  161</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  162</span>  }</div>
<div class="line"><span class="lineno">  163</span>  <span class="comment">// Check whether PDSCH time domain resource fits in DL symbols of the slot.</span></div>
<div class="line"><span class="lineno">  164</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_td_cfg</a>.symbols.stop() &gt; cell_cfg.get_nof_dl_symbol_per_slot(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.slot)) {</div>
<div class="line"><span class="lineno">  165</span>    logger.warning(<span class="stringliteral">&quot;Failed to allocate PDSCH in slot={}. Cause: Nof. DL symbols in PDSCH slot shorter than PDSCH time &quot;</span></div>
<div class="line"><span class="lineno">  166</span>                   <span class="stringliteral">&quot;domain resource ={}&quot;</span>,</div>
<div class="line"><span class="lineno">  167</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.slot,</div>
<div class="line"><span class="lineno">  168</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index);</div>
<div class="line"><span class="lineno">  169</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  170</span>  }</div>
<div class="line"><span class="lineno">  171</span>  <span class="comment">// Verify there is space in PDSCH and PDCCH result lists for new allocations.</span></div>
<div class="line"><span class="lineno">  172</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.result.dl.ue_grants.full() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">or</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a>.result.dl.dl_pdcchs.full()) {</div>
<div class="line"><span class="lineno">  173</span>    logger.info(<span class="stringliteral">&quot;ue={} rnti={}: Failed to allocate PDSCH. Cause: No space available in scheduler output list&quot;</span>,</div>
<div class="line"><span class="lineno">  174</span>                u.ue_index,</div>
<div class="line"><span class="lineno">  175</span>                u.crnti);</div>
<div class="line"><span class="lineno">  176</span>    <span class="keywordflow">return</span> alloc_outcome::skip_slot;</div>
<div class="line"><span class="lineno">  177</span>  }</div>
<div class="line"><span class="lineno">  178</span> </div>
<div class="line"><span class="lineno">  179</span>  <span class="comment">// Verify CRBs fit in the chosen BWP.</span></div>
<div class="line"><span class="lineno">  180</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;dl_crb_lims.contains(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs)) {</div>
<div class="line"><span class="lineno">  181</span>    logger.warning(<span class="stringliteral">&quot;ue={} rnti={}: Failed to allocate PDSCH. Cause: CRBs={} are outside the valid limits={}.&quot;</span>,</div>
<div class="line"><span class="lineno">  182</span>                   u.ue_index,</div>
<div class="line"><span class="lineno">  183</span>                   u.crnti,</div>
<div class="line"><span class="lineno">  184</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  185</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;dl_crb_lims);</div>
<div class="line"><span class="lineno">  186</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  187</span>  }</div>
<div class="line"><span class="lineno">  188</span> </div>
<div class="line"><span class="lineno">  189</span>  <span class="comment">// In case of retx, ensure the number of PRBs for the grant did not change.</span></div>
<div class="line"><span class="lineno">  190</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.empty() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs.length() != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.last_alloc_params().rbs.type1().length()) {</div>
<div class="line"><span class="lineno">  191</span>    logger.warning(<span class="stringliteral">&quot;ue={} rnti={}: Failed to allocate PDSCH. Cause: Number of CRBs has to remain constant during &quot;</span></div>
<div class="line"><span class="lineno">  192</span>                   <span class="stringliteral">&quot;retxs (Harq-id={}, nof_prbs expected={} != actual={})&quot;</span>,</div>
<div class="line"><span class="lineno">  193</span>                   u.ue_index,</div>
<div class="line"><span class="lineno">  194</span>                   u.crnti,</div>
<div class="line"><span class="lineno">  195</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.id,</div>
<div class="line"><span class="lineno">  196</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.last_alloc_params().rbs.type1().length(),</div>
<div class="line"><span class="lineno">  197</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs.length());</div>
<div class="line"><span class="lineno">  198</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  199</span>  }</div>
<div class="line"><span class="lineno">  200</span> </div>
<div class="line"><span class="lineno">  201</span>  <span class="comment">// Verify there is no RB collision.</span></div>
<div class="line"><span class="lineno">  202</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.dl_res_grid.collides(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">bwp_dl_cmn</a>.generic_params.scs, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_td_cfg</a>.symbols, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs)) {</div>
<div class="line"><span class="lineno">  203</span>    logger.warning(<span class="stringliteral">&quot;ue={} rnti={}: Failed to allocate PDSCH. Cause: No space available in scheduler RB resource grid.&quot;</span>,</div>
<div class="line"><span class="lineno">  204</span>                   u.ue_index,</div>
<div class="line"><span class="lineno">  205</span>                   u.crnti);</div>
<div class="line"><span class="lineno">  206</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  207</span>  }</div>
<div class="line"><span class="lineno">  208</span> </div>
<div class="line"><span class="lineno">  209</span>  <span class="comment">// Allocate PDCCH position.</span></div>
<div class="line"><span class="lineno">  210</span>  <a class="code hl_struct" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html">pdcch_dl_information</a>* pdcch = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  211</span>  <span class="keywordflow">if</span> (ue_cc-&gt;is_in_fallback_mode() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">or</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a> == dci_dl_rnti_config_type::tc_rnti_f1_0) {</div>
<div class="line"><span class="lineno">  212</span>    pdcch =</div>
<div class="line"><span class="lineno">  213</span>        get_pdcch_sched(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index).<a class="code hl_function" href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html#abcd74ac9c8620420686fcafa617a19a8">alloc_dl_pdcch_common</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a>, u.crnti, ss_cfg.<a class="code hl_function" href="../../dd/df5/structsrsran_1_1search__space__configuration.html#af62d83a85585b358f7626a3ccfe1005d">get_id</a>(), <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.aggr_lvl);</div>
<div class="line"><span class="lineno">  214</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  215</span>    pdcch = get_pdcch_sched(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index)</div>
<div class="line"><span class="lineno">  216</span>                .<a class="code hl_function" href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html#a78bb0ae89aa1fa10c939d72da8ccb1de">alloc_dl_pdcch_ue</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a>, u.crnti, ue_cell_cfg, ss_cfg.<a class="code hl_function" href="../../dd/df5/structsrsran_1_1search__space__configuration.html#af62d83a85585b358f7626a3ccfe1005d">get_id</a>(), <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.aggr_lvl);</div>
<div class="line"><span class="lineno">  217</span>  }</div>
<div class="line"><span class="lineno">  218</span>  <span class="keywordflow">if</span> (pdcch == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  219</span>    logger.info(<span class="stringliteral">&quot;ue={} rnti={}: Failed to allocate PDSCH. Cause: No space in PDCCH.&quot;</span>, u.ue_index, u.crnti);</div>
<div class="line"><span class="lineno">  220</span>    <span class="comment">// TODO: For now, given that only one searchSpace is used, we skip the UE. In the future, we might still try</span></div>
<div class="line"><span class="lineno">  221</span>    <span class="comment">// different searchSpaces.</span></div>
<div class="line"><span class="lineno">  222</span>    <span class="keywordflow">return</span> alloc_outcome::skip_ue;</div>
<div class="line"><span class="lineno">  223</span>  }</div>
<div class="line"><span class="lineno">  224</span> </div>
<div class="line"><span class="lineno">  225</span>  <span class="comment">// Allocate UCI. UCI destination (i.e., PUCCH or PUSCH) depends on whether there exist a PUSCH grant for the UE.</span></div>
<div class="line"><span class="lineno">  226</span>  <span class="keywordtype">unsigned</span>                 k1      = 0;</div>
<div class="line"><span class="lineno">  227</span>  <a class="code hl_class" href="../../de/d4c/classsrsran_1_1span.html">span&lt;const uint8_t&gt;</a>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_list</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;get_k1_candidates();</div>
<div class="line"><span class="lineno">  228</span>  <a class="code hl_class" href="../../d1/d57/classsrsran_1_1optional.html">optional&lt;uci_allocation&gt;</a> uci     = get_uci_alloc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index)</div>
<div class="line"><span class="lineno">  229</span>                                     .<a class="code hl_function" href="../../da/d26/classsrsran_1_1uci__allocator.html#a674277651ca609ca8e827986589305a3">alloc_uci_harq_ue</a>(get_res_alloc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index),</div>
<div class="line"><span class="lineno">  230</span>                                                        u.crnti,</div>
<div class="line"><span class="lineno">  231</span>                                                        u.<a class="code hl_function" href="../../de/d8c/classsrsran_1_1ue.html#a731245d82c06b3498ca7808f6f308687">get_pcell</a>().cfg(),</div>
<div class="line"><span class="lineno">  232</span>                                                        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_td_cfg</a>.k0,</div>
<div class="line"><span class="lineno">  233</span>                                                        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_list</a>,</div>
<div class="line"><span class="lineno">  234</span>                                                        ue_cc-&gt;is_in_fallback_mode() ? pdcch : <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nullptr</a>);</div>
<div class="line"><span class="lineno">  235</span>  <span class="keywordflow">if</span> (uci.<a class="code hl_function" href="../../d1/d57/classsrsran_1_1optional.html#a2f160539a76c3f4dd0b50b339b81202e">has_value</a>()) {</div>
<div class="line"><span class="lineno">  236</span>    k1                                      = uci.value().k1;</div>
<div class="line"><span class="lineno">  237</span>    pdcch-&gt;<a class="code hl_variable" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html#a9a8b5db2a28afcd115c3adc4c5d0212d">ctx</a>.context.<a class="code hl_variable" href="../../d1/d4f/structsrsran_1_1dci__context__information_1_1decision__context.html#a6c2c48e3d8dc6fab8da7bb0e3945166f">harq_feedback_timing</a> = k1;</div>
<div class="line"><span class="lineno">  238</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  239</span>    logger.info(<span class="stringliteral">&quot;ue={} rnti={}: Failed to allocate PDSCH. Cause: No space in PUCCH.&quot;</span>, u.ue_index, u.crnti);</div>
<div class="line"><span class="lineno">  240</span>    get_pdcch_sched(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index).<a class="code hl_function" href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html#a2c7d3c611349eaa40e7e39a5fde0c9be">cancel_last_pdcch</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a>);</div>
<div class="line"><span class="lineno">  241</span>    <span class="comment">// TODO: For now, given that only one searchSpace is used, we skip the UE. In the future, we might still try</span></div>
<div class="line"><span class="lineno">  242</span>    <span class="comment">// different searchSpaces.</span></div>
<div class="line"><span class="lineno">  243</span>    <span class="keywordflow">return</span> alloc_outcome::skip_ue;</div>
<div class="line"><span class="lineno">  244</span>  }</div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>  <a class="code hl_struct" href="../../d7/df3/structsrsran_1_1pdsch__config__params.html">pdsch_config_params</a> pdsch_cfg;</div>
<div class="line"><span class="lineno">  247</span>  <span class="keywordflow">switch</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a>) {</div>
<div class="line"><span class="lineno">  248</span>    <span class="keywordflow">case</span> dci_dl_rnti_config_type::tc_rnti_f1_0:</div>
<div class="line"><span class="lineno">  249</span>      pdsch_cfg = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#afdd0020f677962611dc4750ff59adaf8">get_pdsch_config_f1_0_tc_rnti</a>(cell_cfg, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_list</a>[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index]);</div>
<div class="line"><span class="lineno">  250</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  251</span>    <span class="keywordflow">case</span> dci_dl_rnti_config_type::c_rnti_f1_0:</div>
<div class="line"><span class="lineno">  252</span>      pdsch_cfg = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#ade749ce1cb6bc8a5dcbadb05bdb9453e">get_pdsch_config_f1_0_c_rnti</a>(ue_cell_cfg, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_list</a>[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index]);</div>
<div class="line"><span class="lineno">  253</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  254</span>    <span class="keywordflow">case</span> dci_dl_rnti_config_type::c_rnti_f1_1:</div>
<div class="line"><span class="lineno">  255</span>      pdsch_cfg = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#ad1f3c8f521e705599a853caca9257e16">get_pdsch_config_f1_1_c_rnti</a>(ue_cell_cfg, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_list</a>[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index], <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.nof_layers);</div>
<div class="line"><span class="lineno">  256</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  257</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  258</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a630688b51219f81c5a47ec5650326afc">report_fatal_error</a>(<span class="stringliteral">&quot;Unsupported PDCCH DCI UL format&quot;</span>);</div>
<div class="line"><span class="lineno">  259</span>  }</div>
<div class="line"><span class="lineno">  260</span> </div>
<div class="line"><span class="lineno">  261</span>  <span class="comment">// Reduce estimated MCS by 1 whenever CSI-RS is sent over a particular slot to account for the overhead of CSI-RS REs.</span></div>
<div class="line"><span class="lineno">  262</span>  <a class="code hl_class" href="../../da/d3a/classsrsran_1_1bounded__integer.html">sch_mcs_index</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">adjusted_mcs</a>{<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.mcs};</div>
<div class="line"><span class="lineno">  263</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.result.dl.csi_rs.empty()) {</div>
<div class="line"><span class="lineno">  264</span>    <span class="comment">// [Implementation-defined] The max MCS values below are set empirically and should avoid the effective code rate to</span></div>
<div class="line"><span class="lineno">  265</span>    <span class="comment">// exceed 0.95 due to the overhead of CSI-RS REs.</span></div>
<div class="line"><span class="lineno">  266</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">adjusted_mcs</a>                = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">adjusted_mcs</a> == 0 ? <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">adjusted_mcs</a> : <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">adjusted_mcs</a> - 1;</div>
<div class="line"><span class="lineno">  267</span>    <a class="code hl_class" href="../../d4/dff/classuint8__t.html">uint8_t</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_mcs_with_csi_rs</a> = 28;</div>
<div class="line"><span class="lineno">  268</span>    <span class="keywordflow">if</span> (pdsch_cfg.mcs_table == <a class="code hl_enumvalue" href="../../d9/def/namespacesrsran.html#a7360cbf57f4cd82cfda032d47fa58e81afe97d5927e34d78b68330ae92f2773cb">pdsch_mcs_table::qam64</a>) {</div>
<div class="line"><span class="lineno">  269</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_mcs_with_csi_rs</a> = 26U;</div>
<div class="line"><span class="lineno">  270</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pdsch_cfg.mcs_table == <a class="code hl_enumvalue" href="../../d9/def/namespacesrsran.html#a7360cbf57f4cd82cfda032d47fa58e81ad6020165a82bfc26499c2cd4dd812255">pdsch_mcs_table::qam256</a>) {</div>
<div class="line"><span class="lineno">  271</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_mcs_with_csi_rs</a> = 24U;</div>
<div class="line"><span class="lineno">  272</span>    }</div>
<div class="line"><span class="lineno">  273</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">adjusted_mcs</a> = <span class="keyword">static_cast&lt;</span><a class="code hl_class" href="../../da/d3a/classsrsran_1_1bounded__integer.html">sch_mcs_index</a><span class="keyword">&gt;</span>(std::min(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">adjusted_mcs</a>.to_uint(), <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_mcs_with_csi_rs</a>));</div>
<div class="line"><span class="lineno">  274</span>  }</div>
<div class="line"><span class="lineno">  275</span> </div>
<div class="line"><span class="lineno">  276</span>  <a class="code hl_class" href="../../d1/d57/classsrsran_1_1optional.html">optional&lt;sch_mcs_tbs&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>;</div>
<div class="line"><span class="lineno">  277</span>  <span class="comment">// If it&#39;s a new Tx, compute the MCS and TBS.</span></div>
<div class="line"><span class="lineno">  278</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.empty()) {</div>
<div class="line"><span class="lineno">  279</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a564f9dc3d69e5afaec20c66366331b40">compute_dl_mcs_tbs</a>(pdsch_cfg, ue_cell_cfg, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">adjusted_mcs</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs.length());</div>
<div class="line"><span class="lineno">  280</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  281</span>    <span class="comment">// It is a retx.</span></div>
<div class="line"><span class="lineno">  282</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.emplace(</div>
<div class="line"><span class="lineno">  283</span>        <a class="code hl_struct" href="../../d5/d97/structsrsran_1_1sch__mcs__tbs.html">sch_mcs_tbs</a>{.<a class="code hl_variable" href="../../d5/d97/structsrsran_1_1sch__mcs__tbs.html#a0e39436a73718f7c879b0df8cbdb6810">mcs</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.last_alloc_params().tb[0]-&gt;mcs, .tbs = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.last_alloc_params().tb[0]-&gt;tbs_bytes});</div>
<div class="line"><span class="lineno">  284</span>  }</div>
<div class="line"><span class="lineno">  285</span> </div>
<div class="line"><span class="lineno">  286</span>  <span class="comment">// If there is not MCS-TBS info, it means no MCS exists such that the effective code rate is &lt;= 0.95.</span></div>
<div class="line"><span class="lineno">  287</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.has_value()) {</div>
<div class="line"><span class="lineno">  288</span>    logger.warning(</div>
<div class="line"><span class="lineno">  289</span>        <span class="stringliteral">&quot;ue={} rnti={}: Failed to allocate PDSCH. Cause: no MCS such that code rate &lt;= 0.95.&quot;</span>, u.ue_index, u.crnti);</div>
<div class="line"><span class="lineno">  290</span>    get_pdcch_sched(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index).<a class="code hl_function" href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html#a2c7d3c611349eaa40e7e39a5fde0c9be">cancel_last_pdcch</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a>);</div>
<div class="line"><span class="lineno">  291</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  292</span>  }</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>  <span class="comment">// In case of retx, ensure the TBS does not change.</span></div>
<div class="line"><span class="lineno">  295</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.empty() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>-&gt;tbs != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.last_alloc_params().tb[0]-&gt;tbs_bytes) {</div>
<div class="line"><span class="lineno">  296</span>    logger.warning(<span class="stringliteral">&quot;ue={} rnti={}: Failed to allocate PDSCH. Cause: TBS has to remain constant during retxs &quot;</span></div>
<div class="line"><span class="lineno">  297</span>                   <span class="stringliteral">&quot;(Harq-id={}, tbs expected={} != actual={})&quot;</span>,</div>
<div class="line"><span class="lineno">  298</span>                   u.ue_index,</div>
<div class="line"><span class="lineno">  299</span>                   u.crnti,</div>
<div class="line"><span class="lineno">  300</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.id,</div>
<div class="line"><span class="lineno">  301</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.last_alloc_params().tb[0]-&gt;tbs_bytes,</div>
<div class="line"><span class="lineno">  302</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>-&gt;tbs);</div>
<div class="line"><span class="lineno">  303</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  304</span>  }</div>
<div class="line"><span class="lineno">  305</span> </div>
<div class="line"><span class="lineno">  306</span>  <span class="comment">// Mark resources as occupied in the ResourceGrid.</span></div>
<div class="line"><span class="lineno">  307</span>  <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.dl_res_grid.fill(<a class="code hl_struct" href="../../de/dbd/structsrsran_1_1grant__info.html">grant_info</a>{<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">bwp_dl_cmn</a>.generic_params.scs, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_td_cfg</a>.symbols, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs});</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>  <span class="comment">// Allocate UE DL HARQ.</span></div>
<div class="line"><span class="lineno">  310</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.empty()) {</div>
<div class="line"><span class="lineno">  311</span>    <span class="comment">// It is a new tx.</span></div>
<div class="line"><span class="lineno">  312</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.new_tx(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.slot,</div>
<div class="line"><span class="lineno">  313</span>                k1,</div>
<div class="line"><span class="lineno">  314</span>                expert_cfg.max_nof_harq_retxs,</div>
<div class="line"><span class="lineno">  315</span>                uci.value().harq_bit_idx,</div>
<div class="line"><span class="lineno">  316</span>                ue_cc-&gt;<a class="code hl_function" href="../../d9/d2d/classsrsran_1_1ue__cell.html#a9ec269dbea62873f276ab52989a5df1d">channel_state_manager</a>().get_wideband_cqi(),</div>
<div class="line"><span class="lineno">  317</span>                <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.nof_layers);</div>
<div class="line"><span class="lineno">  318</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  319</span>    <span class="comment">// It is a retx.</span></div>
<div class="line"><span class="lineno">  320</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.new_retx(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.slot, k1, uci.value().harq_bit_idx);</div>
<div class="line"><span class="lineno">  321</span>  }</div>
<div class="line"><span class="lineno">  322</span> </div>
<div class="line"><span class="lineno">  323</span>  <span class="comment">// Fill DL PDCCH DCI PDU.</span></div>
<div class="line"><span class="lineno">  324</span>  <span class="comment">// Number of possible Downlink Assignment Indexes {0, ..., 3} as per TS38.213 Section 9.1.3.</span></div>
<div class="line"><span class="lineno">  325</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">DAI_MOD</a> = 4U;</div>
<div class="line"><span class="lineno">  326</span>  <a class="code hl_class" href="../../d4/dff/classuint8__t.html">uint8_t</a>                   rv      = ue_cc-&gt;get_pdsch_rv(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>);</div>
<div class="line"><span class="lineno">  327</span>  <span class="comment">// For allocation on PUSCH, we use a PUCCH resource indicator set to 0, as it will get ignored by the UE.</span></div>
<div class="line"><span class="lineno">  328</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pucch_res_indicator =</div>
<div class="line"><span class="lineno">  329</span>      uci.value().pucch_res_indicator.has_value() ? uci.value().pucch_res_indicator.value() : 0U;</div>
<div class="line"><span class="lineno">  330</span>  <span class="keywordflow">switch</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a>) {</div>
<div class="line"><span class="lineno">  331</span>    <span class="keywordflow">case</span> dci_dl_rnti_config_type::tc_rnti_f1_0:</div>
<div class="line"><span class="lineno">  332</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#af1d1b499db60acdab5d6433159f3992a">build_dci_f1_0_tc_rnti</a>(pdcch-&gt;<a class="code hl_variable" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html#a7d58e4814244671ba0903fe9c58fa337">dci</a>,</div>
<div class="line"><span class="lineno">  333</span>                             init_dl_bwp,</div>
<div class="line"><span class="lineno">  334</span>                             <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  335</span>                             <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index,</div>
<div class="line"><span class="lineno">  336</span>                             k1,</div>
<div class="line"><span class="lineno">  337</span>                             pucch_res_indicator,</div>
<div class="line"><span class="lineno">  338</span>                             <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value().mcs,</div>
<div class="line"><span class="lineno">  339</span>                             rv,</div>
<div class="line"><span class="lineno">  340</span>                             <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>);</div>
<div class="line"><span class="lineno">  341</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  342</span>    <span class="keywordflow">case</span> dci_dl_rnti_config_type::c_rnti_f1_0:</div>
<div class="line"><span class="lineno">  343</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a70794355f71104c5cc1e5e91ed8b968e">build_dci_f1_0_c_rnti</a>(pdcch-&gt;<a class="code hl_variable" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html#a7d58e4814244671ba0903fe9c58fa337">dci</a>,</div>
<div class="line"><span class="lineno">  344</span>                            ue_cell_cfg,</div>
<div class="line"><span class="lineno">  345</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id,</div>
<div class="line"><span class="lineno">  346</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  347</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index,</div>
<div class="line"><span class="lineno">  348</span>                            k1,</div>
<div class="line"><span class="lineno">  349</span>                            pucch_res_indicator,</div>
<div class="line"><span class="lineno">  350</span>                            uci.value().harq_bit_idx % <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">DAI_MOD</a>,</div>
<div class="line"><span class="lineno">  351</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value().mcs,</div>
<div class="line"><span class="lineno">  352</span>                            rv,</div>
<div class="line"><span class="lineno">  353</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>);</div>
<div class="line"><span class="lineno">  354</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  355</span>    <span class="keywordflow">case</span> dci_dl_rnti_config_type::c_rnti_f1_1:</div>
<div class="line"><span class="lineno">  356</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a08aa5fe6b74e470b76e7417d4d5e1d1e">build_dci_f1_1_c_rnti</a>(pdcch-&gt;<a class="code hl_variable" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html#a7d58e4814244671ba0903fe9c58fa337">dci</a>,</div>
<div class="line"><span class="lineno">  357</span>                            ue_cell_cfg,</div>
<div class="line"><span class="lineno">  358</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id,</div>
<div class="line"><span class="lineno">  359</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a2de764a7c1baa17f5288a9fef373aca4">crb_to_prb</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;dl_crb_lims, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs),</div>
<div class="line"><span class="lineno">  360</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index,</div>
<div class="line"><span class="lineno">  361</span>                            k1,</div>
<div class="line"><span class="lineno">  362</span>                            pucch_res_indicator,</div>
<div class="line"><span class="lineno">  363</span>                            uci.value().harq_bit_idx % <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">DAI_MOD</a>,</div>
<div class="line"><span class="lineno">  364</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value().mcs,</div>
<div class="line"><span class="lineno">  365</span>                            rv,</div>
<div class="line"><span class="lineno">  366</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>,</div>
<div class="line"><span class="lineno">  367</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.nof_layers);</div>
<div class="line"><span class="lineno">  368</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  369</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  370</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a630688b51219f81c5a47ec5650326afc">report_fatal_error</a>(<span class="stringliteral">&quot;Unsupported RNTI type for PDSCH allocation&quot;</span>);</div>
<div class="line"><span class="lineno">  371</span>  }</div>
<div class="line"><span class="lineno">  372</span> </div>
<div class="line"><span class="lineno">  373</span>  <span class="comment">// Fill PDSCH PDU.</span></div>
<div class="line"><span class="lineno">  374</span>  <a class="code hl_struct" href="../../d3/dcc/structsrsran_1_1dl__msg__alloc.html">dl_msg_alloc</a>&amp; msg     = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_alloc</a>.result.dl.ue_grants.emplace_back();</div>
<div class="line"><span class="lineno">  375</span>  msg.context.<a class="code hl_variable" href="../../d9/ddd/structsrsran_1_1dl__msg__alloc_1_1decision__context.html#a5a87ff9870306599830438972d164a5d">ue_index</a>  = u.ue_index;</div>
<div class="line"><span class="lineno">  376</span>  msg.context.<a class="code hl_variable" href="../../d9/ddd/structsrsran_1_1dl__msg__alloc_1_1decision__context.html#a24fc0edcea4d8aa5e41b32289a25f7c3">k1</a>        = k1;</div>
<div class="line"><span class="lineno">  377</span>  msg.context.<a class="code hl_variable" href="../../d9/ddd/structsrsran_1_1dl__msg__alloc_1_1decision__context.html#acd34d6a236d696dac52ab0fbd08f8f22">ss_id</a>     = ss_cfg.<a class="code hl_function" href="../../dd/df5/structsrsran_1_1search__space__configuration.html#af62d83a85585b358f7626a3ccfe1005d">get_id</a>();</div>
<div class="line"><span class="lineno">  378</span>  msg.context.<a class="code hl_variable" href="../../d9/ddd/structsrsran_1_1dl__msg__alloc_1_1decision__context.html#a2dc690ee43db0d22302da6ec57964c6d">nof_retxs</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.tb(0).nof_retxs;</div>
<div class="line"><span class="lineno">  379</span>  <span class="keywordflow">if</span> (msg.context.<a class="code hl_variable" href="../../d9/ddd/structsrsran_1_1dl__msg__alloc_1_1decision__context.html#a2dc690ee43db0d22302da6ec57964c6d">nof_retxs</a> == 0 <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> ue_cc-&gt;link_adaptation_controller().<a class="code hl_function" href="../../dc/d07/classsrsran_1_1ue__link__adaptation__controller.html#a878dc8c69b88ace04843eedf866a691e">is_dl_olla_enabled</a>()) {</div>
<div class="line"><span class="lineno">  380</span>    msg.context.<a class="code hl_variable" href="../../d9/ddd/structsrsran_1_1dl__msg__alloc_1_1decision__context.html#a2114ff853966185998cc2dfc5295d92b">olla_offset</a> = ue_cc-&gt;link_adaptation_controller().<a class="code hl_function" href="../../dc/d07/classsrsran_1_1ue__link__adaptation__controller.html#ae9a0a43b2798fe6bc0af75ec69f40422">dl_cqi_offset</a>();</div>
<div class="line"><span class="lineno">  381</span>  }</div>
<div class="line"><span class="lineno">  382</span>  <span class="keywordflow">switch</span> (pdcch-&gt;<a class="code hl_variable" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html#a7d58e4814244671ba0903fe9c58fa337">dci</a>.type) {</div>
<div class="line"><span class="lineno">  383</span>    <span class="keywordflow">case</span> dci_dl_rnti_config_type::tc_rnti_f1_0:</div>
<div class="line"><span class="lineno">  384</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a7f508cb4c31e0e1fe5c716f7302e4c72">build_pdsch_f1_0_tc_rnti</a>(msg.pdsch_cfg,</div>
<div class="line"><span class="lineno">  385</span>                               pdsch_cfg,</div>
<div class="line"><span class="lineno">  386</span>                               <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value().tbs,</div>
<div class="line"><span class="lineno">  387</span>                               u.crnti,</div>
<div class="line"><span class="lineno">  388</span>                               cell_cfg,</div>
<div class="line"><span class="lineno">  389</span>                               pdcch-&gt;<a class="code hl_variable" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html#a7d58e4814244671ba0903fe9c58fa337">dci</a>.tc_rnti_f1_0,</div>
<div class="line"><span class="lineno">  390</span>                               <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  391</span>                               <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.tb(0).nof_retxs == 0);</div>
<div class="line"><span class="lineno">  392</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  393</span>    <span class="keywordflow">case</span> dci_dl_rnti_config_type::c_rnti_f1_0:</div>
<div class="line"><span class="lineno">  394</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#af25dbfb9ea9d3abf2f4a0c62f0035da8">build_pdsch_f1_0_c_rnti</a>(msg.pdsch_cfg,</div>
<div class="line"><span class="lineno">  395</span>                              pdsch_cfg,</div>
<div class="line"><span class="lineno">  396</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value().tbs,</div>
<div class="line"><span class="lineno">  397</span>                              u.crnti,</div>
<div class="line"><span class="lineno">  398</span>                              ue_cell_cfg,</div>
<div class="line"><span class="lineno">  399</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id,</div>
<div class="line"><span class="lineno">  400</span>                              pdcch-&gt;<a class="code hl_variable" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html#a7d58e4814244671ba0903fe9c58fa337">dci</a>.c_rnti_f1_0,</div>
<div class="line"><span class="lineno">  401</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  402</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.tb(0).nof_retxs == 0);</div>
<div class="line"><span class="lineno">  403</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  404</span>    <span class="keywordflow">case</span> dci_dl_rnti_config_type::c_rnti_f1_1:</div>
<div class="line"><span class="lineno">  405</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a7d67c23151a68f37ce240b7ab88aa542">build_pdsch_f1_1_c_rnti</a>(msg.pdsch_cfg,</div>
<div class="line"><span class="lineno">  406</span>                              pdsch_cfg,</div>
<div class="line"><span class="lineno">  407</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value(),</div>
<div class="line"><span class="lineno">  408</span>                              u.crnti,</div>
<div class="line"><span class="lineno">  409</span>                              ue_cell_cfg,</div>
<div class="line"><span class="lineno">  410</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id,</div>
<div class="line"><span class="lineno">  411</span>                              pdcch-&gt;<a class="code hl_variable" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html#a7d58e4814244671ba0903fe9c58fa337">dci</a>.c_rnti_f1_1,</div>
<div class="line"><span class="lineno">  412</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  413</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>,</div>
<div class="line"><span class="lineno">  414</span>                              ue_cc-&gt;<a class="code hl_function" href="../../d9/d2d/classsrsran_1_1ue__cell.html#a9ec269dbea62873f276ab52989a5df1d">channel_state_manager</a>());</div>
<div class="line"><span class="lineno">  415</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  416</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  417</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a630688b51219f81c5a47ec5650326afc">report_fatal_error</a>(<span class="stringliteral">&quot;Unsupported PDCCH DL DCI format&quot;</span>);</div>
<div class="line"><span class="lineno">  418</span>  }</div>
<div class="line"><span class="lineno">  419</span> </div>
<div class="line"><span class="lineno">  420</span>  <span class="comment">// Save set PDCCH and PDSCH PDU parameters in HARQ process.</span></div>
<div class="line"><span class="lineno">  421</span>  <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.save_alloc_params(pdcch-&gt;<a class="code hl_variable" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html#a7d58e4814244671ba0903fe9c58fa337">dci</a>.type, msg.pdsch_cfg);</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_dl</a>.tb(0).nof_retxs == 0) {</div>
<div class="line"><span class="lineno">  424</span>    <span class="comment">// Set MAC logical channels to schedule in this PDU if it is a newtx.</span></div>
<div class="line"><span class="lineno">  425</span>    u.<a class="code hl_function" href="../../de/d8c/classsrsran_1_1ue.html#a66338f2e37d78c01ea60b844d27fd806">build_dl_transport_block_info</a>(msg.tb_list.emplace_back(), msg.pdsch_cfg.codewords[0].tb_size_bytes);</div>
<div class="line"><span class="lineno">  426</span>  }</div>
<div class="line"><span class="lineno">  427</span> </div>
<div class="line"><span class="lineno">  428</span>  <span class="keywordflow">return</span> alloc_outcome::success;</div>
<div class="line"><span class="lineno">  429</span>}</div>
<div class="ttc" id="aclasssrsran_1_1bounded__integer_html"><div class="ttname"><a href="../../da/d3a/classsrsran_1_1bounded__integer.html">srsran::bounded_integer&lt; uint8_t, 0, 31 &gt;</a></div></div>
<div class="ttc" id="aclasssrsran_1_1cell__configuration_html"><div class="ttname"><a href="../../d2/d2d/classsrsran_1_1cell__configuration.html">srsran::cell_configuration</a></div><div class="ttdef"><b>Definition</b> cell_configuration.h:36</div></div>
<div class="ttc" id="aclasssrsran_1_1dl__harq__process_html"><div class="ttname"><a href="../../d3/d90/classsrsran_1_1dl__harq__process.html">srsran::dl_harq_process</a></div><div class="ttdef"><b>Definition</b> harq_process.h:262</div></div>
<div class="ttc" id="aclasssrsran_1_1optional_html"><div class="ttname"><a href="../../d1/d57/classsrsran_1_1optional.html">srsran::optional</a></div><div class="ttdoc">Optional objects.</div><div class="ttdef"><b>Definition</b> optional.h:281</div></div>
<div class="ttc" id="aclasssrsran_1_1optional_html_a2f160539a76c3f4dd0b50b339b81202e"><div class="ttname"><a href="../../d1/d57/classsrsran_1_1optional.html#a2f160539a76c3f4dd0b50b339b81202e">srsran::optional::has_value</a></div><div class="ttdeci">constexpr bool has_value() const noexcept</div><div class="ttdef"><b>Definition</b> optional.h:298</div></div>
<div class="ttc" id="aclasssrsran_1_1pdcch__resource__allocator_html_a2c7d3c611349eaa40e7e39a5fde0c9be"><div class="ttname"><a href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html#a2c7d3c611349eaa40e7e39a5fde0c9be">srsran::pdcch_resource_allocator::cancel_last_pdcch</a></div><div class="ttdeci">virtual bool cancel_last_pdcch(cell_slot_resource_allocator &amp;slot_alloc)=0</div><div class="ttdoc">Cancels the last PDCCH allocation.</div></div>
<div class="ttc" id="aclasssrsran_1_1pdcch__resource__allocator_html_a78bb0ae89aa1fa10c939d72da8ccb1de"><div class="ttname"><a href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html#a78bb0ae89aa1fa10c939d72da8ccb1de">srsran::pdcch_resource_allocator::alloc_dl_pdcch_ue</a></div><div class="ttdeci">virtual pdcch_dl_information * alloc_dl_pdcch_ue(cell_slot_resource_allocator &amp;slot_alloc, rnti_t rnti, const ue_cell_configuration &amp;user, search_space_id ss_id, aggregation_level aggr_lvl)=0</div></div>
<div class="ttc" id="aclasssrsran_1_1pdcch__resource__allocator_html_abcd74ac9c8620420686fcafa617a19a8"><div class="ttname"><a href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html#abcd74ac9c8620420686fcafa617a19a8">srsran::pdcch_resource_allocator::alloc_dl_pdcch_common</a></div><div class="ttdeci">virtual pdcch_dl_information * alloc_dl_pdcch_common(cell_slot_resource_allocator &amp;slot_alloc, rnti_t rnti, search_space_id ss_id, aggregation_level aggr_lvl)=0</div></div>
<div class="ttc" id="aclasssrsran_1_1span_html"><div class="ttname"><a href="../../de/d4c/classsrsran_1_1span.html">srsran::span</a></div><div class="ttdef"><b>Definition</b> span.h:98</div></div>
<div class="ttc" id="aclasssrsran_1_1uci__allocator_html_a674277651ca609ca8e827986589305a3"><div class="ttname"><a href="../../da/d26/classsrsran_1_1uci__allocator.html#a674277651ca609ca8e827986589305a3">srsran::uci_allocator::alloc_uci_harq_ue</a></div><div class="ttdeci">virtual optional&lt; uci_allocation &gt; alloc_uci_harq_ue(cell_resource_allocator &amp;res_alloc, rnti_t crnti, const ue_cell_configuration &amp;ue_cell_cfg, unsigned k0, span&lt; const uint8_t &gt; k1_list, const pdcch_dl_information *fallback_dci_info=nullptr)=0</div></div>
<div class="ttc" id="aclasssrsran_1_1ue__cell__configuration_html"><div class="ttname"><a href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html">srsran::ue_cell_configuration</a></div><div class="ttdoc">UE-dedicated configuration for a given cell.</div><div class="ttdef"><b>Definition</b> ue_configuration.h:104</div></div>
<div class="ttc" id="aclasssrsran_1_1ue__cell__configuration_html_ac98203b0c951eb022845bd8b85bb6613"><div class="ttname"><a href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html#ac98203b0c951eb022845bd8b85bb6613">srsran::ue_cell_configuration::find_search_space</a></div><div class="ttdeci">const search_space_info * find_search_space(search_space_id ss_id) const</div><div class="ttdef"><b>Definition</b> ue_configuration.h:149</div></div>
<div class="ttc" id="aclasssrsran_1_1ue__cell_html"><div class="ttname"><a href="../../d9/d2d/classsrsran_1_1ue__cell.html">srsran::ue_cell</a></div><div class="ttdoc">Context respective to a UE serving cell.</div><div class="ttdef"><b>Definition</b> ue_cell.h:47</div></div>
<div class="ttc" id="aclasssrsran_1_1ue__cell_html_a5547f22a9e862e932a494f187f17b61a"><div class="ttname"><a href="../../d9/d2d/classsrsran_1_1ue__cell.html#a5547f22a9e862e932a494f187f17b61a">srsran::ue_cell::is_active</a></div><div class="ttdeci">bool is_active() const</div><div class="ttdoc">Determines whether the UE cell is currently active.</div><div class="ttdef"><b>Definition</b> ue_cell.h:68</div></div>
<div class="ttc" id="aclasssrsran_1_1ue__cell_html_a9ec269dbea62873f276ab52989a5df1d"><div class="ttname"><a href="../../d9/d2d/classsrsran_1_1ue__cell.html#a9ec269dbea62873f276ab52989a5df1d">srsran::ue_cell::channel_state_manager</a></div><div class="ttdeci">ue_channel_state_manager &amp; channel_state_manager()</div><div class="ttdoc">Get UE channel state handler.</div><div class="ttdef"><b>Definition</b> ue_cell.h:142</div></div>
<div class="ttc" id="aclasssrsran_1_1ue__link__adaptation__controller_html_a878dc8c69b88ace04843eedf866a691e"><div class="ttname"><a href="../../dc/d07/classsrsran_1_1ue__link__adaptation__controller.html#a878dc8c69b88ace04843eedf866a691e">srsran::ue_link_adaptation_controller::is_dl_olla_enabled</a></div><div class="ttdeci">bool is_dl_olla_enabled() const</div><div class="ttdoc">Checks whether OLLA is enabled for DL.</div><div class="ttdef"><b>Definition</b> ue_link_adaptation_controller.h:57</div></div>
<div class="ttc" id="aclasssrsran_1_1ue__link__adaptation__controller_html_ae9a0a43b2798fe6bc0af75ec69f40422"><div class="ttname"><a href="../../dc/d07/classsrsran_1_1ue__link__adaptation__controller.html#ae9a0a43b2798fe6bc0af75ec69f40422">srsran::ue_link_adaptation_controller::dl_cqi_offset</a></div><div class="ttdeci">float dl_cqi_offset() const</div><div class="ttdoc">Get the value of the DL CQI offset that the OLLA algorithm is currently using.</div><div class="ttdef"><b>Definition</b> ue_link_adaptation_controller.h:51</div></div>
<div class="ttc" id="aclasssrsran_1_1ue__repository_html_a8d4b4805828ab1b0375fa323b73c3d6c"><div class="ttname"><a href="../../dc/df2/classsrsran_1_1ue__repository.html#a8d4b4805828ab1b0375fa323b73c3d6c">srsran::ue_repository::contains</a></div><div class="ttdeci">bool contains(du_ue_index_t ue_index) const</div><div class="ttdoc">Contains ue index.</div><div class="ttdef"><b>Definition</b> ue_repository.h:48</div></div>
<div class="ttc" id="aclasssrsran_1_1ue_html"><div class="ttname"><a href="../../de/d8c/classsrsran_1_1ue.html">srsran::ue</a></div><div class="ttdef"><b>Definition</b> ue.h:47</div></div>
<div class="ttc" id="aclasssrsran_1_1ue_html_a009850d92300e2137c65a21030ec7c1c"><div class="ttname"><a href="../../de/d8c/classsrsran_1_1ue.html#a009850d92300e2137c65a21030ec7c1c">srsran::ue::is_conres_ce_pending</a></div><div class="ttdeci">bool is_conres_ce_pending() const</div><div class="ttdoc">Whether MAC ConRes CE is pending.</div><div class="ttdef"><b>Definition</b> ue.h:140</div></div>
<div class="ttc" id="aclasssrsran_1_1ue_html_a66338f2e37d78c01ea60b844d27fd806"><div class="ttname"><a href="../../de/d8c/classsrsran_1_1ue.html#a66338f2e37d78c01ea60b844d27fd806">srsran::ue::build_dl_transport_block_info</a></div><div class="ttdeci">unsigned build_dl_transport_block_info(dl_msg_tb_info &amp;tb_info, unsigned tb_size_bytes)</div><div class="ttdoc">Defines the list of subPDUs, including LCID and payload size, that will compose the transport block.</div><div class="ttdef"><b>Definition</b> ue.cpp:171</div></div>
<div class="ttc" id="aclasssrsran_1_1ue_html_a731245d82c06b3498ca7808f6f308687"><div class="ttname"><a href="../../de/d8c/classsrsran_1_1ue.html#a731245d82c06b3498ca7808f6f308687">srsran::ue::get_pcell</a></div><div class="ttdeci">ue_cell &amp; get_pcell()</div><div class="ttdoc">Fetch UE PCell.</div><div class="ttdef"><b>Definition</b> ue.h:86</div></div>
<div class="ttc" id="aclassuint8__t_html"><div class="ttname"><a href="../../d4/dff/classuint8__t.html">uint8_t</a></div></div>
<div class="ttc" id="anamespacesrsran_html_a08aa5fe6b74e470b76e7417d4d5e1d1e"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a08aa5fe6b74e470b76e7417d4d5e1d1e">srsran::build_dci_f1_1_c_rnti</a></div><div class="ttdeci">void build_dci_f1_1_c_rnti(dci_dl_info &amp;dci, const ue_cell_configuration &amp;ue_cell_cfg, search_space_id ss_id, prb_interval prbs, unsigned time_resource, unsigned k1, unsigned pucch_res_indicator, unsigned dai, sch_mcs_index tb1_mcs_index, uint8_t rv, const dl_harq_process &amp;h_dl, unsigned nof_layers)</div><div class="ttdoc">Builds DCI f1_1 for C-RNTI.</div><div class="ttdef"><b>Definition</b> dci_builder.cpp:226</div></div>
<div class="ttc" id="anamespacesrsran_html_a2de764a7c1baa17f5288a9fef373aca4"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a2de764a7c1baa17f5288a9fef373aca4">srsran::crb_to_prb</a></div><div class="ttdeci">unsigned crb_to_prb(crb_interval bwp_crb_lims, unsigned crb)</div><div class="ttdoc">Convert CRB into PRB given the CRB assignment limits. The CRB and PRB are assumed to use the same num...</div><div class="ttdef"><b>Definition</b> rb_interval.h:49</div></div>
<div class="ttc" id="anamespacesrsran_html_a41c7236508881761bbd602d002833e8e"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a41c7236508881761bbd602d002833e8e">srsran::to_bwp_id</a></div><div class="ttdeci">constexpr bwp_id_t to_bwp_id(std::underlying_type_t&lt; bwp_id_t &gt; value)</div><div class="ttdoc">Converts integer value to BWP-Id&quot;.</div><div class="ttdef"><b>Definition</b> bwp_configuration.h:64</div></div>
<div class="ttc" id="anamespacesrsran_html_a564f9dc3d69e5afaec20c66366331b40"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a564f9dc3d69e5afaec20c66366331b40">srsran::compute_dl_mcs_tbs</a></div><div class="ttdeci">optional&lt; sch_mcs_tbs &gt; compute_dl_mcs_tbs(const pdsch_config_params &amp;pdsch_params, const ue_cell_configuration &amp;ue_cell_cfg, sch_mcs_index max_mcs, unsigned nof_prbs)</div><div class="ttdoc">Computes the PDSCH MCS and TBS such that the effective code rate does not exceed 0....</div><div class="ttdef"><b>Definition</b> mcs_tbs_calculator.cpp:162</div></div>
<div class="ttc" id="anamespacesrsran_html_a630688b51219f81c5a47ec5650326afc"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a630688b51219f81c5a47ec5650326afc">srsran::report_fatal_error</a></div><div class="ttdeci">void report_fatal_error(const char *reason_fmt, Args &amp;&amp;... args) noexcept</div><div class="ttdoc">Reports a fatal error and handles the application shutdown. This function is intended to be used for ...</div><div class="ttdef"><b>Definition</b> error_handling.h:57</div></div>
<div class="ttc" id="anamespacesrsran_html_a70794355f71104c5cc1e5e91ed8b968e"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a70794355f71104c5cc1e5e91ed8b968e">srsran::build_dci_f1_0_c_rnti</a></div><div class="ttdeci">void build_dci_f1_0_c_rnti(dci_dl_info &amp;dci, const ue_cell_configuration &amp;ue_cell_cfg, search_space_id ss_id, crb_interval crbs, unsigned time_resource, unsigned k1, unsigned pucch_res_indicator, unsigned dai, sch_mcs_index mcs_index, uint8_t rv, const dl_harq_process &amp;h_dl)</div><div class="ttdoc">Builds DCI f1_0 for C-RNTI.</div><div class="ttdef"><b>Definition</b> dci_builder.cpp:166</div></div>
<div class="ttc" id="anamespacesrsran_html_a7360cbf57f4cd82cfda032d47fa58e81ad6020165a82bfc26499c2cd4dd812255"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a7360cbf57f4cd82cfda032d47fa58e81ad6020165a82bfc26499c2cd4dd812255">srsran::pdsch_mcs_table::qam256</a></div><div class="ttdeci">@ qam256</div><div class="ttdoc">Identifies MCS index table 2, TS38.214 Table 5.1.3.1-2.</div></div>
<div class="ttc" id="anamespacesrsran_html_a7360cbf57f4cd82cfda032d47fa58e81afe97d5927e34d78b68330ae92f2773cb"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a7360cbf57f4cd82cfda032d47fa58e81afe97d5927e34d78b68330ae92f2773cb">srsran::pdsch_mcs_table::qam64</a></div><div class="ttdeci">@ qam64</div><div class="ttdoc">Identifies MCS index table 1, TS38.214 Table 5.1.3.1-1.</div></div>
<div class="ttc" id="anamespacesrsran_html_a7d67c23151a68f37ce240b7ab88aa542"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a7d67c23151a68f37ce240b7ab88aa542">srsran::build_pdsch_f1_1_c_rnti</a></div><div class="ttdeci">void build_pdsch_f1_1_c_rnti(pdsch_information &amp;pdsch, const pdsch_config_params &amp;pdsch_cfg, sch_mcs_tbs mcs_tbs_info, rnti_t rnti, const ue_cell_configuration &amp;ue_cell_cfg, search_space_id ss_id, const dci_1_1_configuration &amp;dci_cfg, const crb_interval &amp;crbs, const dl_harq_process &amp;h_dl, const ue_channel_state_manager &amp;cs_mgr)</div><div class="ttdoc">Builds PDSCH PDU for DCI format 1_1, scrambled by C-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:501</div></div>
<div class="ttc" id="anamespacesrsran_html_a7f508cb4c31e0e1fe5c716f7302e4c72"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a7f508cb4c31e0e1fe5c716f7302e4c72">srsran::build_pdsch_f1_0_tc_rnti</a></div><div class="ttdeci">void build_pdsch_f1_0_tc_rnti(pdsch_information &amp;pdsch, const pdsch_config_params &amp;pdsch_cfg, unsigned tbs_bytes, rnti_t rnti, const cell_configuration &amp;cell_cfg, const dci_1_0_tc_rnti_configuration &amp;dci_cfg, const crb_interval &amp;crbs, bool is_new_data)</div><div class="ttdoc">Builds PDSCH PDU for DCI format 1_0, scrambled by TC-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:402</div></div>
<div class="ttc" id="anamespacesrsran_html_ac0a93d3e0aa8452e32308d5038bcad49"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#ac0a93d3e0aa8452e32308d5038bcad49">srsran::dci_dl_rnti_config_type</a></div><div class="ttdeci">dci_dl_rnti_config_type</div><div class="ttdoc">Defines which fields are stored in the DCI payload, based on the chosen DCI format and RNTI type.</div><div class="ttdef"><b>Definition</b> scheduler_dci.h:45</div></div>
<div class="ttc" id="anamespacesrsran_html_ad1f3c8f521e705599a853caca9257e16"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#ad1f3c8f521e705599a853caca9257e16">srsran::get_pdsch_config_f1_1_c_rnti</a></div><div class="ttdeci">pdsch_config_params get_pdsch_config_f1_1_c_rnti(const ue_cell_configuration &amp;ue_cell_cfg, const pdsch_time_domain_resource_allocation &amp;pdsch_td_cfg, unsigned nof_layers)</div><div class="ttdoc">Fetches the PDSCH parameters needed for PUSCH PDU for DCI format 1_1, scrambled by C-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:103</div></div>
<div class="ttc" id="anamespacesrsran_html_ade749ce1cb6bc8a5dcbadb05bdb9453e"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#ade749ce1cb6bc8a5dcbadb05bdb9453e">srsran::get_pdsch_config_f1_0_c_rnti</a></div><div class="ttdeci">pdsch_config_params get_pdsch_config_f1_0_c_rnti(const ue_cell_configuration &amp;ue_cell_cfg, const pdsch_time_domain_resource_allocation &amp;pdsch_td_cfg)</div><div class="ttdoc">Fetches the PDSCH parameters needed for PUSCH PDU for DCI format 1_0, scrambled by C-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:76</div></div>
<div class="ttc" id="anamespacesrsran_html_af1d1b499db60acdab5d6433159f3992a"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#af1d1b499db60acdab5d6433159f3992a">srsran::build_dci_f1_0_tc_rnti</a></div><div class="ttdeci">void build_dci_f1_0_tc_rnti(dci_dl_info &amp;dci, const bwp_downlink_common &amp;init_dl_bwp, crb_interval crbs, unsigned time_resource, unsigned k1, unsigned pucch_res_indicator, sch_mcs_index mcs_index, uint8_t rv, const dl_harq_process &amp;h_dl)</div><div class="ttdoc">Builds DCI f1_0 for TC-RNTI, used for instance in Msg4.</div><div class="ttdef"><b>Definition</b> dci_builder.cpp:125</div></div>
<div class="ttc" id="anamespacesrsran_html_af25dbfb9ea9d3abf2f4a0c62f0035da8"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#af25dbfb9ea9d3abf2f4a0c62f0035da8">srsran::build_pdsch_f1_0_c_rnti</a></div><div class="ttdeci">void build_pdsch_f1_0_c_rnti(pdsch_information &amp;pdsch, const pdsch_config_params &amp;pdsch_cfg, unsigned tbs_bytes, rnti_t rnti, const ue_cell_configuration &amp;ue_cell_cfg, search_space_id ss_id, const dci_1_0_c_rnti_configuration &amp;dci_cfg, const crb_interval &amp;crbs, bool is_new_data)</div><div class="ttdoc">Builds PDSCH PDU for DCI format 1_0, scrambled by C-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:450</div></div>
<div class="ttc" id="anamespacesrsran_html_afdd0020f677962611dc4750ff59adaf8"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#afdd0020f677962611dc4750ff59adaf8">srsran::get_pdsch_config_f1_0_tc_rnti</a></div><div class="ttdeci">pdsch_config_params get_pdsch_config_f1_0_tc_rnti(const cell_configuration &amp;cell_cfg, const pdsch_time_domain_resource_allocation &amp;pdsch_td_cfg)</div><div class="ttdoc">Fetches the PDSCH parameters needed for PDSCH PDU for DCI format 1_0, scrambled by TC-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:50</div></div>
<div class="ttc" id="astructsrsran_1_1bwp__downlink__common_html"><div class="ttname"><a href="../../d8/df2/structsrsran_1_1bwp__downlink__common.html">srsran::bwp_downlink_common</a></div><div class="ttdef"><b>Definition</b> bwp_configuration.h:117</div></div>
<div class="ttc" id="astructsrsran_1_1cell__slot__resource__allocator_html"><div class="ttname"><a href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">srsran::cell_slot_resource_allocator</a></div><div class="ttdoc">Stores all the scheduled information relative to a {slot, cell}.</div><div class="ttdef"><b>Definition</b> resource_grid.h:215</div></div>
<div class="ttc" id="astructsrsran_1_1coreset__configuration_html"><div class="ttname"><a href="../../de/dcf/structsrsran_1_1coreset__configuration.html">srsran::coreset_configuration</a></div><div class="ttdef"><b>Definition</b> coreset.h:52</div></div>
<div class="ttc" id="astructsrsran_1_1coreset__configuration_html_ac70faa1088f184a624da17749bc1c863"><div class="ttname"><a href="../../de/dcf/structsrsran_1_1coreset__configuration.html#ac70faa1088f184a624da17749bc1c863">srsran::coreset_configuration::duration</a></div><div class="ttdeci">unsigned duration</div><div class="ttdoc">Duration in number of symbols. Values: (1..maxCORESETDuration).</div><div class="ttdef"><b>Definition</b> coreset.h:71</div></div>
<div class="ttc" id="astructsrsran_1_1dci__context__information_1_1decision__context_html_a6c2c48e3d8dc6fab8da7bb0e3945166f"><div class="ttname"><a href="../../d1/d4f/structsrsran_1_1dci__context__information_1_1decision__context.html#a6c2c48e3d8dc6fab8da7bb0e3945166f">srsran::dci_context_information::decision_context::harq_feedback_timing</a></div><div class="ttdeci">optional&lt; unsigned &gt; harq_feedback_timing</div><div class="ttdoc">Number of slots the UE is expected to wait before transmitting a DL HARQ-ACK, upon a PDSCH reception.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:128</div></div>
<div class="ttc" id="astructsrsran_1_1dl__msg__alloc_1_1decision__context_html_a2114ff853966185998cc2dfc5295d92b"><div class="ttname"><a href="../../d9/ddd/structsrsran_1_1dl__msg__alloc_1_1decision__context.html#a2114ff853966185998cc2dfc5295d92b">srsran::dl_msg_alloc::decision_context::olla_offset</a></div><div class="ttdeci">optional&lt; float &gt; olla_offset</div><div class="ttdoc">Offset that the OLLA algorithm applied to the DL MCS candidate to account for channel impairments.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:229</div></div>
<div class="ttc" id="astructsrsran_1_1dl__msg__alloc_1_1decision__context_html_a24fc0edcea4d8aa5e41b32289a25f7c3"><div class="ttname"><a href="../../d9/ddd/structsrsran_1_1dl__msg__alloc_1_1decision__context.html#a24fc0edcea4d8aa5e41b32289a25f7c3">srsran::dl_msg_alloc::decision_context::k1</a></div><div class="ttdeci">unsigned k1</div><div class="ttdoc">Chosen k1 delay to receive UCI HARQ-ACK.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:223</div></div>
<div class="ttc" id="astructsrsran_1_1dl__msg__alloc_1_1decision__context_html_a2dc690ee43db0d22302da6ec57964c6d"><div class="ttname"><a href="../../d9/ddd/structsrsran_1_1dl__msg__alloc_1_1decision__context.html#a2dc690ee43db0d22302da6ec57964c6d">srsran::dl_msg_alloc::decision_context::nof_retxs</a></div><div class="ttdeci">unsigned nof_retxs</div><div class="ttdoc">Number of times the HARQ process has been retransmitted.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:227</div></div>
<div class="ttc" id="astructsrsran_1_1dl__msg__alloc_1_1decision__context_html_a5a87ff9870306599830438972d164a5d"><div class="ttname"><a href="../../d9/ddd/structsrsran_1_1dl__msg__alloc_1_1decision__context.html#a5a87ff9870306599830438972d164a5d">srsran::dl_msg_alloc::decision_context::ue_index</a></div><div class="ttdeci">du_ue_index_t ue_index</div><div class="ttdoc">UE index of allocated UE.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:221</div></div>
<div class="ttc" id="astructsrsran_1_1dl__msg__alloc_1_1decision__context_html_acd34d6a236d696dac52ab0fbd08f8f22"><div class="ttname"><a href="../../d9/ddd/structsrsran_1_1dl__msg__alloc_1_1decision__context.html#acd34d6a236d696dac52ab0fbd08f8f22">srsran::dl_msg_alloc::decision_context::ss_id</a></div><div class="ttdeci">search_space_id ss_id</div><div class="ttdoc">Chosen search space id.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:225</div></div>
<div class="ttc" id="astructsrsran_1_1dl__msg__alloc_html"><div class="ttname"><a href="../../d3/dcc/structsrsran_1_1dl__msg__alloc.html">srsran::dl_msg_alloc</a></div><div class="ttdoc">Dedicated DL Grant for UEs.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:213</div></div>
<div class="ttc" id="astructsrsran_1_1grant__info_html"><div class="ttname"><a href="../../de/dbd/structsrsran_1_1grant__info.html">srsran::grant_info</a></div><div class="ttdoc">Parameters of a grant allocation in the cell resource grid.</div><div class="ttdef"><b>Definition</b> resource_grid.h:54</div></div>
<div class="ttc" id="astructsrsran_1_1pdcch__config__common_html_abb3e2d05a704bec469946b206ad200f7"><div class="ttname"><a href="../../d1/d67/structsrsran_1_1pdcch__config__common.html#abb3e2d05a704bec469946b206ad200f7">srsran::pdcch_config_common::ra_search_space_id</a></div><div class="ttdeci">search_space_id ra_search_space_id</div><div class="ttdoc">SearchSpace of RA procedure. If field is invalid, the UE does not receive RAR in this BWP.</div><div class="ttdef"><b>Definition</b> bwp_configuration.h:56</div></div>
<div class="ttc" id="astructsrsran_1_1pdcch__dl__information_html"><div class="ttname"><a href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html">srsran::pdcch_dl_information</a></div><div class="ttdoc">PDCCH DL allocation.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:133</div></div>
<div class="ttc" id="astructsrsran_1_1pdcch__dl__information_html_a7d58e4814244671ba0903fe9c58fa337"><div class="ttname"><a href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html#a7d58e4814244671ba0903fe9c58fa337">srsran::pdcch_dl_information::dci</a></div><div class="ttdeci">dci_dl_info dci</div><div class="ttdoc">DL DCI unpacked content.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:137</div></div>
<div class="ttc" id="astructsrsran_1_1pdcch__dl__information_html_a9a8b5db2a28afcd115c3adc4c5d0212d"><div class="ttname"><a href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html#a9a8b5db2a28afcd115c3adc4c5d0212d">srsran::pdcch_dl_information::ctx</a></div><div class="ttdeci">dci_context_information ctx</div><div class="ttdoc">Context associated with PDCCH allocation.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:135</div></div>
<div class="ttc" id="astructsrsran_1_1pdsch__config__params_html"><div class="ttname"><a href="../../d7/df3/structsrsran_1_1pdsch__config__params.html">srsran::pdsch_config_params</a></div><div class="ttdef"><b>Definition</b> sch_pdu_builder.h:35</div></div>
<div class="ttc" id="astructsrsran_1_1pdsch__time__domain__resource__allocation_html"><div class="ttname"><a href="../../d3/d05/structsrsran_1_1pdsch__time__domain__resource__allocation.html">srsran::pdsch_time_domain_resource_allocation</a></div><div class="ttdef"><b>Definition</b> bwp_configuration.h:97</div></div>
<div class="ttc" id="astructsrsran_1_1sch__mcs__tbs_html"><div class="ttname"><a href="../../d5/d97/structsrsran_1_1sch__mcs__tbs.html">srsran::sch_mcs_tbs</a></div><div class="ttdoc">Container for MCS and TBS results.</div><div class="ttdef"><b>Definition</b> mcs_tbs_calculator.h:36</div></div>
<div class="ttc" id="astructsrsran_1_1sch__mcs__tbs_html_a0e39436a73718f7c879b0df8cbdb6810"><div class="ttname"><a href="../../d5/d97/structsrsran_1_1sch__mcs__tbs.html#a0e39436a73718f7c879b0df8cbdb6810">srsran::sch_mcs_tbs::mcs</a></div><div class="ttdeci">sch_mcs_index mcs</div><div class="ttdoc">MCS to use for the UE's PDSCH and PUSCH.</div><div class="ttdef"><b>Definition</b> mcs_tbs_calculator.h:38</div></div>
<div class="ttc" id="astructsrsran_1_1scheduler__ue__expert__config_html_a489ee2f731f31aa0d2f710253bd62541"><div class="ttname"><a href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#a489ee2f731f31aa0d2f710253bd62541">srsran::scheduler_ue_expert_config::max_pdschs_per_slot</a></div><div class="ttdeci">unsigned max_pdschs_per_slot</div><div class="ttdoc">Maximum number of PDSCH grants per slot.</div><div class="ttdef"><b>Definition</b> scheduler_expert_config.h:71</div></div>
<div class="ttc" id="astructsrsran_1_1scheduler__ue__expert__config_html_a5c3949d57f4a7de1391f092b4288c352"><div class="ttname"><a href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#a5c3949d57f4a7de1391f092b4288c352">srsran::scheduler_ue_expert_config::max_pdcch_alloc_attempts_per_slot</a></div><div class="ttdeci">unsigned max_pdcch_alloc_attempts_per_slot</div><div class="ttdoc">Maximum number of PDCCH grant allocation attempts per slot. Default: Unlimited.</div><div class="ttdef"><b>Definition</b> scheduler_expert_config.h:79</div></div>
<div class="ttc" id="astructsrsran_1_1search__space__configuration_html"><div class="ttname"><a href="../../dd/df5/structsrsran_1_1search__space__configuration.html">srsran::search_space_configuration</a></div><div class="ttdoc">SearchSpace configuration as per TS38.331, &quot;SearchSpace&quot;.</div><div class="ttdef"><b>Definition</b> search_space.h:60</div></div>
<div class="ttc" id="astructsrsran_1_1search__space__configuration_html_ab5df7a88e860e0181fb1c5bd24dd0831"><div class="ttname"><a href="../../dd/df5/structsrsran_1_1search__space__configuration.html#ab5df7a88e860e0181fb1c5bd24dd0831">srsran::search_space_configuration::get_first_symbol_index</a></div><div class="ttdeci">unsigned get_first_symbol_index(uint8_t ssb_beam_idx=0) const</div><div class="ttdoc">Returns the first monitoring symbol for the current SearchSpace.</div><div class="ttdef"><b>Definition</b> search_space.h:209</div></div>
<div class="ttc" id="astructsrsran_1_1search__space__configuration_html_af62d83a85585b358f7626a3ccfe1005d"><div class="ttname"><a href="../../dd/df5/structsrsran_1_1search__space__configuration.html#af62d83a85585b358f7626a3ccfe1005d">srsran::search_space_configuration::get_id</a></div><div class="ttdeci">search_space_id get_id() const</div><div class="ttdoc">Returns Id of the SearchSpace.</div><div class="ttdef"><b>Definition</b> search_space.h:111</div></div>
<div class="ttc" id="astructsrsran_1_1search__space__info_html"><div class="ttname"><a href="../../de/d65/structsrsran_1_1search__space__info.html">srsran::search_space_info</a></div><div class="ttdoc">Grouping of common and UE-dedicated information associated with a given search space.</div><div class="ttdef"><b>Definition</b> ue_configuration.h:53</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acc2a16bc1d10fb89a00d487e6d95b805" name="acc2a16bc1d10fb89a00d487e6d95b805"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc2a16bc1d10fb89a00d487e6d95b805">&#9670;&#160;</a></span>allocate_ul_grant()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/def/namespacesrsran.html#adad52e6cbb57b4801efa5bf5b1c11b14">alloc_outcome</a> ue_cell_grid_allocator::allocate_ul_grant </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d6/dbc/structsrsran_1_1ue__pusch__grant.html">ue_pusch_grant</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>grant</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d4/d82/classsrsran_1_1ue__pusch__allocator.html">srsran::ue_pusch_allocator</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  432</span>{</div>
<div class="line"><span class="lineno">  433</span>  srsran_assert(ues.<a class="code hl_function" href="../../dc/df2/classsrsran_1_1ue__repository.html#a8d4b4805828ab1b0375fa323b73c3d6c">contains</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.user-&gt;ue_index), <span class="stringliteral">&quot;Invalid UE candidate index={}&quot;</span>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.user-&gt;ue_index);</div>
<div class="line"><span class="lineno">  434</span>  srsran_assert(has_cell(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index), <span class="stringliteral">&quot;Invalid UE candidate cell_index={}&quot;</span>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index);</div>
<div class="line"><span class="lineno">  435</span>  <span class="keyword">constexpr</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_delay_in_slots</a> = 0;</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>  <span class="keywordflow">if</span> (ul_attempts_count++ &gt;= expert_cfg.<a class="code hl_variable" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#a5c3949d57f4a7de1391f092b4288c352">max_pdcch_alloc_attempts_per_slot</a>) {</div>
<div class="line"><span class="lineno">  438</span>    logger.debug(<span class="stringliteral">&quot;Stopping UL allocations. Cause: Max number of UL PDCCH allocation attempts {} reached.&quot;</span>,</div>
<div class="line"><span class="lineno">  439</span>                 expert_cfg.<a class="code hl_variable" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#a5c3949d57f4a7de1391f092b4288c352">max_pdcch_alloc_attempts_per_slot</a>);</div>
<div class="line"><span class="lineno">  440</span>    <span class="keywordflow">return</span> alloc_outcome::skip_slot;</div>
<div class="line"><span class="lineno">  441</span>  }</div>
<div class="line"><span class="lineno">  442</span> </div>
<div class="line"><span class="lineno">  443</span>  <a class="code hl_class" href="../../de/d8c/classsrsran_1_1ue.html">ue</a>&amp; u = ues[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.user-&gt;ue_index];</div>
<div class="line"><span class="lineno">  444</span> </div>
<div class="line"><span class="lineno">  445</span>  <span class="comment">// Verify UE carrier is active.</span></div>
<div class="line"><span class="lineno">  446</span>  <a class="code hl_class" href="../../d9/d2d/classsrsran_1_1ue__cell.html">ue_cell</a>* ue_cc = u.find_cell(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index);</div>
<div class="line"><span class="lineno">  447</span>  <span class="keywordflow">if</span> (ue_cc == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  448</span>    logger.warning(<span class="stringliteral">&quot;PUSCH allocation failed. Cause: The ue={} carrier with cell_index={} is inactive&quot;</span>,</div>
<div class="line"><span class="lineno">  449</span>                   u.ue_index,</div>
<div class="line"><span class="lineno">  450</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index);</div>
<div class="line"><span class="lineno">  451</span>    <span class="keywordflow">return</span> alloc_outcome::skip_ue;</div>
<div class="line"><span class="lineno">  452</span>  }</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html">ue_cell_configuration</a>&amp; ue_cell_cfg = ue_cc-&gt;cfg();</div>
<div class="line"><span class="lineno">  455</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../d2/d2d/classsrsran_1_1cell__configuration.html">cell_configuration</a>&amp;    cell_cfg    = ue_cell_cfg.cell_cfg_common;</div>
<div class="line"><span class="lineno">  456</span>  <a class="code hl_class" href="../../d2/db4/classsrsran_1_1ul__harq__process.html">ul_harq_process</a>&amp;             <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>        = ue_cc-&gt;harqs.ul_harq(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.h_id);</div>
<div class="line"><span class="lineno">  457</span> </div>
<div class="line"><span class="lineno">  458</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> ue_cc-&gt;<a class="code hl_function" href="../../d9/d2d/classsrsran_1_1ue__cell.html#a5547f22a9e862e932a494f187f17b61a">is_active</a>() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.empty()) {</div>
<div class="line"><span class="lineno">  459</span>    <span class="comment">// newTxs are not allowed for inactive UEs.</span></div>
<div class="line"><span class="lineno">  460</span>    logger.warning(<span class="stringliteral">&quot;PUSCH allocation failed. Cause: The ue={} carrier with cell_index={} is inactive&quot;</span>,</div>
<div class="line"><span class="lineno">  461</span>                   u.ue_index,</div>
<div class="line"><span class="lineno">  462</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index);</div>
<div class="line"><span class="lineno">  463</span>    <span class="keywordflow">return</span> alloc_outcome::skip_ue;</div>
<div class="line"><span class="lineno">  464</span>  }</div>
<div class="line"><span class="lineno">  465</span> </div>
<div class="line"><span class="lineno">  466</span>  <span class="comment">// Find a SearchSpace candidate.</span></div>
<div class="line"><span class="lineno">  467</span>  <span class="keyword">const</span> <a class="code hl_struct" href="../../de/d65/structsrsran_1_1search__space__info.html">search_space_info</a>* <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a> = ue_cell_cfg.<a class="code hl_function" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html#ac98203b0c951eb022845bd8b85bb6613">find_search_space</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id);</div>
<div class="line"><span class="lineno">  468</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a> == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  469</span>    logger.warning(<span class="stringliteral">&quot;Failed to allocate PUSCH. Cause: No valid SearchSpace found.&quot;</span>);</div>
<div class="line"><span class="lineno">  470</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  471</span>  }</div>
<div class="line"><span class="lineno">  472</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;bwp-&gt;bwp_id != ue_cc-&gt;active_bwp_id()) {</div>
<div class="line"><span class="lineno">  473</span>    logger.warning(<span class="stringliteral">&quot;Failed to allocate PUSCH. Cause: Chosen SearchSpace {} does not belong to the active BWP {}&quot;</span>,</div>
<div class="line"><span class="lineno">  474</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id,</div>
<div class="line"><span class="lineno">  475</span>                   ue_cc-&gt;active_bwp_id());</div>
<div class="line"><span class="lineno">  476</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  477</span>  }</div>
<div class="line"><span class="lineno">  478</span>  <span class="keyword">const</span> <a class="code hl_struct" href="../../dd/df5/structsrsran_1_1search__space__configuration.html">search_space_configuration</a>&amp;            ss_cfg       = *<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;cfg;</div>
<div class="line"><span class="lineno">  479</span>  <span class="keyword">const</span> <a class="code hl_struct" href="../../d9/db8/structsrsran_1_1bwp__uplink__common.html">bwp_uplink_common</a>&amp;                     <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">bwp_ul_cmn</a>   = *<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;bwp-&gt;ul_common;</div>
<div class="line"><span class="lineno">  480</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d9/def/namespacesrsran.html#aca64228c7486db8ce1f0a3118e8cedc8">subcarrier_spacing</a>                     scs          = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">bwp_ul_cmn</a>.generic_params.scs;</div>
<div class="line"><span class="lineno">  481</span>  <span class="keyword">const</span> <a class="code hl_struct" href="../../d4/d45/structsrsran_1_1pusch__time__domain__resource__allocation.html">pusch_time_domain_resource_allocation</a>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_td_cfg</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;pusch_time_domain_list[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index];</div>
<div class="line"><span class="lineno">  482</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d9/def/namespacesrsran.html#a635cecd3b3b6716ab9f4b6043d603f9f">dci_ul_rnti_config_type</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_supported_crnti_dci_type</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;get_ul_dci_format() == dci_ul_format::f0_0</div>
<div class="line"><span class="lineno">  483</span>                                                                  ? dci_ul_rnti_config_type::c_rnti_f0_0</div>
<div class="line"><span class="lineno">  484</span>                                                                  : dci_ul_rnti_config_type::c_rnti_f0_1;</div>
<div class="line"><span class="lineno">  485</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d9/def/namespacesrsran.html#a635cecd3b3b6716ab9f4b6043d603f9f">dci_ul_rnti_config_type</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a> =</div>
<div class="line"><span class="lineno">  486</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.empty() ? <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_supported_crnti_dci_type</a> : <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.last_tx_params().dci_cfg_type;</div>
<div class="line"><span class="lineno">  487</span> </div>
<div class="line"><span class="lineno">  488</span>  <span class="comment">// See 3GPP TS 38.213, clause 10.1,</span></div>
<div class="line"><span class="lineno">  489</span>  <span class="comment">// A UE monitors PDCCH candidates in one or more of the following search spaces sets</span></div>
<div class="line"><span class="lineno">  490</span>  <span class="comment">//  - a Type1-PDCCH CSS set configured by ra-SearchSpace in PDCCH-ConfigCommon for a DCI format with</span></div>
<div class="line"><span class="lineno">  491</span>  <span class="comment">//    CRC scrambled by a RA-RNTI, a MsgB-RNTI, or a TC-RNTI on the primary cell.</span></div>
<div class="line"><span class="lineno">  492</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a> == dci_ul_rnti_config_type::tc_rnti_f0_0 <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a></div>
<div class="line"><span class="lineno">  493</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id != cell_cfg.dl_cfg_common.init_dl_bwp.pdcch_common.<a class="code hl_variable" href="../../d1/d67/structsrsran_1_1pdcch__config__common.html#abb3e2d05a704bec469946b206ad200f7">ra_search_space_id</a>) {</div>
<div class="line"><span class="lineno">  494</span>    logger.info(<span class="stringliteral">&quot;Failed to allocate PUSCH. Cause: SearchSpace not valid for re-transmission.&quot;</span>);</div>
<div class="line"><span class="lineno">  495</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  496</span>  }</div>
<div class="line"><span class="lineno">  497</span> </div>
<div class="line"><span class="lineno">  498</span>  <span class="comment">// In case of re-transmission DCI format must remain same and therefore its necessary to find the SS which support</span></div>
<div class="line"><span class="lineno">  499</span>  <span class="comment">// that DCI format.</span></div>
<div class="line"><span class="lineno">  500</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a> != dci_ul_rnti_config_type::tc_rnti_f0_0 <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a> != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_supported_crnti_dci_type</a>) {</div>
<div class="line"><span class="lineno">  501</span>    logger.info(</div>
<div class="line"><span class="lineno">  502</span>        <span class="stringliteral">&quot;rnti={} Failed to allocate PUSCH. Cause: DCI format {} in HARQ retx is not supported in SearchSpace {}.&quot;</span>,</div>
<div class="line"><span class="lineno">  503</span>        u.crnti,</div>
<div class="line"><span class="lineno">  504</span>        dci_ul_rnti_config_format(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.last_tx_params().dci_cfg_type),</div>
<div class="line"><span class="lineno">  505</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id);</div>
<div class="line"><span class="lineno">  506</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  507</span>  }</div>
<div class="line"><span class="lineno">  508</span> </div>
<div class="line"><span class="lineno">  509</span>  <span class="comment">// Fetch PDCCH and PDSCH resource grid allocators.</span></div>
<div class="line"><span class="lineno">  510</span>  <a class="code hl_struct" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a> = get_res_alloc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index)[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_delay_in_slots</a>];</div>
<div class="line"><span class="lineno">  511</span>  <a class="code hl_struct" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a> =</div>
<div class="line"><span class="lineno">  512</span>      get_res_alloc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index)[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_delay_in_slots</a> + <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_td_cfg</a>.k2 + cell_cfg.ntn_cs_koffset];</div>
<div class="line"><span class="lineno">  513</span> </div>
<div class="line"><span class="lineno">  514</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> cell_cfg.is_dl_enabled(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a>.slot)) {</div>
<div class="line"><span class="lineno">  515</span>    logger.warning(<span class="stringliteral">&quot;rnti={} Failed to allocate PUSCH in slot={}. Cause: DL is not active in the PDCCH slot&quot;</span>,</div>
<div class="line"><span class="lineno">  516</span>                   u.crnti,</div>
<div class="line"><span class="lineno">  517</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.slot);</div>
<div class="line"><span class="lineno">  518</span>    <span class="keywordflow">return</span> alloc_outcome::skip_slot;</div>
<div class="line"><span class="lineno">  519</span>  }</div>
<div class="line"><span class="lineno">  520</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> cell_cfg.is_ul_enabled(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.slot)) {</div>
<div class="line"><span class="lineno">  521</span>    logger.warning(<span class="stringliteral">&quot;rnti={} Failed to allocate PUSCH in slot={}. Cause: UL is not active in the PUSCH slot (k2={})&quot;</span>,</div>
<div class="line"><span class="lineno">  522</span>                   u.crnti,</div>
<div class="line"><span class="lineno">  523</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.slot,</div>
<div class="line"><span class="lineno">  524</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_td_cfg</a>.k2);</div>
<div class="line"><span class="lineno">  525</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  526</span>  }</div>
<div class="line"><span class="lineno">  527</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.result.ul.puschs.size() &gt;= expert_cfg.<a class="code hl_variable" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#abe1697c6e83cc3f0a870688b71d1764d">max_puschs_per_slot</a>) {</div>
<div class="line"><span class="lineno">  528</span>    logger.info(<span class="stringliteral">&quot;Failed to allocate PUSCH. Cause: Max number of PUSCHs per slot {} was reached.&quot;</span>,</div>
<div class="line"><span class="lineno">  529</span>                expert_cfg.<a class="code hl_variable" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#abe1697c6e83cc3f0a870688b71d1764d">max_puschs_per_slot</a>);</div>
<div class="line"><span class="lineno">  530</span>    <span class="keywordflow">return</span> alloc_outcome::skip_slot;</div>
<div class="line"><span class="lineno">  531</span>  }</div>
<div class="line"><span class="lineno">  532</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.result.ul.puschs.size() &gt;=</div>
<div class="line"><span class="lineno">  533</span>      expert_cfg.<a class="code hl_variable" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#acd5a312b18e77ecdcb45c36c450a407b">max_ul_grants_per_slot</a> - <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.result.ul.pucchs.size())) {</div>
<div class="line"><span class="lineno">  534</span>    logger.info(<span class="stringliteral">&quot;Failed to allocate PUSCH. Cause: Max number of UL grants per slot {} was reached.&quot;</span>,</div>
<div class="line"><span class="lineno">  535</span>                expert_cfg.<a class="code hl_variable" href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#abe1697c6e83cc3f0a870688b71d1764d">max_puschs_per_slot</a>);</div>
<div class="line"><span class="lineno">  536</span>    <span class="keywordflow">return</span> alloc_outcome::skip_slot;</div>
<div class="line"><span class="lineno">  537</span>  }</div>
<div class="line"><span class="lineno">  538</span> </div>
<div class="line"><span class="lineno">  539</span>  <span class="comment">// Verify there is space in PUSCH and PDCCH result lists for new allocations.</span></div>
<div class="line"><span class="lineno">  540</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.result.ul.puschs.full() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">or</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a>.result.dl.ul_pdcchs.full()) {</div>
<div class="line"><span class="lineno">  541</span>    logger.warning(<span class="stringliteral">&quot;rnti={} Failed to allocate PUSCH in slot={}. Cause: No space available in scheduler output list&quot;</span>,</div>
<div class="line"><span class="lineno">  542</span>                   u.crnti,</div>
<div class="line"><span class="lineno">  543</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.slot);</div>
<div class="line"><span class="lineno">  544</span>    <span class="keywordflow">return</span> alloc_outcome::skip_slot;</div>
<div class="line"><span class="lineno">  545</span>  }</div>
<div class="line"><span class="lineno">  546</span> </div>
<div class="line"><span class="lineno">  547</span>  <span class="comment">// [Implementation-defined] We skip allocation of PUSCH if there is already a PUCCH grant scheduled over the same slot</span></div>
<div class="line"><span class="lineno">  548</span>  <span class="comment">// and the UE is in fallback mode.</span></div>
<div class="line"><span class="lineno">  549</span>  <span class="comment">// NOTE: This is due to the lack of clarity of the TS when it comes to define what \c betaOffsets to use for PUSCH</span></div>
<div class="line"><span class="lineno">  550</span>  <span class="comment">// when the UE does not have a dedicated configuration.</span></div>
<div class="line"><span class="lineno">  551</span>  <span class="keywordflow">if</span> (ue_cc-&gt;is_in_fallback_mode()) {</div>
<div class="line"><span class="lineno">  552</span>    <span class="keyword">const</span> <span class="keyword">auto</span>* <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_grant_it</a> =</div>
<div class="line"><span class="lineno">  553</span>        std::find_if(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.result.ul.pucchs.begin(),</div>
<div class="line"><span class="lineno">  554</span>                     <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.result.ul.pucchs.end(),</div>
<div class="line"><span class="lineno">  555</span>                     [&amp;u](<span class="keyword">const</span> <a class="code hl_struct" href="../../de/d8f/structsrsran_1_1pucch__info.html">pucch_info</a>&amp; pucch_grant) { return pucch_grant.crnti == u.crnti; });</div>
<div class="line"><span class="lineno">  556</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_grant_it</a> != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.result.ul.pucchs.end()) {</div>
<div class="line"><span class="lineno">  557</span>      logger.debug(<span class="stringliteral">&quot;rnti={} Allocation of PUSCH in slot={} skipped. Cause: this UE is in fallback mode and has &quot;</span></div>
<div class="line"><span class="lineno">  558</span>                   <span class="stringliteral">&quot;PUCCH grants scheduled&quot;</span>,</div>
<div class="line"><span class="lineno">  559</span>                   u.crnti,</div>
<div class="line"><span class="lineno">  560</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.slot);</div>
<div class="line"><span class="lineno">  561</span>      <span class="keywordflow">return</span> alloc_outcome::skip_ue;</div>
<div class="line"><span class="lineno">  562</span>    }</div>
<div class="line"><span class="lineno">  563</span>  }</div>
<div class="line"><span class="lineno">  564</span> </div>
<div class="line"><span class="lineno">  565</span>  <span class="comment">// Verify CRBs allocation.</span></div>
<div class="line"><span class="lineno">  566</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;ul_crb_lims.contains(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs)) {</div>
<div class="line"><span class="lineno">  567</span>    logger.warning(<span class="stringliteral">&quot;rnti={} Failed to allocate PUSCH. Cause: CRBs {} allocated outside the BWP {}&quot;</span>,</div>
<div class="line"><span class="lineno">  568</span>                   u.crnti,</div>
<div class="line"><span class="lineno">  569</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  570</span>                   <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">ss_info</a>-&gt;ul_crb_lims);</div>
<div class="line"><span class="lineno">  571</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  572</span>  }</div>
<div class="line"><span class="lineno">  573</span> </div>
<div class="line"><span class="lineno">  574</span>  <span class="comment">// In case of retx, ensure the number of PRBs for the grant did not change.</span></div>
<div class="line"><span class="lineno">  575</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.empty() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs.length() != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.last_tx_params().rbs.type1().length()) {</div>
<div class="line"><span class="lineno">  576</span>    logger.warning(</div>
<div class="line"><span class="lineno">  577</span>        <span class="stringliteral">&quot;rnti={} Failed to allocate PUSCH. Cause: Number of CRBs has to remain constant during retxs (harq-id={}, &quot;</span></div>
<div class="line"><span class="lineno">  578</span>        <span class="stringliteral">&quot;nof_prbs={}!={})&quot;</span>,</div>
<div class="line"><span class="lineno">  579</span>        u.crnti,</div>
<div class="line"><span class="lineno">  580</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.id,</div>
<div class="line"><span class="lineno">  581</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.last_tx_params().rbs.type1().length(),</div>
<div class="line"><span class="lineno">  582</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs.length());</div>
<div class="line"><span class="lineno">  583</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  584</span>  }</div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span>  <span class="comment">// Verify there is no RB collision.</span></div>
<div class="line"><span class="lineno">  587</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.ul_res_grid.collides(scs, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_td_cfg</a>.symbols, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs)) {</div>
<div class="line"><span class="lineno">  588</span>    logger.warning(<span class="stringliteral">&quot;rnti={} Failed to allocate PUSCH. Cause: No space available in scheduler RB resource grid.&quot;</span>,</div>
<div class="line"><span class="lineno">  589</span>                   u.crnti);</div>
<div class="line"><span class="lineno">  590</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  591</span>  }</div>
<div class="line"><span class="lineno">  592</span> </div>
<div class="line"><span class="lineno">  593</span>  <span class="comment">// Allocate PDCCH position.</span></div>
<div class="line"><span class="lineno">  594</span>  <a class="code hl_struct" href="../../d6/d0e/structsrsran_1_1pdcch__ul__information.html">pdcch_ul_information</a>* pdcch =</div>
<div class="line"><span class="lineno">  595</span>      get_pdcch_sched(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index)</div>
<div class="line"><span class="lineno">  596</span>          .<a class="code hl_function" href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html#a47d0018eefa65c2aa4e726e93fb05a16">alloc_ul_pdcch_ue</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a>, u.crnti, ue_cell_cfg, ss_cfg.<a class="code hl_function" href="../../dd/df5/structsrsran_1_1search__space__configuration.html#af62d83a85585b358f7626a3ccfe1005d">get_id</a>(), <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.aggr_lvl);</div>
<div class="line"><span class="lineno">  597</span>  <span class="keywordflow">if</span> (pdcch == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  598</span>    logger.info(<span class="stringliteral">&quot;rnti={}: Failed to allocate PUSCH. Cause: No space in PDCCH.&quot;</span>, u.crnti);</div>
<div class="line"><span class="lineno">  599</span>    <span class="keywordflow">return</span> alloc_outcome::skip_ue;</div>
<div class="line"><span class="lineno">  600</span>  }</div>
<div class="line"><span class="lineno">  601</span> </div>
<div class="line"><span class="lineno">  602</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> nof_harq_ack_bits =</div>
<div class="line"><span class="lineno">  603</span>      get_uci_alloc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index).<a class="code hl_function" href="../../da/d26/classsrsran_1_1uci__allocator.html#a9c7a7c379c79a8815d14d4a0daa17435">get_scheduled_pdsch_counter_in_ue_uci</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>, u.crnti);</div>
<div class="line"><span class="lineno">  604</span> </div>
<div class="line"><span class="lineno">  605</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">is_csi_report_slot</a> =</div>
<div class="line"><span class="lineno">  606</span>      csi_helper::is_csi_reporting_slot(u.<a class="code hl_function" href="../../de/d8c/classsrsran_1_1ue.html#a731245d82c06b3498ca7808f6f308687">get_pcell</a>().cfg().cfg_dedicated(), <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.slot);</div>
<div class="line"><span class="lineno">  607</span> </div>
<div class="line"><span class="lineno">  608</span>  <span class="comment">// Fetch PUSCH parameters based on type of transmission.</span></div>
<div class="line"><span class="lineno">  609</span>  <a class="code hl_struct" href="../../d2/d4a/structsrsran_1_1pusch__config__params.html">pusch_config_params</a> pusch_cfg;</div>
<div class="line"><span class="lineno">  610</span>  <span class="keywordflow">switch</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a>) {</div>
<div class="line"><span class="lineno">  611</span>    <span class="keywordflow">case</span> dci_ul_rnti_config_type::tc_rnti_f0_0:</div>
<div class="line"><span class="lineno">  612</span>      pusch_cfg = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a188c8322d8c26fc620cee9cc2579d2a7">get_pusch_config_f0_0_tc_rnti</a>(cell_cfg, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_td_cfg</a>);</div>
<div class="line"><span class="lineno">  613</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  614</span>    <span class="keywordflow">case</span> dci_ul_rnti_config_type::c_rnti_f0_0:</div>
<div class="line"><span class="lineno">  615</span>      pusch_cfg =</div>
<div class="line"><span class="lineno">  616</span>          <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a1b99f8650ec705314f82f2cf2eea6794">get_pusch_config_f0_0_c_rnti</a>(ue_cell_cfg, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">bwp_ul_cmn</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_td_cfg</a>, nof_harq_ack_bits, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">is_csi_report_slot</a>);</div>
<div class="line"><span class="lineno">  617</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  618</span>    <span class="keywordflow">case</span> dci_ul_rnti_config_type::c_rnti_f0_1:</div>
<div class="line"><span class="lineno">  619</span>      pusch_cfg = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a79c60f1a36e31fb93f87c74488a9dfc4">get_pusch_config_f0_1_c_rnti</a>(ue_cell_cfg,</div>
<div class="line"><span class="lineno">  620</span>                                               <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_td_cfg</a>,</div>
<div class="line"><span class="lineno">  621</span>                                               ue_cc-&gt;<a class="code hl_function" href="../../d9/d2d/classsrsran_1_1ue__cell.html#a9ec269dbea62873f276ab52989a5df1d">channel_state_manager</a>().<a class="code hl_function" href="../../da/d83/classsrsran_1_1ue__channel__state__manager.html#abf82a4f102d9f9b559edb435cbbfeb43">get_nof_ul_layers</a>(),</div>
<div class="line"><span class="lineno">  622</span>                                               nof_harq_ack_bits,</div>
<div class="line"><span class="lineno">  623</span>                                               <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">is_csi_report_slot</a>);</div>
<div class="line"><span class="lineno">  624</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  625</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  626</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a630688b51219f81c5a47ec5650326afc">report_fatal_error</a>(<span class="stringliteral">&quot;Unsupported PDCCH DCI UL format&quot;</span>);</div>
<div class="line"><span class="lineno">  627</span>  }</div>
<div class="line"><span class="lineno">  628</span> </div>
<div class="line"><span class="lineno">  629</span>  <span class="comment">// Compute MCS and TBS for this transmission.</span></div>
<div class="line"><span class="lineno">  630</span>  <a class="code hl_class" href="../../d1/d57/classsrsran_1_1optional.html">optional&lt;sch_mcs_tbs&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>;</div>
<div class="line"><span class="lineno">  631</span>  <span class="comment">// If it&#39;s a new Tx, compute the MCS and TBS from SNR, payload size, and available RBs.</span></div>
<div class="line"><span class="lineno">  632</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.empty()) {</div>
<div class="line"><span class="lineno">  633</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#af8840579fc38bd5b2f9605e73f2e2ee0">compute_ul_mcs_tbs</a>(pusch_cfg, ue_cell_cfg, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.mcs, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs.length());</div>
<div class="line"><span class="lineno">  634</span>  }</div>
<div class="line"><span class="lineno">  635</span>  <span class="comment">// If it&#39;s a reTx, fetch the MCS and TBS from the previous transmission.</span></div>
<div class="line"><span class="lineno">  636</span>  <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  637</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.emplace(<a class="code hl_struct" href="../../d5/d97/structsrsran_1_1sch__mcs__tbs.html">sch_mcs_tbs</a>{.<a class="code hl_variable" href="../../d5/d97/structsrsran_1_1sch__mcs__tbs.html#a0e39436a73718f7c879b0df8cbdb6810">mcs</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.last_tx_params().mcs, .tbs = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.last_tx_params().tbs_bytes});</div>
<div class="line"><span class="lineno">  638</span>  }</div>
<div class="line"><span class="lineno">  639</span> </div>
<div class="line"><span class="lineno">  640</span>  <span class="comment">// If there is not MCS-TBS info, it means no MCS exists such that the effective code rate is &lt;= 0.95.</span></div>
<div class="line"><span class="lineno">  641</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.has_value()) {</div>
<div class="line"><span class="lineno">  642</span>    logger.warning(</div>
<div class="line"><span class="lineno">  643</span>        <span class="stringliteral">&quot;rnti={} Failed to allocate PUSCH. Cause: no MCS such that code rate &lt;= 0.95 with this &quot;</span></div>
<div class="line"><span class="lineno">  644</span>        <span class="stringliteral">&quot;configuration: mcs={} crbs={} symbols={} nof_oh={} tb-sc-field={} layers={} pi2bpsk={} &quot;</span></div>
<div class="line"><span class="lineno">  645</span>        <span class="stringliteral">&quot;harq_bits={} csi1_bits={} csi2_bits={} mcs_table_idx={} dmrs_A_pos={} is_dmrs_type2={} dmrs_add_pos_idx={}&quot;</span>,</div>
<div class="line"><span class="lineno">  646</span>        u.crnti,</div>
<div class="line"><span class="lineno">  647</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.mcs.to_uint(),</div>
<div class="line"><span class="lineno">  648</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  649</span>        pusch_cfg.symbols,</div>
<div class="line"><span class="lineno">  650</span>        pusch_cfg.nof_oh_prb,</div>
<div class="line"><span class="lineno">  651</span>        pusch_cfg.tb_scaling_field,</div>
<div class="line"><span class="lineno">  652</span>        pusch_cfg.nof_layers,</div>
<div class="line"><span class="lineno">  653</span>        pusch_cfg.tp_pi2bpsk_present ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>,</div>
<div class="line"><span class="lineno">  654</span>        pusch_cfg.nof_harq_ack_bits,</div>
<div class="line"><span class="lineno">  655</span>        pusch_cfg.nof_csi_part1_bits,</div>
<div class="line"><span class="lineno">  656</span>        pusch_cfg.max_nof_csi_part2_bits,</div>
<div class="line"><span class="lineno">  657</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">static_cast</a>&lt;<a class="code hl_class" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt;(pusch_cfg.mcs_table),</div>
<div class="line"><span class="lineno">  658</span>        ue_cell_cfg.cell_cfg_common.dmrs_typeA_pos == <a class="code hl_enumeration" href="../../d9/def/namespacesrsran.html#a3c5416bf7ff59c183bb2047d936b55ef">dmrs_typeA_position</a>::pos2 ? <span class="stringliteral">&quot;pos2&quot;</span> : <span class="stringliteral">&quot;pos3&quot;</span>,</div>
<div class="line"><span class="lineno">  659</span>        ue_cell_cfg.cfg_dedicated().ul_config-&gt;init_ul_bwp.pusch_cfg-&gt;pusch_mapping_type_a_dmrs.value().is_dmrs_type2</div>
<div class="line"><span class="lineno">  660</span>            ? <span class="stringliteral">&quot;yes&quot;</span></div>
<div class="line"><span class="lineno">  661</span>            : <span class="stringliteral">&quot;no&quot;</span>,</div>
<div class="line"><span class="lineno">  662</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">static_cast</a>&lt;<a class="code hl_class" href="../../d0/d1d/classunsigned.html">unsigned</a>&gt;(ue_cell_cfg.cfg_dedicated()</div>
<div class="line"><span class="lineno">  663</span>                                  .ul_config-&gt;init_ul_bwp.pusch_cfg-&gt;pusch_mapping_type_a_dmrs.value()</div>
<div class="line"><span class="lineno">  664</span>                                  .additional_positions));</div>
<div class="line"><span class="lineno">  665</span>    get_pdcch_sched(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index).<a class="code hl_function" href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html#a2c7d3c611349eaa40e7e39a5fde0c9be">cancel_last_pdcch</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdcch_alloc</a>);</div>
<div class="line"><span class="lineno">  666</span>    <span class="keywordflow">return</span> alloc_outcome::invalid_params;</div>
<div class="line"><span class="lineno">  667</span>  }</div>
<div class="line"><span class="lineno">  668</span> </div>
<div class="line"><span class="lineno">  669</span>  <span class="comment">// Mark resources as occupied in the ResourceGrid.</span></div>
<div class="line"><span class="lineno">  670</span>  <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.ul_res_grid.fill(<a class="code hl_struct" href="../../de/dbd/structsrsran_1_1grant__info.html">grant_info</a>{scs, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_td_cfg</a>.symbols, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs});</div>
<div class="line"><span class="lineno">  671</span> </div>
<div class="line"><span class="lineno">  672</span>  <span class="comment">// Remove NTN offset when adding slot to HARQ process.</span></div>
<div class="line"><span class="lineno">  673</span>  <a class="code hl_class" href="../../df/d3c/classsrsran_1_1slot__point.html">slot_point</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">harq_slot</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.slot - ue_cell_cfg.cell_cfg_common.ntn_cs_koffset;</div>
<div class="line"><span class="lineno">  674</span>  <span class="comment">// Allocate UE UL HARQ.</span></div>
<div class="line"><span class="lineno">  675</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.empty()) {</div>
<div class="line"><span class="lineno">  676</span>    <span class="comment">// It is a new tx.</span></div>
<div class="line"><span class="lineno">  677</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.new_tx(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">harq_slot</a>, expert_cfg.max_nof_harq_retxs);</div>
<div class="line"><span class="lineno">  678</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  679</span>    <span class="comment">// It is a retx.</span></div>
<div class="line"><span class="lineno">  680</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.new_retx(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">harq_slot</a>);</div>
<div class="line"><span class="lineno">  681</span>  }</div>
<div class="line"><span class="lineno">  682</span> </div>
<div class="line"><span class="lineno">  683</span>  <span class="comment">// Compute total DAI. See TS 38.213, 9.1.3.2.</span></div>
<div class="line"><span class="lineno">  684</span>  <span class="comment">// Total DAI provides total number of transmissions at the end of each interval (slot in a cell). Values range from 1</span></div>
<div class="line"><span class="lineno">  685</span>  <span class="comment">// to 4.</span></div>
<div class="line"><span class="lineno">  686</span>  <span class="comment">// If a UE is not provided PDSCH-CodeBlockGroupTransmission and the UE is scheduled for a PUSCH transmission by</span></div>
<div class="line"><span class="lineno">  687</span>  <span class="comment">// DCI format 0_1 with DAI field value V_T_DAI_UL = 4 and the UE has not received any PDCCH within the monitoring</span></div>
<div class="line"><span class="lineno">  688</span>  <span class="comment">// occasions for PDCCH with DCI format 1_0 or DCI format 1_1 for scheduling PDSCH receptions or SPS PDSCH</span></div>
<div class="line"><span class="lineno">  689</span>  <span class="comment">// release on any serving cell c and the UE does not have HARQ-ACK information in response to a SPS PDSCH</span></div>
<div class="line"><span class="lineno">  690</span>  <span class="comment">// reception to multiplex in the PUSCH, the UE does not multiplex HARQ-ACK information in the PUSCH transmission.</span></div>
<div class="line"><span class="lineno">  691</span>  <span class="comment">// NOTE: DAI is encoded as per left most column in Table 9.1.3-2 of TS 38.213.</span></div>
<div class="line"><span class="lineno">  692</span>  <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dai</a> = 3;</div>
<div class="line"><span class="lineno">  693</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a> == dci_ul_rnti_config_type::c_rnti_f0_1) {</div>
<div class="line"><span class="lineno">  694</span>    <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">total_harq_ack_in_uci</a> = nof_harq_ack_bits;</div>
<div class="line"><span class="lineno">  695</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">total_harq_ack_in_uci</a> != 0) {</div>
<div class="line"><span class="lineno">  696</span>      <span class="comment">// See TS 38.213, Table 9.1.3-2. dai value below maps to the leftmost column in the table.</span></div>
<div class="line"><span class="lineno">  697</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dai</a> = ((<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">total_harq_ack_in_uci</a> - 1) % 4);</div>
<div class="line"><span class="lineno">  698</span>    }</div>
<div class="line"><span class="lineno">  699</span>  }</div>
<div class="line"><span class="lineno">  700</span> </div>
<div class="line"><span class="lineno">  701</span>  <span class="comment">// Fill UL PDCCH DCI.</span></div>
<div class="line"><span class="lineno">  702</span>  <a class="code hl_class" href="../../d4/dff/classuint8__t.html">uint8_t</a> rv = ue_cc-&gt;get_pusch_rv(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>);</div>
<div class="line"><span class="lineno">  703</span>  <span class="keywordflow">switch</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dci_type</a>) {</div>
<div class="line"><span class="lineno">  704</span>    <span class="keywordflow">case</span> dci_ul_rnti_config_type::tc_rnti_f0_0:</div>
<div class="line"><span class="lineno">  705</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#adbe5af22eaca44589440aa0edb4b8bc0">build_dci_f0_0_tc_rnti</a>(pdcch-&gt;<a class="code hl_variable" href="../../d6/d0e/structsrsran_1_1pdcch__ul__information.html#acf8a1b3025449226cbe3703229c1137e">dci</a>,</div>
<div class="line"><span class="lineno">  706</span>                             *ue_cell_cfg.bwp(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a41c7236508881761bbd602d002833e8e">to_bwp_id</a>(0)).dl_common,</div>
<div class="line"><span class="lineno">  707</span>                             ue_cell_cfg.bwp(ue_cc-&gt;active_bwp_id()).ul_common-&gt;generic_params,</div>
<div class="line"><span class="lineno">  708</span>                             <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.<a class="code hl_variable" href="../../d4/da4/structsrsran_1_1bwp__configuration.html#ad7e6a6961052ba5b05ecb93aa0b9510f">crbs</a>,</div>
<div class="line"><span class="lineno">  709</span>                             <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index,</div>
<div class="line"><span class="lineno">  710</span>                             <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value().mcs,</div>
<div class="line"><span class="lineno">  711</span>                             rv,</div>
<div class="line"><span class="lineno">  712</span>                             <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>);</div>
<div class="line"><span class="lineno">  713</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  714</span>    <span class="keywordflow">case</span> dci_ul_rnti_config_type::c_rnti_f0_0:</div>
<div class="line"><span class="lineno">  715</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a5a5a682002e7df26aafe0563da08cf74">build_dci_f0_0_c_rnti</a>(</div>
<div class="line"><span class="lineno">  716</span>          pdcch-&gt;<a class="code hl_variable" href="../../d6/d0e/structsrsran_1_1pdcch__ul__information.html#acf8a1b3025449226cbe3703229c1137e">dci</a>, ue_cell_cfg, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value().mcs, rv, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>);</div>
<div class="line"><span class="lineno">  717</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  718</span>    <span class="keywordflow">case</span> dci_ul_rnti_config_type::c_rnti_f0_1:</div>
<div class="line"><span class="lineno">  719</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a17d42ddb858609995659056831889226">build_dci_f0_1_c_rnti</a>(pdcch-&gt;<a class="code hl_variable" href="../../d6/d0e/structsrsran_1_1pdcch__ul__information.html#acf8a1b3025449226cbe3703229c1137e">dci</a>,</div>
<div class="line"><span class="lineno">  720</span>                            ue_cell_cfg,</div>
<div class="line"><span class="lineno">  721</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.ss_id,</div>
<div class="line"><span class="lineno">  722</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  723</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.time_res_index,</div>
<div class="line"><span class="lineno">  724</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value().mcs,</div>
<div class="line"><span class="lineno">  725</span>                            rv,</div>
<div class="line"><span class="lineno">  726</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>,</div>
<div class="line"><span class="lineno">  727</span>                            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">dai</a>,</div>
<div class="line"><span class="lineno">  728</span>                            ue_cc-&gt;<a class="code hl_function" href="../../d9/d2d/classsrsran_1_1ue__cell.html#a9ec269dbea62873f276ab52989a5df1d">channel_state_manager</a>().<a class="code hl_function" href="../../da/d83/classsrsran_1_1ue__channel__state__manager.html#abf82a4f102d9f9b559edb435cbbfeb43">get_nof_ul_layers</a>());</div>
<div class="line"><span class="lineno">  729</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  730</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  731</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a630688b51219f81c5a47ec5650326afc">report_fatal_error</a>(<span class="stringliteral">&quot;Unsupported PDCCH UL DCI format&quot;</span>);</div>
<div class="line"><span class="lineno">  732</span>  }</div>
<div class="line"><span class="lineno">  733</span> </div>
<div class="line"><span class="lineno">  734</span>  <span class="comment">// Fill PUSCH.</span></div>
<div class="line"><span class="lineno">  735</span>  <a class="code hl_struct" href="../../dd/df1/structsrsran_1_1ul__sched__info.html">ul_sched_info</a>&amp; msg    = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>.result.ul.puschs.emplace_back();</div>
<div class="line"><span class="lineno">  736</span>  msg.context.ue_index  = u.ue_index;</div>
<div class="line"><span class="lineno">  737</span>  msg.context.ss_id     = ss_cfg.<a class="code hl_function" href="../../dd/df5/structsrsran_1_1search__space__configuration.html#af62d83a85585b358f7626a3ccfe1005d">get_id</a>();</div>
<div class="line"><span class="lineno">  738</span>  msg.context.<a class="code hl_variable" href="../../d2/df9/structsrsran_1_1ul__sched__info_1_1decision__context.html#a7eaef783726e75630a1ed8cad748813f">k2</a>        = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_td_cfg</a>.k2;</div>
<div class="line"><span class="lineno">  739</span>  msg.context.<a class="code hl_variable" href="../../d2/df9/structsrsran_1_1ul__sched__info_1_1decision__context.html#a72d92f4c61ac0bb88f22a59c2e36e813">nof_retxs</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.tb().nof_retxs;</div>
<div class="line"><span class="lineno">  740</span>  <span class="keywordflow">if</span> (msg.context.<a class="code hl_variable" href="../../d2/df9/structsrsran_1_1ul__sched__info_1_1decision__context.html#a72d92f4c61ac0bb88f22a59c2e36e813">nof_retxs</a> == 0 <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> ue_cc-&gt;link_adaptation_controller().<a class="code hl_function" href="../../dc/d07/classsrsran_1_1ue__link__adaptation__controller.html#a57ba034a9544eacfde3ad60284e71cab">is_ul_olla_enabled</a>()) {</div>
<div class="line"><span class="lineno">  741</span>    msg.context.<a class="code hl_variable" href="../../d2/df9/structsrsran_1_1ul__sched__info_1_1decision__context.html#a546397d33dc6fa0fc9b325cf3761e482">olla_offset</a> = ue_cc-&gt;link_adaptation_controller().<a class="code hl_function" href="../../dc/d07/classsrsran_1_1ue__link__adaptation__controller.html#a8bf5045f421cf50f3c87c366ca7865fa">ul_snr_offset_db</a>();</div>
<div class="line"><span class="lineno">  742</span>  }</div>
<div class="line"><span class="lineno">  743</span>  <span class="keywordflow">switch</span> (pdcch-&gt;<a class="code hl_variable" href="../../d6/d0e/structsrsran_1_1pdcch__ul__information.html#acf8a1b3025449226cbe3703229c1137e">dci</a>.type) {</div>
<div class="line"><span class="lineno">  744</span>    <span class="keywordflow">case</span> dci_ul_rnti_config_type::tc_rnti_f0_0:</div>
<div class="line"><span class="lineno">  745</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a7bc02b56e3a9fe3f95b6bf6b634c79a2">build_pusch_f0_0_tc_rnti</a>(msg.pusch_cfg,</div>
<div class="line"><span class="lineno">  746</span>                               pusch_cfg,</div>
<div class="line"><span class="lineno">  747</span>                               <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value().tbs,</div>
<div class="line"><span class="lineno">  748</span>                               u.crnti,</div>
<div class="line"><span class="lineno">  749</span>                               cell_cfg,</div>
<div class="line"><span class="lineno">  750</span>                               pdcch-&gt;<a class="code hl_variable" href="../../d6/d0e/structsrsran_1_1pdcch__ul__information.html#acf8a1b3025449226cbe3703229c1137e">dci</a>.tc_rnti_f0_0,</div>
<div class="line"><span class="lineno">  751</span>                               <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  752</span>                               <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.tb().nof_retxs == 0);</div>
<div class="line"><span class="lineno">  753</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  754</span>    <span class="keywordflow">case</span> dci_ul_rnti_config_type::c_rnti_f0_0:</div>
<div class="line"><span class="lineno">  755</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#aed9e662a0981f4eba5c749e0dde3f927">build_pusch_f0_0_c_rnti</a>(msg.pusch_cfg,</div>
<div class="line"><span class="lineno">  756</span>                              u.crnti,</div>
<div class="line"><span class="lineno">  757</span>                              pusch_cfg,</div>
<div class="line"><span class="lineno">  758</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value().tbs,</div>
<div class="line"><span class="lineno">  759</span>                              cell_cfg,</div>
<div class="line"><span class="lineno">  760</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">bwp_ul_cmn</a>,</div>
<div class="line"><span class="lineno">  761</span>                              pdcch-&gt;<a class="code hl_variable" href="../../d6/d0e/structsrsran_1_1pdcch__ul__information.html#acf8a1b3025449226cbe3703229c1137e">dci</a>.c_rnti_f0_0,</div>
<div class="line"><span class="lineno">  762</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  763</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.tb().nof_retxs == 0);</div>
<div class="line"><span class="lineno">  764</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  765</span>    <span class="keywordflow">case</span> dci_ul_rnti_config_type::c_rnti_f0_1:</div>
<div class="line"><span class="lineno">  766</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a65abbade9591ee4957e7d80f33791e39">build_pusch_f0_1_c_rnti</a>(msg.pusch_cfg,</div>
<div class="line"><span class="lineno">  767</span>                              u.crnti,</div>
<div class="line"><span class="lineno">  768</span>                              pusch_cfg,</div>
<div class="line"><span class="lineno">  769</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">mcs_tbs_info</a>.value(),</div>
<div class="line"><span class="lineno">  770</span>                              ue_cell_cfg,</div>
<div class="line"><span class="lineno">  771</span>                              ss_cfg.<a class="code hl_function" href="../../dd/df5/structsrsran_1_1search__space__configuration.html#af62d83a85585b358f7626a3ccfe1005d">get_id</a>(),</div>
<div class="line"><span class="lineno">  772</span>                              pdcch-&gt;<a class="code hl_variable" href="../../d6/d0e/structsrsran_1_1pdcch__ul__information.html#acf8a1b3025449226cbe3703229c1137e">dci</a>.c_rnti_f0_1,</div>
<div class="line"><span class="lineno">  773</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.crbs,</div>
<div class="line"><span class="lineno">  774</span>                              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>);</div>
<div class="line"><span class="lineno">  775</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  776</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  777</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a630688b51219f81c5a47ec5650326afc">report_fatal_error</a>(<span class="stringliteral">&quot;Unsupported PDCCH UL DCI format&quot;</span>);</div>
<div class="line"><span class="lineno">  778</span>  }</div>
<div class="line"><span class="lineno">  779</span> </div>
<div class="line"><span class="lineno">  780</span>  <span class="comment">// Check if there is any UCI grant allocated on the PUCCH that can be moved to the PUSCH.</span></div>
<div class="line"><span class="lineno">  781</span>  get_uci_alloc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">grant</a>.cell_index).<a class="code hl_function" href="../../da/d26/classsrsran_1_1uci__allocator.html#a7dc8ff45c9cfad1a418ce24f2c06d1ff">multiplex_uci_on_pusch</a>(msg, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_alloc</a>, ue_cell_cfg, u.crnti);</div>
<div class="line"><span class="lineno">  782</span> </div>
<div class="line"><span class="lineno">  783</span>  <span class="comment">// Save set PDCCH and PUSCH PDU parameters in HARQ process.</span></div>
<div class="line"><span class="lineno">  784</span>  <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">h_ul</a>.save_alloc_params(pdcch-&gt;<a class="code hl_variable" href="../../d6/d0e/structsrsran_1_1pdcch__ul__information.html#acf8a1b3025449226cbe3703229c1137e">dci</a>.type, msg.pusch_cfg);</div>
<div class="line"><span class="lineno">  785</span> </div>
<div class="line"><span class="lineno">  786</span>  <span class="comment">// In case there is a SR pending. Reset it.</span></div>
<div class="line"><span class="lineno">  787</span>  u.<a class="code hl_function" href="../../de/d8c/classsrsran_1_1ue.html#a8f374bc3743fcdd79b84df74c242ae06">reset_sr_indication</a>();</div>
<div class="line"><span class="lineno">  788</span> </div>
<div class="line"><span class="lineno">  789</span>  <span class="keywordflow">return</span> alloc_outcome::success;</div>
<div class="line"><span class="lineno">  790</span>}</div>
<div class="ttc" id="aclasssrsran_1_1pdcch__resource__allocator_html_a47d0018eefa65c2aa4e726e93fb05a16"><div class="ttname"><a href="../../d6/d11/classsrsran_1_1pdcch__resource__allocator.html#a47d0018eefa65c2aa4e726e93fb05a16">srsran::pdcch_resource_allocator::alloc_ul_pdcch_ue</a></div><div class="ttdeci">virtual pdcch_ul_information * alloc_ul_pdcch_ue(cell_slot_resource_allocator &amp;slot_alloc, rnti_t rnti, const ue_cell_configuration &amp;user, search_space_id ss_id, aggregation_level aggr_lvl)=0</div></div>
<div class="ttc" id="aclasssrsran_1_1slot__point_html"><div class="ttname"><a href="../../df/d3c/classsrsran_1_1slot__point.html">srsran::slot_point</a></div><div class="ttdef"><b>Definition</b> slot_point.h:51</div></div>
<div class="ttc" id="aclasssrsran_1_1uci__allocator_html_a7dc8ff45c9cfad1a418ce24f2c06d1ff"><div class="ttname"><a href="../../da/d26/classsrsran_1_1uci__allocator.html#a7dc8ff45c9cfad1a418ce24f2c06d1ff">srsran::uci_allocator::multiplex_uci_on_pusch</a></div><div class="ttdeci">virtual void multiplex_uci_on_pusch(ul_sched_info &amp;pusch_grant, cell_slot_resource_allocator &amp;slot_alloc, const ue_cell_configuration &amp;ue_cell_cfg, rnti_t crnti)=0</div></div>
<div class="ttc" id="aclasssrsran_1_1uci__allocator_html_a9c7a7c379c79a8815d14d4a0daa17435"><div class="ttname"><a href="../../da/d26/classsrsran_1_1uci__allocator.html#a9c7a7c379c79a8815d14d4a0daa17435">srsran::uci_allocator::get_scheduled_pdsch_counter_in_ue_uci</a></div><div class="ttdeci">virtual uint8_t get_scheduled_pdsch_counter_in_ue_uci(cell_slot_resource_allocator &amp;slot_alloc, rnti_t crnti)=0</div></div>
<div class="ttc" id="aclasssrsran_1_1ue__channel__state__manager_html_abf82a4f102d9f9b559edb435cbbfeb43"><div class="ttname"><a href="../../da/d83/classsrsran_1_1ue__channel__state__manager.html#abf82a4f102d9f9b559edb435cbbfeb43">srsran::ue_channel_state_manager::get_nof_ul_layers</a></div><div class="ttdeci">unsigned get_nof_ul_layers() const</div><div class="ttdoc">Fetches the number of recommended layers to be used in UL.</div><div class="ttdef"><b>Definition</b> ue_channel_state_manager.h:53</div></div>
<div class="ttc" id="aclasssrsran_1_1ue__link__adaptation__controller_html_a57ba034a9544eacfde3ad60284e71cab"><div class="ttname"><a href="../../dc/d07/classsrsran_1_1ue__link__adaptation__controller.html#a57ba034a9544eacfde3ad60284e71cab">srsran::ue_link_adaptation_controller::is_ul_olla_enabled</a></div><div class="ttdeci">bool is_ul_olla_enabled() const</div><div class="ttdoc">Checks whether OLLA is enabled for UL.</div><div class="ttdef"><b>Definition</b> ue_link_adaptation_controller.h:60</div></div>
<div class="ttc" id="aclasssrsran_1_1ue__link__adaptation__controller_html_a8bf5045f421cf50f3c87c366ca7865fa"><div class="ttname"><a href="../../dc/d07/classsrsran_1_1ue__link__adaptation__controller.html#a8bf5045f421cf50f3c87c366ca7865fa">srsran::ue_link_adaptation_controller::ul_snr_offset_db</a></div><div class="ttdeci">float ul_snr_offset_db() const</div><div class="ttdoc">Get the value of the UL SNR offset that the OLLA algorithm is currently using.</div><div class="ttdef"><b>Definition</b> ue_link_adaptation_controller.h:54</div></div>
<div class="ttc" id="aclasssrsran_1_1ue_html_a8f374bc3743fcdd79b84df74c242ae06"><div class="ttname"><a href="../../de/d8c/classsrsran_1_1ue.html#a8f374bc3743fcdd79b84df74c242ae06">srsran::ue::reset_sr_indication</a></div><div class="ttdeci">void reset_sr_indication()</div><div class="ttdoc">Once an UL grant is given, the SR status of the UE must be reset.</div><div class="ttdef"><b>Definition</b> ue.h:105</div></div>
<div class="ttc" id="aclasssrsran_1_1ul__harq__process_html"><div class="ttname"><a href="../../d2/db4/classsrsran_1_1ul__harq__process.html">srsran::ul_harq_process</a></div><div class="ttdef"><b>Definition</b> harq_process.h:360</div></div>
<div class="ttc" id="aclassunsigned_html"><div class="ttname"><a href="../../d0/d1d/classunsigned.html">unsigned</a></div></div>
<div class="ttc" id="anamespacesrsran_html_a17d42ddb858609995659056831889226"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a17d42ddb858609995659056831889226">srsran::build_dci_f0_1_c_rnti</a></div><div class="ttdeci">void build_dci_f0_1_c_rnti(dci_ul_info &amp;dci, const ue_cell_configuration &amp;ue_cell_cfg, search_space_id ss_id, const crb_interval &amp;crbs, unsigned time_resource, sch_mcs_index mcs_index, uint8_t rv, const ul_harq_process &amp;h_ul, unsigned total_dai, unsigned nof_layers)</div><div class="ttdoc">Builds DCI f0_1 for C-RNTI.</div><div class="ttdef"><b>Definition</b> dci_builder.cpp:397</div></div>
<div class="ttc" id="anamespacesrsran_html_a188c8322d8c26fc620cee9cc2579d2a7"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a188c8322d8c26fc620cee9cc2579d2a7">srsran::get_pusch_config_f0_0_tc_rnti</a></div><div class="ttdeci">pusch_config_params get_pusch_config_f0_0_tc_rnti(const cell_configuration &amp;cell_cfg, const pusch_time_domain_resource_allocation &amp;pusch_td_cfg)</div><div class="ttdoc">Fetches the PUSCH parameters needed for PUSCH PDU for DCI format 0_0, scrambled by TC-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:142</div></div>
<div class="ttc" id="anamespacesrsran_html_a1b99f8650ec705314f82f2cf2eea6794"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a1b99f8650ec705314f82f2cf2eea6794">srsran::get_pusch_config_f0_0_c_rnti</a></div><div class="ttdeci">pusch_config_params get_pusch_config_f0_0_c_rnti(const ue_cell_configuration &amp;ue_cell_cfg, const bwp_uplink_common &amp;ul_bwp, const pusch_time_domain_resource_allocation &amp;pusch_td_cfg, const unsigned nof_harq_ack_bits, bool is_csi_report_slot)</div><div class="ttdoc">Fetches the PUSCH parameters needed for PUSCH PDU for DCI format 0_0, scrambled by C-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:177</div></div>
<div class="ttc" id="anamespacesrsran_html_a3c5416bf7ff59c183bb2047d936b55ef"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a3c5416bf7ff59c183bb2047d936b55ef">srsran::dmrs_typeA_position</a></div><div class="ttdeci">dmrs_typeA_position</div><div class="ttdoc">Position of first DM-RS for Downlink (see TS 38.211, clause 7.4.1.1.1) and Uplink (see TS 38....</div><div class="ttdef"><b>Definition</b> dmrs.h:29</div></div>
<div class="ttc" id="anamespacesrsran_html_a5a5a682002e7df26aafe0563da08cf74"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a5a5a682002e7df26aafe0563da08cf74">srsran::build_dci_f0_0_c_rnti</a></div><div class="ttdeci">void build_dci_f0_0_c_rnti(dci_ul_info &amp;dci, const ue_cell_configuration &amp;ue_cell_cfg, search_space_id ss_id, const crb_interval &amp;crbs, unsigned time_resource, sch_mcs_index mcs_index, uint8_t rv, const ul_harq_process &amp;h_ul)</div><div class="ttdoc">Builds DCI f0_0 for C-RNTI.</div><div class="ttdef"><b>Definition</b> dci_builder.cpp:349</div></div>
<div class="ttc" id="anamespacesrsran_html_a635cecd3b3b6716ab9f4b6043d603f9f"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a635cecd3b3b6716ab9f4b6043d603f9f">srsran::dci_ul_rnti_config_type</a></div><div class="ttdeci">dci_ul_rnti_config_type</div><div class="ttdoc">Defines which fields are stored in the DCI payload, based on the chosen DCI format and RNTI type.</div><div class="ttdef"><b>Definition</b> scheduler_dci.h:84</div></div>
<div class="ttc" id="anamespacesrsran_html_a65abbade9591ee4957e7d80f33791e39"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a65abbade9591ee4957e7d80f33791e39">srsran::build_pusch_f0_1_c_rnti</a></div><div class="ttdeci">void build_pusch_f0_1_c_rnti(pusch_information &amp;pusch, rnti_t rnti, const pusch_config_params &amp;pusch_cfg, sch_mcs_tbs mcs_tbs_info, const ue_cell_configuration &amp;ue_cell_cfg, search_space_id ss_id, const dci_0_1_configuration &amp;dci_cfg, const crb_interval &amp;crbs, const ul_harq_process &amp;h_ul)</div><div class="ttdoc">Builds PUSCH PDU for DCI format 0_1, scrambled by C-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:644</div></div>
<div class="ttc" id="anamespacesrsran_html_a79c60f1a36e31fb93f87c74488a9dfc4"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a79c60f1a36e31fb93f87c74488a9dfc4">srsran::get_pusch_config_f0_1_c_rnti</a></div><div class="ttdeci">pusch_config_params get_pusch_config_f0_1_c_rnti(const ue_cell_configuration &amp;ue_cell_cfg, const pusch_time_domain_resource_allocation &amp;pusch_td_cfg, unsigned nof_layers, const unsigned nof_harq_ack_bits, bool is_csi_report_slot)</div><div class="ttdoc">Fetches the PUSCH parameters needed for PUSCH PDU for DCI format 0_1, scrambled by C-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:229</div></div>
<div class="ttc" id="anamespacesrsran_html_a7bc02b56e3a9fe3f95b6bf6b634c79a2"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a7bc02b56e3a9fe3f95b6bf6b634c79a2">srsran::build_pusch_f0_0_tc_rnti</a></div><div class="ttdeci">void build_pusch_f0_0_tc_rnti(pusch_information &amp;pusch, const pusch_config_params &amp;pusch_cfg, unsigned tbs_bytes, rnti_t rnti, const cell_configuration &amp;cell_cfg, const dci_0_0_tc_rnti_configuration &amp;dci_cfg, const crb_interval &amp;crbs, bool is_new_data)</div><div class="ttdoc">Builds PUSCH PDU for DCI format 0_0, scrambled by TC-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:550</div></div>
<div class="ttc" id="anamespacesrsran_html_aca64228c7486db8ce1f0a3118e8cedc8"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#aca64228c7486db8ce1f0a3118e8cedc8">srsran::subcarrier_spacing</a></div><div class="ttdeci">subcarrier_spacing</div><div class="ttdoc">Representation of subcarrier spacing.</div><div class="ttdef"><b>Definition</b> subcarrier_spacing.h:34</div></div>
<div class="ttc" id="anamespacesrsran_html_adbe5af22eaca44589440aa0edb4b8bc0"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#adbe5af22eaca44589440aa0edb4b8bc0">srsran::build_dci_f0_0_tc_rnti</a></div><div class="ttdeci">void build_dci_f0_0_tc_rnti(dci_ul_info &amp;dci, const bwp_downlink_common &amp;init_dl_bwp, const bwp_configuration &amp;ul_bwp, const crb_interval &amp;crbs, unsigned time_resource, sch_mcs_index mcs_index, uint8_t rv, const ul_harq_process &amp;h_ul)</div><div class="ttdoc">Builds DCI f0_0 for TC-RNTI, used in Msg3 retxs.</div><div class="ttdef"><b>Definition</b> dci_builder.cpp:303</div></div>
<div class="ttc" id="anamespacesrsran_html_aed9e662a0981f4eba5c749e0dde3f927"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#aed9e662a0981f4eba5c749e0dde3f927">srsran::build_pusch_f0_0_c_rnti</a></div><div class="ttdeci">void build_pusch_f0_0_c_rnti(pusch_information &amp;pusch, rnti_t rnti, const pusch_config_params &amp;pusch_cfg, unsigned tbs_bytes, const cell_configuration &amp;cell_cfg, const bwp_uplink_common &amp;ul_bwp, const dci_0_0_c_rnti_configuration &amp;dci_cfg, const crb_interval &amp;crbs, bool is_new_data)</div><div class="ttdoc">Builds PUSCH PDU for DCI format 0_0, scrambled by C-RNTI.</div><div class="ttdef"><b>Definition</b> sch_pdu_builder.cpp:597</div></div>
<div class="ttc" id="anamespacesrsran_html_af8840579fc38bd5b2f9605e73f2e2ee0"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#af8840579fc38bd5b2f9605e73f2e2ee0">srsran::compute_ul_mcs_tbs</a></div><div class="ttdeci">optional&lt; sch_mcs_tbs &gt; compute_ul_mcs_tbs(const pusch_config_params &amp;pusch_params, const ue_cell_configuration &amp;ue_cell_cfg, sch_mcs_index max_mcs, unsigned nof_prbs)</div><div class="ttdoc">Computes the PUSCH MCS and TBS such that the effective code rate does not exceed 0....</div><div class="ttdef"><b>Definition</b> mcs_tbs_calculator.cpp:224</div></div>
<div class="ttc" id="astructsrsran_1_1bwp__configuration_html_ad7e6a6961052ba5b05ecb93aa0b9510f"><div class="ttname"><a href="../../d4/da4/structsrsran_1_1bwp__configuration.html#ad7e6a6961052ba5b05ecb93aa0b9510f">srsran::bwp_configuration::crbs</a></div><div class="ttdeci">crb_interval crbs</div><div class="ttdoc">Common RBs where the BWP is located. CRB=0 overlaps with pointA.</div><div class="ttdef"><b>Definition</b> bwp_configuration.h:75</div></div>
<div class="ttc" id="astructsrsran_1_1bwp__uplink__common_html"><div class="ttname"><a href="../../d9/db8/structsrsran_1_1bwp__uplink__common.html">srsran::bwp_uplink_common</a></div><div class="ttdef"><b>Definition</b> bwp_configuration.h:167</div></div>
<div class="ttc" id="astructsrsran_1_1pdcch__ul__information_html"><div class="ttname"><a href="../../d6/d0e/structsrsran_1_1pdcch__ul__information.html">srsran::pdcch_ul_information</a></div><div class="ttdoc">PDCCH UL allocation.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:141</div></div>
<div class="ttc" id="astructsrsran_1_1pdcch__ul__information_html_acf8a1b3025449226cbe3703229c1137e"><div class="ttname"><a href="../../d6/d0e/structsrsran_1_1pdcch__ul__information.html#acf8a1b3025449226cbe3703229c1137e">srsran::pdcch_ul_information::dci</a></div><div class="ttdeci">dci_ul_info dci</div><div class="ttdoc">UL DCI unpacked content.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:145</div></div>
<div class="ttc" id="astructsrsran_1_1pucch__info_html"><div class="ttname"><a href="../../de/d8f/structsrsran_1_1pucch__info.html">srsran::pucch_info</a></div><div class="ttdoc">Info about PUCCH used resource.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:475</div></div>
<div class="ttc" id="astructsrsran_1_1pusch__config__params_html"><div class="ttname"><a href="../../d2/d4a/structsrsran_1_1pusch__config__params.html">srsran::pusch_config_params</a></div><div class="ttdef"><b>Definition</b> sch_pdu_builder.h:47</div></div>
<div class="ttc" id="astructsrsran_1_1pusch__time__domain__resource__allocation_html"><div class="ttname"><a href="../../d4/d45/structsrsran_1_1pusch__time__domain__resource__allocation.html">srsran::pusch_time_domain_resource_allocation</a></div><div class="ttdef"><b>Definition</b> bwp_configuration.h:123</div></div>
<div class="ttc" id="astructsrsran_1_1scheduler__ue__expert__config_html_abe1697c6e83cc3f0a870688b71d1764d"><div class="ttname"><a href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#abe1697c6e83cc3f0a870688b71d1764d">srsran::scheduler_ue_expert_config::max_puschs_per_slot</a></div><div class="ttdeci">unsigned max_puschs_per_slot</div><div class="ttdoc">Maximum number of PUSCH grants per slot.</div><div class="ttdef"><b>Definition</b> scheduler_expert_config.h:73</div></div>
<div class="ttc" id="astructsrsran_1_1scheduler__ue__expert__config_html_acd5a312b18e77ecdcb45c36c450a407b"><div class="ttname"><a href="../../d2/d3d/structsrsran_1_1scheduler__ue__expert__config.html#acd5a312b18e77ecdcb45c36c450a407b">srsran::scheduler_ue_expert_config::max_ul_grants_per_slot</a></div><div class="ttdeci">unsigned max_ul_grants_per_slot</div><div class="ttdoc">Maximum number of PUSCH + PUCCH grants per slot.</div><div class="ttdef"><b>Definition</b> scheduler_expert_config.h:77</div></div>
<div class="ttc" id="astructsrsran_1_1ul__sched__info_1_1decision__context_html_a546397d33dc6fa0fc9b325cf3761e482"><div class="ttname"><a href="../../d2/df9/structsrsran_1_1ul__sched__info_1_1decision__context.html#a546397d33dc6fa0fc9b325cf3761e482">srsran::ul_sched_info::decision_context::olla_offset</a></div><div class="ttdeci">optional&lt; float &gt; olla_offset</div><div class="ttdoc">Offset that the OLLA algorithm applied to derive the UL MCS.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:447</div></div>
<div class="ttc" id="astructsrsran_1_1ul__sched__info_1_1decision__context_html_a72d92f4c61ac0bb88f22a59c2e36e813"><div class="ttname"><a href="../../d2/df9/structsrsran_1_1ul__sched__info_1_1decision__context.html#a72d92f4c61ac0bb88f22a59c2e36e813">srsran::ul_sched_info::decision_context::nof_retxs</a></div><div class="ttdeci">unsigned nof_retxs</div><div class="ttdoc">Number of times the HARQ process has been retransmitted.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:443</div></div>
<div class="ttc" id="astructsrsran_1_1ul__sched__info_1_1decision__context_html_a7eaef783726e75630a1ed8cad748813f"><div class="ttname"><a href="../../d2/df9/structsrsran_1_1ul__sched__info_1_1decision__context.html#a7eaef783726e75630a1ed8cad748813f">srsran::ul_sched_info::decision_context::k2</a></div><div class="ttdeci">unsigned k2</div><div class="ttdoc">Chosen k2 delay between UL PDCCH and PUSCH.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:441</div></div>
<div class="ttc" id="astructsrsran_1_1ul__sched__info_html"><div class="ttname"><a href="../../dd/df1/structsrsran_1_1ul__sched__info.html">srsran::ul_sched_info</a></div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:431</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abe20d3757ae24b91489c800a86acf968" name="abe20d3757ae24b91489c800a86acf968"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe20d3757ae24b91489c800a86acf968">&#9670;&#160;</a></span>nof_cells()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t srsran::ue_cell_grid_allocator::nof_cells </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   49</span>{ <span class="keywordflow">return</span> cells.<a class="code hl_function" href="../../d7/da5/classsrsran_1_1slotted__array.html#ada775fc23021dc2c35d3b2339a9b42a1">size</a>(); }</div>
<div class="ttc" id="aclasssrsran_1_1slotted__array_html_ada775fc23021dc2c35d3b2339a9b42a1"><div class="ttname"><a href="../../d7/da5/classsrsran_1_1slotted__array.html#ada775fc23021dc2c35d3b2339a9b42a1">srsran::slotted_array::size</a></div><div class="ttdeci">constexpr size_t size() const noexcept</div><div class="ttdoc">Checks the number of elements stored in the container.</div><div class="ttdef"><b>Definition</b> slotted_array.h:258</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab623952886cb3dd29d7c84a487c3ad01" name="ab623952886cb3dd29d7c84a487c3ad01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab623952886cb3dd29d7c84a487c3ad01">&#9670;&#160;</a></span>slot_indication()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a> ue_cell_grid_allocator::slot_indication </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   51</span>{</div>
<div class="line"><span class="lineno">   52</span>  dl_attempts_count = 0;</div>
<div class="line"><span class="lineno">   53</span>  ul_attempts_count = 0;</div>
<div class="line"><span class="lineno">   54</span>}</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>lib/scheduler/ue_scheduling/<a class="el" href="../../dd/dfe/ue__cell__grid__allocator_8h_source.html">ue_cell_grid_allocator.h</a></li>
<li>lib/scheduler/ue_scheduling/<b>ue_cell_grid_allocator.cpp</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
