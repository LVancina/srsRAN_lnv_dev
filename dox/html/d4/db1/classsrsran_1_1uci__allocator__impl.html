<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>srsRAN Docs: srsran::uci_allocator_impl Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">srsRAN Docs
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/def/namespacesrsran.html">srsran</a></li><li class="navelem"><a class="el" href="../../d4/db1/classsrsran_1_1uci__allocator__impl.html">uci_allocator_impl</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="../../d5/d43/classsrsran_1_1uci__allocator__impl-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">srsran::uci_allocator_impl Class Reference<span class="mlabels"><span class="mlabel">final</span></span></div></div>
</div><!--header-->
<div class="contents">

<p>Implementation of <a class="el" href="../../da/d26/classsrsran_1_1uci__allocator.html">uci_allocator</a> interface.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="../../da/d80/uci__allocator__impl_8h_source.html">uci_allocator_impl.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for srsran::uci_allocator_impl:</div>
<div class="dyncontent">
<div class="center"><img src="../../d9/dcf/classsrsran_1_1uci__allocator__impl__inherit__graph.png" border="0" usemap="#asrsran_1_1uci__allocator__impl_inherit__map" alt="Inheritance graph"/></div>
<map name="asrsran_1_1uci__allocator__impl_inherit__map" id="asrsran_1_1uci__allocator__impl_inherit__map">
<area shape="rect" title="Implementation of uci_allocator interface." alt="" coords="5,253,229,473"/>
<area shape="rect" href="../../da/d26/classsrsran_1_1uci__allocator.html" title="UCI allocator interface. Depending on whether there is an existing PUSCH grant, it allocates the UCI ..." alt="" coords="5,5,229,205"/>
<area shape="poly" title=" " alt="" coords="120,219,120,253,115,253,115,219"/>
</map>
</div>
<div class="dynheader">
Collaboration diagram for srsran::uci_allocator_impl:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d1f/classsrsran_1_1uci__allocator__impl__coll__graph.png" border="0" usemap="#asrsran_1_1uci__allocator__impl_coll__map" alt="Collaboration graph"/></div>
<map name="asrsran_1_1uci__allocator__impl_coll__map" id="asrsran_1_1uci__allocator__impl_coll__map">
<area shape="rect" title="Implementation of uci_allocator interface." alt="" coords="5,253,229,473"/>
<area shape="rect" href="../../da/d26/classsrsran_1_1uci__allocator.html" title="UCI allocator interface. Depending on whether there is an existing PUSCH grant, it allocates the UCI ..." alt="" coords="5,5,229,205"/>
<area shape="poly" title=" " alt="" coords="120,219,120,253,115,253,115,219"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a016335457f6dd1ad6e81c03f0e603d91" id="r_a016335457f6dd1ad6e81c03f0e603d91"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a016335457f6dd1ad6e81c03f0e603d91">uci_allocator_impl</a> (<a class="el" href="../../d8/db0/classsrsran_1_1pucch__allocator.html">pucch_allocator</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_alloc_</a>)</td></tr>
<tr class="separator:a016335457f6dd1ad6e81c03f0e603d91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84eb829ee60066ebf2e38f13386e45c8" id="r_a84eb829ee60066ebf2e38f13386e45c8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a84eb829ee60066ebf2e38f13386e45c8">slot_indication</a> (<a class="el" href="../../df/d3c/classsrsran_1_1slot__point.html">slot_point</a> sl_tx) <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">override</a></td></tr>
<tr class="memdesc:a84eb829ee60066ebf2e38f13386e45c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the internal counter of the allocated PDSCHs to be acknowledged per slot.  <br /></td></tr>
<tr class="separator:a84eb829ee60066ebf2e38f13386e45c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd2cfbdf8a259b7a56d61acd258dabc2" id="r_acd2cfbdf8a259b7a56d61acd258dabc2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d1/d57/classsrsran_1_1optional.html">optional</a>&lt; <a class="el" href="../../d2/d40/structsrsran_1_1uci__allocation.html">uci_allocation</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acd2cfbdf8a259b7a56d61acd258dabc2">alloc_uci_harq_ue</a> (<a class="el" href="../../df/d56/structsrsran_1_1cell__resource__allocator.html">cell_resource_allocator</a> &amp;res_alloc, <a class="el" href="../../d9/def/namespacesrsran.html#a1d83bcd76f2b7c6251855be8472a46f5">rnti_t</a> crnti, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html">ue_cell_configuration</a> &amp;ue_cell_cfg, <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> k0, <a class="el" href="../../de/d4c/classsrsran_1_1span.html">span</a>&lt; <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d4/dff/classuint8__t.html">uint8_t</a> &gt; <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_list</a>, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html">pdcch_dl_information</a> *<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">fallback_dci_info</a>=<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nullptr</a>) <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">override</a></td></tr>
<tr class="separator:acd2cfbdf8a259b7a56d61acd258dabc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fddfb180ae008720176729b6d33e862" id="r_a4fddfb180ae008720176729b6d33e862"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4fddfb180ae008720176729b6d33e862">multiplex_uci_on_pusch</a> (<a class="el" href="../../dd/df1/structsrsran_1_1ul__sched__info.html">ul_sched_info</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_grant</a>, <a class="el" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html">ue_cell_configuration</a> &amp;ue_cell_cfg, <a class="el" href="../../d9/def/namespacesrsran.html#a1d83bcd76f2b7c6251855be8472a46f5">rnti_t</a> crnti) <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">override</a></td></tr>
<tr class="separator:a4fddfb180ae008720176729b6d33e862"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc49dd1f1e934b61b239929608850414" id="r_adc49dd1f1e934b61b239929608850414"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adc49dd1f1e934b61b239929608850414">uci_allocate_sr_opportunity</a> (<a class="el" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>, <a class="el" href="../../d9/def/namespacesrsran.html#a1d83bcd76f2b7c6251855be8472a46f5">rnti_t</a> crnti, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html">ue_cell_configuration</a> &amp;ue_cell_cfg) <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">override</a></td></tr>
<tr class="separator:adc49dd1f1e934b61b239929608850414"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8822e6aa48eadc564e20f040e34e21dd" id="r_a8822e6aa48eadc564e20f040e34e21dd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8822e6aa48eadc564e20f040e34e21dd">uci_allocate_csi_opportunity</a> (<a class="el" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>, <a class="el" href="../../d9/def/namespacesrsran.html#a1d83bcd76f2b7c6251855be8472a46f5">rnti_t</a> crnti, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html">ue_cell_configuration</a> &amp;ue_cell_cfg) <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">override</a></td></tr>
<tr class="separator:a8822e6aa48eadc564e20f040e34e21dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16dcd0eedda8fe1a34f419b1bec7c2f6" id="r_a16dcd0eedda8fe1a34f419b1bec7c2f6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/dff/classuint8__t.html">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a16dcd0eedda8fe1a34f419b1bec7c2f6">get_scheduled_pdsch_counter_in_ue_uci</a> (<a class="el" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>, <a class="el" href="../../d9/def/namespacesrsran.html#a1d83bcd76f2b7c6251855be8472a46f5">rnti_t</a> crnti) <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">override</a></td></tr>
<tr class="separator:a16dcd0eedda8fe1a34f419b1bec7c2f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of <a class="el" href="../../da/d26/classsrsran_1_1uci__allocator.html">uci_allocator</a> interface. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a016335457f6dd1ad6e81c03f0e603d91" name="a016335457f6dd1ad6e81c03f0e603d91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a016335457f6dd1ad6e81c03f0e603d91">&#9670;&#160;</a></span>uci_allocator_impl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uci_allocator_impl::uci_allocator_impl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d8/db0/classsrsran_1_1pucch__allocator.html">pucch_allocator</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pucch_alloc_</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   35</span>                                                                    :</div>
<div class="line"><span class="lineno">   36</span>  pucch_alloc{<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_alloc_</a>}, logger(srslog::fetch_basic_logger(<span class="stringliteral">&quot;SCHED&quot;</span>))</div>
<div class="line"><span class="lineno">   37</span>{</div>
<div class="line"><span class="lineno">   38</span>}</div>
<div class="ttc" id="anamespacesrsran_html_a58e7c9f2c51a9ad6a0899b46d5315723"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">srsran::mask_msb_ones</a></div><div class="ttdeci">constexpr Integer mask_msb_ones(size_t N)</div><div class="ttdoc">Returns an unsigned integer with the N most significant bits (MSB) set to one, and the remaining bits...</div><div class="ttdef"><b>Definition</b> bounded_bitset.h:65</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="acd2cfbdf8a259b7a56d61acd258dabc2" name="acd2cfbdf8a259b7a56d61acd258dabc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd2cfbdf8a259b7a56d61acd258dabc2">&#9670;&#160;</a></span>alloc_uci_harq_ue()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d1/d57/classsrsran_1_1optional.html">optional</a>&lt; <a class="el" href="../../d2/d40/structsrsran_1_1uci__allocation.html">uci_allocation</a> &gt; uci_allocator_impl::alloc_uci_harq_ue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d56/structsrsran_1_1cell__resource__allocator.html">cell_resource_allocator</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>res_alloc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a1d83bcd76f2b7c6251855be8472a46f5">rnti_t</a></td>          <td class="paramname"><span class="paramname"><em>crnti</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html">ue_cell_configuration</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>ue_cell_cfg</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a></td>          <td class="paramname"><span class="paramname"><em>k0</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/d4c/classsrsran_1_1span.html">span</a>&lt; <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d4/dff/classuint8__t.html">uint8_t</a> &gt;</td>          <td class="paramname"><span class="paramname"><em>k1_list</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d1/df4/structsrsran_1_1pdcch__dl__information.html">pdcch_dl_information</a> *</td>          <td class="paramname"><span class="paramname"><em>fallback_dci_info</em><span class="paramdefsep"> = </span><span class="paramdefval"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nullptr</a></span></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Allocate the common PUCCH resource for HARQ-ACK for a given UE. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">res_alloc</td><td>struct with scheduling results. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">crnti</td><td>RNTI of the UE. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ue_cell_cfg</td><td>user configuration. For the fallback mode case, this configuration is used to determine whether the slot coincides with a CSI report opportunity; in which case, the allocation of the UCI on common PUCCH resources will be skipped. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k0</td><td>k0 value, or delay (in slots) of PDSCH slot vs the corresponding PDCCH slot. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k1_list</td><td>List of k1 candidates configured for UE. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fallback_dci_info</td><td>pointer to the information with DL DCI, used for scheduling the UCI on common PUCCH resources. If this is not <code>nullptr</code>, it triggers the UCI scheduling using common PUCCH resources; else, UCI will be scheduled either on dedicated PUCCH resources or on PUSCH. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="../../da/d26/classsrsran_1_1uci__allocator.html#a674277651ca609ca8e827986589305a3">srsran::uci_allocator</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  194</span>{</div>
<div class="line"><span class="lineno">  195</span>  <span class="comment">// [Implementation-defined] We restrict the number of HARQ bits per PUCCH that are expected to carry CSI reporting to</span></div>
<div class="line"><span class="lineno">  196</span>  <span class="comment">// 2 , until the PUCCH allocator supports more than this.</span></div>
<div class="line"><span class="lineno">  197</span>  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="../../d4/dff/classuint8__t.html">uint8_t</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_harq_bits_per_uci</a> = 2U;</div>
<div class="line"><span class="lineno">  198</span> </div>
<div class="line"><span class="lineno">  199</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../df/d3c/classsrsran_1_1slot__point.html">slot_point</a>          <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_slot</a> = res_alloc[k0].slot;</div>
<div class="line"><span class="lineno">  200</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../d2/d2d/classsrsran_1_1cell__configuration.html">cell_configuration</a>&amp; cell_cfg   = ue_cell_cfg.cell_cfg_common;</div>
<div class="line"><span class="lineno">  201</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>            <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">min_pdsch_to_ack_slot_distance</a> =</div>
<div class="line"><span class="lineno">  202</span>      get_min_pdsch_to_ack_slot_distance(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pdsch_slot</a>,</div>
<div class="line"><span class="lineno">  203</span>                                         crnti,</div>
<div class="line"><span class="lineno">  204</span>                                         *std::min_element(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_list</a>.begin(), <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_list</a>.end()),</div>
<div class="line"><span class="lineno">  205</span>                                         *std::max_element(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_list</a>.begin(), <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_list</a>.end()));</div>
<div class="line"><span class="lineno">  206</span> </div>
<div class="line"><span class="lineno">  207</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code hl_class" href="../../d4/dff/classuint8__t.html">uint8_t</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_candidate</a> : <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_list</a>) {</div>
<div class="line"><span class="lineno">  208</span>    <span class="comment">// Step 1: Check for validity of the UCI slot and other restrictions.</span></div>
<div class="line"><span class="lineno">  209</span> </div>
<div class="line"><span class="lineno">  210</span>    <span class="comment">// Check whether the UCI slot to be scheduled is &gt;= last UCI HARQ ACK allocated slot for the UE.</span></div>
<div class="line"><span class="lineno">  211</span>    <span class="comment">// NOTE: The reason for having this logic is due to fact that COTS UE sends an invalid ACK bits if newly scheduled</span></div>
<div class="line"><span class="lineno">  212</span>    <span class="comment">// PDSCH has its UCI HARQ ACK slot before the (in time) UCI HARQ ACK slot of the previously scheduled PDSCH.</span></div>
<div class="line"><span class="lineno">  213</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_candidate</a> &lt; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">min_pdsch_to_ack_slot_distance</a>) {</div>
<div class="line"><span class="lineno">  214</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  215</span>    }</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>    <span class="comment">// Retrieve the scheduling results for slot = k0 + k1;</span></div>
<div class="line"><span class="lineno">  218</span>    <a class="code hl_struct" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a> = res_alloc[k0 + <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_candidate</a> + res_alloc.<a class="code hl_variable" href="../../df/d56/structsrsran_1_1cell__resource__allocator.html#a569167b4165a6dcd93b36bc5cee15105">cfg</a>.ntn_cs_koffset];</div>
<div class="line"><span class="lineno">  219</span>    <span class="keyword">const</span> <a class="code hl_class" href="../../df/d3c/classsrsran_1_1slot__point.html">slot_point</a>              <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">uci_slot</a>   = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.slot;</div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span>    <span class="comment">// Check whether UCI slot is UL enabled.</span></div>
<div class="line"><span class="lineno">  222</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> cell_cfg.is_fully_ul_enabled(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">uci_slot</a>)) {</div>
<div class="line"><span class="lineno">  223</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  224</span>    }</div>
<div class="line"><span class="lineno">  225</span> </div>
<div class="line"><span class="lineno">  226</span>    <span class="keywordflow">if</span> (uci_alloc_grid[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.slot.to_uint()].ucis.full()) {</div>
<div class="line"><span class="lineno">  227</span>      logger.info(</div>
<div class="line"><span class="lineno">  228</span>          <span class="stringliteral">&quot;rnti={}: UCI allocation for slot={} skipped due to UCI cache full. Attempting this allocation for the next &quot;</span></div>
<div class="line"><span class="lineno">  229</span>          <span class="stringliteral">&quot;k1 candidate, if any k1 available&quot;</span>,</div>
<div class="line"><span class="lineno">  230</span>          crnti,</div>
<div class="line"><span class="lineno">  231</span>          <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.slot);</div>
<div class="line"><span class="lineno">  232</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  233</span>    }</div>
<div class="line"><span class="lineno">  234</span> </div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">if</span> (csi_helper::is_csi_reporting_slot(ue_cell_cfg.cfg_dedicated(), <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">uci_slot</a>)) {</div>
<div class="line"><span class="lineno">  236</span>      <span class="comment">// NOTE: This is only to avoid allocating more than 2 HARQ bits in PUCCH that are expected to carry CSI reporting.</span></div>
<div class="line"><span class="lineno">  237</span>      <span class="comment">// TODO: Remove this when the PUCCH allocator handle properly more than 2 HARQ-ACK bits + CSI.</span></div>
<div class="line"><span class="lineno">  238</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="#a16dcd0eedda8fe1a34f419b1bec7c2f6">get_scheduled_pdsch_counter_in_ue_uci</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>, crnti) &gt;= <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_harq_bits_per_uci</a>) {</div>
<div class="line"><span class="lineno">  239</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  240</span>      }</div>
<div class="line"><span class="lineno">  241</span>    }</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span>    <span class="comment">// Step 2: Try to allocate UCI HARQ ACK for UE, either on PUSCH or PUCCH.</span></div>
<div class="line"><span class="lineno">  244</span>    <a class="code hl_class" href="../../d1/d57/classsrsran_1_1optional.html">optional&lt;uci_allocation&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">uci_output</a> =</div>
<div class="line"><span class="lineno">  245</span>        alloc_uci_harq_ue_helper(res_alloc, crnti, ue_cell_cfg, k0, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_candidate</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">fallback_dci_info</a>);</div>
<div class="line"><span class="lineno">  246</span> </div>
<div class="line"><span class="lineno">  247</span>    <span class="comment">// Register new UCI allocation in the respective grid slot entry and derive DAI.</span></div>
<div class="line"><span class="lineno">  248</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">uci_output</a>.has_value()) {</div>
<div class="line"><span class="lineno">  249</span>      <span class="keyword">auto</span>* uci = get_uci_alloc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.slot, crnti);</div>
<div class="line"><span class="lineno">  250</span>      <span class="keywordflow">if</span> (uci == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  251</span>        uci                             = &amp;uci_alloc_grid[<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.slot.to_uint()].ucis.emplace_back();</div>
<div class="line"><span class="lineno">  252</span>        uci-&gt;rnti                       = crnti;</div>
<div class="line"><span class="lineno">  253</span>        uci-&gt;scheduled_dl_pdcch_counter = 0;</div>
<div class="line"><span class="lineno">  254</span>      }</div>
<div class="line"><span class="lineno">  255</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">uci_output</a>.value().harq_bit_idx = uci-&gt;scheduled_dl_pdcch_counter;</div>
<div class="line"><span class="lineno">  256</span>      ++uci-&gt;scheduled_dl_pdcch_counter;</div>
<div class="line"><span class="lineno">  257</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">uci_output</a>.value().k1 = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">k1_candidate</a>;</div>
<div class="line"><span class="lineno">  258</span> </div>
<div class="line"><span class="lineno">  259</span>      <span class="keywordflow">return</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">uci_output</a>;</div>
<div class="line"><span class="lineno">  260</span>    }</div>
<div class="line"><span class="lineno">  261</span>  }</div>
<div class="line"><span class="lineno">  262</span>  <span class="keywordflow">return</span> {};</div>
<div class="line"><span class="lineno">  263</span>}</div>
<div class="ttc" id="aclasssrsran_1_1cell__configuration_html"><div class="ttname"><a href="../../d2/d2d/classsrsran_1_1cell__configuration.html">srsran::cell_configuration</a></div><div class="ttdef"><b>Definition</b> cell_configuration.h:36</div></div>
<div class="ttc" id="aclasssrsran_1_1optional_html"><div class="ttname"><a href="../../d1/d57/classsrsran_1_1optional.html">srsran::optional</a></div><div class="ttdoc">Optional objects.</div><div class="ttdef"><b>Definition</b> optional.h:281</div></div>
<div class="ttc" id="aclasssrsran_1_1slot__point_html"><div class="ttname"><a href="../../df/d3c/classsrsran_1_1slot__point.html">srsran::slot_point</a></div><div class="ttdef"><b>Definition</b> slot_point.h:51</div></div>
<div class="ttc" id="aclasssrsran_1_1uci__allocator__impl_html_a16dcd0eedda8fe1a34f419b1bec7c2f6"><div class="ttname"><a href="#a16dcd0eedda8fe1a34f419b1bec7c2f6">srsran::uci_allocator_impl::get_scheduled_pdsch_counter_in_ue_uci</a></div><div class="ttdeci">uint8_t get_scheduled_pdsch_counter_in_ue_uci(cell_slot_resource_allocator &amp;slot_alloc, rnti_t crnti) override</div><div class="ttdef"><b>Definition</b> uci_allocator_impl.cpp:355</div></div>
<div class="ttc" id="aclassuint8__t_html"><div class="ttname"><a href="../../d4/dff/classuint8__t.html">uint8_t</a></div></div>
<div class="ttc" id="astructsrsran_1_1cell__resource__allocator_html_a569167b4165a6dcd93b36bc5cee15105"><div class="ttname"><a href="../../df/d56/structsrsran_1_1cell__resource__allocator.html#a569167b4165a6dcd93b36bc5cee15105">srsran::cell_resource_allocator::cfg</a></div><div class="ttdeci">const cell_configuration &amp; cfg</div><div class="ttdoc">Cell configuration.</div><div class="ttdef"><b>Definition</b> resource_grid.h:258</div></div>
<div class="ttc" id="astructsrsran_1_1cell__slot__resource__allocator_html"><div class="ttname"><a href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">srsran::cell_slot_resource_allocator</a></div><div class="ttdoc">Stores all the scheduled information relative to a {slot, cell}.</div><div class="ttdef"><b>Definition</b> resource_grid.h:215</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a16dcd0eedda8fe1a34f419b1bec7c2f6" name="a16dcd0eedda8fe1a34f419b1bec7c2f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16dcd0eedda8fe1a34f419b1bec7c2f6">&#9670;&#160;</a></span>get_scheduled_pdsch_counter_in_ue_uci()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/dff/classuint8__t.html">uint8_t</a> uci_allocator_impl::get_scheduled_pdsch_counter_in_ue_uci </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>slot_alloc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a1d83bcd76f2b7c6251855be8472a46f5">rnti_t</a></td>          <td class="paramname"><span class="paramname"><em>crnti</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the number of PDSCHs currently scheduled for a given UE UCI. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slot_alloc</td><td>struct with scheduling results. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">crnti</td><td>C-RNTI of the UE. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns number of PDSCHs scheduled if UCI allocation if found, 0 otherwise. </dd></dl>

<p>Implements <a class="el" href="../../da/d26/classsrsran_1_1uci__allocator.html#a9c7a7c379c79a8815d14d4a0daa17435">srsran::uci_allocator</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  357</span>{</div>
<div class="line"><span class="lineno">  358</span>  <span class="keyword">auto</span>* uci = get_uci_alloc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.slot, crnti);</div>
<div class="line"><span class="lineno">  359</span>  <span class="keywordflow">if</span> (uci == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  360</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  361</span>  }</div>
<div class="line"><span class="lineno">  362</span>  <span class="keywordflow">return</span> uci-&gt;scheduled_dl_pdcch_counter;</div>
<div class="line"><span class="lineno">  363</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4fddfb180ae008720176729b6d33e862" name="a4fddfb180ae008720176729b6d33e862"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fddfb180ae008720176729b6d33e862">&#9670;&#160;</a></span>multiplex_uci_on_pusch()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a> uci_allocator_impl::multiplex_uci_on_pusch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/df1/structsrsran_1_1ul__sched__info.html">ul_sched_info</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pusch_grant</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>slot_alloc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html">ue_cell_configuration</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>ue_cell_cfg</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a1d83bcd76f2b7c6251855be8472a46f5">rnti_t</a></td>          <td class="paramname"><span class="paramname"><em>crnti</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Multiplexes the UCI on PUSCH, by removing the UCI on the PUCCH (if present) and adding it to the PUSCH. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">pusch_grant</td><td>struct with PUSCH PDU where UCI need to be allocated. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">slot_alloc</td><td>struct with scheduling results. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ue_cell_cfg</td><td>user configuration. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">crnti</td><td>C-RNTI of the UE. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="../../da/d26/classsrsran_1_1uci__allocator.html#a7dc8ff45c9cfad1a418ce24f2c06d1ff">srsran::uci_allocator</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  269</span>{</div>
<div class="line"><span class="lineno">  270</span>  <span class="comment">// Move the bits that are carried by the PUCCH into the PUSCH.</span></div>
<div class="line"><span class="lineno">  271</span>  <span class="keyword">const</span> <a class="code hl_struct" href="../../d6/d71/structsrsran_1_1pucch__uci__bits.html">pucch_uci_bits</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_uci</a> = pucch_alloc.<a class="code hl_function" href="../../d8/db0/classsrsran_1_1pucch__allocator.html#ac72002185e4401aa842da529b8aa8e3c">remove_ue_uci_from_pucch</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>, crnti, ue_cell_cfg);</div>
<div class="line"><span class="lineno">  272</span> </div>
<div class="line"><span class="lineno">  273</span>  <span class="comment">// In case there are no UCI bits from PUCCH, then there is no UCI to be multiplexed on the PUSCH.</span></div>
<div class="line"><span class="lineno">  274</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_uci</a>.harq_ack_nof_bits == 0 <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_uci</a>.csi_part1_bits == 0) {</div>
<div class="line"><span class="lineno">  275</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  276</span>  }</div>
<div class="line"><span class="lineno">  277</span> </div>
<div class="line"><span class="lineno">  278</span>  <span class="comment">// We assume that at this point, there are no existing UCI grants in the PUSCH; allocate a new one.</span></div>
<div class="line"><span class="lineno">  279</span>  <a class="code hl_struct" href="../../db/dd7/structsrsran_1_1uci__info.html">uci_info</a>&amp; uci = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pusch_grant</a>.uci.emplace();</div>
<div class="line"><span class="lineno">  280</span>  uci.<a class="code hl_variable" href="../../db/dd7/structsrsran_1_1uci__info.html#acc567220ff7b74727a80b923d80abcb5">alpha</a>     = ue_cell_cfg.cfg_dedicated().<a class="code hl_variable" href="../../d3/d0d/structsrsran_1_1serving__cell__config.html#a2fe7ab17cda5bafb76bcabb1e526e556">ul_config</a>.value().init_ul_bwp.pusch_cfg.value().uci_cfg.value().scaling;</div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_uci</a>.csi_part1_bits != 0) {</div>
<div class="line"><span class="lineno">  283</span>    <span class="comment">// The number of bits is computed based on the CSI report configuration.</span></div>
<div class="line"><span class="lineno">  284</span>    add_csi_to_uci_on_pusch(uci.csi.emplace(), ue_cell_cfg);</div>
<div class="line"><span class="lineno">  285</span>  }</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_uci</a>.harq_ack_nof_bits != 0) {</div>
<div class="line"><span class="lineno">  288</span>    uci.harq.emplace();</div>
<div class="line"><span class="lineno">  289</span>    uci.harq.value().harq_ack_nof_bits = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">pucch_uci</a>.harq_ack_nof_bits;</div>
<div class="line"><span class="lineno">  290</span>    update_uci_on_pusch_harq_offsets(</div>
<div class="line"><span class="lineno">  291</span>        uci.harq.value(), ue_cell_cfg.cfg_dedicated().<a class="code hl_variable" href="../../d3/d0d/structsrsran_1_1serving__cell__config.html#a2fe7ab17cda5bafb76bcabb1e526e556">ul_config</a>.value().init_ul_bwp.pusch_cfg.value().uci_cfg.value());</div>
<div class="line"><span class="lineno">  292</span>  }</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>  logger.debug(<span class="stringliteral">&quot;rnti={}: UCI mltplxd on PUSCH for slot={}&quot;</span>, crnti, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.slot);</div>
<div class="line"><span class="lineno">  295</span>}</div>
<div class="ttc" id="aclasssrsran_1_1pucch__allocator_html_ac72002185e4401aa842da529b8aa8e3c"><div class="ttname"><a href="../../d8/db0/classsrsran_1_1pucch__allocator.html#ac72002185e4401aa842da529b8aa8e3c">srsran::pucch_allocator::remove_ue_uci_from_pucch</a></div><div class="ttdeci">virtual pucch_uci_bits remove_ue_uci_from_pucch(cell_slot_resource_allocator &amp;slot_alloc, rnti_t crnti, const ue_cell_configuration &amp;ue_cell_cfg)=0</div></div>
<div class="ttc" id="astructsrsran_1_1pucch__uci__bits_html"><div class="ttname"><a href="../../d6/d71/structsrsran_1_1pucch__uci__bits.html">srsran::pucch_uci_bits</a></div><div class="ttdoc">Contains the number of UCI HARQ-ACK and CSI information bits of a removed PUCCH grant.</div><div class="ttdef"><b>Definition</b> pucch_allocator.h:33</div></div>
<div class="ttc" id="astructsrsran_1_1serving__cell__config_html_a2fe7ab17cda5bafb76bcabb1e526e556"><div class="ttname"><a href="../../d3/d0d/structsrsran_1_1serving__cell__config.html#a2fe7ab17cda5bafb76bcabb1e526e556">srsran::serving_cell_config::ul_config</a></div><div class="ttdeci">optional&lt; uplink_config &gt; ul_config</div><div class="ttdoc">uplinkConfig, containing the UL configuration.</div><div class="ttdef"><b>Definition</b> serving_cell_config.h:256</div></div>
<div class="ttc" id="astructsrsran_1_1uci__info_html"><div class="ttname"><a href="../../db/dd7/structsrsran_1_1uci__info.html">srsran::uci_info</a></div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:288</div></div>
<div class="ttc" id="astructsrsran_1_1uci__info_html_acc567220ff7b74727a80b923d80abcb5"><div class="ttname"><a href="../../db/dd7/structsrsran_1_1uci__info.html#acc567220ff7b74727a80b923d80abcb5">srsran::uci_info::alpha</a></div><div class="ttdeci">alpha_scaling_opt alpha</div><div class="ttdoc">parameter, as per Section 6.3.2.4.1.1-3, TS 38.212.</div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:315</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a84eb829ee60066ebf2e38f13386e45c8" name="a84eb829ee60066ebf2e38f13386e45c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84eb829ee60066ebf2e38f13386e45c8">&#9670;&#160;</a></span>slot_indication()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a> uci_allocator_impl::slot_indication </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d3c/classsrsran_1_1slot__point.html">slot_point</a></td>          <td class="paramname"><span class="paramname"><em>sl_tx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reset the internal counter of the allocated PDSCHs to be acknowledged per slot. </p>

<p>Implements <a class="el" href="../../da/d26/classsrsran_1_1uci__allocator.html#afd4f1ff81475ddc02a6af42623a98e60">srsran::uci_allocator</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  183</span>{</div>
<div class="line"><span class="lineno">  184</span>  <span class="comment">// Clear previous slot UCI allocations.</span></div>
<div class="line"><span class="lineno">  185</span>  uci_alloc_grid[(sl_tx - 1).to_uint()].ucis.clear();</div>
<div class="line"><span class="lineno">  186</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8822e6aa48eadc564e20f040e34e21dd" name="a8822e6aa48eadc564e20f040e34e21dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8822e6aa48eadc564e20f040e34e21dd">&#9670;&#160;</a></span>uci_allocate_csi_opportunity()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a> uci_allocator_impl::uci_allocate_csi_opportunity </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>slot_alloc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a1d83bcd76f2b7c6251855be8472a46f5">rnti_t</a></td>          <td class="paramname"><span class="paramname"><em>crnti</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html">ue_cell_configuration</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>ue_cell_cfg</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Allocates the CSI opportunities for a given UE. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">slot_alloc</td><td>struct with scheduling results. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">crnti</td><td>C-RNTI of the UE. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ue_cell_cfg</td><td>user configuration. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="../../da/d26/classsrsran_1_1uci__allocator.html#a0f84d2218d19858514d4c0ae3617006f">srsran::uci_allocator</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  321</span>{</div>
<div class="line"><span class="lineno">  322</span>  <span class="keyword">auto</span>&amp;          puschs         = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.result.ul.puschs;</div>
<div class="line"><span class="lineno">  323</span>  <a class="code hl_struct" href="../../dd/df1/structsrsran_1_1ul__sched__info.html">ul_sched_info</a>* <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">existing_pusch</a> = std::find_if(</div>
<div class="line"><span class="lineno">  324</span>      puschs.begin(), puschs.end(), [crnti](<a class="code hl_struct" href="../../dd/df1/structsrsran_1_1ul__sched__info.html">ul_sched_info</a>&amp; pusch) { return pusch.pusch_cfg.rnti == crnti; });</div>
<div class="line"><span class="lineno">  325</span> </div>
<div class="line"><span class="lineno">  326</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">has_pusch_grants</a> =</div>
<div class="line"><span class="lineno">  327</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.result.ul.puschs.empty() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">existing_pusch</a> != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.result.ul.puschs.end();</div>
<div class="line"><span class="lineno">  328</span> </div>
<div class="line"><span class="lineno">  329</span>  <span class="comment">// TODO: check if this case is possible. The first PUSCH that is allocated outside the RAR grant is will be allocated</span></div>
<div class="line"><span class="lineno">  330</span>  <span class="comment">//       after the UE objected gets created with the UE dedicated configuration; this means the CSI scheduler should</span></div>
<div class="line"><span class="lineno">  331</span>  <span class="comment">//       start allocating CSI grants before any PUSCH grants (except the PUSCH scheduled in the RAR).</span></div>
<div class="line"><span class="lineno">  332</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">has_pusch_grants</a>) {</div>
<div class="line"><span class="lineno">  333</span>    <span class="comment">// If there is UCI grant allocated, allocate it.</span></div>
<div class="line"><span class="lineno">  334</span>    srsran_assert(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">existing_pusch</a>-&gt;uci.has_value(), <span class="stringliteral">&quot;UCI on PUSCH grant for CSI cannot be already allocated&quot;</span>);</div>
<div class="line"><span class="lineno">  335</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">existing_pusch</a>-&gt;uci.emplace();</div>
<div class="line"><span class="lineno">  336</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">existing_pusch</a>-&gt;uci.value().alpha =</div>
<div class="line"><span class="lineno">  337</span>        ue_cell_cfg.cfg_dedicated().<a class="code hl_variable" href="../../d3/d0d/structsrsran_1_1serving__cell__config.html#a2fe7ab17cda5bafb76bcabb1e526e556">ul_config</a>.value().init_ul_bwp.pusch_cfg.value().uci_cfg.value().scaling;</div>
<div class="line"><span class="lineno">  338</span> </div>
<div class="line"><span class="lineno">  339</span>    add_csi_to_uci_on_pusch(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">existing_pusch</a>-&gt;uci.value().csi.emplace(), ue_cell_cfg);</div>
<div class="line"><span class="lineno">  340</span> </div>
<div class="line"><span class="lineno">  341</span>    logger.debug(<span class="stringliteral">&quot;rnti={} UCI with 0 H-ACK, {} CSI-p1 and {} CSI-p2 bits for slot={} allocated on PUSCH&quot;</span>,</div>
<div class="line"><span class="lineno">  342</span>                 crnti,</div>
<div class="line"><span class="lineno">  343</span>                 <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">existing_pusch</a>-&gt;uci.value().csi.value().csi_part1_nof_bits,</div>
<div class="line"><span class="lineno">  344</span>                 <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">existing_pusch</a>-&gt;uci.value().csi.value().beta_offset_csi_2.has_value() ? <span class="stringliteral">&quot;up to 11&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>,</div>
<div class="line"><span class="lineno">  345</span>                 <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.<a class="code hl_enumvalue" href="../../d9/def/namespacesrsran.html#a457973e91fb03d0c262578c3bdf460f0a5e97994ed38a2b2f984f3b2b75012bf8">slot</a>);</div>
<div class="line"><span class="lineno">  346</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  347</span>  }</div>
<div class="line"><span class="lineno">  348</span> </div>
<div class="line"><span class="lineno">  349</span>  <span class="comment">// Else, allocate the CSI on the PUCCH.</span></div>
<div class="line"><span class="lineno">  350</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_report_cfg</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a60da9701c9f3803ebd964b4f13f2c545">create_csi_report_configuration</a>(ue_cell_cfg.cfg_dedicated().<a class="code hl_variable" href="../../d3/d0d/structsrsran_1_1serving__cell__config.html#a6cb73c2a0cc5b1478ca90b6535700926">csi_meas_cfg</a>.value());</div>
<div class="line"><span class="lineno">  351</span>  pucch_alloc.<a class="code hl_function" href="../../d8/db0/classsrsran_1_1pucch__allocator.html#aaac1e5eeb05f561f15cba9f4e00fd2cd">pucch_allocate_csi_opportunity</a>(</div>
<div class="line"><span class="lineno">  352</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>, crnti, ue_cell_cfg, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#aa54a86e2745b57a02fb20c90a3d48427">get_csi_report_pucch_size</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">csi_report_cfg</a>).value());</div>
<div class="line"><span class="lineno">  353</span>}</div>
<div class="ttc" id="aclasssrsran_1_1pucch__allocator_html_aaac1e5eeb05f561f15cba9f4e00fd2cd"><div class="ttname"><a href="../../d8/db0/classsrsran_1_1pucch__allocator.html#aaac1e5eeb05f561f15cba9f4e00fd2cd">srsran::pucch_allocator::pucch_allocate_csi_opportunity</a></div><div class="ttdeci">virtual void pucch_allocate_csi_opportunity(cell_slot_resource_allocator &amp;pucch_slot_alloc, rnti_t crnti, const ue_cell_configuration &amp;ue_cell_cfg, unsigned csi_part1_nof_bits)=0</div></div>
<div class="ttc" id="anamespacesrsran_html_a457973e91fb03d0c262578c3bdf460f0a5e97994ed38a2b2f984f3b2b75012bf8"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a457973e91fb03d0c262578c3bdf460f0a5e97994ed38a2b2f984f3b2b75012bf8">srsran::lower_phy_baseband_buffer_size_policy::slot</a></div><div class="ttdeci">@ slot</div><div class="ttdoc">The buffer size matches the number of samples per slot.</div></div>
<div class="ttc" id="anamespacesrsran_html_a60da9701c9f3803ebd964b4f13f2c545"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a60da9701c9f3803ebd964b4f13f2c545">srsran::create_csi_report_configuration</a></div><div class="ttdeci">csi_report_configuration create_csi_report_configuration(const csi_meas_config &amp;csi_meas)</div><div class="ttdoc">Returns the Chanel State Information (CSI) report configuration parameters based on CSI-MeasConfig.</div><div class="ttdef"><b>Definition</b> csi_report_config_helpers.cpp:28</div></div>
<div class="ttc" id="anamespacesrsran_html_aa54a86e2745b57a02fb20c90a3d48427"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#aa54a86e2745b57a02fb20c90a3d48427">srsran::get_csi_report_pucch_size</a></div><div class="ttdeci">units::bits get_csi_report_pucch_size(const csi_report_configuration &amp;config)</div><div class="ttdoc">Gets the Channel State Information (CSI) report size when the CSI report is transmitted in PUCCH.</div><div class="ttdef"><b>Definition</b> csi_report_on_pucch_helpers.cpp:188</div></div>
<div class="ttc" id="astructsrsran_1_1serving__cell__config_html_a6cb73c2a0cc5b1478ca90b6535700926"><div class="ttname"><a href="../../d3/d0d/structsrsran_1_1serving__cell__config.html#a6cb73c2a0cc5b1478ca90b6535700926">srsran::serving_cell_config::csi_meas_cfg</a></div><div class="ttdeci">optional&lt; csi_meas_config &gt; csi_meas_cfg</div><div class="ttdoc">CSI-MeasConfig.</div><div class="ttdef"><b>Definition</b> serving_cell_config.h:260</div></div>
<div class="ttc" id="astructsrsran_1_1ul__sched__info_html"><div class="ttname"><a href="../../dd/df1/structsrsran_1_1ul__sched__info.html">srsran::ul_sched_info</a></div><div class="ttdef"><b>Definition</b> scheduler_slot_handler.h:431</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adc49dd1f1e934b61b239929608850414" name="adc49dd1f1e934b61b239929608850414"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc49dd1f1e934b61b239929608850414">&#9670;&#160;</a></span>uci_allocate_sr_opportunity()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a> uci_allocator_impl::uci_allocate_sr_opportunity </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d5/db7/structsrsran_1_1cell__slot__resource__allocator.html">cell_slot_resource_allocator</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>slot_alloc</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a1d83bcd76f2b7c6251855be8472a46f5">rnti_t</a></td>          <td class="paramname"><span class="paramname"><em>crnti</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d6/d95/classsrsran_1_1ue__cell__configuration.html">ue_cell_configuration</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>ue_cell_cfg</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Allocates the SR opportunities for a given UE. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">slot_alloc</td><td>struct with scheduling results. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">crnti</td><td>C-RNTI of the UE. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ue_cell_cfg</td><td>user configuration. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="../../da/d26/classsrsran_1_1uci__allocator.html#a8988a7267faed735f86e43ddc04c70e8">srsran::uci_allocator</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  300</span>{</div>
<div class="line"><span class="lineno">  301</span>  <span class="comment">// Retrieve the scheduling results for slot = k0 + k1;</span></div>
<div class="line"><span class="lineno">  302</span>  <span class="keyword">auto</span>&amp;          puschs         = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.result.ul.puschs;</div>
<div class="line"><span class="lineno">  303</span>  <a class="code hl_struct" href="../../dd/df1/structsrsran_1_1ul__sched__info.html">ul_sched_info</a>* <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">existing_pusch</a> = std::find_if(</div>
<div class="line"><span class="lineno">  304</span>      puschs.begin(), puschs.end(), [crnti](<a class="code hl_struct" href="../../dd/df1/structsrsran_1_1ul__sched__info.html">ul_sched_info</a>&amp; pusch) { return pusch.pusch_cfg.rnti == crnti; });</div>
<div class="line"><span class="lineno">  305</span> </div>
<div class="line"><span class="lineno">  306</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">has_pusch_grants</a> =</div>
<div class="line"><span class="lineno">  307</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">not</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.result.ul.puschs.empty() <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">and</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">existing_pusch</a> != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>.result.ul.puschs.end();</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>  <span class="comment">// If there is a PUSCH allocated for this UE, do not allocate any PUCCH SR grants.</span></div>
<div class="line"><span class="lineno">  310</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">has_pusch_grants</a>) {</div>
<div class="line"><span class="lineno">  311</span>    logger.debug(<span class="stringliteral">&quot;rnti={}: SR allocation skipped due to PUSCH grant allocated.&quot;</span>, crnti);</div>
<div class="line"><span class="lineno">  312</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  313</span>  }</div>
<div class="line"><span class="lineno">  314</span> </div>
<div class="line"><span class="lineno">  315</span>  pucch_alloc.<a class="code hl_function" href="../../d8/db0/classsrsran_1_1pucch__allocator.html#a756012774ab9d566cd8231211c769df9">pucch_allocate_sr_opportunity</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">slot_alloc</a>, crnti, ue_cell_cfg);</div>
<div class="line"><span class="lineno">  316</span>}</div>
<div class="ttc" id="aclasssrsran_1_1pucch__allocator_html_a756012774ab9d566cd8231211c769df9"><div class="ttname"><a href="../../d8/db0/classsrsran_1_1pucch__allocator.html#a756012774ab9d566cd8231211c769df9">srsran::pucch_allocator::pucch_allocate_sr_opportunity</a></div><div class="ttdeci">virtual void pucch_allocate_sr_opportunity(cell_slot_resource_allocator &amp;pucch_slot_alloc, rnti_t crnti, const ue_cell_configuration &amp;ue_cell_cfg)=0</div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>lib/scheduler/uci_scheduling/<a class="el" href="../../da/d80/uci__allocator__impl_8h_source.html">uci_allocator_impl.h</a></li>
<li>lib/scheduler/uci_scheduling/<b>uci_allocator_impl.cpp</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
