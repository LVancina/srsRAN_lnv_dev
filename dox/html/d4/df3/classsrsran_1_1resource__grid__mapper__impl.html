<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>srsRAN Docs: srsran::resource_grid_mapper_impl Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">srsRAN Docs
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/def/namespacesrsran.html">srsran</a></li><li class="navelem"><a class="el" href="../../d4/df3/classsrsran_1_1resource__grid__mapper__impl.html">resource_grid_mapper_impl</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="../../da/df4/classsrsran_1_1resource__grid__mapper__impl-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">srsran::resource_grid_mapper_impl Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implements a resource grid mapper.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="../../d1/d83/resource__grid__mapper__impl_8h_source.html">resource_grid_mapper_impl.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for srsran::resource_grid_mapper_impl:</div>
<div class="dyncontent">
<div class="center"><img src="../../d9/d45/classsrsran_1_1resource__grid__mapper__impl__inherit__graph.png" border="0" usemap="#asrsran_1_1resource__grid__mapper__impl_inherit__map" alt="Inheritance graph"/></div>
<map name="asrsran_1_1resource__grid__mapper__impl_inherit__map" id="asrsran_1_1resource__grid__mapper__impl_inherit__map">
<area shape="rect" title="Implements a resource grid mapper." alt="" coords="10,173,195,343"/>
<area shape="rect" href="../../d0/ddc/classsrsran_1_1resource__grid__mapper.html" title="Resource Element mapping interface." alt="" coords="5,5,200,125"/>
<area shape="poly" title=" " alt="" coords="105,139,105,173,100,173,100,139"/>
</map>
</div>
<div class="dynheader">
Collaboration diagram for srsran::resource_grid_mapper_impl:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/d3e/classsrsran_1_1resource__grid__mapper__impl__coll__graph.png" border="0" usemap="#asrsran_1_1resource__grid__mapper__impl_coll__map" alt="Collaboration graph"/></div>
<map name="asrsran_1_1resource__grid__mapper__impl_coll__map" id="asrsran_1_1resource__grid__mapper__impl_coll__map">
<area shape="rect" title="Implements a resource grid mapper." alt="" coords="10,173,195,343"/>
<area shape="rect" href="../../d0/ddc/classsrsran_1_1resource__grid__mapper.html" title="Resource Element mapping interface." alt="" coords="5,5,200,125"/>
<area shape="poly" title=" " alt="" coords="105,139,105,173,100,173,100,139"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2876b3ed1a2cc7936b19907df466d083" id="r_a2876b3ed1a2cc7936b19907df466d083"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2876b3ed1a2cc7936b19907df466d083">resource_grid_mapper_impl</a> (<a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_ports_</a>, <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_</a>, <a class="el" href="../../d5/d6e/classsrsran_1_1resource__grid__writer.html">resource_grid_writer</a> &amp;<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">writer_</a>, std::unique_ptr&lt; <a class="el" href="../../d8/d31/classsrsran_1_1channel__precoder.html">channel_precoder</a> &gt; <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoder_</a>)</td></tr>
<tr class="separator:a2876b3ed1a2cc7936b19907df466d083"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f1e4cf477dd01ea2fcbeed922fb0259" id="r_a3f1e4cf477dd01ea2fcbeed922fb0259"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3f1e4cf477dd01ea2fcbeed922fb0259">map</a> (<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d7/d48/classsrsran_1_1re__buffer__reader.html">re_buffer_reader</a> &amp;input, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d2/d8f/structsrsran_1_1re__pattern.html">re_pattern</a> &amp;pattern, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../dc/da4/classsrsran_1_1precoding__configuration.html">precoding_configuration</a> &amp;precoding) <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">override</a></td></tr>
<tr class="memdesc:a3f1e4cf477dd01ea2fcbeed922fb0259"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maps the input resource elements into the resource grid.  <br /></td></tr>
<tr class="separator:a3f1e4cf477dd01ea2fcbeed922fb0259"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f52b7dcf26004e13a15791c6d9ece7d" id="r_a1f52b7dcf26004e13a15791c6d9ece7d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1f52b7dcf26004e13a15791c6d9ece7d">map</a> (<a class="el" href="../../d1/d5c/classsrsran_1_1resource__grid__mapper_1_1symbol__buffer.html">symbol_buffer</a> &amp;buffer, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d9/d27/classsrsran_1_1re__pattern__list.html">re_pattern_list</a> &amp;pattern, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d9/d27/classsrsran_1_1re__pattern__list.html">re_pattern_list</a> &amp;reserved, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../dc/da4/classsrsran_1_1precoding__configuration.html">precoding_configuration</a> &amp;precoding, <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_skip</a>) <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">override</a></td></tr>
<tr class="memdesc:a1f52b7dcf26004e13a15791c6d9ece7d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maps complex symbols onto the resource grid.  <br /></td></tr>
<tr class="separator:a1f52b7dcf26004e13a15791c6d9ece7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classsrsran_1_1resource__grid__mapper"><td colspan="2" onclick="javascript:dynsection.toggleInherit('pub_methods_classsrsran_1_1resource__grid__mapper')"><img src="../../closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="../../d0/ddc/classsrsran_1_1resource__grid__mapper.html">srsran::resource_grid_mapper</a></td></tr>
<tr class="memitem:a474c45c3466ddc6f23b37a4417ab04a2 inherit pub_methods_classsrsran_1_1resource__grid__mapper" id="r_a474c45c3466ddc6f23b37a4417ab04a2"><td class="memItemLeft" align="right" valign="top">
<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">virtual</a>&#160;</td><td class="memItemRight" valign="bottom"><b>~resource_grid_mapper</b> ()=<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">default</a></td></tr>
<tr class="memdesc:a474c45c3466ddc6f23b37a4417ab04a2 inherit pub_methods_classsrsran_1_1resource__grid__mapper"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default destructor. <br /></td></tr>
<tr class="separator:a474c45c3466ddc6f23b37a4417ab04a2 inherit pub_methods_classsrsran_1_1resource__grid__mapper"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements a resource grid mapper. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a2876b3ed1a2cc7936b19907df466d083" name="a2876b3ed1a2cc7936b19907df466d083"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2876b3ed1a2cc7936b19907df466d083">&#9670;&#160;</a></span>resource_grid_mapper_impl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">resource_grid_mapper_impl::resource_grid_mapper_impl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a></td>          <td class="paramname"><span class="paramname"><em>nof_ports_</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a></td>          <td class="paramname"><span class="paramname"><em>nof_subc_</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d5/d6e/classsrsran_1_1resource__grid__writer.html">resource_grid_writer</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>writer_</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_ptr&lt; <a class="el" href="../../d8/d31/classsrsran_1_1channel__precoder.html">channel_precoder</a> &gt;</td>          <td class="paramname"><span class="paramname"><em>precoder_</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  152</span>                                                                                                :</div>
<div class="line"><span class="lineno">  153</span>  nof_ports(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_ports_</a>), nof_subc(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_</a>), writer(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">writer_</a>), precoder(std::move(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoder_</a>))</div>
<div class="line"><span class="lineno">  154</span>{</div>
<div class="line"><span class="lineno">  155</span>  srsran_assert(nof_ports &lt;= max_nof_ports,</div>
<div class="line"><span class="lineno">  156</span>                <span class="stringliteral">&quot;The number of ports (i.e., {}) exceeds the maximum number of ports (i.e., {}).&quot;</span>,</div>
<div class="line"><span class="lineno">  157</span>                nof_ports,</div>
<div class="line"><span class="lineno">  158</span>                <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(max_nof_ports));</div>
<div class="line"><span class="lineno">  159</span>  srsran_assert(nof_subc &lt;= max_nof_subcarriers,</div>
<div class="line"><span class="lineno">  160</span>                <span class="stringliteral">&quot;The number of subcarriers (i.e., {}) exceeds the maximum number of subcarriers (i.e., {}).&quot;</span>,</div>
<div class="line"><span class="lineno">  161</span>                nof_subc,</div>
<div class="line"><span class="lineno">  162</span>                <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(max_nof_subcarriers));</div>
<div class="line"><span class="lineno">  163</span>}</div>
<div class="ttc" id="anamespacesrsran_html_a58e7c9f2c51a9ad6a0899b46d5315723"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">srsran::mask_msb_ones</a></div><div class="ttdeci">constexpr Integer mask_msb_ones(size_t N)</div><div class="ttdoc">Returns an unsigned integer with the N most significant bits (MSB) set to one, and the remaining bits...</div><div class="ttdef"><b>Definition</b> bounded_bitset.h:65</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a3f1e4cf477dd01ea2fcbeed922fb0259" name="a3f1e4cf477dd01ea2fcbeed922fb0259"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f1e4cf477dd01ea2fcbeed922fb0259">&#9670;&#160;</a></span>map() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a> resource_grid_mapper_impl::map </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d7/d48/classsrsran_1_1re__buffer__reader.html">re_buffer_reader</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>input</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d2/d8f/structsrsran_1_1re__pattern.html">re_pattern</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pattern</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../dc/da4/classsrsran_1_1precoding__configuration.html">precoding_configuration</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>precoding</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maps the input resource elements into the resource grid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">input</td><td>Input data. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pattern</td><td>Data allocation pattern in the resource grid. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">precoding</td><td>Precoding configuration. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="../../d0/ddc/classsrsran_1_1resource__grid__mapper.html#a9fc1909c95b969acdd14de808d4cb0c2">srsran::resource_grid_mapper</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  168</span>{</div>
<div class="line"><span class="lineno">  169</span>  <span class="keywordtype">unsigned</span> nof_layers = precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#a78eeca8376d722f128340ed3c58fbfbd">get_nof_layers</a>();</div>
<div class="line"><span class="lineno">  170</span> </div>
<div class="line"><span class="lineno">  171</span>  srsran_assert(input.<a class="code hl_function" href="../../d3/d07/classsrsran_1_1detail_1_1re__buffer__dimensions.html#af9938dde244e7d21ee3280d29030c6d8">get_nof_slices</a>() == precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#a78eeca8376d722f128340ed3c58fbfbd">get_nof_layers</a>(),</div>
<div class="line"><span class="lineno">  172</span>                <span class="stringliteral">&quot;The input number of layers (i.e., {}) and the precoding number of layers (i.e., {}) are different.&quot;</span>,</div>
<div class="line"><span class="lineno">  173</span>                input.<a class="code hl_function" href="../../d3/d07/classsrsran_1_1detail_1_1re__buffer__dimensions.html#af9938dde244e7d21ee3280d29030c6d8">get_nof_slices</a>(),</div>
<div class="line"><span class="lineno">  174</span>                nof_layers);</div>
<div class="line"><span class="lineno">  175</span> </div>
<div class="line"><span class="lineno">  176</span>  <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_precoding_ports</a> = precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#acdca559896b9c54658537e244ce89085">get_nof_ports</a>();</div>
<div class="line"><span class="lineno">  177</span>  srsran_assert(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_precoding_ports</a> &lt;= nof_ports,</div>
<div class="line"><span class="lineno">  178</span>                <span class="stringliteral">&quot;The precoding number of ports (i.e., {}) exceeds the grid number of ports (i.e., {}).&quot;</span>,</div>
<div class="line"><span class="lineno">  179</span>                precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#acdca559896b9c54658537e244ce89085">get_nof_ports</a>(),</div>
<div class="line"><span class="lineno">  180</span>                nof_ports);</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>  <span class="comment">// Temporary intermediate buffer for storing precoded symbols.</span></div>
<div class="line"><span class="lineno">  183</span>  <a class="code hl_class" href="../../d9/d87/classsrsran_1_1static__re__buffer.html">precoding_buffer_type</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>;</div>
<div class="line"><span class="lineno">  184</span> </div>
<div class="line"><span class="lineno">  185</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">is_dmrs_type1</a> = pattern.<a class="code hl_variable" href="../../d2/d8f/structsrsran_1_1re__pattern.html#ad54232b98e15d6169aad59093d196710">prb_mask</a>.<a class="code hl_function" href="../../d4/dae/classsrsran_1_1bounded__bitset.html#a6063ce8435cbbc14fb1344e49ac3becf">is_contiguous</a>(<span class="keyword">true</span>) &amp;&amp;</div>
<div class="line"><span class="lineno">  186</span>                       (pattern.<a class="code hl_variable" href="../../d2/d8f/structsrsran_1_1re__pattern.html#af9f3399e9641474ffeea688fae30a731">re_mask</a> == get_re_mask_type_1(0) || pattern.<a class="code hl_variable" href="../../d2/d8f/structsrsran_1_1re__pattern.html#af9f3399e9641474ffeea688fae30a731">re_mask</a> == get_re_mask_type_1(1));</div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">is_dmrs_type1</a>) {</div>
<div class="line"><span class="lineno">  189</span>    <span class="comment">// Optimized contiguous DM-RS Type 1 mapping.</span></div>
<div class="line"><span class="lineno">  190</span>    map_dmrs_type1_contiguous(writer, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>, input, pattern, precoding, *precoder);</div>
<div class="line"><span class="lineno">  191</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  192</span>  }</div>
<div class="line"><span class="lineno">  193</span> </div>
<div class="line"><span class="lineno">  194</span>  <span class="comment">// PRG size in number of subcarriers.</span></div>
<div class="line"><span class="lineno">  195</span>  <span class="keywordtype">unsigned</span> prg_size = precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#a176decd1c24e563e4754c93e5f5b82a9">get_prg_size</a>() * NRE;</div>
<div class="line"><span class="lineno">  196</span> </div>
<div class="line"><span class="lineno">  197</span>  <span class="keywordtype">int</span> first_symbol = pattern.<a class="code hl_variable" href="../../d2/d8f/structsrsran_1_1re__pattern.html#adb611adea4c54a4ad5c0ddbcc593cd99">symbols</a>.<a class="code hl_function" href="../../d4/dae/classsrsran_1_1bounded__bitset.html#aa2de3a0528dbe3ab78a6c764bef1eb0f">find_lowest</a>(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  198</span>  <span class="keywordtype">int</span> end_symbol   = pattern.<a class="code hl_variable" href="../../d2/d8f/structsrsran_1_1re__pattern.html#adb611adea4c54a4ad5c0ddbcc593cd99">symbols</a>.<a class="code hl_function" href="../../d4/dae/classsrsran_1_1bounded__bitset.html#a4113d614afd53f3e204dce4ec89963b9">find_highest</a>(<span class="keyword">true</span>) + 1;</div>
<div class="line"><span class="lineno">  199</span>  srsran_assert((first_symbol &gt;= 0) &amp;&amp; (end_symbol &gt;= 0),</div>
<div class="line"><span class="lineno">  200</span>                <span class="stringliteral">&quot;At least one OFDM symbol must be used by the allocation pattern.&quot;</span>);</div>
<div class="line"><span class="lineno">  201</span> </div>
<div class="line"><span class="lineno">  202</span>  <span class="comment">// Get the symbol RE mask. It is the same for all allocated OFDM symbols.</span></div>
<div class="line"><span class="lineno">  203</span>  <a class="code hl_class" href="../../d4/dae/classsrsran_1_1bounded__bitset.html">bounded_bitset&lt;max_nof_subcarriers&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>(nof_subc);</div>
<div class="line"><span class="lineno">  204</span>  pattern.<a class="code hl_function" href="../../d2/d8f/structsrsran_1_1re__pattern.html#a51220cce79fd4314ad55ac7a1220e7f6">get_inclusion_mask</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>, first_symbol);</div>
<div class="line"><span class="lineno">  205</span> </div>
<div class="line"><span class="lineno">  206</span>  <span class="comment">// Find the highest used subcarrier. Skip symbol if no active subcarrier.</span></div>
<div class="line"><span class="lineno">  207</span>  <span class="keywordtype">int</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_highest_subc</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>.find_highest();</div>
<div class="line"><span class="lineno">  208</span>  srsran_assert(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_highest_subc</a> &gt;= 0, <span class="stringliteral">&quot;At least one subcarrier must be used by the allocation pattern.&quot;</span>);</div>
<div class="line"><span class="lineno">  209</span> </div>
<div class="line"><span class="lineno">  210</span>  <span class="comment">// Resize the mask to the highest subcarrier, ceiling to PRB.</span></div>
<div class="line"><span class="lineno">  211</span>  <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>.resize(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a6e5aee1d553dc6e825017842e4059adb">divide_ceil</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_highest_subc</a> + 1, NRE) * NRE);</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>  <span class="comment">// Number of RE to be allocated for each OFDM symbol in the pattern.</span></div>
<div class="line"><span class="lineno">  214</span>  <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_symbol</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>.count();</div>
<div class="line"><span class="lineno">  215</span> </div>
<div class="line"><span class="lineno">  216</span>  <span class="keywordflow">if</span> ((<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_symbol</a> != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>.get_nof_re()) || (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_precoding_ports</a> != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>.get_nof_slices())) {</div>
<div class="line"><span class="lineno">  217</span>    <span class="comment">// Resize the output buffer if the input dimensions don&#39;t match.</span></div>
<div class="line"><span class="lineno">  218</span>    <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>.resize(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_precoding_ports</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_symbol</a>);</div>
<div class="line"><span class="lineno">  219</span>  }</div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span>  <span class="comment">// Counter for the number of RE read from the input and mapped to the grid.</span></div>
<div class="line"><span class="lineno">  222</span>  <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_re_buffer</a> = 0;</div>
<div class="line"><span class="lineno">  223</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a> = first_symbol; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a> != end_symbol; ++<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a>) {</div>
<div class="line"><span class="lineno">  224</span>    <span class="comment">// Skip symbol if it is not in the allocation pattern.</span></div>
<div class="line"><span class="lineno">  225</span>    <span class="keywordflow">if</span> (!pattern.<a class="code hl_variable" href="../../d2/d8f/structsrsran_1_1re__pattern.html#adb611adea4c54a4ad5c0ddbcc593cd99">symbols</a>.<a class="code hl_function" href="../../d4/dae/classsrsran_1_1bounded__bitset.html#a53b1498a7820972edb5b9c8db2fc94db">test</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a>)) {</div>
<div class="line"><span class="lineno">  226</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  227</span>    }</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>    <span class="comment">// Bypass precoding if it has no effect on the signal.</span></div>
<div class="line"><span class="lineno">  230</span>    <span class="keywordflow">if</span> ((nof_layers == 1) &amp;&amp; (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_precoding_ports</a> == 1) &amp;&amp; (precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#ad46543b1edc0bbec24b89f7a1c798e19">get_nof_prg</a>() == 1) &amp;&amp;</div>
<div class="line"><span class="lineno">  231</span>        (precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#ad5ce71c497de768ec0fd79336b8e5b23">get_coefficient</a>(0, 0, 0) == 1.0F)) {</div>
<div class="line"><span class="lineno">  232</span>      <span class="comment">// View over the input RE belonging to the current symbol.</span></div>
<div class="line"><span class="lineno">  233</span>      <a class="code hl_class" href="../../d6/d15/classsrsran_1_1re__buffer__reader__view.html">re_buffer_reader_view</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">input_re_symbol</a>(input, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_re_buffer</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_symbol</a>);</div>
<div class="line"><span class="lineno">  234</span> </div>
<div class="line"><span class="lineno">  235</span>      <span class="comment">// Map directly to the grid.</span></div>
<div class="line"><span class="lineno">  236</span>      <a class="code hl_class" href="../../de/d4c/classsrsran_1_1span.html">span&lt;const cf_t&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">unmapped</a> = writer.<a class="code hl_function" href="../../d5/d6e/classsrsran_1_1resource__grid__writer.html#aaad19c2090c3824f52092dfcf251710c">put</a>(0, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a>, 0, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">input_re_symbol</a>.get_slice(0));</div>
<div class="line"><span class="lineno">  237</span>      srsran_assert(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">unmapped</a>.empty(), <span class="stringliteral">&quot;Not all REs have been mapped to the grid.&quot;</span>);</div>
<div class="line"><span class="lineno">  238</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_re_buffer</a> += <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_symbol</a>;</div>
<div class="line"><span class="lineno">  239</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  240</span>    }</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>    <span class="comment">// Counter for the number of precoded REs for the current symbol.</span></div>
<div class="line"><span class="lineno">  243</span>    <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_precoding_buffer</a> = 0;</div>
<div class="line"><span class="lineno">  244</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_prg</a> = 0, nof_prg = precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#ad46543b1edc0bbec24b89f7a1c798e19">get_nof_prg</a>(), <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_subc</a> = 0; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_prg</a> != nof_prg; ++<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_prg</a>) {</div>
<div class="line"><span class="lineno">  245</span>      <span class="comment">// Get the precoding matrix for the current PRG.</span></div>
<div class="line"><span class="lineno">  246</span>      <span class="keyword">const</span> <a class="code hl_class" href="../../d6/d8c/classsrsran_1_1precoding__weight__matrix.html">precoding_weight_matrix</a>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_weights</a> = precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#aed3b3de237d44a03bca4409970c4eb63">get_prg_coefficients</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_prg</a>);</div>
<div class="line"><span class="lineno">  247</span> </div>
<div class="line"><span class="lineno">  248</span>      <span class="comment">// Number of grid RE belonging to the current PRG for the provided allocation pattern dimensions.</span></div>
<div class="line"><span class="lineno">  249</span>      <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_prg</a> = std::min(prg_size, <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>.size()) - <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_subc</a>);</div>
<div class="line"><span class="lineno">  250</span> </div>
<div class="line"><span class="lineno">  251</span>      <span class="comment">// Mask for the RE belonging to the current PRG.</span></div>
<div class="line"><span class="lineno">  252</span>      <a class="code hl_class" href="../../d4/dae/classsrsran_1_1bounded__bitset.html">bounded_bitset&lt;max_nof_subcarriers&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_re_mask</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>.<a class="code hl_function" href="../../d4/dae/classsrsran_1_1bounded__bitset.html#afe1a0207f2e64504dfe8df1d6d7c163b">slice</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_subc</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_subc</a> + <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_prg</a>);</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>      <span class="comment">// Number of allocated RE for the current PRG.</span></div>
<div class="line"><span class="lineno">  255</span>      <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_prg</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_re_mask</a>.count();</div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span>      <span class="comment">// Views of the input and precoder buffers for the REs belonging to the current PRG.</span></div>
<div class="line"><span class="lineno">  258</span>      <a class="code hl_class" href="../../d6/d15/classsrsran_1_1re__buffer__reader__view.html">re_buffer_reader_view</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">input_re_prg</a>(input, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_re_buffer</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_prg</a>);</div>
<div class="line"><span class="lineno">  259</span>      <a class="code hl_class" href="../../d2/d09/classsrsran_1_1re__buffer__writer__view.html">re_buffer_writer_view</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">output_re_prg</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_precoding_buffer</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_prg</a>);</div>
<div class="line"><span class="lineno">  260</span> </div>
<div class="line"><span class="lineno">  261</span>      <span class="comment">// Apply precoding.</span></div>
<div class="line"><span class="lineno">  262</span>      precoder-&gt;apply_precoding(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">output_re_prg</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">input_re_prg</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_weights</a>);</div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span>      <span class="comment">// Advance input and output buffers.</span></div>
<div class="line"><span class="lineno">  265</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_re_buffer</a> += <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_prg</a>;</div>
<div class="line"><span class="lineno">  266</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_precoding_buffer</a> += <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_prg</a>;</div>
<div class="line"><span class="lineno">  267</span> </div>
<div class="line"><span class="lineno">  268</span>      <span class="comment">// Advance mask slice.</span></div>
<div class="line"><span class="lineno">  269</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_subc</a> += <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_prg</a>;</div>
<div class="line"><span class="lineno">  270</span>    }</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>    <span class="comment">// Assert that the precoding buffer has been filled.</span></div>
<div class="line"><span class="lineno">  273</span>    srsran_assert((<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_precoding_buffer</a> == <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>.get_nof_re()),</div>
<div class="line"><span class="lineno">  274</span>                  <span class="stringliteral">&quot;The number of precoded RE (i.e., {}) does not match the precoding buffer size (i.e., {}).&quot;</span>,</div>
<div class="line"><span class="lineno">  275</span>                  <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_precoding_buffer</a>,</div>
<div class="line"><span class="lineno">  276</span>                  <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>.get_nof_re());</div>
<div class="line"><span class="lineno">  277</span> </div>
<div class="line"><span class="lineno">  278</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_tx_port</a> = 0; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_tx_port</a> != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_precoding_ports</a>; ++<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_tx_port</a>) {</div>
<div class="line"><span class="lineno">  279</span>      <span class="comment">// Map the precoded REs to each port for the current symbol.</span></div>
<div class="line"><span class="lineno">  280</span>      <a class="code hl_class" href="../../de/d4c/classsrsran_1_1span.html">span&lt;const cf_t&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">port_data</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>.get_slice(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_tx_port</a>);</div>
<div class="line"><span class="lineno">  281</span>      <a class="code hl_class" href="../../de/d4c/classsrsran_1_1span.html">span&lt;const cf_t&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">unmapped</a>  = writer.<a class="code hl_function" href="../../d5/d6e/classsrsran_1_1resource__grid__writer.html#aaad19c2090c3824f52092dfcf251710c">put</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_tx_port</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a>, 0, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">port_data</a>);</div>
<div class="line"><span class="lineno">  282</span>      srsran_assert(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">unmapped</a>.empty(), <span class="stringliteral">&quot;Not all REs have been mapped to the grid.&quot;</span>);</div>
<div class="line"><span class="lineno">  283</span>    }</div>
<div class="line"><span class="lineno">  284</span>  }</div>
<div class="line"><span class="lineno">  285</span> </div>
<div class="line"><span class="lineno">  286</span>  <span class="comment">// Assert that all input REs have been processed.</span></div>
<div class="line"><span class="lineno">  287</span>  srsran_assert((<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_re_buffer</a> == input.<a class="code hl_function" href="../../d3/d07/classsrsran_1_1detail_1_1re__buffer__dimensions.html#a07437ee656d4110db488f06f63ff51dd">get_nof_re</a>()),</div>
<div class="line"><span class="lineno">  288</span>                <span class="stringliteral">&quot;The number of total precoded RE (i.e., {}) does not match the number of total input RE (i.e., {}).&quot;</span>,</div>
<div class="line"><span class="lineno">  289</span>                <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_re_buffer</a>,</div>
<div class="line"><span class="lineno">  290</span>                input.<a class="code hl_function" href="../../d3/d07/classsrsran_1_1detail_1_1re__buffer__dimensions.html#a07437ee656d4110db488f06f63ff51dd">get_nof_re</a>());</div>
<div class="line"><span class="lineno">  291</span>}</div>
<div class="ttc" id="aclasssrsran_1_1bounded__bitset_html"><div class="ttname"><a href="../../d4/dae/classsrsran_1_1bounded__bitset.html">srsran::bounded_bitset</a></div><div class="ttdoc">Represents a dynamically-sized bitset with an upper bound capacity of N bits.</div><div class="ttdef"><b>Definition</b> bounded_bitset.h:280</div></div>
<div class="ttc" id="aclasssrsran_1_1bounded__bitset_html_a4113d614afd53f3e204dce4ec89963b9"><div class="ttname"><a href="../../d4/dae/classsrsran_1_1bounded__bitset.html#a4113d614afd53f3e204dce4ec89963b9">srsran::bounded_bitset::find_highest</a></div><div class="ttdeci">int find_highest(bool value=true) const noexcept</div><div class="ttdoc">Finds the highest bit with value set to the value passed as argument.</div><div class="ttdef"><b>Definition</b> bounded_bitset.h:813</div></div>
<div class="ttc" id="aclasssrsran_1_1bounded__bitset_html_a53b1498a7820972edb5b9c8db2fc94db"><div class="ttname"><a href="../../d4/dae/classsrsran_1_1bounded__bitset.html#a53b1498a7820972edb5b9c8db2fc94db">srsran::bounded_bitset::test</a></div><div class="ttdeci">bool test(size_t pos) const</div><div class="ttdoc">Check if bit with provided index is set to true.</div><div class="ttdef"><b>Definition</b> bounded_bitset.h:569</div></div>
<div class="ttc" id="aclasssrsran_1_1bounded__bitset_html_a6063ce8435cbbc14fb1344e49ac3becf"><div class="ttname"><a href="../../d4/dae/classsrsran_1_1bounded__bitset.html#a6063ce8435cbbc14fb1344e49ac3becf">srsran::bounded_bitset::is_contiguous</a></div><div class="ttdeci">bool is_contiguous(bool value=true) const noexcept</div><div class="ttdoc">Determines whether all bits with value set to value are contiguous.</div><div class="ttdef"><b>Definition</b> bounded_bitset.h:875</div></div>
<div class="ttc" id="aclasssrsran_1_1bounded__bitset_html_aa2de3a0528dbe3ab78a6c764bef1eb0f"><div class="ttname"><a href="../../d4/dae/classsrsran_1_1bounded__bitset.html#aa2de3a0528dbe3ab78a6c764bef1eb0f">srsran::bounded_bitset::find_lowest</a></div><div class="ttdeci">int find_lowest(bool value=true) const noexcept</div><div class="ttdoc">Finds the lowest bit with value set to the value passed as argument.</div><div class="ttdef"><b>Definition</b> bounded_bitset.h:642</div></div>
<div class="ttc" id="aclasssrsran_1_1bounded__bitset_html_afe1a0207f2e64504dfe8df1d6d7c163b"><div class="ttname"><a href="../../d4/dae/classsrsran_1_1bounded__bitset.html#afe1a0207f2e64504dfe8df1d6d7c163b">srsran::bounded_bitset::slice</a></div><div class="ttdeci">bounded_bitset&lt; N2, LowestInfoBitIsMSB &gt; slice(size_t startpos, size_t endpos) const</div><div class="ttdoc">Returns bounded_bitset&lt;&gt; that represents a slice or subview of the original bounded_bitset....</div><div class="ttdef"><b>Definition</b> bounded_bitset.h:610</div></div>
<div class="ttc" id="aclasssrsran_1_1detail_1_1re__buffer__dimensions_html_a07437ee656d4110db488f06f63ff51dd"><div class="ttname"><a href="../../d3/d07/classsrsran_1_1detail_1_1re__buffer__dimensions.html#a07437ee656d4110db488f06f63ff51dd">srsran::detail::re_buffer_dimensions::get_nof_re</a></div><div class="ttdeci">virtual unsigned get_nof_re() const =0</div><div class="ttdoc">Gets the current number of Resource Elements.</div></div>
<div class="ttc" id="aclasssrsran_1_1detail_1_1re__buffer__dimensions_html_af9938dde244e7d21ee3280d29030c6d8"><div class="ttname"><a href="../../d3/d07/classsrsran_1_1detail_1_1re__buffer__dimensions.html#af9938dde244e7d21ee3280d29030c6d8">srsran::detail::re_buffer_dimensions::get_nof_slices</a></div><div class="ttdeci">virtual unsigned get_nof_slices() const =0</div><div class="ttdoc">Gets the current number of slices.</div></div>
<div class="ttc" id="aclasssrsran_1_1precoding__configuration_html_a176decd1c24e563e4754c93e5f5b82a9"><div class="ttname"><a href="../../dc/da4/classsrsran_1_1precoding__configuration.html#a176decd1c24e563e4754c93e5f5b82a9">srsran::precoding_configuration::get_prg_size</a></div><div class="ttdeci">unsigned get_prg_size() const</div><div class="ttdoc">Gets the current PRG size.</div><div class="ttdef"><b>Definition</b> precoding_configuration.h:182</div></div>
<div class="ttc" id="aclasssrsran_1_1precoding__configuration_html_a78eeca8376d722f128340ed3c58fbfbd"><div class="ttname"><a href="../../dc/da4/classsrsran_1_1precoding__configuration.html#a78eeca8376d722f128340ed3c58fbfbd">srsran::precoding_configuration::get_nof_layers</a></div><div class="ttdeci">unsigned get_nof_layers() const</div><div class="ttdoc">Gets the current number of layers.</div><div class="ttdef"><b>Definition</b> precoding_configuration.h:173</div></div>
<div class="ttc" id="aclasssrsran_1_1precoding__configuration_html_acdca559896b9c54658537e244ce89085"><div class="ttname"><a href="../../dc/da4/classsrsran_1_1precoding__configuration.html#acdca559896b9c54658537e244ce89085">srsran::precoding_configuration::get_nof_ports</a></div><div class="ttdeci">unsigned get_nof_ports() const</div><div class="ttdoc">Gets the current number of ports.</div><div class="ttdef"><b>Definition</b> precoding_configuration.h:176</div></div>
<div class="ttc" id="aclasssrsran_1_1precoding__configuration_html_ad46543b1edc0bbec24b89f7a1c798e19"><div class="ttname"><a href="../../dc/da4/classsrsran_1_1precoding__configuration.html#ad46543b1edc0bbec24b89f7a1c798e19">srsran::precoding_configuration::get_nof_prg</a></div><div class="ttdeci">unsigned get_nof_prg() const</div><div class="ttdoc">Gets the current number of PRG.</div><div class="ttdef"><b>Definition</b> precoding_configuration.h:179</div></div>
<div class="ttc" id="aclasssrsran_1_1precoding__configuration_html_ad5ce71c497de768ec0fd79336b8e5b23"><div class="ttname"><a href="../../dc/da4/classsrsran_1_1precoding__configuration.html#ad5ce71c497de768ec0fd79336b8e5b23">srsran::precoding_configuration::get_coefficient</a></div><div class="ttdeci">cf_t get_coefficient(unsigned i_layer, unsigned i_port, unsigned i_prg) const</div><div class="ttdoc">Gets a specific coefficient for a given layer, port and PRG.</div><div class="ttdef"><b>Definition</b> precoding_configuration.h:217</div></div>
<div class="ttc" id="aclasssrsran_1_1precoding__configuration_html_aed3b3de237d44a03bca4409970c4eb63"><div class="ttname"><a href="../../dc/da4/classsrsran_1_1precoding__configuration.html#aed3b3de237d44a03bca4409970c4eb63">srsran::precoding_configuration::get_prg_coefficients</a></div><div class="ttdeci">const precoding_weight_matrix &amp; get_prg_coefficients(unsigned i_prg) const</div><div class="ttdoc">Gets the precoding weights for a given PRG.</div><div class="ttdef"><b>Definition</b> precoding_configuration.h:239</div></div>
<div class="ttc" id="aclasssrsran_1_1precoding__weight__matrix_html"><div class="ttname"><a href="../../d6/d8c/classsrsran_1_1precoding__weight__matrix.html">srsran::precoding_weight_matrix</a></div><div class="ttdoc">Precoding matrix, consisting of complex coefficients arranged by i) transmit layers and ii) antenna p...</div><div class="ttdef"><b>Definition</b> precoding_weight_matrix.h:35</div></div>
<div class="ttc" id="aclasssrsran_1_1re__buffer__reader__view_html"><div class="ttname"><a href="../../d6/d15/classsrsran_1_1re__buffer__reader__view.html">srsran::re_buffer_reader_view</a></div><div class="ttdoc">Implements a resource element buffer reader view, with read-only access methods.</div><div class="ttdef"><b>Definition</b> re_buffer.h:77</div></div>
<div class="ttc" id="aclasssrsran_1_1re__buffer__writer__view_html"><div class="ttname"><a href="../../d2/d09/classsrsran_1_1re__buffer__writer__view.html">srsran::re_buffer_writer_view</a></div><div class="ttdoc">Implements a resource element buffer writer view, with read-write access methods.</div><div class="ttdef"><b>Definition</b> re_buffer.h:124</div></div>
<div class="ttc" id="aclasssrsran_1_1resource__grid__writer_html_aaad19c2090c3824f52092dfcf251710c"><div class="ttname"><a href="../../d5/d6e/classsrsran_1_1resource__grid__writer.html#aaad19c2090c3824f52092dfcf251710c">srsran::resource_grid_writer::put</a></div><div class="ttdeci">virtual void put(unsigned port, span&lt; const resource_grid_coordinate &gt; coordinates, span&lt; const cf_t &gt; symbols)=0</div><div class="ttdoc">Puts a number of elements in the grid for a given port according to a list of coordinates.</div></div>
<div class="ttc" id="aclasssrsran_1_1span_html"><div class="ttname"><a href="../../de/d4c/classsrsran_1_1span.html">srsran::span</a></div><div class="ttdef"><b>Definition</b> span.h:98</div></div>
<div class="ttc" id="aclasssrsran_1_1static__re__buffer_html"><div class="ttname"><a href="../../d9/d87/classsrsran_1_1static__re__buffer.html">srsran::static_re_buffer</a></div><div class="ttdoc">Implements a static resource element buffer.</div><div class="ttdef"><b>Definition</b> re_buffer.h:224</div></div>
<div class="ttc" id="anamespacesrsran_html_a6e5aee1d553dc6e825017842e4059adb"><div class="ttname"><a href="../../d9/def/namespacesrsran.html#a6e5aee1d553dc6e825017842e4059adb">srsran::divide_ceil</a></div><div class="ttdeci">constexpr unsigned divide_ceil(unsigned num, unsigned den)</div><div class="ttdoc">Performs an integer division rounding up.</div><div class="ttdef"><b>Definition</b> math_utils.h:41</div></div>
<div class="ttc" id="astructsrsran_1_1re__pattern_html_a51220cce79fd4314ad55ac7a1220e7f6"><div class="ttname"><a href="../../d2/d8f/structsrsran_1_1re__pattern.html#a51220cce79fd4314ad55ac7a1220e7f6">srsran::re_pattern::get_inclusion_mask</a></div><div class="ttdeci">void get_inclusion_mask(bounded_bitset&lt; MAX_RB *NRE &gt; &amp;mask, unsigned symbol) const</div><div class="ttdoc">Include the described resource element pattern in a resource grid symbol mask.</div><div class="ttdef"><b>Definition</b> re_pattern.cpp:27</div></div>
<div class="ttc" id="astructsrsran_1_1re__pattern_html_ad54232b98e15d6169aad59093d196710"><div class="ttname"><a href="../../d2/d8f/structsrsran_1_1re__pattern.html#ad54232b98e15d6169aad59093d196710">srsran::re_pattern::prb_mask</a></div><div class="ttdeci">bounded_bitset&lt; MAX_RB &gt; prb_mask</div><div class="ttdoc">Physical resource block mask.</div><div class="ttdef"><b>Definition</b> re_pattern.h:37</div></div>
<div class="ttc" id="astructsrsran_1_1re__pattern_html_adb611adea4c54a4ad5c0ddbcc593cd99"><div class="ttname"><a href="../../d2/d8f/structsrsran_1_1re__pattern.html#adb611adea4c54a4ad5c0ddbcc593cd99">srsran::re_pattern::symbols</a></div><div class="ttdeci">symbol_slot_mask symbols</div><div class="ttdoc">Symbol mask. True entries indicate the symbols affected by the pattern.</div><div class="ttdef"><b>Definition</b> re_pattern.h:41</div></div>
<div class="ttc" id="astructsrsran_1_1re__pattern_html_af9f3399e9641474ffeea688fae30a731"><div class="ttname"><a href="../../d2/d8f/structsrsran_1_1re__pattern.html#af9f3399e9641474ffeea688fae30a731">srsran::re_pattern::re_mask</a></div><div class="ttdeci">re_prb_mask re_mask</div><div class="ttdoc">Resource element mask per resource block. True entries indicate the resource elements affected by the...</div><div class="ttdef"><b>Definition</b> re_pattern.h:39</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1f52b7dcf26004e13a15791c6d9ece7d" name="a1f52b7dcf26004e13a15791c6d9ece7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f52b7dcf26004e13a15791c6d9ece7d">&#9670;&#160;</a></span>map() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">void</a> resource_grid_mapper_impl::map </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d1/d5c/classsrsran_1_1resource__grid__mapper_1_1symbol__buffer.html">symbol_buffer</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d9/d27/classsrsran_1_1re__pattern__list.html">re_pattern_list</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pattern</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../d9/d27/classsrsran_1_1re__pattern__list.html">re_pattern_list</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>reserved</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">const</a> <a class="el" href="../../dc/da4/classsrsran_1_1precoding__configuration.html">precoding_configuration</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>precoding</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a></td>          <td class="paramname"><span class="paramname"><em>re_skip</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maps complex symbols onto the resource grid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">buffer</td><td>Buffer containing the complex symbols to map. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pattern</td><td>Data allocation pattern in the resource grid. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reserved</td><td>Reserved resource elements, to be excluded from the allocation pattern. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">precoding</td><td>Precoding configuration. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">re_skip</td><td>Number of RE to skip before start mapping the buffer. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="../../d0/ddc/classsrsran_1_1resource__grid__mapper.html#a8ee7b26f78f544f3ba3fc69260b3030c">srsran::resource_grid_mapper</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  298</span>{</div>
<div class="line"><span class="lineno">  299</span>  <span class="comment">// Temporary intermediate buffer for storing precoded symbols.</span></div>
<div class="line"><span class="lineno">  300</span>  <a class="code hl_class" href="../../d9/d87/classsrsran_1_1static__re__buffer.html">precoding_buffer_type</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>;</div>
<div class="line"><span class="lineno">  301</span> </div>
<div class="line"><span class="lineno">  302</span>  <span class="comment">// The number of layers is equal to the number of ports.</span></div>
<div class="line"><span class="lineno">  303</span>  <span class="keywordtype">unsigned</span> nof_layers = precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#a78eeca8376d722f128340ed3c58fbfbd">get_nof_layers</a>();</div>
<div class="line"><span class="lineno">  304</span> </div>
<div class="line"><span class="lineno">  305</span>  <span class="comment">// Extract number of antennas.</span></div>
<div class="line"><span class="lineno">  306</span>  <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_antennas</a> = precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#acdca559896b9c54658537e244ce89085">get_nof_ports</a>();</div>
<div class="line"><span class="lineno">  307</span> </div>
<div class="line"><span class="lineno">  308</span>  <span class="comment">// Verify that the number of layers is consistent with the number of ports.</span></div>
<div class="line"><span class="lineno">  309</span>  <a class="code hl_class" href="../../d4/d3c/classsrsran_1_1interval.html">interval&lt;unsigned, true&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_antennas_range</a>(1, nof_ports);</div>
<div class="line"><span class="lineno">  310</span>  srsran_assert(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_antennas_range</a>.contains(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_antennas</a>),</div>
<div class="line"><span class="lineno">  311</span>                <span class="stringliteral">&quot;The number of antennas (i.e., {}) must be in range {}&quot;</span>,</div>
<div class="line"><span class="lineno">  312</span>                <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_antennas</a>,</div>
<div class="line"><span class="lineno">  313</span>                <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_antennas_range</a>);</div>
<div class="line"><span class="lineno">  314</span>  <a class="code hl_class" href="../../d4/d3c/classsrsran_1_1interval.html">interval&lt;unsigned, true&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_layers_range</a>(1, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_antennas</a>);</div>
<div class="line"><span class="lineno">  315</span>  srsran_assert(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_layers_range</a>.contains(nof_layers),</div>
<div class="line"><span class="lineno">  316</span>                <span class="stringliteral">&quot;The number of layers (i.e., {}) must be in range {}&quot;</span>,</div>
<div class="line"><span class="lineno">  317</span>                nof_layers,</div>
<div class="line"><span class="lineno">  318</span>                <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_layers_range</a>);</div>
<div class="line"><span class="lineno">  319</span> </div>
<div class="line"><span class="lineno">  320</span>  <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_count</a> = 0;</div>
<div class="line"><span class="lineno">  321</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a> = 0; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a> != MAX_NSYMB_PER_SLOT; ++<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a>) {</div>
<div class="line"><span class="lineno">  322</span>    <span class="comment">// Get the symbol RE mask.</span></div>
<div class="line"><span class="lineno">  323</span>    <a class="code hl_class" href="../../d4/dae/classsrsran_1_1bounded__bitset.html">bounded_bitset&lt;max_nof_subcarriers&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>(max_nof_subcarriers);</div>
<div class="line"><span class="lineno">  324</span>    pattern.<a class="code hl_function" href="../../d9/d27/classsrsran_1_1re__pattern__list.html#a401dec364e6b970042f47fd775bb4139">get_inclusion_mask</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a>);</div>
<div class="line"><span class="lineno">  325</span>    reserved.get_exclusion_mask(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a>);</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>    <span class="comment">// Find the highest used subcarrier. Skip symbol if no active subcarrier.</span></div>
<div class="line"><span class="lineno">  328</span>    <span class="keywordtype">int</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_highest_subc</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>.find_highest();</div>
<div class="line"><span class="lineno">  329</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_highest_subc</a> &lt; 0) {</div>
<div class="line"><span class="lineno">  330</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  331</span>    }</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>    <span class="comment">// Get the number of active RE in the OFDM symbol. Skip symbol if the number of active RE does not reach the skip.</span></div>
<div class="line"><span class="lineno">  334</span>    <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_symbol</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>.count();</div>
<div class="line"><span class="lineno">  335</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_count</a> + <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_symbol</a> &lt; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_skip</a>) {</div>
<div class="line"><span class="lineno">  336</span>      <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_count</a> += <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_symbol</a>;</div>
<div class="line"><span class="lineno">  337</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  338</span>    }</div>
<div class="line"><span class="lineno">  339</span> </div>
<div class="line"><span class="lineno">  340</span>    <span class="comment">// Iterate all precoding PRGs.</span></div>
<div class="line"><span class="lineno">  341</span>    <span class="keywordtype">unsigned</span> prg_size = precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#a176decd1c24e563e4754c93e5f5b82a9">get_prg_size</a>() * NRE;</div>
<div class="line"><span class="lineno">  342</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_prg</a> = 0, nof_prg = precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#ad46543b1edc0bbec24b89f7a1c798e19">get_nof_prg</a>(); <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_prg</a> != nof_prg; ++<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_prg</a>) {</div>
<div class="line"><span class="lineno">  343</span>      <span class="comment">// Get the precoding matrix for the current PRG.</span></div>
<div class="line"><span class="lineno">  344</span>      <span class="keyword">const</span> <a class="code hl_class" href="../../d6/d8c/classsrsran_1_1precoding__weight__matrix.html">precoding_weight_matrix</a>&amp; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_weights</a> = precoding.<a class="code hl_function" href="../../dc/da4/classsrsran_1_1precoding__configuration.html#aed3b3de237d44a03bca4409970c4eb63">get_prg_coefficients</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_prg</a>);</div>
<div class="line"><span class="lineno">  345</span> </div>
<div class="line"><span class="lineno">  346</span>      <span class="comment">// Get the subcarrier interval for the PRG.</span></div>
<div class="line"><span class="lineno">  347</span>      <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_subc</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_prg</a> * prg_size;</div>
<div class="line"><span class="lineno">  348</span> </div>
<div class="line"><span class="lineno">  349</span>      <span class="comment">// Number of grid RE belonging to the current PRG for the provided allocation pattern dimensions.</span></div>
<div class="line"><span class="lineno">  350</span>      <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_prg</a> = std::min(prg_size, <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_highest_subc</a> + 1) - <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_subc</a>);</div>
<div class="line"><span class="lineno">  351</span> </div>
<div class="line"><span class="lineno">  352</span>      <span class="comment">// Mask for the RE belonging to the current PRG.</span></div>
<div class="line"><span class="lineno">  353</span>      <a class="code hl_class" href="../../d4/dae/classsrsran_1_1bounded__bitset.html">bounded_bitset&lt;max_nof_subcarriers&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_re_mask</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">symbol_re_mask</a>.<a class="code hl_function" href="../../d4/dae/classsrsran_1_1bounded__bitset.html#afe1a0207f2e64504dfe8df1d6d7c163b">slice</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_subc</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_subc</a> + <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_prg</a>);</div>
<div class="line"><span class="lineno">  354</span> </div>
<div class="line"><span class="lineno">  355</span>      <span class="comment">// Skip PRG if no RE is selected.</span></div>
<div class="line"><span class="lineno">  356</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_re_mask</a>.none()) {</div>
<div class="line"><span class="lineno">  357</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  358</span>      }</div>
<div class="line"><span class="lineno">  359</span> </div>
<div class="line"><span class="lineno">  360</span>      <span class="comment">// Get the number of active RE in the PRG. Skip PRG if the number of active RE does not reach the skip.</span></div>
<div class="line"><span class="lineno">  361</span>      <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_prg</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_re_mask</a>.count();</div>
<div class="line"><span class="lineno">  362</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_count</a> + <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_prg</a> &lt; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_skip</a>) {</div>
<div class="line"><span class="lineno">  363</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_count</a> += <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_prg</a>;</div>
<div class="line"><span class="lineno">  364</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  365</span>      }</div>
<div class="line"><span class="lineno">  366</span> </div>
<div class="line"><span class="lineno">  367</span>      <span class="comment">// Advance subcarrier offset to reach the skip count.</span></div>
<div class="line"><span class="lineno">  368</span>      <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">subc_offset</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_re_mask</a>.find_lowest();</div>
<div class="line"><span class="lineno">  369</span>      <span class="keywordflow">while</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_count</a> &lt; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_skip</a>) {</div>
<div class="line"><span class="lineno">  370</span>        <span class="comment">// Calculate the maximum number of subcarriers that can be processed in one block.</span></div>
<div class="line"><span class="lineno">  371</span>        <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_nof_subc_block</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_skip</a> - <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_count</a>;</div>
<div class="line"><span class="lineno">  372</span> </div>
<div class="line"><span class="lineno">  373</span>        <span class="comment">// Calculate the number of pending subcarriers to process.</span></div>
<div class="line"><span class="lineno">  374</span>        <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_pending</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_prg</a> - <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">subc_offset</a>;</div>
<div class="line"><span class="lineno">  375</span>        srsran_assert(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_pending</a> != 0, <span class="stringliteral">&quot;The number of pending subcarriers cannot be zero.&quot;</span>);</div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>        <span class="comment">// Select the number of subcarriers to process in a block.</span></div>
<div class="line"><span class="lineno">  378</span>        <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_block</a> = std::min(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_pending</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_nof_subc_block</a>);</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>        <span class="comment">// Get the allocation mask for the block.</span></div>
<div class="line"><span class="lineno">  381</span>        <a class="code hl_class" href="../../d4/dae/classsrsran_1_1bounded__bitset.html">bounded_bitset&lt;max_nof_subcarriers&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">block_mask</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_re_mask</a>.<a class="code hl_function" href="../../d4/dae/classsrsran_1_1bounded__bitset.html#afe1a0207f2e64504dfe8df1d6d7c163b">slice</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">subc_offset</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">subc_offset</a> + <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_block</a>);</div>
<div class="line"><span class="lineno">  382</span> </div>
<div class="line"><span class="lineno">  383</span>        <span class="comment">// Count the number of resource elements to map in the block.</span></div>
<div class="line"><span class="lineno">  384</span>        <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_block</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">block_mask</a>.count();</div>
<div class="line"><span class="lineno">  385</span> </div>
<div class="line"><span class="lineno">  386</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">re_count</a> += <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_block</a>;</div>
<div class="line"><span class="lineno">  387</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">subc_offset</a> += <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_block</a>;</div>
<div class="line"><span class="lineno">  388</span>      }</div>
<div class="line"><span class="lineno">  389</span> </div>
<div class="line"><span class="lineno">  390</span>      <span class="comment">// Process PRG in blocks smaller than or equal to max_block_size subcarriers.</span></div>
<div class="line"><span class="lineno">  391</span>      <span class="keywordflow">while</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">subc_offset</a> != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_prg</a>) {</div>
<div class="line"><span class="lineno">  392</span>        <span class="comment">// Calculate the maximum number of subcarriers that can be processed in one block.</span></div>
<div class="line"><span class="lineno">  393</span>        <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_nof_subc_block</a> = buffer.get_max_block_size() / nof_layers;</div>
<div class="line"><span class="lineno">  394</span> </div>
<div class="line"><span class="lineno">  395</span>        <span class="comment">// Calculate the number of pending subcarriers to process.</span></div>
<div class="line"><span class="lineno">  396</span>        <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_pending</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_prg</a> - <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">subc_offset</a>;</div>
<div class="line"><span class="lineno">  397</span> </div>
<div class="line"><span class="lineno">  398</span>        <span class="comment">// Select the number of subcarriers to process in a block.</span></div>
<div class="line"><span class="lineno">  399</span>        <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_block</a> = std::min(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_pending</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">max_nof_subc_block</a>);</div>
<div class="line"><span class="lineno">  400</span>        srsran_assert(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_block</a> != 0, <span class="stringliteral">&quot;The number of pending subcarriers cannot be zero.&quot;</span>);</div>
<div class="line"><span class="lineno">  401</span> </div>
<div class="line"><span class="lineno">  402</span>        <span class="comment">// Get the allocation mask for the block.</span></div>
<div class="line"><span class="lineno">  403</span>        <a class="code hl_class" href="../../d4/dae/classsrsran_1_1bounded__bitset.html">bounded_bitset&lt;max_nof_subcarriers&gt;</a> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">block_mask</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_re_mask</a>.<a class="code hl_function" href="../../d4/dae/classsrsran_1_1bounded__bitset.html#afe1a0207f2e64504dfe8df1d6d7c163b">slice</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">subc_offset</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">subc_offset</a> + <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_block</a>);</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>        <span class="comment">// Count the number of resource elements to map in the block.</span></div>
<div class="line"><span class="lineno">  406</span>        <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_block</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">block_mask</a>.count();</div>
<div class="line"><span class="lineno">  407</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_block</a> &gt; 0) {</div>
<div class="line"><span class="lineno">  408</span>          <span class="comment">// Calculate the number of symbols to generate.</span></div>
<div class="line"><span class="lineno">  409</span>          <span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_symbols_block</a> = <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_block</a> * nof_layers;</div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>          <span class="comment">// Prepare destination of the modulation buffer.</span></div>
<div class="line"><span class="lineno">  412</span>          <a class="code hl_class" href="../../de/d4c/classsrsran_1_1span.html">span&lt;const ci8_t&gt;</a> block = buffer.pop_symbols(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_symbols_block</a>);</div>
<div class="line"><span class="lineno">  413</span> </div>
<div class="line"><span class="lineno">  414</span>          <span class="comment">// Prepare buffers.</span></div>
<div class="line"><span class="lineno">  415</span>          <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>.resize(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_antennas</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_re_block</a>);</div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>          <span class="comment">// Layer map and precoding.</span></div>
<div class="line"><span class="lineno">  418</span>          precoder-&gt;apply_layer_map_and_precoding(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>, block, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">prg_weights</a>);</div>
<div class="line"><span class="lineno">  419</span> </div>
<div class="line"><span class="lineno">  420</span>          <span class="comment">// Map for each port.</span></div>
<div class="line"><span class="lineno">  421</span>          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_port</a> = 0; <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_port</a> != <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_antennas</a>; ++<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_port</a>) {</div>
<div class="line"><span class="lineno">  422</span>            writer.<a class="code hl_function" href="../../d5/d6e/classsrsran_1_1resource__grid__writer.html#aaad19c2090c3824f52092dfcf251710c">put</a>(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_port</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_symbol</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_subc</a> + <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">subc_offset</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">block_mask</a>, <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">precoding_buffer</a>.get_slice(<a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">i_port</a>));</div>
<div class="line"><span class="lineno">  423</span>          }</div>
<div class="line"><span class="lineno">  424</span> </div>
<div class="line"><span class="lineno">  425</span>          <span class="comment">// Early return  if the buffer is empty.</span></div>
<div class="line"><span class="lineno">  426</span>          <span class="keywordflow">if</span> (buffer.empty()) {</div>
<div class="line"><span class="lineno">  427</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  428</span>          }</div>
<div class="line"><span class="lineno">  429</span>        }</div>
<div class="line"><span class="lineno">  430</span> </div>
<div class="line"><span class="lineno">  431</span>        <span class="comment">// Increment the subcarrier offset.</span></div>
<div class="line"><span class="lineno">  432</span>        <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">subc_offset</a> += <a class="code hl_function" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">nof_subc_block</a>;</div>
<div class="line"><span class="lineno">  433</span>      }</div>
<div class="line"><span class="lineno">  434</span>    }</div>
<div class="line"><span class="lineno">  435</span>  }</div>
<div class="line"><span class="lineno">  436</span>}</div>
<div class="ttc" id="aclasssrsran_1_1interval_html"><div class="ttname"><a href="../../d4/d3c/classsrsran_1_1interval.html">srsran::interval</a></div><div class="ttdoc">Representation of an interval between two numeric-types with the math representation [start,...</div><div class="ttdef"><b>Definition</b> interval.h:36</div></div>
<div class="ttc" id="aclasssrsran_1_1re__pattern__list_html_a401dec364e6b970042f47fd775bb4139"><div class="ttname"><a href="../../d9/d27/classsrsran_1_1re__pattern__list.html#a401dec364e6b970042f47fd775bb4139">srsran::re_pattern_list::get_inclusion_mask</a></div><div class="ttdeci">void get_inclusion_mask(bounded_bitset&lt; MAX_RB *NRE &gt; &amp;mask, unsigned symbol) const</div><div class="ttdoc">Includes the described resource element pattern list in a resource grid symbol mask.</div><div class="ttdef"><b>Definition</b> re_pattern.cpp:136</div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>lib/phy/support/<a class="el" href="../../d1/d83/resource__grid__mapper__impl_8h_source.html">resource_grid_mapper_impl.h</a></li>
<li>lib/phy/support/<b>resource_grid_mapper_impl.cpp</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
