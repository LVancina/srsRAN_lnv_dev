<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>srsRAN Docs: lib/ofh/compression/avx512_helpers.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">srsRAN Docs
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="../../dir_d760f2ccf13f25eca8b78b31880d9d65.html">ofh</a></li><li class="navelem"><a class="el" href="../../dir_41fc22ec7441721c2ba1196fd9081e7a.html">compression</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">avx512_helpers.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>AVX512 support for OFH Compression algorithms.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;immintrin.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for avx512_helpers.h:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d1c/avx512__helpers_8h__incl.png" border="0" usemap="#alib_2ofh_2compression_2avx512__helpers_8h" alt=""/></div>
<map name="alib_2ofh_2compression_2avx512__helpers_8h" id="alib_2ofh_2compression_2avx512__helpers_8h">
<area shape="rect" title="AVX512 support for OFH Compression algorithms." alt="" coords="5,5,156,45"/>
<area shape="rect" title=" " alt="" coords="31,93,130,119"/>
<area shape="poly" title=" " alt="" coords="83,46,83,79,78,79,78,46"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../da/dcd/avx512__helpers_8h__dep__incl.png" border="0" usemap="#alib_2ofh_2compression_2avx512__helpers_8hdep" alt=""/></div>
<map name="alib_2ofh_2compression_2avx512__helpers_8hdep" id="alib_2ofh_2compression_2avx512__helpers_8hdep">
<area shape="rect" title="AVX512 support for OFH Compression algorithms." alt="" coords="208,5,359,45"/>
<area shape="rect" title=" " alt="" coords="5,181,161,236"/>
<area shape="poly" title=" " alt="" coords="240,55,184,95,140,140,105,183,101,179,136,136,180,91,237,50"/>
<area shape="rect" title=" " alt="" coords="405,181,572,236"/>
<area shape="poly" title=" " alt="" coords="329,50,386,91,433,136,470,179,466,183,429,140,383,95,326,55"/>
<area shape="rect" href="../../d2/d51/packing__utils__avx512_8h_source.html" title=" " alt="" coords="194,93,373,133"/>
<area shape="poly" title=" " alt="" coords="286,59,286,93,281,93,281,59"/>
<area shape="poly" title=" " alt="" coords="232,142,141,184,139,179,229,137"/>
<area shape="poly" title=" " alt="" coords="338,137,432,179,430,184,336,141"/>
<area shape="rect" title=" " alt="" coords="186,189,381,229"/>
<area shape="poly" title=" " alt="" coords="286,147,286,189,281,189,281,147"/>
</map>
</div>
</div>
<p><a href="../../df/d46/avx512__helpers_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="namespaces" name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:d9/def/namespacesrsran" id="r_d9/def/namespacesrsran"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/def/namespacesrsran.html">srsran</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ab96281e7fbdbcab932b9fe0173e0d7f3" id="r_ab96281e7fbdbcab932b9fe0173e0d7f3"><td class="memItemLeft" align="right" valign="top"><a id="ab96281e7fbdbcab932b9fe0173e0d7f3" name="ab96281e7fbdbcab932b9fe0173e0d7f3"></a>
<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">using</a>&#160;</td><td class="memItemRight" valign="bottom"><b>srsran::ofh::mm512::_mm512_comparator</b> = <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> (*)(<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> a, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> b)</td></tr>
<tr class="memdesc:ab96281e7fbdbcab932b9fe0173e0d7f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type of AVX512 intrinsic calculating min or max values between two vectors. <br /></td></tr>
<tr class="separator:ab96281e7fbdbcab932b9fe0173e0d7f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad2eabcd25afaafd26760fe2e28623797" id="r_ad2eabcd25afaafd26760fe2e28623797"><td class="memTemplParams" colspan="2">template&lt;<a class="el" href="#ab96281e7fbdbcab932b9fe0173e0d7f3">_mm512_comparator</a> COMPARE&gt; </td></tr>
<tr class="memitem:ad2eabcd25afaafd26760fe2e28623797"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#ad2eabcd25afaafd26760fe2e28623797">srsran::ofh::mm512::find_abs_min_max_values</a> (<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">v0_epi16</a>, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">v1_epi16</a>, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">v2_epi16</a>)</td></tr>
<tr class="memdesc:ad2eabcd25afaafd26760fe2e28623797"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the maximum (or minimum) 16bit sample in each of the four input resource blocks, returns its absolute value.  <br /></td></tr>
<tr class="separator:ad2eabcd25afaafd26760fe2e28623797"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a896eb6546ff9996a6289e1ac7bf46171" id="r_a896eb6546ff9996a6289e1ac7bf46171"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a896eb6546ff9996a6289e1ac7bf46171">srsran::ofh::mm512::calculate_max_abs</a> (<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">r0_epi16</a>, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">r1_epi16</a>, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">r2_epi16</a>)</td></tr>
<tr class="memdesc:a896eb6546ff9996a6289e1ac7bf46171"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds maximum absolute value across 16bit IQ samples in each of the four input resource blocks passed in three AVX512 registers.  <br /></td></tr>
<tr class="separator:a896eb6546ff9996a6289e1ac7bf46171"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43ee7ca16282ba3bc2a32e8513b397b3" id="r_a43ee7ca16282ba3bc2a32e8513b397b3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a43ee7ca16282ba3bc2a32e8513b397b3">srsran::ofh::mm512::determine_bfp_exponent</a> (<a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">r0_epi16</a>, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">r1_epi16</a>, <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a> <a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">r2_epi16</a>, <a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a> data_width)</td></tr>
<tr class="memdesc:a43ee7ca16282ba3bc2a32e8513b397b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines BFP exponent for each of the four input RBs passed in three AVX512 registers.  <br /></td></tr>
<tr class="separator:a43ee7ca16282ba3bc2a32e8513b397b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>AVX512 support for OFH Compression algorithms. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a896eb6546ff9996a6289e1ac7bf46171" name="a896eb6546ff9996a6289e1ac7bf46171"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a896eb6546ff9996a6289e1ac7bf46171">&#9670;&#160;</a></span>calculate_max_abs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">__m512i srsran::ofh::mm512::calculate_max_abs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a></td>          <td class="paramname"><span class="paramname"><em>r0_epi16</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a></td>          <td class="paramname"><span class="paramname"><em>r1_epi16</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a></td>          <td class="paramname"><span class="paramname"><em>r2_epi16</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Finds maximum absolute value across 16bit IQ samples in each of the four input resource blocks passed in three AVX512 registers. </p>
<p>The content of the three input AVX512 registers is represented in the table below. Here RBx stands for one unique RE (pair of IQ samples, 32 bits long) pertaining to a respective RB: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>r0_epi16:</code>   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB1 RB1   </td><td class="markdownTableBodyNone">RB1 RB1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>r1_epi16:</code>   </td><td class="markdownTableBodyNone">RB1 RB1   </td><td class="markdownTableBodyNone">RB1 RB1   </td><td class="markdownTableBodyNone">RB1 RB1   </td><td class="markdownTableBodyNone">RB1 RB1   </td><td class="markdownTableBodyNone">RB2 RB2   </td><td class="markdownTableBodyNone">RB2 RB2   </td><td class="markdownTableBodyNone">RB2 RB2   </td><td class="markdownTableBodyNone">RB2 RB2    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>r2_epi16:</code>   </td><td class="markdownTableBodyNone">RB2 RB2   </td><td class="markdownTableBodyNone">RB2 RB2   </td><td class="markdownTableBodyNone">RB3 RB3   </td><td class="markdownTableBodyNone">RB3 RB3   </td><td class="markdownTableBodyNone">RB3 RB3   </td><td class="markdownTableBodyNone">RB3 RB3   </td><td class="markdownTableBodyNone">RB3 RB3   </td><td class="markdownTableBodyNone">RB3 RB3   </td></tr>
</table>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">r0_epi16</td><td>AVX512 register storing 16bit IQ pairs of the first and second RBs. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">r1_epi16</td><td>AVX512 register storing 16bit IQ pairs of the second and third RBs. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">r2_epi16</td><td>AVX512 register storing 16bit IQ pairs of the third and fourth RBs. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An AVX512 register storing the result for each of the four RBs in every 128bit lane. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  108</span>{</div>
<div class="line"><span class="lineno">  109</span>  <span class="keyword">const</span> __m512i ONE_EPI16 = _mm512_set1_epi16(1);</div>
<div class="line"><span class="lineno">  110</span> </div>
<div class="line"><span class="lineno">  111</span>  <span class="comment">// Permute input vectors so that the pairwise comparison can be used. The resulting vectors look as follows:</span></div>
<div class="line"><span class="lineno">  112</span>  <span class="comment">// [ RB0 RB0 | RB0 RB0 | RB1 RB1 | RB1 RB1 | RB2 RB2 | RB2 RB2 | RB3 RB3 | RB3 RB3 ]</span></div>
<div class="line"><span class="lineno">  113</span>  <span class="comment">// [ RB0 RB0 | RB0 RB0 | RB1 RB1 | RB1 RB1 | RB2 RB2 | RB2 RB2 | RB3 RB3 | RB3 RB3 ]</span></div>
<div class="line"><span class="lineno">  114</span>  <span class="comment">// [ RB0 RB0 | RB0 RB0 | RB1 RB1 | RB1 RB1 | RB2 RB2 | RB2 RB2 | RB3 RB3 | RB3 RB3 ]</span></div>
<div class="line"><span class="lineno">  115</span>  __m512i v0_epi16 =</div>
<div class="line"><span class="lineno">  116</span>      _mm512_mask_shuffle_i64x2(r0_epi16, 0b11111100, r1_epi16, r2_epi16, (_MM_PERM_ENUM)_MM_SHUFFLE(1, 0, 0, 0));</div>
<div class="line"><span class="lineno">  117</span>  __m512i v1_epi16 =</div>
<div class="line"><span class="lineno">  118</span>      _mm512_mask_shuffle_i64x2(r1_epi16, 0b11000011, r0_epi16, r2_epi16, (_MM_PERM_ENUM)_MM_SHUFFLE(2, 0, 0, 1));</div>
<div class="line"><span class="lineno">  119</span>  __m512i v2_epi16 =</div>
<div class="line"><span class="lineno">  120</span>      _mm512_mask_shuffle_i64x2(r2_epi16, 0b00111111, r0_epi16, r1_epi16, (_MM_PERM_ENUM)_MM_SHUFFLE(0, 3, 3, 2));</div>
<div class="line"><span class="lineno">  121</span> </div>
<div class="line"><span class="lineno">  122</span>  __m512i abs_min_epu16 = find_abs_min_max_values&lt;_mm512_min_epi16&gt;(v0_epi16, v1_epi16, v2_epi16);</div>
<div class="line"><span class="lineno">  123</span>  __m512i abs_max_epu16 = find_abs_min_max_values&lt;_mm512_max_epi16&gt;(v0_epi16, v1_epi16, v2_epi16);</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>  <span class="comment">// Subtract 1 from absolute minimum value.</span></div>
<div class="line"><span class="lineno">  126</span>  abs_min_epu16 = _mm512_subs_epu16(abs_min_epu16, ONE_EPI16);</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>  <span class="keywordflow">return</span> _mm512_max_epu16(abs_min_epu16, abs_max_epu16);</div>
<div class="line"><span class="lineno">  129</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a43ee7ca16282ba3bc2a32e8513b397b3" name="a43ee7ca16282ba3bc2a32e8513b397b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43ee7ca16282ba3bc2a32e8513b397b3">&#9670;&#160;</a></span>determine_bfp_exponent()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">__m512i srsran::ofh::mm512::determine_bfp_exponent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a></td>          <td class="paramname"><span class="paramname"><em>r0_epi16</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a></td>          <td class="paramname"><span class="paramname"><em>r1_epi16</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a></td>          <td class="paramname"><span class="paramname"><em>r2_epi16</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d1d/classunsigned.html">unsigned</a></td>          <td class="paramname"><span class="paramname"><em>data_width</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determines BFP exponent for each of the four input RBs passed in three AVX512 registers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">r0_epi16</td><td>AVX512 register storing 16bit IQ pairs of the first and second RBs. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">r1_epi16</td><td>AVX512 register storing 16bit IQ pairs of the second and third RBs. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">r2_epi16</td><td>AVX512 register storing 16bit IQ pairs of the third and fourth RBs. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_width</td><td>Compressed samples bit width.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Four exponents in the LSB bits of every 128bit lane. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  139</span>{</div>
<div class="line"><span class="lineno">  140</span>  <span class="comment">// Max allowed exponent (account for the extra 16 MSBs and a sign bit counted by _mm512_lzcnt_epi32 intrinsic).</span></div>
<div class="line"><span class="lineno">  141</span>  <span class="keywordtype">unsigned</span> max_lzcnt     = (16 - data_width) + 16 + 1;</div>
<div class="line"><span class="lineno">  142</span>  __m512i  max_exp_epu32 = _mm512_set1_epi32(max_lzcnt);</div>
<div class="line"><span class="lineno">  143</span> </div>
<div class="line"><span class="lineno">  144</span>  <span class="comment">// Calculate maximum absolute values in the four PRBs.</span></div>
<div class="line"><span class="lineno">  145</span>  __m512i max_abs_epu16 = <a class="code hl_function" href="../../dc/daa/ofh_2compression_2avx2__helpers_8h.html#a1877ae3f8653c849ee2f0ba6708d79be">calculate_max_abs</a>(r0_epi16, r1_epi16, r2_epi16);</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>  <span class="comment">// Mask out 16 MSB bits in each 32bit word.</span></div>
<div class="line"><span class="lineno">  148</span>  max_abs_epu16 = _mm512_and_epi32(max_abs_epu16, _mm512_set1_epi32(0x0000ffff));</div>
<div class="line"><span class="lineno">  149</span> </div>
<div class="line"><span class="lineno">  150</span>  <span class="comment">// Compute BFP exponent as a number of leading zeros.</span></div>
<div class="line"><span class="lineno">  151</span>  __m512i lz_count_epi32 = _mm512_lzcnt_epi32(max_abs_epu16);</div>
<div class="line"><span class="lineno">  152</span> </div>
<div class="line"><span class="lineno">  153</span>  <span class="comment">// Subtract with saturation.</span></div>
<div class="line"><span class="lineno">  154</span>  <span class="keywordflow">return</span> _mm512_subs_epu16(max_exp_epu32, lz_count_epi32);</div>
<div class="line"><span class="lineno">  155</span>}</div>
<div class="ttc" id="aofh_2compression_2avx2__helpers_8h_html_a1877ae3f8653c849ee2f0ba6708d79be"><div class="ttname"><a href="../../dc/daa/ofh_2compression_2avx2__helpers_8h.html#a1877ae3f8653c849ee2f0ba6708d79be">srsran::ofh::mm256::calculate_max_abs</a></div><div class="ttdeci">void calculate_max_abs(span&lt; unsigned &gt; max_abs, __m256i rb0_epi16, __m256i rb01_epi16, __m256i rb1_epi16)</div><div class="ttdoc">Finds maximum absolute value across 16bit IQ samples in each of the two input resource blocks passed ...</div><div class="ttdef"><b>Definition</b> avx2_helpers.h:103</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad2eabcd25afaafd26760fe2e28623797" name="ad2eabcd25afaafd26760fe2e28623797"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2eabcd25afaafd26760fe2e28623797">&#9670;&#160;</a></span>find_abs_min_max_values()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;_mm512_comparator COMPARE&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">__m512i srsran::ofh::mm512::find_abs_min_max_values </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a></td>          <td class="paramname"><span class="paramname"><em>v0_epi16</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a></td>          <td class="paramname"><span class="paramname"><em>v1_epi16</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/def/namespacesrsran.html#a58e7c9f2c51a9ad6a0899b46d5315723">__m512i</a></td>          <td class="paramname"><span class="paramname"><em>v2_epi16</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Finds the maximum (or minimum) 16bit sample in each of the four input resource blocks, returns its absolute value. </p>
<p>Finds absolute maximum (or minimum, depending on the comparator passed as the template argument) values for each of the four RBs passed in three AVX512 registers.</p>
<p>AVX512 register bits are evenly divided between four RBs so that IQ samples of each RB occupy one 128bit lane. The following diagram shows the input format. Here RBx stands for one unique RE (a pair of IQ samples, 32 bits long) pertaining to a respective RB: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>v0_epi16:</code>   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB1 RB1   </td><td class="markdownTableBodyNone">RB1 RB1   </td><td class="markdownTableBodyNone">RB2 RB2   </td><td class="markdownTableBodyNone">RB2 RB2   </td><td class="markdownTableBodyNone">RB3 RB3   </td><td class="markdownTableBodyNone">RB3 RB3    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>v1_epi16:</code>   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB1 RB1   </td><td class="markdownTableBodyNone">RB1 RB1   </td><td class="markdownTableBodyNone">RB2 RB2   </td><td class="markdownTableBodyNone">RB2 RB2   </td><td class="markdownTableBodyNone">RB3 RB3   </td><td class="markdownTableBodyNone">RB3 RB3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>v2_epi16:</code>   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB0 RB0   </td><td class="markdownTableBodyNone">RB1 RB1   </td><td class="markdownTableBodyNone">RB1 RB1   </td><td class="markdownTableBodyNone">RB2 RB2   </td><td class="markdownTableBodyNone">RB2 RB2   </td><td class="markdownTableBodyNone">RB3 RB3   </td><td class="markdownTableBodyNone">RB3 RB3   </td></tr>
</table>
<p>The function first performs vertical min/max search across the three registers (comparing 16bit samples), then horizontal min/max across elements in each 128bit lane of the resulting vector. Finally, the function takes the absolute value of the four 16bit samples computed thus far.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">COMPARE</td><td>AVX512 intrinsic used for comparison, either <code>_mm512_min_epi16</code> or <code>_mm512_max_epi16</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v0_epi16</td><td>AVX512 register storing first four IQ pairs of each of the four RB. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v1_epi16</td><td>AVX512 register storing second four IQ pairs of each of the four RB. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2_epi16</td><td>AVX512 register storing last four IQ pairs of each of the four RB.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An AVX512 register storing the result for each of the four RBs in every 128bit lane. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   64</span>{</div>
<div class="line"><span class="lineno">   65</span>  <span class="comment">// Find vertical min/max across every 8 16bit values pertaining to the same PRB.</span></div>
<div class="line"><span class="lineno">   66</span>  __m512i cmp_8val_epi16 = COMPARE(COMPARE(v0_epi16, v1_epi16), v2_epi16);</div>
<div class="line"><span class="lineno">   67</span> </div>
<div class="line"><span class="lineno">   68</span>  <span class="comment">// Swap 64bit words inside 128bit lanes and find 4 min/max values.</span></div>
<div class="line"><span class="lineno">   69</span>  __m512i cmp_8val_swp_epi16 =</div>
<div class="line"><span class="lineno">   70</span>      _mm512_mask_shuffle_epi32(_mm512_set1_epi64(0), 0xffff, cmp_8val_epi16, (_MM_PERM_ENUM)_MM_SHUFFLE(1, 0, 3, 2));</div>
<div class="line"><span class="lineno">   71</span>  __m512i cmp_4val_epi16 = COMPARE(cmp_8val_epi16, cmp_8val_swp_epi16);</div>
<div class="line"><span class="lineno">   72</span> </div>
<div class="line"><span class="lineno">   73</span>  <span class="comment">// Swap 32bit words and find 2 min/max values.</span></div>
<div class="line"><span class="lineno">   74</span>  __m512i cmp_4val_swp_epi16 =</div>
<div class="line"><span class="lineno">   75</span>      _mm512_mask_shuffle_epi32(_mm512_set1_epi64(0), 0xffff, cmp_4val_epi16, (_MM_PERM_ENUM)_MM_SHUFFLE(2, 3, 0, 1));</div>
<div class="line"><span class="lineno">   76</span>  __m512i cmp_2val_epi16 = COMPARE(cmp_4val_epi16, cmp_4val_swp_epi16);</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>  <span class="comment">// Swap 16bit words and find final min/max values for each PRB.</span></div>
<div class="line"><span class="lineno">   79</span>  <span class="keyword">const</span> __m512i shuffle_mask = _mm512_setr_epi64(0x0504070601000302,</div>
<div class="line"><span class="lineno">   80</span>                                                 0x0d0c0f0e09080b0a,</div>
<div class="line"><span class="lineno">   81</span>                                                 0x0504070601000302,</div>
<div class="line"><span class="lineno">   82</span>                                                 0x0d0c0f0e09080b0a,</div>
<div class="line"><span class="lineno">   83</span>                                                 0x0504070601000302,</div>
<div class="line"><span class="lineno">   84</span>                                                 0x0d0c0f0e09080b0a,</div>
<div class="line"><span class="lineno">   85</span>                                                 0x0504070601000302,</div>
<div class="line"><span class="lineno">   86</span>                                                 0x0d0c0f0e09080b0a);</div>
<div class="line"><span class="lineno">   87</span> </div>
<div class="line"><span class="lineno">   88</span>  __m512i cmp_2val_swp_epi16 = _mm512_shuffle_epi8(cmp_2val_epi16, shuffle_mask);</div>
<div class="line"><span class="lineno">   89</span>  <span class="keywordflow">return</span> _mm512_abs_epi16(COMPARE(cmp_2val_epi16, cmp_2val_swp_epi16));</div>
<div class="line"><span class="lineno">   90</span>}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
